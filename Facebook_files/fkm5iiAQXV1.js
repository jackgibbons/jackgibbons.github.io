/*!CK:1159941235!*//*1387322638,178191153*/

if (self.CavalryLogger) { CavalryLogger.start_js(["9gri0"]); }

__d("BlackbirdUpsellConstants",[],function(a,b,c,d,e,f){e.exports={ACTION_UPSELL:"upsell",CLICK_TYPE_DISMISS_PROMO:"dismiss_promo",ACTION_EDUCATE:"educate",CLICK_TYPE_ENABLE_CHAT:"enable_chat",CLICK_TYPE_OPEN_SETTINGS:"open_settings"};});
__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){e.exports={CHAT:"source:chat",MOBILE:"source:mobile",MESSENGER:"source:messenger",EMAIL:"source:email"};});
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){e.exports={TODAY:0,WEEK_AGO:1,CURRENT_YEAR:3,OTHER_YEAR:4,MONTH_AGO:2};});
__d("MessagesViewerSetID",[],function(a,b,c,d,e,f){e.exports={MESSAGES:"messages",MESSAGES_VIEW_ALL_IN_THREAD:"messages:view_all_in_thread"};});
__d("MessagingEvent",[],function(a,b,c,d,e,f){e.exports={UNSUBSCRIBE:"unsubscribe",DELIVERY_RECEIPT:"delivery_receipt",REPORT_SPAM_MESSAGES:"report_spam_messages",DELIVER_FAST_PAST:"deliver_fast_path",DELETE_MESSAGES:"delete_messages",READ_RECEIPT:"read_receipt",SENT_PUSH:"sent_push",READ:"read",CHANGE_MUTE_SETTINGS:"change_mute_settings",ERROR:"error",UNMARK_SPAM:"unmark_spam",UNREAD:"unread",DELIVER_LOG:"deliver_log",DELIVER:"deliver",READ_ALL:"read_all",MESSENGER_STATUS:"messenger_status",TAG:"tag",MORE_THREADS:"more_threads",DELETE:"delete",REPORT_SPAM:"report_spam",SUBSCRIBE:"subscribe"};});
__d("PUWApplications",[],function(a,b,c,d,e,f){e.exports={WEB_FLASH:"web_flash",WEB_ARCHIVE:"web_archive",MOBILE_PMA_ANDROID:"mobile_pma_android",MOBILE_FB4A:"mobile_fb4a",WEB_COMPOSER:"web_composer",WEB_M_TOUCH:"web_m_touch",WEB_M_ZERO:"web_m_zero",MOBILE_PMA_IOS:"mobile_pma_ios",WEB_SIMPLE:"web_simple",MOBILE_FB4IOS_SNAP:"mobile_fb4ios_snap",THIRD_PARTY:"third_party",WEB_M_BASIC:"web_m_basic",WEB_MESSENGER:"web_messenger",MOBILE_FB4IOS:"mobile_fb4ios",WEB_HTML5:"web_html5"};});
__d("PUWMethods",[],function(a,b,c,d,e,f){e.exports={DRAGDROP:"dragdrop",RECENT_PHOTOS:"recent_photos",VAULT:"vault",PHOTOS_OF_YOU:"photos_of_you",FILE_SELECTOR:"file_selector",METHOD_EDITOR:"editor"};});
__d("PUWSteps",[],function(a,b,c,d,e,f){e.exports={CLIENT_FLOW_INCOMPLETE:"client_flow_incomplete",SERVER_UPLOAD_BEGIN:"server_upload_begin",CLIENT_UPLOAD_CANCEL:"client_upload_cancel",CLIENT_SELECT_BEGIN:"client_select_begin",CLIENT_UPLOAD_REMOVE:"client_upload_remove",CLIENT_FLOW_FATAL:"client_flow_fatal",CLIENT_TRANSFER_BATCH_FAIL:"client_transfer_batch_fail",CLIENT_PROCESS_UNAVAILABLE:"client_process_unavailable",CLIENT_PUBLISH_SUCCESS:"client_publish_success",CLIENT_PROCESS_CANCEL:"client_process_cancel",CLIENT_TRANSFER_BATCH_BEGIN:"client_transfer_batch_begin",CLIENT_UPLOAD_FAIL:"client_upload_fail",SERVER_PUBLISH_BEGIN:"server_publish_begin",CLIENT_TRANSFER_BEGIN:"client_transfer_begin",SERVER_PUBLISH_FAIL:"server_publish_fail",CLIENT_PROCESS_BEGIN:"client_process_begin",CLIENT_TRANSFER_BATCH_SUCCESS:"client_transfer_batch_success",CLIENT_FLOW_RETRY:"client_flow_retry",CLIENT_TRANSFER_ENQUEUE:"client_transfer_enqueue",CLIENT_PUBLISH_ENQUEUE:"client_publish_enqueue",CLIENT_TRANSFER_SUCCESS:"client_transfer_success",SERVER_UPLOAD_FAIL:"server_upload_fail",CLIENT_FLOW_CANCEL:"client_flow_cancel",CLIENT_FLOW_GIVEUP:"client_flow_giveup",CLIENT_PROCESS_SUCCESS:"client_process_success",CLIENT_SELECT_CANCEL:"client_select_cancel",CLIENT_SELECT_FAIL:"client_select_fail",CLIENT_PUBLISH_BEGIN:"client_publish_begin",CLIENT_UPLOAD_BEGIN:"client_upload_begin",CLIENT_TRANSFER_CANCEL:"client_transfer_cancel",CLIENT_UPLOAD_SUCCESS:"client_upload_success",CLIENT_FLOW_SUCCESS:"client_flow_success",CLIENT_TRANSFER_BATCH_CANCEL:"client_transfer_batch_cancel",CLIENT_ATTEMPT_FAIL:"client_attempt_fail",CLIENT_FLOW_BEGIN:"client_flow_begin",CLIENT_PROCESS_FAIL:"client_process_fail",SERVER_PUBLISH_SUCCESS:"server_publish_success",SERVER_UPLOAD_SUCCESS:"server_upload_success",CLIENT_SELECT_SUCCESS:"client_select_success",CLIENT_PUBLISH_FAIL:"client_publish_fail",CLIENT_FLOW_POST:"client_flow_post",CLIENT_TRANSFER_FAIL:"client_transfer_fail",SERVER_RECEIVER_BEGIN:"server_receiver_begin",CLIENT_FLOW_FAIL:"client_flow_fail"};});
__d("GenderConst",[],function(a,b,c,d,e,f){var g={UNKNOWN:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11};e.exports=g;});
__d("AsyncLoader",["copyProperties","AsyncRequest","BaseAsyncLoader"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('AsyncRequest'),i=b('BaseAsyncLoader');function j(k,l){this._endpoint=k;this._type=l;}g(j.prototype,i.prototype);j.prototype.send=function(k,l,m,n,o){new h(k).setData({ids:l}).setHandler(n).setErrorHandler(o).setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};e.exports=j;});
__d("ChannelSubdomain",["Cookie","JSLogger"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('JSLogger'),i=h.create('channel'),j=7,k=null;function l(o,p){var q=null,r=m(),s;o--;var t=Math.min(32,j*o);t=Math.max(t,1);var u=false;for(var v=0;v<32;v++){s=(v+p)%t;if(!(r&(1<<s))){u=true;break;}}if(u){k=s;q=k%j;g.set('sub',r|(1<<k));}else{k=-1;q=null;i.error('subdomain_overflow',{slot:k,max:o});}return q;}function m(){var o=g.get('sub')||0;o=parseInt(o,10);return isNaN(o)?0:o;}function n(){if(k!==null&&k>=0){var o=m()&~(1<<k);if(o){g.set('sub',o);}else g.clear('sub');}}e.exports={allocate:l,clear:n};});
__d("ChannelTransport",["copyProperties","bind","AjaxRequest","URI","JSLogger","DocRPC","ChannelConstants","UserAgent","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('bind'),i=b('AjaxRequest'),j=b('URI'),k=b('JSLogger'),l=b('DocRPC'),m=b('ChannelConstants'),n=b('UserAgent'),o=b('setTimeoutAcrossTransitions'),p=k.create('channel');function q(){return (1048576*Math.random()|0).toString(36);}function r(z,aa){var ba=z.subdomain;ba=ba===null?'':(ba+'-');var ca=new j(aa).setDomain(ba+z.host+'.facebook.com').setPort(z.port).setSecure(j().isSecure());return ca;}function s(z){var aa={partition:z.partition,cb:q()};if(z.sticky_token)aa.sticky_token=z.sticky_token;var ba=r(z,'/p').setQueryData(aa);p.log('start_p',{uri:ba.toString()});var ca=new i('GET',ba);if(i.supportsCORS())ca.xhr.withCredentials=true;var da=function(ea){p.log('finish_p',{xhr:ea.toJSON?ea.toJSON():ea});};ca.timeout=z.P_TIMEOUT;ca.onError=ca.onSuccess=da;ca.send();}function t(z,aa,ba){var ca=new Image(),da=0,ea=function(ha){ca.abort();return ha?aa():ba();};ca.onload=function(){p.log('ping_ok',{duration:Date.now()-da});ea(true);};ca.onerror=function(){s(z);ea(false);};var fa=o(ca.onerror,10000);ca.abort=function(){if(fa){clearTimeout(fa);fa=null;}ca.onload=ca.onerror=null;};var ga={partition:z.partition,cb:q()};if(z.sticky_token)ga.sticky_token=z.sticky_token;da=Date.now();ca.src=r(z,'/ping').setQueryData(ga);return ca;}function u(z,aa,ba,ca){var da=new Date(),ea=-1;if(z.userActive>0){ea=(da-z.userActive)/1000|0;if(ea<0)p.warn('idle_regression',{idleTime:ea,now:da.getTime(),userActive:z.userActive});}var fa={channel:z.user_channel,seq:z.seq,partition:z.partition,clientid:z.sessionID,cb:q(),idle:ea,cap:0};if(z.sticky_token)fa.sticky_token=z.sticky_token;if(z.userActive>0&&ea<60)fa.state='active';if(z.streamingCapable){fa.mode='stream';fa.format='json';}if(z.profile)fa.profile=z.profile;if(z.webrtcSupport&&(n.chrome()>=24||n.firefox()>=22))fa.cap=m.CAPABILITY_VOIP;var ga=r(z,'/pull').setQueryData(fa),ha=new i('GET',ga);if(i.supportsCORS())ha.xhr.withCredentials=true;ha.timeout=z.streamingCapable?z.STREAMING_TIMEOUT:z.LONGPOLL_TIMEOUT;ha.onJSON=aa;ha.onSuccess=ba;ha.onError=function(){var ia=(this.status==12002&&this._time>=z.MIN_12002_TIMEOUT)||(this.status==504&&this._time>=z.MIN_504_TIMEOUT),ja=ia?ba:ca;return ja&&ja.apply(this,arguments);};ha.send();z.inStreaming=z.streamingCapable;return ha;}function v(z){this.manager=z;(this.init&&this.init());}function w(z){v.apply(this,arguments);}g(w.prototype,{logName:'CORS',enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='init')o(h(this.manager,'exitState',{status:m.OK,stateId:aa.stateId}),3000);if(!/pull|ping/.test(z))return;var ba=this.manager;if(z=='ping'){this._request=t(aa,h(ba,'exitState',{status:m.OK,stateId:aa.stateId}),h(ba,'exitState',{status:m.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,h(ba,'_processTransportData',aa.stateId),h(ba,'exitState',{status:m.OK,stateId:aa.stateId}),h(ba,'exitState',{status:m.ERROR,stateId:aa.stateId}));}});function x(z){p.log('iframe_init_constructor');v.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);l.publish(this,'outerTransport');}g(x.prototype,{logName:'iframe',_initIframe:function(z){p.log('iframe_init_start');window.onchanneliframeready=function(){p.log('iframe_resources');return z.resources;};window.onchanneliframeloaded=function(){p.log('iframe_loaded');};if(z){this._iframeURI=r(z,z.path);if(z.bustIframe){var aa={partition:z.partition,cb:q()};this._iframeURI.setQueryData(aa);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);p.log('iframe_uri_set');}catch(ba){p.error('iframe_uri_set_error',ba);this.exitState({status:m.ERROR,stateId:z.stateId},ba+'');}},enterState:function(z,aa){if(z=='init'){this._initIframe(aa);}else if(/idle|ping|pull/.test(z)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(z!='idle')this.exitState({status:m.ERROR,stateId:aa.stateId},'iframe not yet loaded');}else if(z=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(z){if(this.manager.state=='init'&&z.status==m.OK)this._iframeProxy=l.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function y(){this.init=this.init.bind(this);v.apply(this,arguments);}g(y.prototype,{logName:'iframe(inner)',init:function(){l.publish(this,'innerTransport');try{var aa=l.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);g(this,aa);this.exitState({status:m.OK,stateId:1e+06});}catch(z){p.error('iframe_inner_init_error',z);}},enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='ping'){this._request=t(aa,h(this,'exitState',{status:m.OK,stateId:aa.stateId}),h(this,'exitState',{status:m.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,h(this,'_processTransportData',aa.stateId),h(this,'exitState',{status:m.OK,stateId:aa.stateId}),h(this,'exitState',{status:m.ERROR,stateId:aa.stateId}));}});e.exports={getURI:r,Transport:v,CORSTransport:w,IframeTransport:x,IframeInnerTransport:y};});
__d("Dcode",[],function(a,b,c,d,e,f){var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;});
__d("PresenceCookieManager",["Cookie","CurrentUser","Dcode","ErrorUtils","JSLogger","PresenceInitialData","PresenceUtil","URI"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('CurrentUser'),i=b('Dcode'),j=b('ErrorUtils'),k=b('JSLogger'),l=b('PresenceInitialData'),m=b('PresenceUtil'),n=b('URI'),o=l.cookieVersion,p=l.dictEncode,q='presence',r={},s=null,t=null,u=k.create('presence_cookie');function v(){try{var z=g.get(q);if(s!==z){s=z;t=null;if(z&&z.charAt(0)=='E')z=i.decode(z.substring(1));if(z)t=JSON.parse(z);}if(t&&(!t.user||t.user===h.getID()))return t;}catch(y){u.warn('getcookie_error');}return null;}function w(){return parseInt(Date.now()/1000,10);}var x={register:function(y,z){r[y]=z;},store:function(){var y=v();if(y&&y.v&&o<y.v)return;var z={v:o,time:w(),user:h.getID()};for(var aa in r)z[aa]=j.applyWithGuard(r[aa],r,[y&&y[aa]],function(ea){ea.presence_subcookie=aa;});var ba=JSON.stringify(z);if(p)ba='E'+i.encode(ba);if(m.hasUserCookie()){var ca=ba.length;if(ca>1024)u.warn('big_cookie',ca);var da=n.getRequestURI(false).isSecure()&&!!g.get('csm');g.set(q,ba,null,null,da);}},clear:function(){g.clear(q);},getSubCookie:function(y){var z=v();if(!z)return null;return z[y];}};e.exports=x;});
__d("PresenceState",["Arbiter","ErrorUtils","JSLogger","PresenceCookieManager","copyProperties","debounceAcrossTransitions","setIntervalAcrossTransitions","PresenceInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ErrorUtils'),i=b('JSLogger'),j=b('PresenceCookieManager'),k=b('copyProperties'),l=b('debounceAcrossTransitions'),m=b('setIntervalAcrossTransitions'),n=b('PresenceInitialData'),o=n.cookiePollInterval||2000,p=[],q=[],r=null,s=null,t=0,u=null,v=0,w=['sb2','t2','lm2','uct2','tr','tw','at','wml'],x=i.create('presence_state');function y(){return j.getSubCookie('state');}function z(){t=Date.now();j.store();da(s);}var aa=l(z,0);function ba(ia){if(typeof ia=='undefined'||isNaN(ia)||ia==Number.POSITIVE_INFINITY||ia==Number.NEGATIVE_INFINITY)ia=0;return ia;}function ca(ia){var ja={};if(ia){w.forEach(function(ma){ja[ma]=ia[ma];});if(t<ia.ut)x.error('new_cookie',{cookie_time:ia.ut,local_time:t});}ja.ut=t;for(var ka=0,la=p.length;ka<la;ka++)h.applyWithGuard(p[ka],null,[ja]);s=ja;return s;}function da(ia){v++;t=ba(ia.ut);if(!r)r=m(ga,o);s=ia;if(u===null)u=ia;for(var ja=0,ka=q.length;ja<ka;ja++)h.applyWithGuard(q[ja],null,[ia]);v--;}function ea(ia){if(ia&&ia.ut)if(t<ia.ut){return true;}else if(ia.ut<t)x.error('old_cookie',{cookie_time:ia.ut,local_time:t});return false;}function fa(){var ia=y();if(ea(ia))s=ia;return s;}function ga(){var ia=y();if(ea(ia))da(ia);}j.register('state',ca);g.subscribe(i.DUMP_EVENT,function(ia,ja){ja.presence_state={initial:k({},u),state:k({},s),update_time:t,sync_paused:v,poll_time:o};});(function(){var ia=fa();if(ia){da(ia);}else{x.debug('no_cookie_initial');da(ca());return;}})();var ha={doSync:function(ia){if(v)return;if(ia){z();}else aa();},registerStateStorer:function(ia){p.push(ia);},registerStateLoader:function(ia){q.push(ia);},get:function(){return fa();},getInitial:function(){return u;},verifyNumber:ba};e.exports=ha;});
__d("ChannelManager",["AjaxRequest","Arbiter","AsyncRequest","ChannelConstants","ChannelInitialData","ChannelSubdomain","ChannelTransport","ChatVisibility","DTSG","Env","Event","FBAjaxRequest","JSLogger","MovingStat","PresenceCookieManager","PresenceState","PresenceUtil","Run","SystemEvents","URI","UserActivity","copyProperties","createArrayFrom","setIntervalAcrossTransitions","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('AjaxRequest'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('ChannelConstants'),k=b('ChannelInitialData'),l=b('ChannelSubdomain'),m=b('ChannelTransport'),n=b('ChatVisibility'),o=b('DTSG'),p=b('Env'),q=b('Event'),r=b('FBAjaxRequest'),s=b('JSLogger'),t=b('MovingStat'),u=b('PresenceCookieManager'),v=b('PresenceState'),w=b('PresenceUtil'),x=b('Run'),y=b('SystemEvents'),z=b('URI'),aa=b('UserActivity'),ba=b('copyProperties'),ca=b('createArrayFrom'),da=b('setIntervalAcrossTransitions'),ea=b('setTimeoutAcrossTransitions'),fa,ga=s.create('channel'),ha=null;function ia(ta){ha=ta;}var ja={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ka={userActive:n.isOnline()?Date.now():0,sessionID:(Math.random()*2147483648|0).toString(16),streamingCapable:false,inStreaming:false,LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:3000,STREAMING_EXIT_STATE_ON_CONTINUE:false},la=1,ma={},na=0;function oa(){return i.lastSuccessTime?Math.round((Date.now()-i.lastSuccessTime)/1000):-1;}function pa(){var ta={};if(fa.getConfig('host'))ta[fa.getConfig('user_channel')]=fa.getConfig('seq',0);return ta;}function qa(){var ta=Date.now(),ua=Date.now(),va={total:0},wa='idle',xa=false;y.subscribe([y.USER,y.ONLINE,y.TIME_TRAVEL],function(ab,bb){sa(true);ua=null;fa.lastPullTime=Date.now();var cb;switch(ab){case y.USER:cb=y.isPageOwner()?j.SYS_OWNER:j.SYS_NONOWNER;break;case y.ONLINE:cb=bb?j.SYS_ONLINE:j.SYS_OFFLINE;break;case y.TIME_TRAVEL:cb=j.SYS_TIMETRAVEL;break;}fa.exitState({status:cb,stateId:la});});var ya=function(ab,bb){var cb=Date.now(),db;if(bb){ta=cb;db=bb.nextState||bb.state;}else db=wa;y.checkTimeTravel();if(ua){var eb=Math.round((cb-ua)/1000);if(eb>0){va[wa]=(va[wa]||0)+eb;va.total+=eb;}}wa=db;ua=cb;if(!ab){va.lastSuccessTime=oa();va.online=y.isOnline();ga.log('rollup',va);}};h.subscribe(j.ON_ENTER_STATE,ya);da(ya,60000);h.subscribe(s.DUMP_EVENT,function(ab,bb){bb.channelRollup=va;});var za=function(){if(fa.isShutdown()||fa.shouldIdle())return;y.checkTimeTravel();var ab=Date.now()-(fa.lastPullTime||p.start);if(!xa&&ab>ka.STALL_THRESHOLD){var bb=oa();ga.error('stall',{lastSuccessTime:bb,rollupState:wa});xa=true;}var cb=Date.now()-ta;if(fa.state=='pull'&&cb>ka.JUMPSTART_THRESHOLD){ta=null;ga.warn('jumpstart',{state:fa.state,dormant:cb});fa.enterState('init');}};da(za,10000);}function ra(){var ta=Date.now(),ua=1;function va(){ea(va,ua*1000);var ab=fa.state;if(ab=='idle'&&fa.shouldIdle())return;ga.bump('conn_t',ua);if(ab=='pull')ga.bump('conn_t_pull',ua);}va();var wa=[15,30,60,120,240],xa=false,ya=false;function za(ab){ea(function(){ga.rate('pullenter_'+ab,xa);ga.rate('pullexit_'+ab,ya);},ab*1000);}while(wa.length)za(wa.shift());h.subscribe(j.ON_ENTER_STATE,function(ab,bb){if(bb.state=='pull')xa=true;ta=Date.now();});h.subscribe(j.ON_EXIT_STATE,function(ab,bb){if(bb.state!='pull'||!ta)return;var cb='other';if(bb.status==j.OK){ya=true;cb='ok';}else if(bb.xhr&&bb.xhr.errorType){cb=/ar:(\w+)/.test(bb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(bb.status))return;var db=(Date.now()-ta)/1000;if(db<0){return;}else if(db>3600)db=3600;ga.bump('conn_num');ga.bump('conn_exit',db);ga.bump('conn_num_'+cb);ga.bump('conn_exit_'+cb,db);});}function sa(ta){if(ta){na=0;ma={};}else na++;}fa={state:'idle',nextState:null,lastPullTime:Date.now(),heartbeats:[],setTestCallback:ia,init:function(ta){this.init=function(){};if(typeof(aa)!='undefined'){aa.subscribe(function(){if(n.isOnline())ka.userActive=Date.now();}.bind(this));}else ga.error('user_activity_undefined');u.register('ch',pa);var ua=this.getConfig('max_conn',2),va=Math.floor(Math.random()*32);ka.subdomain=l.allocate(ua,va);if(typeof window.onpageshow!='undefined'){q.listen(window,'pagehide',l.clear);}else x.onUnload(l.clear);this._transportRate=new t(30000);var wa=(g.supportsCORS()&&!ka.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new m[wa](this);if(ta)this.enterState.apply(this,arguments);h.subscribe(s.DUMP_EVENT,function(event,ya){ya.transportRate=this._transportRate.tally();ya.transportType=wa;ya.transportVersion=2;}.bind(this));qa();ra();if(fa.getConfig('tryStreaming')&&fa.getConfig('host')&&g.supportsCORS()&&!ka.forceIframe){var xa=ka.MIN_INIT_PROBE_DELAY+Math.random()*ka.INIT_PROBE_DELAY_RANDOMIZE_RANGE;ea(this._probeTest,xa);}},configure:function(){var ta=ca(arguments);ga.log('configure',ta);ta.forEach(ba.bind(null,ka));h.inform(j.ON_CONFIG,this);},getConfig:function(ta,ua){return ta in ka?ka[ta]:ua;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(y.isPageOwner()&&y.isOnline());},_sendIframeError:function(ta){var ua=new i().setURI('/ajax/presence/reconnect.php').setData({reason:ta,fb_dtsg:o.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);ua.specifiesWriteRequiredParams()&&ua.send();},_getDelay:function(){var ta=Math.min(ka.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,na-1)),ka.MAX_RETRY_INTERVAL);return Math.floor(ta*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)ga.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(ta){this._inEnterState=false;throw ta;}},_enterState:function(ta){var ua=0,va=ca(arguments);if(this.isShutdown())return;if(ta!='idle!'&&this.shouldIdle())return;la++;ka.stateId=la;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(ta)){var wa=this._transportRate.tally().timeAverage,xa=fa.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(wa>=xa){if(!this._throttled){this._throttled=true;ga.warn('throttled');}ga.bump('throttle');ua=1000/xa;}}else if(!(/#$/.test(ta)))ua=this._getDelay();ta=ta.replace(/\W*$/,'');if(!ja[ta])throw new Error('invalid state:'+ta);var ya;if(ua<=0){ya={state:ta};this._transportRate.add(1);this.state=ta;var za=this['_enter_'+this.state];if(za){va.shift();za.apply(this,va);}if(/init|idle|pull|ping/.test(this.state)){if(ka.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];this.transport.enterState(this.state,ka);if(this.state=='ping'){ya.url=m.getURI(ka).toString();ya.port=ka.port||'undefined';}}}else{this.state='idle';this.nextState=ta;ya={state:this.state,delay:ua,nextState:ta};va[0]=ta+'#';this._deferredTransition=ea((function(){this._deferredTransition=null;this.enterState.apply(this,va);}).bind(this),ua);}if(/pull/.test(ta)){ya.client_id=ka.sessionID;ya.streaming=ka.inStreaming;}ga.log('enter_'+this.state,ya);h.inform(j.ON_ENTER_STATE,ya);},exitState:function(ta,ua){var va=ta.stateId,wa=ta.status;if(this.isShutdown()||va<la)return;var xa=ca(arguments),ya=this.state;xa[0]=ta.status;var za={state:ya,status:wa};if(/pull/.test(ya)){za.client_id=ka.sessionID;za.streaming=ka.inStreaming;}if(/ping/.test(ya)&&wa!=j.OK)za.url=m.getURI(ka).toString();if(this.nextState)za.nextState=this.nextState;if(ua&&ua.errorType){za.xhr=ua.toJSON?ua.toJSON():ua;delete za.xhr.json;}if(ua&&ua.json){if(ua.json.t)za.t=ua.json.t;if(ua.json.reason)za.reason=ua.json.reason;if(ua.json.seq)za.seq=ua.json.seq;}ga.log('exit_'+ya,za);h.inform(j.ON_EXIT_STATE,za);var ab=this['_exit_'+ya];if(ab)wa=ab.apply(this,xa)||wa;if(wa!=j.OK){sa();ma[ya]=(ma[ya]||0)+1;}var bb=ja[this.nextState||ya][wa]||ja._all[wa],cb=bb&&bb.replace(/!*$/,'');if(!cb){ga.error('terminal_transition',za);this._shutdownHint=j.HINT_INVALID_STATE;bb='shutdown!';}this._lastState=ya;this._lastStatus=wa;this.enterState(bb);},_processTransportData:function(ta,ua){var va=ua.json,wa=va.t;if('s' in va){va.seq=va.s;delete va.s;}var xa=ka.seq;if('seq' in va){ka.seq=va.seq;v.doSync();}switch(wa){case 'continue':if(ka.inStreaming&&this.heartbeats.length<1){ka.streamingCapable=false;ga.log('switch_to_longpoll');ea(this._probeTest,ka.PROBE_DELAY);}sa(true);if(!ka.inStreaming||ka.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:j.OK,stateId:ta});break;case 'refresh':case 'refreshDelay':this.exitState({status:'refresh_'+(va.reason||0),stateId:ta},ua);break;case 'fullReload':u.clear();ga.log('invalid_history');h.inform(j.ON_INVALID_HISTORY);this.exitState({status:j.ERROR_MISSING,stateId:ta},ua);break;case 'msg':var ya,za,ab,bb;sa(true);za=va.ms;ab=ka.seq-za.length;for(ya=0;ya<za.length;ya++,ab++)if(ab>=xa){bb=za[ya];if(bb.type){if(bb.type==='messaging'&&bb.message){var cb=bb.unread_counts&&bb.unread_counts.inbox;ga.debug('message',{type:'messaging',inbox_unread:cb,tid:bb.message.tid,mid:bb.message.mid});}else if(bb.type==='m_messaging'){ga.debug('message',{type:'m_messaging',tid:bb.tid,mid:bb.uuid});}else ga.debug('message',{type:bb.type});h.inform(j.getArbiterType(bb.type),{obj:bb});}}else ga.warn('seq_regression',{seq:ab,last_seq:xa,messages:za.length});break;case 'heartbeat':if(ka.inStreaming){var db=Date.now();if(this.heartbeats.length>0){var eb=db-this.heartbeats[this.heartbeats.length-1];ga.log('heartbeat_interval',{client_id:ka.sessionID,interval:eb});}this.heartbeats.push(db);}break;default:ga.error('unknown_msg_type',{type:wa});break;}},_enter_init:function(){if(ma.init>=fa.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:j.ERROR_MAX,stateId:la}),0);this._initTimer=ea(this.exitState.bind(this,{status:j.ERROR,stateId:la},'timeout'),ka.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(ta){var ua=la;if(!w.hasUserCookie()){ga.warn('no_user_cookie');setTimeout(function(){fa._shutdownHint=j.HINT_AUTH;fa.exitState({status:j.ERROR_SHUTDOWN,stateId:ua});},0);return;}var va={reason:ta,fb_dtsg:o.getToken()};if(p.fb_isb)va.fb_isb=p.fb_isb;if(ha)ha(va);var wa=new r('GET','/ajax/presence/reconnect.php',va);wa.onSuccess=(function(){fa.configure(wa.json);u.store();this.exitState({status:j.OK,stateId:ua});}).bind(this);wa.onError=(function(){var xa=wa.json&&wa.json.error;if(wa.errorType==g.TRANSPORT_ERROR||wa.errorType==g.PROXY_ERROR)this._shutdownHint=j.HINT_CONN;if(xa&&xa==1356007){this._shutdownHint=j.HINT_MAINT;}else if(xa==1357001||xa==1357004||xa==1348009){this._shutdownHint=j.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?j.ERROR_SHUTDOWN:j.ERROR,stateId:ua},wa);}).bind(this);wa.send();},_enter_shutdown:function(){h.inform(j.ON_SHUTDOWN,{reason:this._shutdownHint});},_exit_init:function(ta){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(ta==j.ERROR_MAX)this._sendIframeError(j.reason_IFrameLoadGiveUp);},_exit_pull:function(ta){if(ta==j.OK)this.lastPullTime=Date.now();},_exit_ping:function(ta){if(ta==j.OK){var ua=Date.now()-(this.lastPullTime||p.start);if(ua>ka.STALL_THRESHOLD)return j.ERROR_STALE;}},_probeTest:function(){ka.streamingCapable=false;var ta=[],ua={mode:'stream',format:'json'};if(ka.sticky_token)ua.sticky_token=ka.sticky_token;var va=new z('/probe').setDomain(ka.host+'.facebook.com').setPort(ka.port).setSecure(z().isSecure()).setQueryData(ua),wa=new g('GET',va);wa.onJSON=function(xa,ya){if(xa&&xa.json&&xa.json.t==='heartbeat'){ta.push(Date.now());if(ta.length>=2){var za=ta[1]-ta[0];if(za>=ka.PROBE_HEARTBEATS_INTERVAL_LOW&&za<=ka.PROBE_HEARTBEATS_INTERVAL_HIGH){ka.streamingCapable=true;ga.log('switch_to_streaming');}ga.log('probe_ok',{time:za});}}};wa.onSuccess=function(xa){if(ta.length!=2){ka.streamingCapable=false;ga.error('probe_error',{error:'beats.length = '+ta.length});}};wa.onError=function(xa){ka.streamingCapable=false;ga.error('probe_error',xa);};ga.log('probe_request');wa.send();}};e.exports=fa;if(k.channelConfig){fa.configure(k.channelConfig);if(/shutdown/.test(k.state))fa._shutdownHint=j[k.reason];fa.init(k.state,k.reason);}});
__d("ChannelConnection",["Arbiter","copyProperties","ChatConfig","Run","SystemEvents","ChannelConstants","ChannelManager","JSLogger","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('ChatConfig'),j=b('Run'),k=b('SystemEvents'),l=b('ChannelConstants'),m=b('ChannelManager'),n=b('JSLogger'),o=b('setTimeoutAcrossTransitions'),p=n.create('channel_connection'),q=null,r=null,s=null,t=null,u=0,v=h(new g(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});function w(){if(r){clearTimeout(r);r=null;}}function x(){w();p.log('unmute_warning');v.inform(v.UNMUTE_WARNING);}function y(ca){w();r=o(x,ca);p.log('mute_warning',{time:ca});v.inform(v.MUTE_WARNING);}function z(){if(s){clearTimeout(s);s=null;}}function aa(ca,da){z();if(ca===l.ON_ENTER_STATE&&(da.nextState||da.state)==='pull'){if(t!==v.CONNECTED){p.log('connected');var ea=!t;t=v.CONNECTED;u=0;v.inform(v.CONNECTED,{init:ea});}}else if(ca===l.ON_ENTER_STATE&&((da.nextState||da.state)==='ping'||(!da.nextState&&da.state==='idle'))){s=o(function(){var fa=null;if(!(da.state==='idle'&&!da.nextState))fa=(da.delay||0);p.log('reconnecting',{delay:fa});if(v.disconnected())p.log('reconnecting_ui',{delay:fa});t=v.RECONNECTING;(da.state==='idle')&&u++;if(u>1){v.inform(v.RECONNECTING,fa);}else if(!da.nextState&&da.state==='idle')aa(ca,da);},500);}else if(ca===l.ON_SHUTDOWN){p.log('shutdown',{reason:da.reason});t=v.SHUTDOWN;u=0;v.inform(v.SHUTDOWN,da.reason);}}function ba(ca){if(m.state==='ping'||m.isShutdown())return;p.log('reconnect',{now:ca});v.inform(v.RECONNECTING,0);if(!!ca){if(q!==null){clearTimeout(q);q=null;}m.enterState('ping!');}else if(!q)q=o(function(){m.enterState('ping!');q=null;},i.get('channel_manual_reconnect_defer_msec'));}if(m.isShutdown()){aa(l.ON_SHUTDOWN,m._shutdownHint);}else aa(l.ON_ENTER_STATE,{state:m.state,nextState:m.nextState,delay:0});g.subscribe([l.ON_ENTER_STATE,l.ON_SHUTDOWN],aa);k.subscribe(k.TIME_TRAVEL,function(){ba();y(i.get('mute_warning_time_msec'));});j.onBeforeUnload(z,false);h(v,{disconnected:function(){return t===v.SHUTDOWN||(t===v.RECONNECTING&&!r&&u>1);},isShutdown:function(){return t===v.SHUTDOWN;},reconnect:ba,unmuteWarning:x});e.exports=v;});
__d("BlackbirdUpsell",["Event","Arbiter","AsyncRequest","LegacyContextualDialog","DOM","LayerDestroyOnHide","LayerHideOnTransition","PresencePrivacy","copyProperties","BlackbirdUpsellConfig","BlackbirdUpsellConstants","BlackbirdUpsellTemplates"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('LegacyContextualDialog'),k=b('DOM'),l=b('LayerDestroyOnHide'),m=b('LayerHideOnTransition'),n=b('PresencePrivacy'),o=b('copyProperties'),p=b('BlackbirdUpsellConfig'),q=b('BlackbirdUpsellConstants'),r=b('BlackbirdUpsellTemplates'),s='/ajax/chat/blackbird/update_clicks.php',t='/ajax/chat/blackbird/update_impressions.php',u='/ajax/chat/blackbird/dismiss.php',v=235,w=null,x=null,y=false,z=false;function aa(){}o(aa,{shouldShow:function(){if(this._dialogDismissed)return false;if(this.isEducation()){return !p.EducationDismissed&&p.EducationImpressions<p.EducationImpressionLimit;}else return !!p.UpsellGK&&!p.UpsellDismissed&&p.UpsellImpressions<p.UpsellImpressionLimit&&p.FriendCount>=p.UpsellMinFriendCount;},isEducation:function(){return p.TimeOffline<=p.EducationTimeOfflineThresdhold;},getOfflineContent:function(){if(this.isEducation()){return this._getEducationContent();}else return this._getUpsellContent();},_getEducationContent:function(){ga();var ka=r[':fb:chat:blackbird:offline-educate'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ja(q.CLICK_TYPE_OPEN_SETTINGS);da();});return ka.getRoot();},_getUpsellContent:function(){fa();var ka=r[':fb:chat:blackbird:upsell'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ia(q.CLICK_TYPE_OPEN_SETTINGS);ca();});var ma=ka.getNode('enableChatButton');g.listen(ma,'click',function(){ia(q.CLICK_TYPE_ENABLE_CHAT);ca();});return ka.getRoot();},getBlackbirdContent:function(ka){ga();switch(ka){case n.ONLINE:return r[':fb:chat:blackbird:most-friends-educate'].build().getRoot();case n.OFFLINE:return r[':fb:chat:blackbird:some-friends-educate'].build().getRoot();}},showOfflineDialog:function(ka){this.showDialog(ka,this.getOfflineContent.bind(this));},showBlackbirdDialog:function(ka,la){this.showDialog(ka,this.getBlackbirdContent.bind(null,la));},showDialog:function(ka,la){!w&&this._constructDialog();k.setContent(x,la());w.setContext(ka);w.show();},hide:function(){if(w&&w.isShown())w.hide();},dismiss:function(){this.hide();if(this.isEducation()){da();}else ca();},registerDismissClick:function(){if(this.isEducation()){ja(q.CLICK_TYPE_DISMISS_PROMO);}else ia(q.CLICK_TYPE_DISMISS_PROMO);},isVisible:function(){return z&&!y;},_constructDialog:function(){var ka=r[':fb:chat:blackbird:dialog-frame'].build();x=ka.getNode('dialogContent');w=new j();w.init(ka.getRoot());w.setPosition('above').setWidth(v).setFixed(true).disableBehavior(l).disableBehavior(m);g.listen(ka.getNode('dialogCloseButton'),'click',this.dismiss.bind(this));g.listen(ka.getNode('dialogCloseButton'),'click',this.registerDismissClick.bind(this));}});function ba(ka,la){if(!y&&z){y=true;n.inform('privacy-user-presence-changed');var ma=new i(u);ma.setData({source:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){y=false;});ma.send();}}function ca(){ba(q.ACTION_UPSELL,p.UpsellImpressions);}function da(){ba(q.ACTION_EDUCATE,p.EducationImpressions);}function ea(ka,la){if(!z){z=true;var ma=new i(t);ma.setData({action:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){z=false;});ma.send();}}function fa(){ea(q.ACTION_UPSELL,p.UpsellImpressions);}function ga(){ea(q.ACTION_EDUCATE,p.EducationImpressions);}function ha(ka,la,ma,na){var oa=new i(s);oa.setData({action:ka,impressions:ma,source:la,time_offline:na});oa.send();}function ia(ka){ha(ka,q.ACTION_UPSELL,p.UpsellImpressions,p.TimeOffline);}function ja(ka){ha(ka,q.ACTION_EDUCATE,p.EducateImpressions,p.TimeOffline);}h.subscribe('chat/advanced-settings-dialog-opened',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-online',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-offline',aa.dismiss.bind(aa));e.exports=aa;});
__d("ChatTypeaheadConstants",[],function(a,b,c,d,e,f){var g={USER_TYPE:'user',THREAD_TYPE:'thread',FRIEND_TYPE:'friend',NON_FRIEND_TYPE:'non_friend',FB4C_TYPE:'fb4c',HEADER_TYPE:'header'};e.exports=g;});
__d("ChatContexts",[],function(a,b,c,d,e,f){var g={};function h(k){var l=k?k.subtext:'';return l;}function i(k,l){g[k]=l;}var j={get:function(k){if(k in g){return g[k];}else return null;},update:function(k){for(var l in k)i(l,k[l]);},getShortDisplay:function(k){return h(j.get(k));}};e.exports=j;});
__d("LastMobileActiveTimes",["ServerTime","tx"],function(a,b,c,d,e,f){var g=b('ServerTime'),h=b('tx'),i={};function j(n){if(!n||n<0)return '';var o=(g.get()/1000)-n,p=Math.floor(o/60),q=Math.floor(p/60),r=Math.floor(q/24);if(p<=1){return h._("{count}m",{count:1});}else if(p<60){return h._("{count}m",{count:p});}else if(q<24){return h._("{count}h",{count:q});}else if(r<3){return h._("{count}d",{count:r});}else return '';}function k(n,o){i[n]=o;}function l(n){if(n in i){return i[n];}else return 0;}var m={update:function(n){for(var o in n)k(o,n[o]);},getShortDisplay:function(n){return j(l(n));}};e.exports=m;});
__d("TypingDetector",["ArbiterMixin","Event","Input","Run","copyProperties","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('Event'),i=b('Input'),j=b('Run'),k=b('copyProperties'),l=b('createObjectFrom'),m=b('emptyFunction');function n(o){this._input=o;this._ignoreKeys={};}n.INACTIVE=0;n.TYPING=1;n.QUITTING=2;k(n.prototype,g,{_timeout:7000,_currentState:n.INACTIVE,init:function(){this.init=m;this.reset();h.listen(this._input,'keyup',this._update.bind(this));j.onUnload(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=n.INACTIVE;},setIgnoreKeys:function(o){this._ignoreKeys=l(o);},_onunload:function(){if(this._currentState==n.TYPING)this._transition(n.QUITTING);},_update:function(event){var o=h.getKeyCode(event),p=this._currentState;if(!this._ignoreKeys[o])if(i.getValue(this._input).trim().length===0){if(p==n.TYPING)this._transition(n.INACTIVE);}else if(p==n.TYPING){this._recordKeystroke();}else if(p==n.INACTIVE){this._transition(n.TYPING);this._recordKeystroke();}},_transition:function(o){this.reset();this._currentState=o;this.inform('change',o);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=setTimeout(this._checkTyping.bind(this),this._timeout);},_checkTyping:function(){var o=this._lastKeystrokeTime+this._timeout,p=Date.now();if(p>o){this._transition(n.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=setTimeout(this._checkTyping.bind(this),o-p+10);}}});e.exports=n;});
__d("ChatImpressionLogger",["AvailableList","AsyncSignal","ChatConfig","ChatVisibility","Poller"],function(a,b,c,d,e,f){var g=b('AvailableList'),h=b('AsyncSignal'),i=b('ChatConfig'),j=b('ChatVisibility'),k=b('Poller'),l=null,m=null,n={init:function(o){l=o;var p=i.get('chat_impression_logging_periodical',0);if(p){var q=i.get('periodical_impression_logging_config.interval');m=new k({interval:q,setupRequest:this.logImps.bind(this),clearOnQuicklingEvents:false});}this.init=function(){};},logImps:function(o){if(!j.isOnline())return;var p={source:'periodical_imps'},q=l.getCachedSortedList(),r=[];for(var s=0;s<q.length;s++)r[s]=g.get(q[s]);p.sorted_list=q.toString();p.list_availability=r.toString();o.setURI('/ajax/chat/imps_logging.php').setData(p);},getOrderedList:function(){return l;},logImpressions:function(o){var p=[],q=[];if(i.get('chat_impression_logging_with_click')){p=l.getCachedSortedList();for(var r=0;r<p.length;r++)q[r]=g.get(p[r]);}o.sorted_list=p.toString();o.list_availability=q.toString();new h('/ajax/chat/ct.php',o).send();}};e.exports=n;});
__d("ChatBehavior",["Arbiter","AvailableList","AvailableListConstants","ChatConfig","copyProperties","MercuryConstants","ChatSidebarCalloutData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('ChatConfig'),k=b('copyProperties'),l=b('MercuryConstants').ChatNotificationConstants,m=b('ChatSidebarCalloutData').isShown,n=h.getWebChatNotification(),o=m,p=true,q=k(new g(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return n!==l.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return o;},showsTabUnreadUI:function(){if(j.get('web_messenger_suppress_tab_unread'))return p;return true;}});function r(){q.inform(q.ON_CHANGED);}h.subscribe(i.ON_CHAT_NOTIFICATION_CHANGED,function(){var s=n,t=h.getWebChatNotification();n=t;if(s!=t)r();});g.subscribe('chat/set_does_page_occlude_tabs',function(s,t){o=!!t;r();});g.subscribe('chat/set_show_tab_unread_ui',function(s,t){p=!!t;r();});e.exports=q;});
__d("MercuryTimestampTracker",["MercuryActionTypeConstants","MercuryPayloadSource","MercurySingletonMixin","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f){var g=b('MercuryActionTypeConstants'),h=b('MercuryPayloadSource'),i=b('MercurySingletonMixin'),j=b('MercuryServerRequests'),k=b('copyProperties');function l(m){this._fbid=m;this._serverRequests=j.getForFBID(this._fbid);this._lastTimestamp=0;this._serverRequests.subscribe('update-messages',function(n,o){if(!o.actions||!o.actions.length)return;if(o.payload_source==h.CLIENT_SEND_MESSAGE||o.payload_source==h.UNKNOWN)return;for(var p=0;p<o.actions.length;p++){var q=o.actions[p],r=q.action_type;if(r==g.USER_GENERATED_MESSAGE&&q.thread_id&&q.timestamp>this._lastTimestamp)this._lastTimestamp=q.timestamp;}}.bind(this));}k(l.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});k(l,i);e.exports=l;});
__d("ChatTabModel",["Arbiter","ArbiterMixin","ChatBehavior","ChatConfig","JSLogger","MercuryAssert","MercuryServerRequests","MercuryThreads","MercuryTimestampTracker","PresenceInitialData","PresenceState","PresenceUtil","areObjectsEqual","arrayContains","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatBehavior'),j=b('ChatConfig'),k=b('JSLogger'),l=b('MercuryAssert'),m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o=b('MercuryTimestampTracker').get(),p=b('PresenceInitialData'),q=b('PresenceState'),r=b('PresenceUtil'),s=b('areObjectsEqual'),t=b('arrayContains'),u=b('copyProperties'),v=[],w=null,x=null,y=null,z=null;function aa(){return parseInt(p.serverTime,10);}var ba=j.get('tab_max_load_age')||3600000,ca=aa()-ba,da=0,ea=20,fa=k.create('chat_tab_model'),ga=false;function ha(ab){var bb=q.verifyNumber(ab.uct2);if(!bb||typeof bb!=='number'){fa.warn('bad_cookie_version',ab.uct2);return null;}if(bb<da||bb<ca)return null;return bb;}function ia(ab){var bb=ha(ab);if(!bb){var cb={};cb.old_tabs=ab&&ab.t2&&JSON.stringify(ab.t2);cb.old_promoted=ab&&ab.lm2;cb.old_time=ab&&ab.uct2;cb.old_reason=ab&&ab.tr;cb.old_window=ab&&ab.tw;var db;if(x&&ab.t2)for(var eb=0;eb<ab.t2.length;eb++){var fb=ab.t2[eb];if(fb.i===x)db=fb.r;}var gb=[];v.forEach(function(hb){if(!hb.fragile){var ib={i:hb.id,si:hb.server_id};if(hb.raised||(hb.id===x&&db))ib.r=1;gb.push(ib);}});ab.t2=gb;ab.uct2=da;ab.lm2=w;ab.tr=z;ab.tw=r.getSessionID();cb.new_tabs=JSON.stringify(ab.t2);cb.new_promoted=ab.lm2;cb.new_time=ab.uct2;cb.new_reason=ab.tr;cb.new_window=ab.tw;fa.debug('store',cb);}return ab;}function ja(ab){if(ab){var bb=ha(ab);if(bb&&bb!==da){var cb={};cb.old_tabs=JSON.stringify(v);cb.old_promoted=w;cb.old_time=da;cb.old_reason=z;cb.window_id=r.getSessionID();cb.cookie_tabs=ab&&ab.t2&&JSON.stringify(ab.t2);cb.cookie_promoted=ab&&ab.lm2;cb.cookie_time=ab&&ab.uct2;cb.cookie_reason=ab&&ab.tr;cb.cookie_window=ab&&ab.tw;da=bb;z='load';var db=ka(ab.t2,ab.lm2||null);cb.load_result=db;cb.new_tabs=JSON.stringify(v);cb.new_promoted=w;cb.new_time=da;cb.new_reason=z;var event='load';if(!ga)event+='_init';fa.log(event,cb);return db;}}return false;}function ka(ab,bb){if(la(ab,bb)){var cb=v.filter(function(fb){return fb.fragile;}),db={};w=null;v=ab.map(function(fb){var gb={id:fb.i,server_id:fb.si};if(gb.id==bb)w=gb.id;if(x==fb.i){var hb=qa(x);if(hb!=-1){gb.raised=v[hb].raised;return gb;}else return null;}if(fb.r)gb.raised=true;db[gb.id]=gb;return gb;});v=v.filter(function(fb){return fb!=null;});if(y)for(var eb in y)if(!db[eb]||!db[eb].raised)delete y[eb];cb=cb.filter(function(fb){return !db[fb.id];});v=v.concat(cb);pa();return true;}return false;}function la(ab,bb){if(bb!=w)return true;var cb=v.filter(function(fb){return !fb.fragile;});if(ab.length!=cb.length)return true;for(var db=0,eb=ab.length;db<eb;db++){if(ab[db].id===x)continue;if(!s(ab[db],cb[db]))return true;}return false;}function ma(ab,bb,cb){var db=ja(q.get());if(bb===undefined||bb>da){if(ab()){db=true;z=cb||null;oa(bb);}}else fa.error('rejected',{change_time:bb,state_time:da});db&&na();}function na(){if(ga)ya.inform('chat/tabs-changed',ya.get());}function oa(ab){if(ab===undefined)ab=Math.max(o.getLastUserMessageTimestamp()||1,da+1);da=ab;q.doSync();}function pa(ab){var bb=v.length-ea;if(bb>0)v=v.filter(function(cb){return cb.raised||cb.id==ab||bb--<=0;});if(bb>0)v=v.filter(function(cb){return cb.id==w||cb.id==ab||bb--<=0;});}function qa(ab){for(var bb=0;bb<v.length;bb++)if(v[bb].id==ab)return bb;return -1;}function ra(ab,bb){var cb=n.getThreadMetaNow(ab);if(!cb)return false;if(cb.is_canonical_user){return ua(ab,bb);}else{var db=sa(ab);if(db)m.getServerThreadID(ab,function(eb){if(wa(ab,eb)){oa();na();}});return db;}}function sa(ab){if(qa(ab)===-1){v.push({id:ab,fragile:true});fa.log('open_fragile_tab',{tabs:JSON.stringify(v),opened:ab,window_id:r.getSessionID()});return true;}return false;}function ta(ab){var bb=[];ab.forEach(function(cb){var db=qa(cb);if(db!==-1)bb.push(v[db]);});v.forEach(function(cb){if(!t(ab,cb.id))bb.push(cb);});ma(function(){if(la(bb,w)){v=bb;return true;}return false;});}function ua(ab,bb){var cb=qa(ab);if(cb!=-1)if(v[cb].fragile){v.splice(cb,1);}else{bb&&(v[cb].signatureID=bb);return true;}for(var db=0;db<=v.length;db++)if(db==v.length||v[db].fragile){v.splice(db,0,{id:ab,signatureID:bb});pa(ab);fa.log('open_tab',{tabs:JSON.stringify(v),opened:ab,window_id:r.getSessionID()});return true;}}function va(ab){var bb=qa(ab);if(bb!=-1&&(!v[bb].raised||w!==ab)){v[bb].raised=true;w=ab;return true;}return false;}function wa(ab,bb){var cb=qa(ab);if(cb!=-1&&v[cb].fragile){var db=v[cb];db.fragile=false;db.server_id=bb;var eb=[];v.forEach(function(fb){if(fb.id!=ab){if(db&&fb.fragile){eb.push(db);db=null;}eb.push(fb);}});if(db)eb.push(db);v=eb;fa.log('make_permanent',{tabs:JSON.stringify(v),tab_id:ab,window_id:r.getSessionID()});return true;}return false;}function xa(ab){var bb=qa(ab);if(ab==w)w=null;if(bb!=-1){v.splice(bb,1);fa.log('close_tab',{tabs:JSON.stringify(v),closed:ab,window_id:r.getSessionID()});return true;}return false;}q.registerStateStorer(ia);q.registerStateLoader(function(ab){if(ja(ab))na();});function ya(){}u(ya,h,{isTabPromoted:function(ab){if(ab)return ab==w;return false;},indexOf:function(ab){return qa(ab);},getTab:function(ab){l.isThreadID(ab);var bb=this.indexOf(ab);if(bb>-1){var cb=v[bb];return u({},cb);}return null;},getEmptyTab:function(){for(var ab=0;ab<v.length;ab++){var bb=v[ab].id;if(n.isNewEmptyLocalThread(bb))return bb;}return null;},getServerTime:function(){return aa();},changeShowingTabs:function(ab){return ta(ab);},closeAllTabs:function(){if(v.length){fa.log('close_all_tabs',{closed_tabs:JSON.stringify(v),window_id:r.getSessionID()});v=[];w=null;if(y)y={};oa();na();}},closeFragileTabs:function(){var ab=[];for(var bb=0;bb<v.length;bb++)if(v[bb].fragile&&!n.isNewEmptyLocalThread(v[bb].id)){ab.push(v[bb]);v.splice(bb);na();break;}fa.log('close_fragile_tabs',{tabs:JSON.stringify(v),fragile_closed:ab,window_id:r.getSessionID()});},closeTab:function(ab,bb){l.isThreadID(ab);var cb=false;if(y){delete y[ab];cb=true;}ma(function(){if(xa(ab))cb=true;return cb;},undefined,bb);},raiseTab:function(ab,bb,cb){l.isThreadID(ab);var db=false;if(y&&bb){y[ab]=true;db=true;}if(!bb&&ab===x){db&&na();return;}ma(function(){if(ra(ab,cb))db=true;var eb=qa(ab);if(eb!=-1&&!v[eb].raised){v[eb].raised=true;db=true;fa.log('raise_tab',{tabs:JSON.stringify(v),raised:ab,window_id:r.getSessionID()});}return db;});},get:function(){var ab=v.map(function(bb){var cb=u({},bb);delete cb.fragile;if(y)cb.raised=y[cb.id];return cb;});return {tabs:ab,promoted:w};},openFragileTab:function(ab){l.isThreadID(ab);if(sa(ab))na();},openTab:function(ab){l.isThreadID(ab);ma(ra.bind(null,ab));},lowerTab:function(ab){l.isThreadID(ab);var bb=false;if(y){delete y[ab];bb=true;}ma(function(){var cb=qa(ab);if(cb!=-1&&v[cb].raised){delete v[cb].raised;fa.log('lower_tab',{tabs:JSON.stringify(v),lowered:ab,window_id:r.getSessionID()});bb=true;}return bb;});},raiseAndPromoteTab:function(ab,bb,cb,db,eb){l.isThreadID(ab);var fb=false;if(y&&bb){y[ab]=true;fb=true;}if(!bb&&ab===x){fb&&na();return;}ma(function(){if(ra(ab,cb))fb=true;if(va(ab)){fb=true;fa.log('raise_and_promote_tab',{tabs:JSON.stringify(v),promoted:ab,window_id:r.getSessionID()});}return fb;},db,eb);},setPromotedTab:function(ab){l.isThreadID(ab);ma(va.bind(null,ab));},promoteThreadInPlaceOfThread:function(ab,bb,cb,db){l.isThreadID(ab);l.isThreadID(bb);ma(function(){var eb=qa(ab),fb=qa(bb);if(db){w=ab;}else if(w===bb)return true;var gb=v[eb];if(j.get('chat_tabs_management')&&cb){l.isThreadID(cb);var hb=qa(cb),ib=v[fb];v[fb]=gb;v.splice(eb,1);v.splice(hb,0,ib);}else{v[eb]=v[fb];v[fb]=gb;}return true;});},squelchTab:function(ab){l.isThreadID(ab);x=ab;this.lowerTab(ab);fa.log('squelch_tab',{squelched:ab,tabs:JSON.stringify(v),window_id:r.getSessionID()});},clearSquelchedTab:function(){if(x)fa.log('unsquelch_tab',{squelched:x,tabs:JSON.stringify(v),window_id:r.getSessionID()});x=null;},persistLocalRaised:function(){if(y){ma(function(){var ab=false;v.forEach(function(bb){if(bb.raised!=y[bb.id]){ab=true;if(y[bb.id]){bb.raised=true;}else delete bb.raised;}});return ab;});fa.log('persist_local_raise',{tabs:JSON.stringify(v),window_id:r.getSessionID()});}}});g.subscribe(k.DUMP_EVENT,function(ab,bb){bb.chat_tabs={promoted:w,tabs:v.map(function(cb){return u({},cb);}),time:da,max_load_age:ba};});function za(){var ab=i.ignoresRemoteTabRaise();if(ab&&!y){fa.log('start_ignore_remote_raise');y={};na();}else if(!ab&&y){fa.log('stop_ignore_remote_raise');y=null;na();}}i.subscribe(i.ON_CHANGED,za);za();ja(q.getInitial(),true);if(da===0)da=aa()-600000;ga=true;e.exports=ya;});
__d("WebMessengerEvents",["Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=h(new g(),{MASTER_DOM_CHANGED:'master-dom-changed',DETAIL_DOM_CHANGED:'detail-dom-changed',FOCUS_COMPOSER:'focus-composer',FOCUS_SEARCH:'focus-search',FOCUS_AND_SELECT_SEARCH:'focus-and-select-search',SUBMIT_REPLY:'submit-reply',UPDATE_SELECTION:'update-selection',masterDOMChanged:function(){this.inform(i.MASTER_DOM_CHANGED);},detailDOMChanged:function(){this.inform(i.DETAIL_DOM_CHANGED);},focusComposer:function(){this.inform(i.FOCUS_COMPOSER);},focusSearch:function(){this.inform(i.FOCUS_SEARCH);},focusAndSelectSearch:function(){this.inform(i.FOCUS_AND_SELECT_SEARCH);},updateSelection:function(j){this.inform(i.UPDATE_SELECTION,j);},submitReply:function(){this.inform(i.SUBMIT_REPLY);}});e.exports=i;});
__d("WebMessengerSubscriptionsHandler",["SubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('SubscriptionsHandler'),h=new g('webmessenger');e.exports=h;});
__d("isWebMessengerURI",[],function(a,b,c,d,e,f){function g(h){return (/^(\/messages)/).test(h.getPath());}e.exports=g;});
__d("WebMessengerWidthControl",["Arbiter","CSS","CSSClassTransition","DOMDimensions","Event","Style","URI","ViewportBounds","WebMessengerEvents","WebMessengerSubscriptionsHandler","$","cx","isWebMessengerURI","requestAnimationFrame","setTimeoutAcrossTransitions","shield","throttle"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('CSSClassTransition'),j=b('DOMDimensions'),k=b('Event'),l=b('Style'),m=b('URI'),n=b('ViewportBounds'),o=b('WebMessengerEvents'),p=b('WebMessengerSubscriptionsHandler'),q=b('$'),r=b('cx'),s=b('isWebMessengerURI'),t=b('requestAnimationFrame'),u=b('setTimeoutAcrossTransitions'),v=b('shield'),w=b('throttle'),x=205,y=981,z=257,aa=18,ba=848,ca=724,da=.57,ea=56,fa,ga,ha;function ia(na,oa,pa){this.masterChanged=na;this.detailChaned=oa;p.addSubscriptions(k.listen(window,'resize',w(v(ja,this,this),100)),g.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide'],v(ja,this,this),g.SUBSCRIBE_NEW));var qa=ma()?ea:0;if(pa)qa=x;this._width=ma()?0:ba;ha=true;ja(this,qa);}function ja(na,oa){var pa=n.getRight()+n.getLeft();pa=pa||oa||0;var qa=j.getViewportWithoutScrollbarDimensions().width-pa,ra=Math.round(Math.max(0,qa/2-y/2));qa=y+ra-z;qa-=aa;qa=Math.max(ca,Math.min(ba,qa));if(!isNaN(qa)&&na._width!==qa){na._width=qa;var sa=Math.round(qa/(1+da)),ta=qa-sa;na.masterChanged(ta);na.detailChaned(sa);if(ma()){var ua=qa+z;ka(function(){if(ga){document.body.className=ga;ga='';}la(ua+'px');h.removeClass(document.body,"_5262");ha&&o.detailDOMChanged();ha=false;},ga);}}}function ka(na,oa){oa&&h.addClass(document.documentElement,"_5261");t(na);oa&&u(h.removeClass.bind(null,document.documentElement,"_5261"),1000);}function la(na){l.set(q('pageHead'),'width',na);l.set(q('globalContainer'),'width',na);}function ma(){if(!fa)fa=h.hasClass(document.body,"_6nw");return fa;}i.registerHandler(function(na,oa,pa,qa){function ra(sa){return ma()&&s(m(sa));}if(ra(qa)){ga=oa;return true;}else if(ra(pa)){ka(function(){na.className=oa;la('');},true);return true;}});e.exports=ia;});
__d("ChatQuietLinks",["Event","DOM","UserAgent","DataStore","Parent"],function(a,b,c,d,e,f){var g=b('Event'),h=b('DOM'),i=b('UserAgent'),j=b('DataStore'),k=b('Parent'),l={},m={silenceLinks:function(q){n(q,this.removeEmptyHrefs.bind(this));},nukeLinks:function(q){n(q,this.removeAllHrefs.bind(this));},removeEmptyHrefs:function(q){o(q,function(r){return !r||r==='#';});},removeAllHrefs:function(q){o(q);}};function n(q,r){var s=!!i.chrome(),t=!!i.chrome()||i.ie()>=9||i.firefox()>=4;if(l[h.getID(q)])return;l[h.getID(q)]=true;if(!t)return;if(!s){r&&r(q);return;}g.listen(q,'mouseover',function u(v){var w=k.byTag(v.getTarget(),'a');if(w){var x=w.getAttribute('href');if(p(x)){j.set(w,'stashedHref',w.getAttribute('href'));w.removeAttribute('href');}}});g.listen(q,'mouseout',function u(v){var w=k.byTag(v.getTarget(),'a'),x=w&&j.remove(w,'stashedHref');if(p(x))w.setAttribute('href',x);});g.listen(q,'mousedown',function(u){if(!u.isDefaultRequested())return true;var v=k.byTag(u.getTarget(),'a'),w=v&&j.get(v,'stashedHref');if(p(w))v.setAttribute('href',w);});}function o(q,r){var s=h.scry(q,'a');if(r)s=s.filter(function(t){return r(t.getAttribute('href'));});s.forEach(function(t){t.removeAttribute('href');t.setAttribute('tabindex',0);});}function p(q){return q&&q!=='#';}e.exports=m;});
__d("Dock",["Event","shield","WebMessengerWidthControl","Arbiter","ArbiterMixin","ChatQuietLinks","CSS","DataStore","DOM","Parent","Style","Toggler","Vector","copyProperties","csx","emptyFunction","ge"],function(a,b,c,d,e,f){var g=b('Event'),h=b('shield');b('WebMessengerWidthControl');var i=b('Arbiter'),j=b('ArbiterMixin'),k=b('ChatQuietLinks'),l=b('CSS'),m=b('DataStore'),n=b('DOM'),o=b('Parent'),p=b('Style'),q=b('Toggler'),r=b('Vector'),s=b('copyProperties'),t=b('csx'),u=b('emptyFunction'),v=b('ge');function w(){}s(w,j,{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(x){this.init=u;this.rootEl=x;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();k.removeEmptyHrefs(this.rootEl);g.listen(x,'click',this._onClick.bind(this));g.listen(window,'resize',this._onWindowResize.bind(this));q.subscribe(['show','hide'],function(y,z){var aa=z.getActive();if(!n.contains(x,aa))return;if(l.hasClass(aa,'fbNub')){this.notifyNub(aa,y);if(y==='show')this._resizeNubFlyout(aa);}else{var ba=o.byClass(aa,'fbNubFlyout');if(ba)l.conditionClass(ba,'menuOpened',y==='show');}}.bind(this));this.inform('init',{},i.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return (this.viewportDimensions=r.getViewportDimensions());},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+r.getElementDimensions(this.rootEl).y;var x=v('blueBar');if(x){var y=p.isFixed(x)?'viewport':'document';this.flyoutHeightOffset+=r.getElementPosition(x,y).y+r.getElementDimensions(x).y;}},toggle:function(x){var y=this._findFlyout(x);if(!y)return;this.subscribe('init',function(){q.toggle(x);});},show:function(x){this.subscribe('init',function(){q.show(x);});},showNub:function(x){l.show(x);},hide:function(x){this.subscribe('init',function(){var y=q.getInstance(x);n.contains(x,y.getActive())&&y.hide();});},hideNub:function(x){l.hide(x);this.hide(x);},setUseMaxHeight:function(x,y){l.conditionClass(x,'maxHeight',y!==false);this._resizeNubFlyout(x);},_resizeNubFlyout:function(x){var y=this._findFlyout(x);if(!y||!(l.hasClass(x,'openToggler')||l.hasClass(x,'opened')))return;var z=n.find(y,'div.fbNubFlyoutOuter'),aa=n.find(z,'div.fbNubFlyoutInner'),ba=n.find(aa,'div.fbNubFlyoutBody'),ca=ba.scrollTop,da=ba.offsetHeight;p.set(ba,'height','auto');var ea=r.getElementDimensions(y),fa=r.getElementDimensions(ba),ga=this.getMaxFlyoutHeight(x);p.set(y,'max-height',ga+'px');p.set(z,'max-height',ga+'px');ea=r.getElementDimensions(y);var ha=r.getElementDimensions(aa),ia=ha.y-fa.y,ja=ea.y-ia,ka=parseInt(ba.style.height||ba.clientHeight,10),la=ja!==ka;if(ea.y>ia&&la)p.set(ba,'height',ja+'px');l.removeClass(y,'swapDirection');var ma=r.getElementPosition(y).x;l.conditionClass(y,'swapDirection',function(){if(ma<0)return true;return (ma+ea.x>this.viewportDimensions.x);}.bind(this)());if(la&&ca+da>=fa.y){ba.scrollTop=ba.scrollHeight;}else ba.scrollTop=ca;this.notifyNub(x,'resize');},getMaxFlyoutHeight:function(x){var y=this._findFlyout(x),z=r.getElementPosition(y,'viewport'),aa=r.getElementDimensions(y),ba=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-z.y-aa.y);return Math.max(ba,0);},resizeAllFlyouts:function(){var x=this._getAllNubs(),y=x.length;while(y--)this._resizeNubFlyout(x[y]);},hideAllFlyouts:function(){var x=this._getAllNubs(),y=x.length;while(y--)this.hide(x[y]);},_getAllNubs:function(){var x=n.scry(this.rootEl,"div._50-v.openToggler");return x.concat(n.scry(this.rootEl,"div._50-v.opened"));},_onClick:function(event){var x=event.getTarget(),y=o.byClass(x,'fbNub');if(y){if(o.byClass(x,'fbNubFlyoutTitlebar')){var z=o.byTag(x,'a'),aa=x.nodeName=='INPUT'&&x.getAttribute('type')=='submit';if(!z&&!aa){this.hide(y);return false;}}this.notifyNub(y,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(x){return l.hasClass(x,'fbNubFlyout')?x:n.scry(x,'div.fbNubFlyout')[0]||null;},registerNubController:function(x,y){m.set(x,'dock:nub:controller',y);y.subscribe('nub/button/content-changed',h(this.inform,this,'resize',x));y.subscribe('nub/flyout/content-changed',h(this._resizeNubFlyout,this,x));},unregisterNubController:function(x){m.remove(x,'dock:nub:controller');},notifyNub:function(x,y,z){var aa=m.get(x,'dock:nub:controller');aa&&aa.inform(y,z);}});e.exports=a.Dock||w;});
__d("TabsViewport",["Arbiter","ArbiterMixin","ChatConfig","ChatTabModel","Dock","DOM","DOMDimensions","Event","Parent","Vector","ViewportBounds","areObjectsEqual","copyProperties","csx","shield"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatConfig'),j=b('ChatTabModel'),k=b('Dock'),l=b('DOM'),m=b('DOMDimensions'),n=b('Event'),o=b('Parent'),p=b('Vector'),q=b('ViewportBounds'),r=b('areObjectsEqual'),s=b('copyProperties'),t=b('csx'),u=b('shield'),v=164,w=264,x=175,y=269,z=0;function aa(){if(i.get('litestand')||i.get('litestand_classic_sidebar'))return x;return v;}function ba(){if(i.get('litestand')||i.get('litestand_classic_sidebar'))return y;return w;}function ca(da){this._root=da;var ea=this._recalculateWidth.bind(this);n.listen(window,'resize',ea);k.subscribe('resize',ea);g.subscribe(['LitestandSidebar/expand','LitestandSidebar/collapse'],ea);g.subscribeOnce(['sidebar/initialized','LitestandSidebar/initialized'],ea,g.SUBSCRIBE_NEW);j.subscribe('chat/tabs-changed',u(this._recalculateTabs,this,true));this._recalculateWidth();this._initialized=true;}s(ca.prototype,h,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var da=ca._getAvailableDockWidth(this._root),ea=Math.max(1,Math.floor(da/ba())),fa=ea!=this._maxShown;if(!this._viewState||fa||da<=this._viewState.usedWidth||da>this._viewState.widthToShowNext){this._availableWidth=da;this._maxShown=ea;this._viewState=null;this._recalculateTabs(fa);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(da){var ea=ca._getTabsToShow(j.get(),this._availableWidth);if(da||!r(this._viewState,ea)){this._viewState=ea;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>ba();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},getShowingTabsOrder:function(){var da=j.get(),ea=this._viewState.tabsToShow;return da.tabs.filter(function(fa){return ea[fa.id];});},getRightmostHiddenTab:function(){var da=j.get(),ea=this._viewState.tabsToShow,fa=da.tabs.filter(function(ha){return !ea[ha.id];}),ga=fa.shift();return ga?ga.id:null;},getLeftmostVisibleTab:function(){var da=this.getShowingTabsOrder(),ea=da.pop();return ea?ea.id:null;},shouldPromoteOnRaise:function(da){if(!this._viewState.tabsToShow[da])return true;if(this._viewState.nextToHide!=da)return false;var ea=j.getTab(da),fa=ea&&ea.raised;return !fa&&(this._availableWidth-this._viewState.usedWidth<ba()-aa());}});s(ca,{_getAvailableDockWidth:function(da){var ea=m.getViewportWithoutScrollbarDimensions().width;ea-=q.getLeft()+q.getRight();ea-=50;var fa=o.byClass(da,'fbDock'),ga=l.find(fa,"._56ox"),ha=p.getElementDimensions(ga).x;ea-=ha;var ia=l.find(fa,"._56oy");ha+=p.getElementDimensions(ia).x;var ja=p.getElementDimensions(fa),ka=ja.x-ha;if(ka>z)z=ka;ea-=z;ea-=15;return Math.max(ea,0);},_getTabsToShow:function(da,ea){ea=Math.max(ea,ba()+1);function fa(va,wa){if(i.get('chat_tabs_management')){return (va.raised||!wa)?ba():aa();}else return va.raised?ba():aa();}var ga=JSON.parse(JSON.stringify(da.tabs)),ha=-1,ia=null;if(da.promoted)ga.forEach(function(va,wa){if(va.id===da.promoted){ha=wa;ia=va;}});var ja=0,ka=false,la=0,ma=!ia;ga.forEach(function(va,wa){var xa=fa(va,ka);ka=ka||!va.raised;var ya=i.get('chat_tabs_management')?xa:ba();va.leftmostOffset=ja+ya;ja+=xa;if(va.leftmostOffset<ea)la++;ma|=wa==ha;va.alreadyPlacedPromoted=ma;});function na(va,wa,xa){var ya={};for(var za=0;za<wa;za++){var ab=va[za];if(!ab.alreadyPlacedPromoted&&za==wa-1){ya[xa]=true;}else ya[ab.id]=true;}return ya;}var oa=na(ga,la,da.promoted),pa=na(ga,la-1,da.promoted),qa=null;for(var ra in oa)if(!pa[ra])qa=ra;var sa=ga[la-1],ta=sa?sa.leftmostOffset:0,ua=Infinity;if(la<ga.length)ua=ga[la].leftmostOffset;return {nextToHide:qa,tabsToShow:oa,usedWidth:ta,widthToShowNext:ua};}});e.exports=ca;});
__d("ChatTabPresence",["AvailableList","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f){var g=b('AvailableList'),h=b('ChatTabModel'),i=b('MercuryThreads').get(),j={};function k(l){var m=i.getCanonicalUserInThread(l);if(m)g.updateForID(m);}h.subscribe('chat/tabs-changed',function(event,l){l.tabs.forEach(function(m){if(m.raised&&!j[m.id])k(m.id);});j={};l.tabs.forEach(function(m){if(m.raised)j[m.id]=true;});});e.exports={};});
__d("ChatTypeaheadBehavior",["Chat","ChatConfig","CSS","DOM","Parent","Rect","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('Chat'),h=b('ChatConfig'),i=b('CSS'),j=b('DOM'),k=b('Parent'),l=b('Rect'),m=b('copyProperties'),n=b('cx'),o=b('tx');function p(r,s){if(!h.get('litestand_classic_sidebar'))return;var t=k.byClass(r,"_4oes");if(t)i.conditionClass(t,"_5q83",s);}function q(r){"use strict";this._typeahead=r;}q.prototype.enable=function(){"use strict";var r=this._typeahead;this._subscriptions=[r.subscribe('focus',function(){r.getData().refreshData();p(r.getElement(),true);}),r.subscribe('blur',function(s){r.getCore().reset();p(r.getElement(),false);}),r.subscribe('respond',function(s,t){if(t.value&&t.value===r.getCore().getValue()){if(!t.results.length){var u=h.get('divebar_typeahead_group_fof',0);if(u&&!t.isAsync)return;var v=j.create('div',{className:'noResults'},"Friend not found.");j.setContent(r.getView().getElement(),v);}i.addClass(r.getElement(),'hasValue');}}),r.subscribe('reset',function(){i.removeClass(r.getElement(),'hasValue');}),r.subscribe('select',function(s,t){r.getView().hide();var u=i.hasClass(document.documentElement,'sidebarMode'),v={mode:u?'sidebar':'chatNub',source:'typeahead',type:t.selected.type,typeahead:true};g.openTab(t.selected.uid,t.selected.type,v);}),r.subscribe('highlight',function(s,t){if(t.index>=0){var u=r.getView().getItems()[t.index];if(u){var v=new l(u),w=u.offsetParent,x=v.boundWithin(new l(w)).getPositionVector();v.getPositionVector().sub(x).scrollElementBy(w);}}})];};q.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(r){this._typeahead.unsubscribe(r);}.bind(this));this._subscriptions=null;};m(q.prototype,{_subscriptions:null});e.exports=q;});
__d("ChatActivity",["Event","Arbiter","AvailableList","AvailableListConstants","JSLogger","MercuryConfig","PresenceState","UserActivity","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AvailableList'),j=b('AvailableListConstants'),k=b('JSLogger'),l=b('MercuryConfig'),m=b('PresenceState'),n=b('UserActivity'),o=b('copyProperties'),p=l.activity_limit||60000,q=l.idle_limit||1800000,r=l.idle_poll_interval||300000,s=k.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&(aa-t<p));}var x=o(new h(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);m.doSync();}x.inform('activity');}i.subscribe(j.ON_AVAILABILITY_CHANGED,function(){if(!i.isUserIdle())u=Date.now();});g.listen(window,'focus',function(){v=true;y();});g.listen(window,'blur',function(){v=false;});n.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&m.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(m.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);m.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});h.subscribe(k.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});e.exports=x;});
__d("FileFormResetOnSubmit",["DOMQuery"],function(a,b,c,d,e,f){var g=b('DOMQuery');function h(i){"use strict";this._form=i;}h.prototype.enable=function(){"use strict";var i=this._reset.bind(this);this._subscription=this._form.subscribe('submit',function(){setTimeout(i,0);});};h.prototype.disable=function(){"use strict";this._subscription.unsubscribe();this._subscription=null;};h.prototype._reset=function(){"use strict";var i=g.scry(this._form.getRoot(),'input[type="file"]');i.forEach(function(j){j.value='';});};e.exports=h;});
__d("PhotosUploadID",[],function(a,b,c,d,e,f){var g=1024,h={getNewID:function(){return (g++).toString();}};e.exports=h;});
__d("DataViewPolyfill",["copyProperties"],function(a,b,c,d,e,f){"use strict";var g=b('copyProperties');function h(i,j,k){if(j===undefined){this._ba=new Uint8Array(i);}else if(k===undefined){this._ba=new Uint8Array(i,j);}else this._ba=new Uint8Array(i,j,k);this.byteLength=this._ba.byteLength;}g(h,{isSupported:function(){return !!a.Uint8Array;}});g(h.prototype,{getUint8:function(i){if(i>=this._ba.length)throw new Error('Trying to read beyond bounds of DataViewPolyfill');return this._ba[i];},getUint16:function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1);return j?(l*256)+k:(k*256)+l;},getUint32:function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1),m=this.getUint8(i+2),n=this.getUint8(i+3);return j?(((n*256+m)*256+l)*256)+k:(((k*256+l)*256+m)*256)+n;}});e.exports=h;});
__d("getImageSize",["DataViewPolyfill"],function(a,b,c,d,e,f){var g=b('DataViewPolyfill'),h=a.DataView||g;function i(m){return {width:m.getUint16(6,true),height:m.getUint16(8,true)};}function j(m){return {width:m.getUint32(16,false),height:m.getUint32(20,false)};}function k(m){var n=m.byteLength,o=2;while(o<n){var p=m.getUint16(o,false);o+=2;if(p==65472||p==65474){return {width:m.getUint16(o+5,false),height:m.getUint16(o+3,false)};}else o+=m.getUint16(o,false);}return null;}function l(m){var n=new h(m);if(n.getUint8(0)==255&&n.getUint8(1)==216)return k(n);if(n.getUint8(0)==71&&n.getUint8(1)==73&&n.getUint8(2)==70)return i(n);if(n.getUint8(0)==137&&n.getUint8(1)==80&&n.getUint8(2)==78&&n.getUint8(3)==71)return j(n);return null;}e.exports=l;l.gif=i;l.png=j;l.jpeg=k;});
__d("ChatAutoSendPhotoUploader",["ArbiterMixin","AsyncUploadRequest","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","MercuryAttachmentType","PhotosUploadID","SubscriptionsHandler","arrayContains","csx","getImageSize","getObjectValues","invariant","isEmpty","mixin","shield"],function(a,b,c,d,e,f){"use strict";var g=b('ArbiterMixin'),h=b('AsyncUploadRequest'),i=b('DOM'),j=b('Event'),k=b('FileForm'),l=b('FileFormResetOnSubmit'),m=b('FileInput'),n=b('FormSubmitOnChange'),o=b('MercuryAttachmentType'),p=b('PhotosUploadID'),q=b('SubscriptionsHandler'),r=b('arrayContains'),s=b('csx'),t=b('getImageSize'),u=b('getObjectValues'),v=b('invariant'),w=b('isEmpty'),x=b('mixin'),y=b('shield');function z(){return 'upload_'+p.getNewID();}var aa=x(g);for(var ba in aa)if(aa.hasOwnProperty(ba))da[ba]=aa[ba];var ca=aa===null?null:aa.prototype;da.prototype=Object.create(ca);da.prototype.constructor=da;da.__superConstructor__=aa;function da(ea,fa,ga){this.$ChatAutoSendPhotoUploader0=ga;this.$ChatAutoSendPhotoUploader1=fa;this.$ChatAutoSendPhotoUploader2=new q();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};this.$ChatAutoSendPhotoUploader5=ea.getAttribute('action');this.$ChatAutoSendPhotoUploader6=new k(ea,[n,l]);this.$ChatAutoSendPhotoUploader6.setAllowCrossOrigin(true);this.$ChatAutoSendPhotoUploader6.setUploadInParallel(true);var ha=i.find(ea,"._4q60"),ia=i.find(ha,"._4q61");new m(ha,ia,fa);this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.$ChatAutoSendPhotoUploader6.subscribe('submit',this.$ChatAutoSendPhotoUploader7.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('success',this.$ChatAutoSendPhotoUploader8.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('failure',this.$ChatAutoSendPhotoUploader9.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('progress',this.$ChatAutoSendPhotoUploadera.bind(this)),j.listen(ia,'click',y(this.inform,this,'open')));}da.prototype.isUploading=function(){return !w(this.$ChatAutoSendPhotoUploader3);};da.prototype.destroy=function(){this.$ChatAutoSendPhotoUploader2.release();this.$ChatAutoSendPhotoUploader6.destroy();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};};da.prototype.$ChatAutoSendPhotoUploaderb=function(ea,fa){var ga=this.$ChatAutoSendPhotoUploaderc(ea);if(fa){ga.preview_width=fa.width;ga.preview_height=fa.height;}return ga;};da.prototype.$ChatAutoSendPhotoUploaderc=function(ea){var fa={upload_id:ea,on_progress:function(ga){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('progress',ga));}.bind(this),on_success:function(ga){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('success',ga));}.bind(this),upload_canceled:this.$ChatAutoSendPhotoUploaderd.bind(this),attach_type:o.PHOTO,preview_uploading:true};return fa;};da.prototype.$ChatAutoSendPhotoUploader7=function(){var ea=z();this.$ChatAutoSendPhotoUploadere(ea,this.$ChatAutoSendPhotoUploader1.files);};da.prototype.$ChatAutoSendPhotoUploadere=function(ea,fa){var ga={};if(typeof FileReader!=='undefined'&&FileReader.prototype.readAsArrayBuffer&&fa&&fa.length===1){this.$ChatAutoSendPhotoUploader3[ea]=ea;ga[ea]=fa[0];var ha=new FileReader();ha.onload=function(){this.inform('submit',{upload_id:ea,preview_attachments:[this.$ChatAutoSendPhotoUploaderb(ea,t(ha.result))]});}.bind(this);ha.onerror=function(){this.inform('submit',{upload_id:ea,preview_attachments:[this.$ChatAutoSendPhotoUploaderc(ea)]});}.bind(this);ha.readAsArrayBuffer(fa[0]);}else{var ia=[];if(!fa){this.$ChatAutoSendPhotoUploader3[ea]=ea;this.$ChatAutoSendPhotoUploader0.value=ea;ia.push(this.$ChatAutoSendPhotoUploaderc(ea));}else for(var ja=0;ja<fa.length;++ja){var ka=z();ga[ka]=fa[ja];this.$ChatAutoSendPhotoUploader3[ka]=ea;ia.push(this.$ChatAutoSendPhotoUploaderc(ka));}this.inform('submit',{upload_id:ea,preview_attachments:ia});}if(Object.keys(ga).length>0)this.$ChatAutoSendPhotoUploader6.setFiles(ga);};da.prototype.$ChatAutoSendPhotoUploader8=function(event,ea){var fa=this.$ChatAutoSendPhotoUploaderf(ea);if(this.$ChatAutoSendPhotoUploader3[fa]){var ga=this.$ChatAutoSendPhotoUploader3[fa];delete this.$ChatAutoSendPhotoUploader3[fa];var ha=ea.response.getPayload();if(!this.$ChatAutoSendPhotoUploader4[ga])this.$ChatAutoSendPhotoUploader4[ga]=[];this.$ChatAutoSendPhotoUploader4[ga].push(ha.metadata[0].image_id);this.inform('success',{upload_id:fa});if(!this.$ChatAutoSendPhotoUploaderg(ga))this.$ChatAutoSendPhotoUploaderh(ga);}};da.prototype.$ChatAutoSendPhotoUploaderh=function(ea){v(!this.$ChatAutoSendPhotoUploaderg(ea));this.inform('all-uploads-completed',{upload_id:ea,image_ids:this.$ChatAutoSendPhotoUploader4[ea]});delete this.$ChatAutoSendPhotoUploader4[ea];};da.prototype.$ChatAutoSendPhotoUploadera=function(event,ea){this.inform('progress',{upload_id:ea.upload.getName(),event:ea.event});};da.prototype.$ChatAutoSendPhotoUploaderg=function(ea){return r(u(this.$ChatAutoSendPhotoUploader3),ea);};da.prototype.$ChatAutoSendPhotoUploader9=function(event,ea){var fa=this.$ChatAutoSendPhotoUploaderf(ea);this.$ChatAutoSendPhotoUploaderi(fa,'last-upload-failed');return false;};da.prototype.$ChatAutoSendPhotoUploaderd=function(ea){this.$ChatAutoSendPhotoUploaderi(ea,'last-upload-canceled');};da.prototype.$ChatAutoSendPhotoUploaderi=function(ea,fa){if(!this.$ChatAutoSendPhotoUploader3[ea])return;var ga=this.$ChatAutoSendPhotoUploader3[ea];delete this.$ChatAutoSendPhotoUploader3[ea];if(!this.$ChatAutoSendPhotoUploaderg(ga))if(this.$ChatAutoSendPhotoUploader4[ga]){this.$ChatAutoSendPhotoUploaderh(ga);}else this.inform(fa,{upload_id:ga});};da.prototype.$ChatAutoSendPhotoUploaderf=function(ea){if(ea.upload){return ea.upload.getName();}else return ea.response.getPayload().uploadID;};da.prototype.uploadFile=function(ea){var fa=z(),ga={};ga[fa]=ea;var ha=new h(this.$ChatAutoSendPhotoUploader5).setAllowCrossOrigin(true).setRelativeTo(this.$ChatAutoSendPhotoUploader6.getRoot()).setData({store_as_message_image:1}).setFiles(ga);this.$ChatAutoSendPhotoUploader2.addSubscriptions(ha.subscribe('success',function(event,ia){this.$ChatAutoSendPhotoUploader8(event,{upload:ia,response:ia.getResponse()});}.bind(this)),ha.subscribe('failure',this.$ChatAutoSendPhotoUploader9.bind(this)));ha.send();this.$ChatAutoSendPhotoUploadere(fa,[ea]);};e.exports=da;});
__d("MercuryOrderedThreadlist",["LogHistory","MercuryActionTypeConstants","MercuryFilters","MercuryFolders","MercuryPayloadSource","MercurySingletonMixin","MessagingTag","RangedCallbackManager","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","arrayContains","copyProperties"],function(a,b,c,d,e,f){var g=b('LogHistory'),h=b('MercuryActionTypeConstants'),i=b('MercuryFilters'),j=b('MercuryFolders'),k=b('MercuryPayloadSource'),l=b('MercurySingletonMixin'),m=b('MessagingTag'),n=b('RangedCallbackManager'),o=b('MercuryServerRequests'),p=b('MercuryThreadInformer'),q=b('MercuryThreads'),r=b('arrayContains'),s=b('copyProperties'),t=g.getInstance('ordered_threadlist_model'),u=i.getSupportedFilters().concat([i.ALL,m.GROUPS]),v=j.getSupportedFolders();function w(ga,ha,ia,ja){var ka=[],la=false,ma=false,na=(ha||[]).filter(function(ua){var va=ua.filter||i.ALL;return (ua.folder==ia||(!ua.folder&&ia==m.INBOX))&&va==ja;}),oa=ga._threadlistOrderMap[ia][ja].getAllResources(),pa;na.forEach(function(ua){ka=ka.concat(ua.thread_ids);if(ua.error){if(ua.end>oa.length)ma=ua.error;}else{var va=ua.end-ua.start;if(ua.thread_ids.length<va)la=true;}if(!pa||ua.end>pa)pa=ua.end;});aa(ga,ka,ia,ja);if(la){ga._threadlistOrderMap[ia][ja].setReachedEndOfArray();}else if(ma){ga._threadlistOrderMap[ia][ja].setError(ma);}else{var qa=ga._threadlistOrderMap[ia][ja].getCurrentArraySize();if(pa&&qa<pa){var ra={},sa=oa.concat(ka),ta=sa.filter(function(ua){var va=ra[ua];ra[ua]=true;return va;});if(ta.length){t.warn('duplicate_threads',{folder:ia,expected_final_size:pa,actual_final_size:qa,duplicate_thread_ids:ta});ga._serverRequests.fetchThreadlistInfo(pa,ta.length,ia,ja==i.ALL?null:ja);}}}}function x(ga,ha){v.forEach(function(ia){u.forEach(function(ja){w(ga,ha,ia,ja);});});}function y(ga,ha){var ia={};v.forEach(function(ja){ia[ja]={};u.forEach(function(ka){ia[ja][ka]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});ha.forEach(function(ja){if(ja.is_forward)return;var ka=ja.thread_id,la=ba(ga,ka),ma=ca(ga,ka);function na(){ma.forEach(function(pa){ia[la][pa].to_add.push(ka);if(!ga._threadlistOrderMap[la][pa].hasReachedEndOfArray()&&!ga._threadlistOrderMap[la][pa].hasResource(ka))ia[la][pa].to_remove_if_last_after_add[ka]=true;});}function oa(pa){if(r(u,pa))if(r(ma,pa)){ia[la][pa].to_add.push(ka);}else ia[la][pa].to_remove.push(ka);}if(!la){if(ja.action_type===h.CHANGE_FOLDER||ja.action_type===h.CHANGE_ARCHIVED_STATUS)v.forEach(function(pa){if(pa!==la)u.forEach(function(qa){ga._threadlistOrderMap[pa][qa].removeResources([ka]);});});return;}switch(ja.action_type){case h.DELETE_THREAD:ma.forEach(function(pa){ia[la][pa].to_remove.push(ka);});break;case h.CHANGE_ARCHIVED_STATUS:case h.CHANGE_FOLDER:na();break;case h.CHANGE_READ_STATUS:oa(m.UNREAD);break;case h.USER_GENERATED_MESSAGE:case h.LOG_MESSAGE:ma.forEach(function(pa){if(da(ga,ka,la,pa))ia[la][pa].to_add.push(ka);});break;}});v.forEach(function(ja){u.forEach(function(ka){var la=ga._threadlistOrderMap[ja][ka];aa(ga,ia[ja][ka].to_add,ja,ka);for(var ma=la.getCurrentArraySize()-1;ma>=0;ma--){var na=la.getResourceAtIndex(ma);if(!ia[ja][ka].to_remove_if_last_after_add[na])break;ia[ja][ka].to_remove.push(na);}la.removeResources(ia[ja][ka].to_remove);});});}function z(ga,ha){var ia={};v.forEach(function(ja){ia[ja]={};u.forEach(function(ka){ia[ja][ka]=[];});});ha.forEach(function(ja){var ka=ba(ga,ja.thread_id),la=ca(ga,ja.thread_id);if(ka)la.forEach(function(ma){if(da(ga,ja.thread_id,ka,ma))ia[ka][ma].push(ja.thread_id);});});v.forEach(function(ja){u.forEach(function(ka){if(ia[ja][ka].length>0)aa(ga,ia[ja][ka],ja,ka);});});}function aa(ga,ha,ia,ja){ja=ja||i.ALL;ga._threadlistOrderMap[ia][ja].addResources(ha);v.forEach(function(ka){if(ka!=ia)ga._threadlistOrderMap[ka][ja].removeResources(ha);});}function ba(ga,ha){var ia=ga._threads.getThreadMetaNow(ha),ja=null;if(!ia){ja='No thread metadata';}else if(!ia.folder)ja='No thread folder';if(ja){var ka={error:ja,tid:ha};t.warn('no_thread_folder',ka);return null;}var la=ia.folder;if(ia.is_archived)la=m.ACTION_ARCHIVED;if(ga._threadlistOrderMap[la]){return la;}else return null;}function ca(ga,ha){var ia=ga._threads.getThreadMetaNow(ha),ja=[i.ALL];if(!ia){var ka={error:'no_thread_metadata',tid:ha};t.warn('no_thread_metadata',ka);return [];}if(ia.unread_count)ja.push(m.UNREAD);if(!ia.is_canonical)ja.push(m.GROUPS);return ja;}function da(ga,ha,ia,ja){var ka=ga._threads.getThreadMetaNow(ha);return ka&&ka.timestamp&&ba(ga,ha)==ia&&r(ca(ga,ha),ja);}function ea(ga){this._fbid=ga;this._serverRequests=o.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._threads=q.getForFBID(this._fbid);this._threadlistOrderMap={};v.forEach(function(ha){this._threadlistOrderMap[ha]={};u.forEach(function(ia){this._threadlistOrderMap[ha][ia]=new n(function(ja){return this._threads.getThreadMetaNow(ja).timestamp;}.bind(this),function(ja,ka){return ka-ja;},this._serverRequests.canLinkExternally.bind(this._serverRequests));}.bind(this));}.bind(this));this._serverRequests.subscribe('update-threadlist',function(ha,ia){if(!fa(ia))return;var ja=ia.ordered_threadlists;if(ja&&ja.length){x(this,ja);}else{var ka=(ia.actions||[]).filter(function(la){return la.thread_id;});z(this,ia.threads||[]);y(this,ka);}this._threadInformer.updatedThreadlist();}.bind(this));}s(ea.prototype,{getThreadlist:function(ga,ha,ia,ja,ka,la){return this.getFilteredThreadlist(ga,ha,ia,i.ALL,ja,ka,la);},getFilteredThreadlist:function(ga,ha,ia,ja,ka,la,ma){var na=this._threadlistOrderMap[ia][ja],oa=na.executeOrEnqueue(ga,ha,ka,la),pa=na.getUnavailableResources(oa),qa=na.getError(ga,ha,la);if(pa.length||qa){if(na.getCurrentArraySize()<ga){var ra={start:ga,limit:ha,filter:ja,resources_size:na.getCurrentArraySize()};t.warn('range_with_gap',ra);}na.setError(false);this._serverRequests.fetchThreadlistInfo(na.getCurrentArraySize(),pa.length,ia,ja==i.ALL?null:ja,ma);}return oa;},getThreadlistUntilTimestamp:function(ga,ha,ia){ia=ia||i.ALL;return this._threadlistOrderMap[ha][ia].getElementsUntil(ga);},unsubscribe:function(ga,ha,ia){ia=ia||i.ALL;this._threadlistOrderMap[ha][ia].unsubscribe(ga);}});s(ea,l);function fa(ga){switch(ga.payload_source){case k.CLIENT_CHANGE_ARCHIVED_STATUS:case k.CLIENT_CHANGE_READ_STATUS:case k.CLIENT_CHANGE_FOLDER:case k.CLIENT_CHANNEL_MESSAGE:case k.CLIENT_DELETE_MESSAGES:case k.CLIENT_DELETE_THREAD:case k.CLIENT_SEND_MESSAGE:case k.SERVER_SEND_MESSAGE:case k.SERVER_CONFIRM_MESSAGES:case k.SERVER_FETCH_THREADLIST_INFO:case k.SERVER_THREAD_SYNC:return true;case k.SERVER_INITIAL_DATA:return ga.ordered_threadlists;default:return false;}}e.exports=ea;});
__d("ChatGroupThreadsController",["ArbiterMixin","ChatConfig","InitialMultichatList","MercuryOrderedThreadlist","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","MessagingTag","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ChatConfig'),i=b('InitialMultichatList'),j=b('MercuryOrderedThreadlist').get(),k=b('MercuryServerRequests').get(),l=b('MercuryThreadInformer').get(),m=b('MercuryThreads').get(),n=b('MessagingTag'),o=b('copyProperties'),p,q=[],r=h.get('max_sidebar_multichats',3);function s(x){var y=m.getThreadMetaNow(x);return y&&!y.is_canonical&&m.canReply(x);}var t=i.payload;if(t){k.handleUpdate(t);var u=t.threads||[];q=u.map(function(x){return x.thread_id;});}if(q.length){var v=m.getThreadMetaNow(q[q.length-1]);p=v&&(v.timestamp-1);}if(!p)p=Date.now();var w={};o(w,g,{getThreadIDs:function(){var x=0;return q.filter(function(y){return x<r&&s(y)&&++x;});}});l.subscribe('threadlist-updated',function(){q=j.getThreadlistUntilTimestamp(p,n.INBOX,n.GROUPS).filter(s);w.inform('update');});e.exports=w;});
__d("ChatOrderedListHover",["ArbiterMixin","CSS","ErrorUtils","Event","LayerHideOnBlur","Parent","copyProperties","cx","mixin","setTimeoutAcrossTransitions","shield"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('CSS'),i=b('ErrorUtils'),j=b('Event'),k=b('LayerHideOnBlur'),l=b('Parent'),m=b('copyProperties'),n=b('cx'),o=b('mixin'),p=b('setTimeoutAcrossTransitions'),q=b('shield');function r(x){h.addClass(x,'fetching');}function s(x){h.removeClass(x,'fetching');}var t=o(g);for(var u in t)if(t.hasOwnProperty(u))w[u]=t[u];var v=t===null?null:t.prototype;w.prototype=Object.create(v);w.prototype.constructor=w;w.__superConstructor__=t;function w(x){"use strict";this._orderedList=x;this._root=x.getRoot();j.listen(this._root,'mouseover',this._mouseOver.bind(this));j.listen(this._root,'mouseleave',this._mouseLeave.bind(this));x.subscribe('click',q(this._hide,this));}w.prototype._mouseOver=function(event){"use strict";if(this._paused)return;var x=event.getTarget(),y=l.byClass(x,"_42fz")||l.byClass(x,"_5a58");y&&this._setActiveItem(y);};w.prototype._mouseLeave=function(event){"use strict";this._setActiveItem(null);};w.prototype._clearTimeouts=function(){"use strict";this._showTimeout&&clearTimeout(this._showTimeout);this._showTimeout=null;this._hideTimeout&&clearTimeout(this._hideTimeout);this._hideTimeout=null;};w.prototype._hide=function(){"use strict";if(this._showingDialog){this._showingDialog.hide();this._showingDialog=null;this._showingID=null;}};w.prototype._show=function(){"use strict";var x=this.getActiveID(),y=false;if(this._handlers[x]){y=true;i.applyWithGuard(this._handlers[x],{},[x,this]);}else if(this._defaultHandler){y=true;i.applyWithGuard(this._defaultHandler,{},[x,this]);}if(y&&this._showingID!=this.getActiveID())r(this._activeItem);};w.prototype._setActiveItem=function(x){"use strict";if(x!=this._activeItem){this._clearTimeouts();this._activeItem&&s(this._activeItem);this._activeItem=null;var y=x?0:100;this._hideTimeout=p(function(){if(this.getActiveID()!=this._showingID)this._hide();}.bind(this),y);if(x){this._activeItem=x;var z=y+500;this._showTimeout=p(function(){this._show();}.bind(this),z);this.inform('hover');}else this.inform('leave');}};w.prototype.register=function(x,y){"use strict";if(!this._handlers[x]){this._handlers[x]=y;return {unregister:function(){if(x==this._showingID)this._hide();delete this._handlers[x];var z=this._orderedList.getAllNodes(),aa=z[x];aa&&s(aa);}.bind(this)};}};w.prototype.registerDefault=function(x){"use strict";this._defaultHandler=x;};w.prototype.getActiveID=function(){"use strict";var x=this._activeItem&&this._orderedList.getUserForNode(this._activeItem);return x||null;};w.prototype.showHovercard=function(x,y){"use strict";if(x==this.getActiveID()&&x!=this._showingID){this._clearTimeouts();s(this._activeItem);this._hide();this._showingDialog=y;this._showingID=x;var z=y.subscribe('mouseenter',this._setActiveItem.bind(this,this._activeItem)),aa=y.subscribe('mouseleave',function(){z.unsubscribe();this._setActiveItem(null);}.bind(this)),ba=y.subscribe('hide',function(){this.inform('hovercard_hide');z.unsubscribe();aa.unsubscribe();ba.unsubscribe();}.bind(this));y.enableBehavior(k).setContext(this._activeItem).setPosition('left').show();this.inform('hovercard_show');}};m(w.prototype,{_root:null,_activeItem:null,_hideTimeout:null,_showTimeout:null,_showingDialog:null,_showingID:null,_handlers:{},_defaultHandler:null});e.exports=w;});
__d("ChatSidebarConstants",["ChatConfig","mergeInto"],function(a,b,c,d,e,f){var g=b('ChatConfig'),h=b('mergeInto'),i={LITESTAND_IMAGE_SIZE:24,LITESTAND_CLASSIC_SIZE:32,IMAGE_SIZE:28};h(i,{getImageSize:function(){if(g.get('litestand_blended_sidebar')||g.get('litestand_classic_sidebar'))return i.LITESTAND_CLASSIC_SIZE;if(g.get('litestand'))return i.LITESTAND_IMAGE_SIZE;return i.IMAGE_SIZE;}});e.exports=i;});
__d("SplitImage.react",["React","Image.react","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('Image.react'),i=b('cx'),j=g.createClass({displayName:'SplitImage',render:function(){var k=this.props.size;return this.transferPropsTo(g.DOM.div({className:"_55lt",style:{width:k,height:k}},this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;var k=this.props.srcs,l=Array.isArray(k);if(!l||k.length==1)return this.renderOne(l?k[0]:k);return k.length==2?this.renderTwo(k):this.renderThree(k);},renderOne:function(k){return (h({src:k,width:this.props.size,height:this.props.size}));},renderTwo:function(k){var l=this.props.size,m=Math.floor(l/2),n=-Math.floor(m/2),o=(("_55lu")+(this.props.border?' '+"_57xo":''));return (g.DOM.div(null,g.DOM.div({className:"_55lu",style:{width:m}},h({src:k[0],width:l,height:l,style:{marginLeft:n}})),g.DOM.div({className:o,style:{width:m}},h({src:k[1],width:l,height:l,style:{marginLeft:n}}))));},renderThree:function(k){var l=this.props.size,m=Math.floor(l/3*2),n=-Math.floor((l-m)/2),o=Math.floor(l/2),p=l-m,q=-Math.floor((o-p)/2),r=(("_55lu")+(this.props.border?' '+"_57pl":'')),s=(("_55lu")+(this.props.border?' '+"_57pm":''));return (g.DOM.div(null,g.DOM.div({className:r,style:{width:m}},h({src:k[0],width:l,height:l,style:{marginLeft:n}})),g.DOM.div({className:s,style:{width:p,height:o}},h({src:k[1],width:o,height:o,style:{marginLeft:q}})),g.DOM.div({className:"_55lu",style:{width:p,height:o}},h({src:k[2],width:o,height:o,style:{marginLeft:q}}))));}});e.exports=j;});
__d("ChatSidebarItem.react",["AvailableListConstants","ChatConfig","ChatSidebarConstants","Image.react","Link.react","React","SplitImage.react","cx","ix"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('ChatConfig'),i=b('ChatSidebarConstants'),j=b('Image.react'),k=b('Link.react'),l=b('React'),m=b('SplitImage.react'),n=b('cx'),o=b('ix'),p=9,q=l.createClass({displayName:'ChatSidebarItem',render:function(){var r=(("_55ln")+(this.props.context?' '+"_55lo":'')+(this.props.unreadCount&&h.get('litestand_buddylist_count')?' '+"_5bom":'')),s=null;if(h.get('litestand',0))s=l.DOM.div({'aria-label':this.props.name,className:"_4_vf",'data-hover':"tooltip",'data-tooltip-position':"right"});return (k({className:r,href:this.props.href,onClick:this.props.onClick,rel:"ignore"},l.DOM.div({className:"_55lp"},l.DOM.div({className:"_56p9"},this.renderImage(),l.DOM.div({className:"_568w"})),l.DOM.div({className:"_5bon"},this.renderBirthday(),this.renderUnreadCount(),this.renderStatus()),l.DOM.div({className:"_55lr"},this.props.name),l.DOM.div({className:"_55ls"},this.props.context)),s));},renderImage:function(){var r=this.props.imageSize||i.IMAGE_SIZE;return m({size:r,srcs:this.props.images});},renderUnreadCount:function(){var r=this.props.unreadCount;if(!r||!h.get('litestand_buddylist_count'))return null;var s=(("_5boo")+(r>p?' '+"_5bop":''));if(r>p)r=p+'+';return (l.DOM.div({className:s},r));},renderStatus:function(){var r=this.getStatusSrc();if(!r&&!this.props.statusTime)return null;if(this.props.unreadCount&&h.get('litestand_blended_sidebar')&&h.get('litestand_buddylist_count'))return;var s=r?j({className:"_568_",src:r}):null;return (l.DOM.div({className:"_568z"},l.DOM.div({className:"_568-"},this.props.statusTime),l.DOM.div({className:"_5t35"},this.props.detailedStatus),s));},renderBirthday:function(){if(!this.props.birthday)return null;var r=o('/images/gifts/icons/cake_icon.png');if(h.get('gray_cake'))r=o('/images/chat/sidebar/livebar/divebar_cake.png');return (j({className:"_5dv3",src:r}));},getStatusSrc:function(){switch(this.props.status){case g.ACTIVE:case g.IDLE:return h.get('litestand_classic_sidebar')?o('/images/litestand_classic/sidebar/online.png'):o('/images/chat/status/online.png');case g.MOBILE:if(h.get('sidebar_remove_mobile_icon'))return null;return h.get('litestand_classic_sidebar')?o('/images/litestand_classic/sidebar/pushable.png'):o('/images/chat/status/mobile.png');}return null;}});e.exports=q;});
__d("WebMessengerPermalinkConstants",["URI"],function(a,b,c,d,e,f){var g=b('URI'),h={ARCHIVED_PATH:'/messages/archived',BASE_PATH:'/messages',OTHER_PATH:'/messages/other',SPAM_PATH:'/messages/spam',COMPOSE_POSTFIX_PATH:'/new',SEARCH_POSTFIX_PATH:'/search',TID_POSTFIX_PARTIAL_PATH:'/conversation-',overriddenVanities:'(archived|other|spam|new|search|conversation-.*)',getURIPathForThreadID:function(i,j){return (j||h.BASE_PATH)+h.TID_POSTFIX_PARTIAL_PATH+g.encodeComponent(g.encodeComponent(i));},getThreadIDFromURI:function(i){var j=i.getPath().match(h.BASE_PATH+'(/[^/]*)*'+h.TID_POSTFIX_PARTIAL_PATH+'([^/]+)');if(j){var k=g.decodeComponent(g.decodeComponent(j[2]));return k;}},getURIPathForIDOrVanity:function(i,j){if(i.match('^'+h.overriddenVanities+'$'))i='.'+i;return (j||h.BASE_PATH)+'/'+i;},getUserIDOrVanity:function(i){var j=i.match(h.BASE_PATH+'.*/([^/]+)/?$'),k=j&&j[1],l=h.overriddenVanities;if(!k||k.match('^'+l+'$')){return false;}else if(k.match('^\\.'+l+'$')){return k.substr(1);}else return k;}};e.exports=h;});
__d("MercuryThreadMetadataRawRenderer",["Event","CSS","DOM","MercuryActionStatus","MercuryErrorInfo","MessagingTag","MercuryStatusTemplates","Tooltip","URI","WebMessengerPermalinkConstants","cx","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryActionStatus'),k=b('MercuryErrorInfo'),l=b('MessagingTag'),m=b('MercuryStatusTemplates'),n=b('Tooltip'),o=b('URI'),p=b('WebMessengerPermalinkConstants'),q=b('cx'),r=b('tx'),s={renderParticipantListWithNoThreadName:function(u,v,w,x,y,z){var aa={callback:true,check_length:true,show_unread_count:true};z=z||{};var ba={};for(var ca in z)if(aa[ca]){ba[ca]=z[ca];delete z[ca];}var da=w.map(function(ia){return x[ia];}),ea=this.renderRawParticipantList(u,da,w.length,z);ea=this.renderRawTitleWithUnreadCount(ea,ba.show_unread_count?v.unread_count:0);var fa=z.abbr_mode,ga={};for(var ha in z)ga[ha]=z[ha];ga.abbr_mode=true;y.forEach(function(ia){var ja=y.length>1?this._cloneIfDOMElement(ea):ea;i.setContent(ia,ja);if(ba.check_length&&!fa&&ia.scrollWidth>ia.clientWidth){var ka=this.renderRawParticipantList(u,da,w.length,ga),la=this.renderRawTitleWithUnreadCount(ka,ba.show_unread_count?v.unread_count:0);i.setContent(ia,la);}}.bind(this));ba.callback&&ba.callback(ea);},renderRawParticipantList:function(u,v,w,x){var y={abbr_mode:true,last_separator_uses_and:true,names_renderer:true};x=x||{};var z=null;if(x.names_renderer){z=x.names_renderer(v);}else z=v.map(function(ca){return ca.name;});var aa=null;if(z.length===0){if(!u){aa="New Message";}else aa="No Participants";}else if(z.length==1){aa=z[0];}else if(z.length==2){var ba={participant1:z[0],participant2:z[1]};if(x.last_separator_uses_and){aa=r._("{participant1} and {participant2}",ba);}else aa=r._("{participant1}, {participant2}",ba);}else if(x.last_separator_uses_and){if(x.abbr_mode){aa=r._("{participant1} and {others_link}",{participant1:z[0],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-1})});}else if(z.length==3){aa=r._("{participant1}, {participant2} and {participant3}",{participant1:z[0],participant2:z[1],participant3:z[2]});}else aa=r._("{participant1}, {participant2} and {others_link}",{participant1:z[0],participant2:z[1],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-2})});}else if(z.length==3){aa=r._("{participant1}, {participant2}, {participant3}",{participant1:z[0],participant2:z[1],participant3:z[2]});}else aa=r._("{participant1}, {participant2}, {participant3}, {others_link}",{participant1:z[0],participant2:z[1],participant3:z[2],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-3})});if(Array.isArray(aa))aa=i.create('span',{},aa);return aa;},renderRawTitleWithUnreadCount:function(u,v){var w=u;if(v&&v>1)w=i.create('span',{},r._("{conversation_title} ({unread_count})",{conversation_title:u,unread_count:v}));return w;},renderRawParticipantCount:function(u,v){var w=v.render_subset,x;if(!w){x=v.count>1?r._("{num} people",{num:v.count}):"1 person";}else x=v.count>1?r._("{others_count} others",{others_count:v.count}):"1 other";return x;},renderShortNames:function(u){if(u.length==1)return [u[0].name];return u.map(function(v){return v.short_name;});},getUserCanonicalTitanURL:function(u,v,w){var x=new o().setSubdomain('www'),y=u.substr(u.indexOf(':')+1);x.setPath(t(w)+'/'+y);v&&v(x.toString());return x.toString();},getTitanURLWithServerID:function(u,v,w){var x=new o().setSubdomain('www');x.setPath(p.getURIPathForThreadID(u,t(w)));v&&v(x.toString());return x.toString();},renderUserCanonicalTitanLink:function(u,v,w,x){var y=this.getUserCanonicalTitanURL(u,null,x);v.setAttribute('href',y);w&&w();},renderTitanLinkWithServerID:function(u,v,w,x){var y=this.getTitanURLWithServerID(u,null,x);v.setAttribute('href',y);w&&w();},renderStatusIndicator:function(u,v,w){var x;if(u==j.RESENDING){x=this.renderResendIndicator();}else if(u!==undefined&&u!=j.UNSENT&&u!=j.UNCONFIRMED&&u!=j.SUCCESS)x=this.renderErrorIndicator(v,w);return x;},renderResendIndicator:function(){return m[':fb:mercury:resend-indicator'].render();},renderErrorIndicator:function(u,v){if(!u)return null;var w=m[':fb:mercury:error-indicator'].render(),x=u.is_transient,y=k.getMessage(u);if(x)if(k.isConnectionError(u)){y=r._("{message} Check your network connection or click to try again.",{message:y});}else y=r._("{message} Click to send again.",{message:y});n.set(w,y,'above','center');if(v&&x){g.listen(w,'click',v);w.setAttribute('tabindex','0');h.addClass(w,"_55q-");}return w;},_cloneIfDOMElement:function(u){if(u.cloneNode){return u.cloneNode();}else return u;}};function t(u){var v=p.BASE_PATH;if(u&&u!=l.INBOX)v+='/'+u;return v;}e.exports=s;});
__d("ChatSidebarThread.react",["ChatSidebarItem.react","WebMessengerPermalinkConstants","React","MercuryThreadMetadataRawRenderer"],function(a,b,c,d,e,f){var g=b('ChatSidebarItem.react'),h=b('WebMessengerPermalinkConstants'),i=b('React'),j=b('MercuryThreadMetadataRawRenderer'),k=i.createClass({displayName:'ChatSidebarThread',render:function(){var n=this.props.name,o=l(this.props.threadID,this.props.participants),p=n?o:undefined,q=h.getURIPathForThreadID(this.props.threadID),r=m(this.props.image,this.props.participants),s=n?n:o;return (g({context:p,href:{url:q},imageSize:this.props.imageSize,images:r,name:s,status:this.props.status,unreadCount:this.props.unreadCount}));}});function l(n,o){return j.renderRawParticipantList(n,o,o.length,{names_renderer:j.renderShortNames});}function m(n,o){if(n)return n;return o.map(function(p){return p.image_src;});}e.exports=k;});
__d("ChatSidebarThreadlist.react",["ChatConfig","ChatGroupThreadsController","ChatSidebarConstants","ChatSidebarItem.react","ChatSidebarThread.react","MercuryServerRequests","MercuryThreads","MercuryParticipants","PresenceStatus","React","copyProperties","cx","fbt","ix"],function(a,b,c,d,e,f){var g=b('ChatConfig'),h=b('ChatGroupThreadsController'),i=b('ChatSidebarConstants'),j=b('ChatSidebarItem.react'),k=b('ChatSidebarThread.react'),l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get(),n=b('MercuryParticipants'),o=b('PresenceStatus'),p=b('React'),q=b('copyProperties'),r=b('cx'),s=b('fbt'),t=b('ix');function u(){if(g.get('litestand_blended_sidebar')||g.get('litestand_classic_sidebar')){return t('/images/litestand/sidebar/blended/new_group_chat.png');}else if(g.get('litestand')){return t('/images/chat/sidebar/newGroupChatLitestand.png');}else return t('/images/chat/sidebar/newGroupChat.png');}var v=p.createClass({displayName:'ChatSidebarThreadlist',render:function(){var w=this.state.threadData,x=this.state.participantData,y=i.getImageSize(),z=u(),aa="New Group Chat...";aa=g.get('divebar_group_new_button_name',aa);var ba=[];ba.push(p.DOM.li({className:(("_56yg")+(' '+"_56yj")+(this.props.offlineItems?' '+"_570-":'')),key:"new"},j({images:z,imageSize:y,name:aa})));var ca={};for(var da in w){var ea=w[da],fa=ea.participants.map(function(ja){return (x||{})[ja];}).filter(function(ja){return ja;}),ga=ea.participants.map(function(ja){return n.getUserID(ja);}),ha=ga.sort().join('|');if(!ca[ha]&&fa.length){ca[ha]=1;var ia=l.getServerThreadIDNow(da);ba.push(p.DOM.li({className:(("_5a58")+(' '+"_56yg")+(this.props.offlineItems?' '+"_570-":'')),'data-serverthreadid':ia,'data-threadid':da,key:da},k({image:ea.image_src,imageSize:y,name:ea.name,participants:fa,status:o.getGroup(ga),threadID:da,unreadCount:ea.unread_count})));}}return p.DOM.ul(null,ba);},getInitialState:function(){return {};},componentWillMount:function(){var w=function(){this.setState(this._calculateState());}.bind(this);this.token=h.subscribe('update',w);w();},componentWillUnmount:function(){this.token&&this.token.unsubscribe();this.token=null;},_calculateState:function(){var w=false,x={},y={},z=h.getThreadIDs(),aa=z.length;z.forEach(function(ca){m.getThreadMeta(ca,function(da){y[ca]=da;n.getMulti(da.participants,function(ea){delete ea[n.user];if(w){this.setState(this._calculateState());}else q(x,ea);aa--;}.bind(this));}.bind(this));}.bind(this));if(aa===0){return {threadData:y,participantData:x};}else{w=true;var ba=this.state||{};return {threadData:q(ba.threadData,y),participantData:q(ba.participantData,x)};}}});e.exports=v;});
__d("OrderedFriendsList",["AvailableList","ChatConfig","createArrayFrom","ShortProfiles","InitialChatFriendsList"],function(a,b,c,d,e,f){var g=b('AvailableList'),h=b('ChatConfig'),i=b('createArrayFrom'),j=b('ShortProfiles'),k=[],l={},m=[],n={contains:function(o){return o in l;},getList:function(){if(h.get('chat_web_ranking_with_presence'))n.reRank();var o=i(k);o=o.filter(function(p){var q=j.getNowUnsafe(p);return !q||q.type=="friend";});return o;},getRank:function(o){return o in l?l[o]:k.length;},reRank:function(){var o={},p={};m.forEach(function(r,s){var t=r.substr(0,r.length-2),u=r.substring(r.length-1);if(typeof(p.uid)=='undefined'){if(typeof(o.uid)=='undefined')o[t]=g.get(t);var v=o[t];if(v==u)p[s]=t;}});k=[];for(var q in p)k.push(p[q]);k.forEach(function(r,s){l[r]=s;});}};(function(){var o=b('InitialChatFriendsList');k=o.list.length?o.list:[];if(h.get('chat_web_ranking_with_presence')){m=k.slice();n.reRank();}k.forEach(function(p,q){l[p]=q;});})();e.exports=a.OrderedFriendsList||n;});
__d("ChatSortUsers",["AvailableListConstants","OrderedFriendsList","PresencePrivacy","PresenceStatus","ShortProfiles","TokenizeUtil"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('OrderedFriendsList'),i=b('PresencePrivacy'),j=b('PresenceStatus'),k=b('ShortProfiles'),l=b('TokenizeUtil');function m(q,r){var s=i.allows(q),t=i.allows(r);if(s!==t)return s?-1:1;return 0;}var n={};function o(q){if(n[q])return n[q];var r=(k.getNowUnsafe(q)||{}).name;if(r)return n[q]=l.flatten(r);return '~';}var p={sortAlphabetical:function(q,r){var s=o(q),t=o(r);if(s!==t)return s<t?-1:1;return 0;},sortMobile:function(q,r){var s=j.get(q)===g.MOBILE,t=j.get(r)===g.MOBILE;if(s!==t)return t?-1:1;return p.sortAlphabetical(q,r);},sortCoefficient:function(q,r){var s=h.getRank(q),t=h.getRank(r);if(s!==t)return s-t;return p.sortAlphabetical(q,r);},sort:function(q,r){var s=m(q,r);if(s!==0)return s;return p.sortCoefficient(q,r);}};e.exports=p;});
__d("ChatUnreadCount",["ArbiterMixin","MercuryThreadInformer","MercuryThreads","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('MercuryThreadInformer').get(),i=b('MercuryThreads').get(),j=b('copyProperties'),k={};h.subscribe('threads-updated',function(l,m){for(var n in m){var o=i.getCanonicalUserInThread(n);k.inform('unread-changed',o);}});j(k,g,{getUnreadCountForUID:function(l,m){i.getThreadMeta(i.getThreadIdForUser(l),function(n){m(n.unread_count);});}});e.exports=k;});
__d("ChatOrderedList",["Animation","Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AvailableList","AvailableListConstants","CSS","Chat","ChatConfig","ChatContexts","ChatGroupThreadsController","ChatOrderedListHover","ChatQuietLinks","ChatSidebarThreadlist.react","ChatSortUsers","ChatTypeaheadConstants","ChatUnreadCount","ChatVisibility","DOM","DataStore","Event","ImageSourceRequest","ImageSourceType","JSLogger","JSXDOM","LastMobileActiveTimes","MercuryParticipantTypes","OrderedFriendsList","Parent","PhotoResizeModeConst","PresencePrivacy","PresenceStatus","React","ShortProfiles","Style","Tooltip","URI","Vector","XHPTemplate","copyProperties","createObjectFrom","csx","cx","debounceAcrossTransitions","guid","ix","requestAnimationFrame","runAfterScrollingStops","shield","tx","mixin","ChannelImplementation"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('AsyncDialog'),k=b('AsyncRequest'),l=b('AvailableList'),m=b('AvailableListConstants'),n=b('CSS'),o=b('Chat'),p=b('ChatConfig'),q=b('ChatContexts'),r=b('ChatGroupThreadsController'),s=b('ChatOrderedListHover'),t=b('ChatQuietLinks'),u=b('ChatSidebarThreadlist.react'),v=b('ChatSortUsers'),w=b('ChatTypeaheadConstants'),x=b('ChatUnreadCount'),y=b('ChatVisibility'),z=b('DOM'),aa=b('DataStore'),ba=b('Event'),ca=b('ImageSourceRequest'),da=b('ImageSourceType'),ea=b('JSLogger'),fa=b('JSXDOM'),ga=b('LastMobileActiveTimes'),ha=b('MercuryParticipantTypes'),ia=b('OrderedFriendsList'),ja=b('Parent'),ka=b('PhotoResizeModeConst'),la=b('PresencePrivacy'),ma=b('PresenceStatus'),na=b('React'),oa=b('ShortProfiles'),pa=b('Style'),qa=b('Tooltip'),ra=b('URI'),sa=b('Vector'),ta=b('XHPTemplate'),ua=b('copyProperties'),va=b('createObjectFrom'),wa=b('csx'),xa=b('cx'),ya=b('debounceAcrossTransitions'),za=b('guid'),ab=b('ix'),bb=b('requestAnimationFrame'),cb=b('runAfterScrollingStops'),db=b('shield'),eb=b('tx'),fb=b("mixin"),gb=b('ChannelImplementation').instance,hb=null,ib,jb=9,kb=fb(i);for(var lb in kb)if(kb.hasOwnProperty(lb))nb[lb]=kb[lb];var mb=kb===null?null:kb.prototype;nb.prototype=Object.create(mb);nb.prototype.constructor=nb;nb.__superConstructor__=kb;function nb(ob,pb,qb,rb,sb){"use strict";this._isSidebar=ob;this._isLeftCollapsedSidebar=!!ja.byClass(pb,"_5ap0");this._root=pb;this._itemsMap={};this._isVisible=false;this._excludedIds={};this._numTopFriends=5;this._hasRendered=false;this._preventRendering=false;this._hoverController=null;this._template=qb;this._messageTemplate=rb;this._contextualDialog=sb;this._cachedItemHeight=null;this._cachedItemPadding=null;if(p.get('groups_in_divebar')){this._groupThreadsNode=fa.li({className:"_56yf"});this._updateGroupThreads();}this._orderedList=z.find(this._root,'.fbChatOrderedList');this._scrollableOrderedList=ja.byClass(this._root,'scrollableOrderedList');this._chatSidebar=ja.byClass(this._root,'fbChatSidebar');this._scrollableArea=ja.byClass(this._root,'scrollable');ba.listen(this._root,'click',this._onClick.bind(this));ba.listen(this._root,'mouseenter',this._mouseEnter.bind(this));ba.listen(this._root,'mouseleave',this._mouseLeave.bind(this));if(this._editButton)ba.listen(this._editButton,'click',this.toggleEditMode.bind(this));l.subscribe(m.ON_AVAILABILITY_CHANGED,db(this.update,this));la.subscribe('privacy-changed',db(this.update,this));gb.subscribe([gb.CONNECTED,gb.RECONNECTING,gb.SHUTDOWN,gb.MUTE_WARNING,gb.UNMUTE_WARNING],db(this.update,this));this.inform('initialized',this,h.BEHAVIOR_PERSISTENT);this.render();h.subscribe(ea.DUMP_EVENT,function(tb,ub){ub.chat_lists=ub.chat_lists||{sorted_list:this.getCachedSortedList(),ordered_list:ia.getList(),available_list:nb.getAvailableList(this._excludedIds),excluded_list:this._excludedIds};}.bind(this));h.subscribe('ChatOrderedList/itemHeightChange',function(){this._cachedItemHeight=null;this._cachedItemPadding=null;}.bind(this));this._renderUnreadCount=p.get('divebar_message_count');if(this._renderUnreadCount)x.subscribe('unread-changed',function(tb,ub){if(!this._renderedTopUsers||!(ub in this._renderedTopUsers)||!this._itemsMap[ub])return;x.getUnreadCountForUID(ub,this._updateUnreadCount.bind(this,ub));}.bind(this));}nb.prototype.getAllNodes=function(){"use strict";var ob={},pb=z.scry(this._root,"li._42fz");for(var qb=0;qb<pb.length;qb++){var rb=aa.get(pb[qb],'id');if(rb)ob[rb]=pb[qb];}return ob;};nb.prototype.getShowingUsers=function(){"use strict";return z.scry(this._root,"li._42fz,li._5a58").map(this.getUserForNode);};nb.prototype.getUserForNode=function(ob){"use strict";return aa.get(ob,'id')||aa.get(ob,'serverthreadid');};nb.prototype.getHoverController=function(){"use strict";if(!this._hoverController)this._hoverController=new s(this,this._contextualDialog);return this._hoverController;};nb.prototype.getPaddingOffset=function(){"use strict";return 8;};nb.prototype._calculateItemMeasurements=function(){"use strict";var ob=this._orderedList,pb=this._template.build(),qb=pb.getRoot();z.setContent(pb.getNode('name'),'test');qb.style.visibility='hidden';z.appendContent(ob,qb);this._cachedItemHeight=sa.getElementDimensions(qb).y;this._cachedItemPadding=pa.getFloat(pb.getNode('anchor'),'padding')||0;z.remove(qb);};nb.prototype.getItemHeight=function(){"use strict";if(this._cachedItemHeight===null)this._calculateItemMeasurements();return this._cachedItemHeight;};nb.prototype.getItemPadding=function(){"use strict";if(this._cachedItemPadding===null)this._calculateItemMeasurements();return this._cachedItemPadding;};nb.prototype._updateGroupThreads=function(){"use strict";if(this._groupThreadsNode){var ob=la.getVisibility(),pb=u({offlineItems:gb.disconnected()||!ob});na.renderComponent(pb,this._groupThreadsNode);}};nb.prototype._getListItem=function(ob){"use strict";var pb=this._itemsMap[ob];if(!pb)return;var qb=ma.get(ob),rb=ma.isBirthday(ob),sb=la.allows(ob)&&!gb.disconnected();if(pb.contextNode===undefined){pb.contextNode=z.find(pb.node,"._52zk");pb.timeNode=z.scry(pb.node,'.active_time')[0];pb.statusNodes=z.scry(pb.node,'img.status');pb.detailedPresenceNode=z.scry(pb.node,"._5t30")[0];}var tb={active:false,mobile:false,birthday:false};tb.active=qb===m.ACTIVE;tb.mobile=qb===m.MOBILE;tb.birthday=rb;if(tb.mobile){var ub=ga.getShortDisplay(ob);if(pb.timeNode&&pb.lastActiveTime!==ub){pb.lastActiveTime=ub;z.setContent(pb.timeNode,ub);if(p.get('sidebar_remove_mobile_icon'))pb.statusNodes.map(n.hide);}}else if(pb.lastActiveTime){pb.lastActiveTime=null;z.empty(pb.timeNode);}if(tb.active){if(p.get('sidebar_remove_mobile_icon'))pb.statusNodes.map(n.show);var vb=ma.getDetailedActivePresence(ob);if(pb.detailedPresenceNode&&vb){z.setContent(pb.detailedPresenceNode,vb);z.empty(pb.timeNode);}}else if(pb.detailedPresenceNode)z.empty(pb.detailedPresenceNode);if(p.get('sidebar_remove_mobile_icon'))tb.mobile=false;for(var wb in tb)n.conditionClass(pb.node,wb,tb[wb]&&sb);n.conditionClass(pb.node,'invis',!sb);var xb=n.hasClass(document.documentElement,'highContrast');pb.statusNodes.forEach(function(yb){if(qb===m.ACTIVE&&sb){yb.alt="Online";if(xb)yb.src=ab('/images/chat/status/online.png');}else if(qb===m.MOBILE&&sb){yb.alt="Mobile";if(xb)yb.src=ab('/images/chat/status/mobile.png');}else{yb.alt='';if(xb)yb.src=ab('/images/spacer.gif');}});this._applyContext(ob,pb);return pb.node;};nb.prototype.getRoot=function(){"use strict";return this._root;};nb.prototype.getSortedList=function(ob){"use strict";return nb.getSortedList(ob||this._excludedIds,this._numTopFriends);};nb.prototype.getCachedSortedList=function(ob){"use strict";if(hb==null)hb=this.getSortedList(ob);return hb;};nb.prototype.hide=function(){"use strict";if(!this._isVisible)return;this._isVisible=false;n.hide(this._scrollableOrderedList||this._root);this.inform('hide');};nb.prototype._getChatTabOpenLogData=function(ob){"use strict";var pb=n.hasClass(document.documentElement,'sidebarMode'),qb={mode:pb?'sidebar':'chatNub',typehead:false};if(this._scrollableArea&&this._scrollContainer){var rb=sa.getElementPosition(this._scrollableArea,'viewport').y,sb=sa.getElementPosition(ob,'viewport').y,tb=this._scrollContainer.scrollTop;if(sb>rb){qb.visible_slot=Math.round((sb-rb)/32);var ub=Math.round(tb/32);qb.global_slot=qb.visible_slot+ub;}}if(pb){qb.sidebar_height=this._chatSidebar&&this._chatSidebar.clientHeight;if(this._scrollContainer)qb.buddylist_height=this._scrollContainer.clientHeight;}return qb;};nb.prototype._onClick=function(event){"use strict";var ob=event.getTarget(),pb=ja.byTag(ob,'li');if(pb){if(n.hasClass(pb,'blackbirdWhitelist')){var qb=new ra('/ajax/chat/privacy/settings_dialog.php').addQueryData({ref:'whitelist_separator'});j.send(new k(qb));event.prevent();return false;}var rb=aa.get(pb,'id'),sb=n.hasClass(pb,"_56yg");if(rb||sb){var tb=this._getChatTabOpenLogData(pb),ub=n.hasClass(document.documentElement,'sidebarMode'),vb=la.getOnlinePolicy()===la.ONLINE_TO_WHITELIST,wb=vb?'white_list':'ordered_list';if(sb){rb=pb.getAttribute('data-threadid');wb=rb?'recent_threads_in_divebar':'recent_threads_in_divebar_new';}else while(pb.previousSibling){pb=pb.previousSibling;if(n.hasClass(pb,"_554m")){if(n.hasClass(pb,'moreOnlineFriends')){wb='more_online_friends';break;}if(n.hasClass(pb,'blackbirdWhitelist')){wb='blackbird_offline_section';break;}}}tb.source=wb;var xb=sb?w.THREAD_TYPE:ha.FRIEND;o.openTab(rb,xb,tb);this.inform('click',{id:rb});}else if(n.hasClass(pb,"_554m")&&ja.byClass(ob,"_554n"))this.scrollTo(pb);return false;}};nb.prototype._mouseEnter=function(){"use strict";this._preventRendering=true;};nb.prototype._mouseLeave=function(){"use strict";this._preventRendering=false;};nb.prototype.setExcludedIds=function(ob){"use strict";this._excludedIds=va(ob||[]);};nb.prototype.setNumTopFriends=function(ob){"use strict";if(ob!==this._numTopFriends){this._numTopFriends=ob;this.render();}};nb.prototype._getOfflineToSectionItems=function(){"use strict";var ob='subheader-text-'+za(),pb=z.create('a',{href:'#','aria-describedby':ob},z.tx._("Edit")),qb=[],rb=z.tx._("MORE FRIENDS");qb.push(fa.li({className:"_554m"},fa.div({className:"_554o"},fa.div({className:"_554n"},fa.span({className:"_554p"},rb),fa.div({className:"_554q"},fa.span({className:"_554r"}))))));qb.push(fa.li({className:"_554m blackbirdWhitelist"},fa.div({className:"_554o"},fa.div({className:"_554n"},fa.div({className:"_5v-d"},fa.span({id:ob,className:"_554t"},eb._("These friends can't see you on chat. {=link}",{'=link':pb})))))));return qb;};nb.prototype._renderOrderedList=function(){"use strict";if(!this._isVisible||(this._preventRendering&&this._hasRendered)||ib)return;this._hasRendered=true;this._cachedItems=null;var ob=[],pb,qb,rb=p.get('groups_in_divebar');rb&&this._updateGroupThreads();var sb=rb&&r.getThreadIDs().length,tb=sb||0;if(sb)tb++;var ub,vb,wb=nb.getSortedList({},Math.max(0,this._numTopFriends-tb));if(sb)this._groupThreadsNode&&ob.push(this._groupThreadsNode);var xb=la.getVisibility()&&la.getOnlinePolicy()==la.ONLINE_TO_WHITELIST;for(var yb=0,zb=wb.length;yb<zb;yb++){pb=wb[yb];if(xb)if(!la.allows(pb)){if(yb+2>=wb.length)break;xb=false;var ac=this._getOfflineToSectionItems();ob.push(ac[0]);ob.push(ac[1]);zb-=2;}qb=this._getListItem(pb);if(qb){ob.push(qb);}else this._renderListItem(pb,this.render.bind(this));}var bc=nb.getAvailableList(this._excludedIds),cc=wb,dc=va(cc);bc=bc.filter(function(lc){return !(lc in dc);});if(this._renderUnreadCount){var ec=[];if(this._renderedTopUsers){var fc=Object.keys(this._renderedTopUsers).filter(function(lc){return !(lc in dc);});fc.forEach(function(lc){this._updateUnreadCount(lc,0);}.bind(this));cc.forEach(function(lc){if(!(lc in this._renderedTopUsers))ec.push(lc);}.bind(this));}else ec=cc;var gc=this._updateUnreadCount.bind(this);ec.forEach(function(lc){x.getUnreadCountForUID(lc,function(mc){gc(lc,mc);});});this._renderedTopUsers=dc;}if(p.get('divebar_show_mobile_more_friends_alphabetical')){bc.sort(v.sortAlphabetical);}else bc.sort(v.sortMobile);var hc="MORE FRIENDS";if(bc.length&&ob.length){var ic=eb._("{MORE ONLINE FRIENDS} ({=count})",{'MORE ONLINE FRIENDS':hc,'=count':bc.length});}else ic=eb._("{MORE ONLINE FRIENDS} ({=count})",{'MORE ONLINE FRIENDS':hc,'=count':bc.length});ob.push(fa.li({className:"_554m moreOnlineFriends"},fa.div({className:"_554o"},fa.div({className:"_554n"},fa.span({className:"_554p"},ic),fa.div({className:"_554q"},fa.span({className:"_554r"}))))));for(ub=0,vb=bc.length;ub<vb;ub++){pb=bc[ub];qb=this._getListItem(pb);if(qb){ob.push(qb);}else this._renderListItem(pb,this.render.bind(this));}if(!wb.length&&!bc.length&&!tb){var jc=this._messageTemplate.render(),kc=ta.getNode(jc,'message');z.setContent(kc,"No one is available to chat.");ob.push(jc);}if(ob.length){z.setContent(this._orderedList,ob);t.nukeLinks(this.getRoot());this.inform('render');if(!this._renderingAfterScroll){this._renderingAfterScroll=true;this.render=ya(cb.bind(null,this._renderOrderedList.bind(this),'ChatOrderedList/render',true),300);}}};nb.prototype.render=function(){"use strict";this.render=ya(this._renderOrderedList.bind(this),300);this.render();};nb.prototype._renderListItem=function(ob,pb){"use strict";oa.get(ob,function(qb){var rb=this._template.render(),sb=ta.getNode(rb,'profile-photo');if(p.get('chat_use_client_side_image_requests',0)){var tb=28;new ca().setFBID(qb.id).setType(da.PROFILE_PICTURE).setDimensions(tb,tb).setResizeMode(ka.COVER).setCallback(function(yb){sb.setAttribute('src',yb.uri);}).send();}else sb.setAttribute('src',qb.thumbSrc);var ub=ta.getNode(rb,'name');z.setContent(ub,qb.name);if(qb.dir)ub.setAttribute('dir',qb.dir);var vb=ta.getNode(rb,'accessible-name');z.setContent(vb,qb.name);var wb=ta.getNode(rb,'anchor');wb.setAttribute('href','/messages/'+ob);var xb=ta.getNode(rb,'tooltip');xb&&qa.set(xb,qb.name,'right');aa.set(rb,'id',ob);this._itemsMap[ob]={node:rb};pb&&pb(rb);}.bind(this));};nb.prototype._updateUnreadCount=function(ob,pb){"use strict";var qb=this._itemsMap[ob];if(!qb)return;if(this._isSidebar){this._unreadMessages=this._unreadMessages||{};if(!!pb){this._unreadMessages[ob]=true;}else delete this._unreadMessages[ob];h.inform('buddylist-nub/updateCount',{count:Object.keys(this._unreadMessages).length});}qb.unreadCount=qb.unreadCount||z.find(qb.node,"._550_");pb=pb?pb:0;z.setContent(qb.unreadCount,pb>jb?jb+'+':pb);n.conditionClass(qb.unreadCount,"_550z",pb>jb);n.conditionClass(qb.node,"_550-",pb);};nb.prototype.show=function(){"use strict";if(this._isVisible)return;this._isVisible=true;n.show(this._scrollableOrderedList||this._root);this.render();this.inform('show');};nb.prototype.isVisible=function(){"use strict";return this._isVisible;};nb.prototype.update=function(){"use strict";this._hasRendered=false;if(!this._renderRequest)this._renderRequest=bb(function(){this.render();this._renderRequest=null;}.bind(this));};nb.prototype.setScrollContainer=function(ob){"use strict";if(z.contains(ob,this._root))this._scrollContainer=ob;};nb.prototype.scrollTo=function(ob){"use strict";if(!this._scrollContainer)return;var pb=this._scrollContainer.scrollHeight,qb=this._scrollContainer.clientHeight,rb=this._scrollContainer.scrollTop,sb=Math.min(ob.offsetTop,pb-qb);if(rb!==sb){var tb=Math.abs(sb-rb)/this._scrollContainer.clientHeight*500;new g(this._scrollContainer).to('scrollTop',sb).ease(g.ease.end).duration(tb).go();}};nb.prototype._applyContext=function(ob,pb){"use strict";var qb=q.getShortDisplay(ob)||'';if(pb.contextNode){z.setContent(pb.contextNode,qb);n.conditionClass(pb.node,"_52zj",qb);var rb=q.get(ob),sb=rb?rb.type:null;for(var tb in nb.CONTEXT_CLASSES){var ub=(tb===sb),vb=nb.CONTEXT_CLASSES[tb]||"_56x-";n.conditionClass(pb.contextNode,vb,ub);}}};nb.getSortedList=function(ob,pb){"use strict";var qb=ia.getList().filter(function(tb){return !(tb in ob)&&la.getFriendVisibility(tb)!==la.BLACKLISTED;}),rb=[];if(!y.isOnline()){Array.prototype.push.apply(rb,qb);}else{if(la.getOnlinePolicy()===la.ONLINE_TO_WHITELIST)qb=this._filterByWhitelist(qb);if(p.get('chat_web_ranking_with_presence')){Array.prototype.push.apply(rb,qb);}else rb=this._splitOutTopFriends(qb,pb);}rb=rb.slice(0,pb);if(rb.length===pb){var sb=nb.getAvailableList(rb.concat(ob)).length;sb&&rb.splice(-1);}if(!p.get('chat_web_ranking_with_presence'))rb.sort(v.sort);hb=rb.slice();return rb;};nb._filterByWhitelist=function(ob){"use strict";var pb=ob,qb={},rb,sb;ob=[];for(rb=0;rb<pb.length;++rb){sb=pb[rb];if(la.allows(sb)){qb[sb]=true;ob.push(sb);}}var tb=la.getWhitelist();for(rb=0;rb<tb.length;++rb){sb=tb[rb];if(!(sb in qb))ob.push(sb);}for(rb=0;rb<pb.length;++rb){sb=pb[rb];if(!la.allows(sb))ob.push(sb);}return ob;};nb._splitOutTopFriends=function(ob,pb){"use strict";var qb=[],rb=[],sb=p.get('ordered_list.top_friends',0),tb=p.get('ordered_list.top_mobile',0),ub=pb,vb=ob.length;for(var wb=0;wb<vb&&ub>0;wb++){var xb=ob[wb],yb=ma.get(xb),zb=yb===m.ACTIVE;if(zb||(yb===m.MOBILE&&wb<tb)||wb<sb){qb.push(xb);zb&&ub--;}else rb.push(xb);}if(wb<vb)Array.prototype.push.apply(rb,ob.slice(wb));if(qb.length<pb)Array.prototype.push.apply(qb,rb);return qb;};nb.getAvailableList=function(ob){"use strict";var pb;if(p.get('divebar_show_mobile_more_friends')||p.get('divebar_show_mobile_more_friends_alphabetical'))pb=l.getAvailableIDs();if(!pb)pb=l.getOnlineIDs();return pb.filter(function(qb){return !(qb in ob);});};nb._pause=function(){"use strict";ib=true;};nb._unpause=function(){"use strict";ib=false;};nb._registerToggleRenderItem=function(ob){"use strict";ba.listen(ob,'click',function(){ib=!ib;n.conditionClass(ob,'checked',ib);});};ua(nb,{CONTEXT_CLASSES:{nearby:"_56xw",visiting:"_56xx",neighbourhood:"_56xy",listening:"_56xz"}});e.exports=nb;});
__d("ChatTypeaheadCore",["Event","Keys","TypeaheadCore","copyProperties","emptyFunction","shield"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Keys'),i=b('TypeaheadCore'),j=b('copyProperties'),k=b('emptyFunction'),l=b('shield');for(var m in i)if(i.hasOwnProperty(m))o[m]=i[m];var n=i===null?null:i.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=i;function o(){"use strict";if(i!==null)i.apply(this,arguments);}o.prototype.init=function(p,q,r){"use strict";n.init.call(this,p,q,r);this.informBeginActive=false;this.informEndActive=false;this.data.subscribe('respond',function(){if(this.informBeginActive){this.informBeginActive=false;this.inform('sidebar/typeahead/active',true);}else if(this.informEndActive){this.informEndActive=false;this.inform('sidebar/typeahead/active',false);}}.bind(this));};o.prototype.keydown=function(event){"use strict";var p=g.getKeyCode(event);if(p===h.ESC){setTimeout(l(this.reset,this),0);if(!this.getValue()){this.element.blur();this.inform('escape');}return event.kill();}return n.keydown.call(this,event);};o.prototype.checkValue=function(){"use strict";var p=this.getValue(),q=this.value;if(p==q)return;if(q&&!p){this.typeaheadActive=false;this.informEndActive=true;}else if(!q&&p){this.typeaheadActive=true;this.informBeginActive=true;this.inform('sidebar/typeahead/preActive');}n.checkValue.call(this);};j(o.prototype,{handleTab:k});e.exports=o;});
__d("ChatTypeaheadDataSource",["ChatSortUsers","CurrentUser","DataSource","JSLogger","MercuryParticipantTypes","Run","ShortProfiles"],function(a,b,c,d,e,f){var g=b('ChatSortUsers'),h=b('CurrentUser'),i=b('DataSource'),j=b('JSLogger'),k=b('MercuryParticipantTypes'),l=b('Run'),m=b('ShortProfiles');for(var n in i)if(i.hasOwnProperty(n))p[n]=i[n];var o=i===null?null:i.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=i;function p(q){"use strict";q=q||{};q.kanaNormalization=true;i.call(this,q);this.persistOnRefresh=q.persistOnRefresh!==false;this.showOfflineUsers=!!q.showOfflineUsers;this._jslog=j.create('chat_typeahead');this._jslog.log('created');}p.prototype.init=function(){"use strict";this._jslog.log('init');o.init.call(this);this._update();};p.prototype.bootstrap=function(){"use strict";this._jslog.log('bootstrap');o.bootstrap.call(this);if(this.showOfflineUsers){this._jslog.log('show_offline_users');this._jslog.log('ensured_short_profiles');if(m.hasAll()){this._update();}else{this._jslog.log('fetch_all_short_profiles');m.fetchAll();this.inform('activity',{activity:true});var q=m.subscribe('updated',function(){this.inform('activity',{activity:false});this._update();}.bind(this));if(!this.persistOnRefresh)l.onLeave(function(){m.unsubscribe(q);});}}};p.prototype._update=function(){"use strict";d(['AvailableList'],function(q){var r=this.value;this.dirty();var s=m.getCachedProfileIDs(),t=s.filter(function(v){var w=m.getNow(v);return w.type===k.FRIEND;});t.sort(g.sort);var u=[];t.forEach(function(v){if(v==h.getID())return;var w=q.get(v);if(!this.showOfflineUsers&&w!==q.ACTIVE)return;var x=m.getNow(v),y=x.additionalName;if(x.hasOwnProperty('searchTokens'))y=y!==null?y+" "+x.searchTokens.join(" "):x.searchTokens.join(" ");u.push({uid:v,text:x.name,tokens:y,localized_text:x.name,additional_text:x.additionalName,photo:x.thumbSrc,type:x.type});}.bind(this));if(u.length)this.addEntries(u);this.value=r;if(r)this.query(r);}.bind(this));};p.prototype.refreshData=function(){"use strict";d(['AvailableList'],function(q){q.update();}.bind(this));};e.exports=p;});
__d("ChatSidebarHeader.react",["React","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('cx'),i=g.createClass({displayName:'ReactChatSidebarHeader',render:function(){return (g.DOM.div({className:"_55ob"},g.DOM.div({className:"_55oc"},this.props.name)));}});e.exports=i;});
__d("ChatSidebarUser.react",["WebMessengerPermalinkConstants","ChatConfig","React","ChatSidebarItem.react"],function(a,b,c,d,e,f){var g=b('WebMessengerPermalinkConstants'),h=b('ChatConfig'),i=b('React'),j=b('ChatSidebarItem.react'),k=i.createClass({displayName:'ChatSidebarUser',render:function(){var l=g.getURIPathForIDOrVanity(this.props.userID);return (j({href:{url:l},imageSize:this.props.imageSize,images:this.props.image,name:this.props.name,status:this.props.status,birthday:this.props.birthday,statusTime:this.props.statusTime,detailedStatus:this.props.detailedStatus,context:this.props.context}));}});e.exports=k;});
__d("ChatTypeaheadRenderer",["AvailableListConstants","ChatSidebarConstants","ChatSidebarHeader.react","ChatSidebarThread.react","ChatSidebarUser.react","ChatTypeaheadConstants","DOM","LastMobileActiveTimes","MercuryParticipants","PresenceStatus","React"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('ChatSidebarConstants'),i=b('ChatSidebarHeader.react'),j=b('ChatSidebarThread.react'),k=b('ChatSidebarUser.react'),l=b('ChatTypeaheadConstants'),m=b('DOM'),n=b('LastMobileActiveTimes'),o=b('MercuryParticipants'),p=b('PresenceStatus'),q=b('React'),r={};function s(x,y){if(!(x in r))r[x]=m.create('li');q.renderComponent(y,r[x]);return r[x];}function t(x){return s(x.text,i({name:x.text}));}function u(x){var y=x.mercury_thread.participants.map(function(z){return o.getUserID(z);});return s(x.uid,j({image:x.mercury_thread.image_src,imageSize:h.getImageSize(),name:x.mercury_thread.name,participants:x.participants_to_render,status:p.getGroup(y),threadID:x.uid}));}function v(x){var y=p.get(x.uid),z=(y===g.MOBILE)?n.getShortDisplay(x.uid):null,aa=(x.render_type==l.NON_FRIEND_TYPE||x.render_type==l.FB4C_TYPE)?x.subtext:null,ba=null;if(y===g.ACTIVE)ba=p.getDetailedActivePresence(x.uid);return s(x.uid,k({image:x.photo,imageSize:h.getImageSize(),name:x.text,status:y,birthday:p.isBirthday(x.uid),statusTime:z,detailedStatus:ba,userID:x.uid,context:aa}));}function w(x,y){if(x.type===l.HEADER_TYPE)return t(x);if(x.type==l.THREAD_TYPE)return u(x);return v(x);}e.exports=w;});
__d("escapeRegex",[],function(a,b,c,d,e,f){function g(h){return h.replace(/([.?*+\^$\[\]\\(){}|\-])/g,"\\$1");}e.exports=g;});
__d("MercuryThreadSearchUtils",["escapeRegex","TokenizeUtil"],function(a,b,c,d,e,f){var g=b('escapeRegex'),h=b('TokenizeUtil'),i={wordsInString:function(j){return (j||'').split(/\s+/).filter(function(k){return k.trim().length>0;});},anyMatchPredicate:function(j,k){for(var l=0;l<j.length;l++)if(k(j[l]))return true;return false;},allMatchPredicate:function(j,k){for(var l=0;l<j.length;l++)if(!k(j[l]))return false;return true;},queryWordMatchesAnyNameWord:function(j,k){var l=new RegExp('\\b'+g(j),'i');return this.anyMatchPredicate(k,function(m){var n=h.parse(m).flatValue;return l.test(n);});},queryMatchesName:function(j,k){var l=this.wordsInString(j),m=this.wordsInString(k);return this.allMatchPredicate(l,function(n){return this.queryWordMatchesAnyNameWord(n,m);}.bind(this));}};e.exports=i;});
__d("ChatTypeaheadView",["BucketedTypeaheadView","ChatConfig","ChatTypeaheadConstants","CurrentUser","MercuryThreadSearchUtils","arrayContains","fbt","tx"],function(a,b,c,d,e,f){var g=b('BucketedTypeaheadView'),h=b('ChatConfig'),i=b('ChatTypeaheadConstants'),j=b('CurrentUser'),k=b('MercuryThreadSearchUtils'),l=b('arrayContains'),m=b('fbt'),n=b('tx'),o=h.get('divebar_typeahead_group_fof',0);for(var p in g)if(g.hasOwnProperty(p))r[p]=g[p];var q=g===null?null:g.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=g;function r(s,t){"use strict";g.call(this,s,t);this.typeObjects={};this.typeObjectsOrder=[];this.typeObjects[i.NON_FRIEND_TYPE]={uid:i.NON_FRIEND_TYPE,type:i.HEADER_TYPE,text:"FRIENDS OF FRIENDS"};this.typeObjectsOrder.push(i.NON_FRIEND_TYPE);this.typeObjects[i.THREAD_TYPE]={uid:i.THREAD_TYPE,type:i.HEADER_TYPE,text:"GROUP CONVERSATIONS"};this.typeObjectsOrder.push(i.THREAD_TYPE);this.typeObjects[i.FB4C_TYPE]={uid:i.FB4C_TYPE,type:i.HEADER_TYPE,text:"CO-WORKERS"};this.typeObjectsOrder.push(i.FB4C_TYPE);this.typeObjects[i.FRIEND_TYPE]={disabled:true,uid:i.FRIEND_TYPE,type:i.HEADER_TYPE,text:"FRIENDS"};this.typeObjectsOrder.push(i.FRIEND_TYPE);}r.prototype.buildBuckets=function(s,t){"use strict";if(o){t=t.reverse();t=t.filter(function(u){var v=u.render_type||u.type;if(v==='thread'){var w='fbid:'+j.getID();if(!l(u.mercury_thread.participants,w))return false;var x=u.participants_to_render.some(function(z){return k.queryMatchesName(s,z.name);}),y=k.queryMatchesName(s,u.mercury_thread.name);if(!x&&!y)return false;}return true;});}t=q.buildBuckets.call(this,s,t);if(!o)t=t.filter(function(u){return u&&!u.disabled;});return t;};r.prototype.getDefaultIndex=function(s){"use strict";if(!o)return q.getDefaultIndex.call(this,s);if(s.length===0)return -1;var t=s.length-1;while(!this.isHighlightable(s[t])&&t>=0)t--;return t;};e.exports=r;});
__d("ChatHovercard",["Arbiter","AsyncLoader","Hovercard","JSLogger","debounce"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncLoader'),i=b('Hovercard'),j=b('JSLogger'),k=b('debounce'),l=5,m=new h('/ajax/chat/hovercard/sidebar.php','hover'),n=j.create('chat_hovercard');g.subscribe('Hovercard/dirty',m.reset.bind(m));function o(s,t){m.get(s,function(u){setTimeout(function(){if(!u){n.error('fetch_failure',{id:s});return;}var v=i.getDialog(u);if(!v){n.error('no_hovercard',{id:s,endpoint:u});return;}if(s==t.getActiveID())t.showHovercard(s,v);},0);});}function p(s,t){var u=[];function v(y){if(y>=0&&y<s.length)u.push(s[y]);}var w=s.indexOf(t);if(w>-1){v(w);for(var x=1;x<l;x++){v(w+x);v(w-x);}}return u.filter(function(y){return y;});}function q(s,t){var u=t.getActiveID();if(u){var v=s.getShowingUsers(),w=p(v,u);m.get(w,function(){});}}function r(s){var t=s.getHoverController();t.registerDefault(o);t.subscribe('hover',k(q.bind(null,s,t),100));}e.exports=r;});
__d("ChatOptions",["Arbiter","ChannelConstants","JSLogger","PresenceUtil","copyProperties","ChatOptionsInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('JSLogger'),j=b('PresenceUtil'),k=b('copyProperties'),l=i.create('chat_options'),m={};(function(){var o=b('ChatOptionsInitialData');for(var p in o){var q=o[p];m[p]=!!q;}})();var n=k(new g(),{getSetting:function(o){return m[o];},setSetting:function(o,p,q){if(this.getSetting(o)==p)return;if(q){q='from_'+q;l.log(q,{name:o,new_value:p,old_value:this.getSetting(o)});}m[o]=!!p;g.inform('chat/option-changed',{name:o,value:p});}});g.subscribe(h.getArbiterType('setting'),function(o,p){var q=p.obj;if(q.window_id===j.getSessionID())return;n.setSetting(q.setting,!!q.value,'channel');});g.subscribe(i.DUMP_EVENT,function(o,p){p.chat_options=m;});e.exports=n;});
__d("FBDesktopPlugin",["CacheStorage","CurrentUser","DOM","FBDesktopDetect","Style","URI"],function(a,b,c,d,e,f){var g=b('CacheStorage'),h=b('CurrentUser'),i=b('DOM'),j=b('FBDesktopDetect'),k=b('Style'),l=b('URI'),m=new g('localstorage','_socialfox_'),n={_plugin:'_not_checked',arbiterInform:function(o,p){var q=JSON.stringify({name:o,payload:p});this._transmitCommand('arbiterinform',q);},bringToFront:function(){this._transmitCommand('bringtofront');},dock:function(){this._transmitCommand('dock');},getPlugin:function(){if(this._plugin==='_not_checked'){this._plugin=null;if(j.isPluginInstalled()){var o=i.create('object',{id:'kiwi_plugin',type:j.mimeType});k.set(o,'width',0);k.set(o,'height',0);var p=i.create('div',{},o);k.set(p,'width',0);k.set(p,'height',0);document.body.appendChild(p);this._plugin=o;}}return this._plugin;},getUserID:function(){var o=this.getPlugin();return o&&'getUserID' in o&&o.getUserID();},getVersion:function(){var o=this.getPlugin();return o&&'getVersion' in o&&o.getVersion();},isAppRunning:function(){var o=this.getPlugin();return o&&'isAppRunning' in o&&o.isAppRunning();},launchApp:function(){var o=this.getPlugin();return o&&'launchApp' in o&&o.launchApp();},login:function(o,p){if(p&&o&&o.length>0){var q=this.getPlugin();if(q){this._transmitCommand('relogin\n'+o+'\n'+p);return;}}},logout:function(o){o=o||"0";var p=this.getPlugin();if(p)p.logout(o);},recheck:function(){if(this._plugin===null)this._plugin='_not_checked';},shouldSuppressBeeper:function(){return this.isAppRunning();},shouldSuppressMessages:function(){if(m&&m.get('connected'))return true;var o=this.getUserID();if(o){return o===h.getID();}else return this.isAppRunning();},shouldSuppressSidebar:function(){var o=this.getPlugin(),p=o&&'isAppDocked' in o&&o.isAppDocked(),q=m&&m.get('active')==='true';return p||q;},transferAuthToken:function(o,p){if(o&&o.length>0){var q=this.getPlugin();if(q){q.setAccessToken(o,p);var r=setInterval(function(){q.setAccessToken(o,p);},500);setTimeout(function(){clearInterval(r);},10*1000);}}if(this.redirectHome)window.location.href=l().setPath().toString();},_transmitCommand:function(o,p){p=p||'';var q=this.getPlugin();if(q&&'transmitCommand' in q)q.transmitCommand(o,p);}};e.exports=n;});
__d("SidebarFitWindowHeight",["Arbiter","ArbiterMixin","Event","Style","SubscriptionsHandler","TinyViewport","Vector","mixin","queryThenMutateDOM"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Event'),j=b('Style'),k=b('SubscriptionsHandler'),l=b('TinyViewport'),m=b('Vector'),n=b('mixin'),o=b('queryThenMutateDOM'),p=n(h);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t){"use strict";this.$SidebarFitWindowHeight0=t;this.onViewportUpdate();l.subscribe('change',this.onViewportUpdate.bind(this));}s.prototype.onViewportUpdate=function(){"use strict";if(l.isTiny()){this.onScroll();var t=this.onScroll.bind(this);this.$SidebarFitWindowHeight1=new k();this.$SidebarFitWindowHeight1.addSubscriptions(i.listen(window,'scroll',t),g.subscribe('dom-scroll',t));}else{if(this.$SidebarFitWindowHeight2!==0){j.set(this.$SidebarFitWindowHeight0,'margin-top','0');this.$SidebarFitWindowHeight2=0;}this.$SidebarFitWindowHeight1&&this.$SidebarFitWindowHeight1.release();}};s.prototype.onScroll=function(){"use strict";o(this.updateScrollPosition.bind(this),this.resizeSidebar.bind(this),'SidebarFitWindowHeight/scroll');};s.prototype.updateScrollPosition=function(){"use strict";this.$SidebarFitWindowHeight3=m.getScrollPosition().y;this.$SidebarFitWindowHeight4||(this.$SidebarFitWindowHeight4=this.$SidebarFitWindowHeight0.offsetHeight);};s.prototype.resizeSidebar=function(){"use strict";var t=-Math.max(Math.min(this.$SidebarFitWindowHeight3,this.$SidebarFitWindowHeight4),0);j.set(this.$SidebarFitWindowHeight0,'margin-top',t+'px');if(t!=this.$SidebarFitWindowHeight2){this.$SidebarFitWindowHeight2=t;this.inform('resized',t);}};s.prototype.getOffset=function(){"use strict";return this.$SidebarFitWindowHeight2;};e.exports=s;});
__d("ChatSidebar",["ChatOrderedList","ChatTypeaheadBehavior","ChatTypeaheadCore","ChatTypeaheadDataSource","ChatTypeaheadRenderer","ChatTypeaheadView","Typeahead","Arbiter","ArbiterMixin","AsyncRequest","AsyncSignal","Bootloader","Chat","ChatConfig","ChatHovercard","ChatImpressionLogger","ChatOptions","ChatSidebarSheet","CSS","DOM","DOMDimensions","Env","Event","FBDesktopPlugin","JSLogger","JSXDOM","KeyEventController","OrderedFriendsList","Parent","PresencePrivacy","ScrollableArea","SidebarFitWindowHeight","Style","UserAgent","ViewportBounds","copyProperties","createArrayFrom","csx","cx","debounce","emptyFunction","ge"],function(a,b,c,d,e,f){b('ChatOrderedList');b('ChatTypeaheadBehavior');b('ChatTypeaheadCore');b('ChatTypeaheadDataSource');b('ChatTypeaheadRenderer');b('ChatTypeaheadView');b('Typeahead');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncRequest'),j=b('AsyncSignal'),k=b('Bootloader'),l=b('Chat'),m=b('ChatConfig'),n=b('ChatHovercard'),o=b('ChatImpressionLogger'),p=b('ChatOptions'),q=b('ChatSidebarSheet'),r=b('CSS'),s=b('DOM'),t=b('DOMDimensions'),u=b('Env'),v=b('Event'),w=b('FBDesktopPlugin'),x=b('JSLogger'),y=b('JSXDOM'),z=b('KeyEventController'),aa=b('OrderedFriendsList'),ba=b('Parent'),ca=b('PresencePrivacy'),da=b('ScrollableArea'),ea=b('SidebarFitWindowHeight'),fa=b('Style'),ga=b('UserAgent'),ha=b('ViewportBounds'),ia=b('copyProperties'),ja=b('createArrayFrom'),ka=b('csx'),la=b('cx'),ma=b('debounce'),na=b('emptyFunction'),oa=b('ge'),pa,qa=false,ra=false,sa=false,ta=false,ua=false,va=false,wa,xa,ya,za,ab,bb=null,cb,db,eb,fb,gb,hb,ib=28,jb=38,kb=x.create('chat_sidebar');function lb(){if(db)return;r.removeClass(document.documentElement,'sidebarMode');if(!ta||!ub.isVisible()){g.inform('reflow');return;}sa=false;bb=null;wa.hide();za.getCore().reset();r.hide(xa);kb.rate('sidebar_hide',ta);ub.inform('sidebar/hide',ub);g.inform('sidebar/hide',ub);g.inform('reflow');}function mb(){var vb=ub.shouldShowSidebar();r.conditionClass(document.documentElement,'sidebarCapable',vb);if(ub.isEnabled()&&vb){pb();var wb;if(cb){var xb=r.hasClass(xa,"_4w59");if(xb)return;hb=hb||s.find(xa,"._50g0");if(cb.has_favorites_editing)gb=gb||s.scry(xa,"._52s9")[0];wb=[hb];}else wb=ja(xa.childNodes);var yb=ob(wb),zb=wa.getItemHeight()||32,ac=wa.getPaddingOffset()||8,bc;if(db){if(db.isExpanded()){ac=ac+ib;if(cb&&cb.always_show_one_see_more)ac+=zb;}if(!l.isOnline())ac+=jb;var cc=Math.floor(wa.getItemPadding()/2);bc=Math.floor((yb-ac+cc)/zb);if(!wa.isVisible())fa.set(pa,'height',yb+'px');}else{bc=Math.floor((yb-ac)/(zb+1));fa.set(pa,'height',yb+'px');}wa.setNumTopFriends(bc);var dc=Math.floor((yb-ac)/zb);if(rb())dc=(dc-2)>0?dc-2:0;za.getData().setMaxResults(dc);ub.inform('sidebar/resized',ub);g.inform('sidebar/resized',ub);g.inform('reflow');}else lb();if(!ta){tb();ta=true;}bb=null;}function nb(){if(za&&ub.isVisible())za.getCore().getElement().focus();}function ob(vb){if(!vb)if(cb){hb=hb||s.find(xa,"._50g0");vb=[hb];}else vb=ja(xa.childNodes);var wb=ab.height;if(db&&eb)wb-=eb.getFullHeight();vb.forEach(function(xb){if(xb&&xb!==pa)wb-=t.getElementDimensions(xb).height;});if(fb)wb-=fb.getOffset();return Math.max(0,wb);}function pb(){if(ub.isVisible())return;sa=true;bb=null;r.show(xa);r.addClass(document.documentElement,'sidebarMode');wa.show();kb.rate('sidebar_show',ta);ub.inform('sidebar/show',ub);g.inform('sidebar/show',ub);}function qb(){p.setSetting('sidebar_mode',ub.isEnabled(),'sidebar');new i('/ajax/chat/settings.php').setHandler(na).setErrorHandler(na).setData({sidebar_mode:ub.isEnabled()}).setAllowCrossPageTransition(true).send();}function rb(){return m.get('divebar_typeahead_group_fof',0);}function sb(){return aa.getList().length<=m.get('sidebar.min_friends');}function tb(){var vb=true;if(!ub.isEnabled()){kb.log('state_not_enabled');vb=false;}if(!ub.isViewportCapable()){kb.log('state_not_shown_viewport');vb=false;}if(ra){kb.log('state_not_shown_hidden');vb=false;}if(sb()){kb.log('state_not_shown_num_friends');vb=false;}if(w.shouldSuppressSidebar()){kb.log('state_not_shown_fbdesktop');vb=false;}kb.log(vb?'state_shown':'state_not_shown');}var ub={init:function(vb,wb,xb,yb){ub.init=na;ua=true;xa=vb;wa=wb;za=xb;ya=yb;pa=s.find(vb,'div.fbChatSidebarBody');db=yb&&yb.ls_module;cb=yb&&yb.ls_config;if(db){g.subscribe('ViewportSizeChange',function(){g.inform('ChatOrderedList/itemHeightChange');mb();});g.subscribe('Sidebar/BookmarksHeightChange',mb);k.loadModules(['LitestandSidebarBookmarksDisplay'],function(cc){eb=cc;});}else v.listen(window,'resize',mb);z.registerKey('q',function(event){if(sa){var cc=null;if(hb){cc=s.scry(hb,'.inputsearch')[0];}else cc=s.scry(vb,'.inputsearch')[0];if(cc){cc.focus();event.prevent();}}});new n(wb);var zb=new q(vb);zb.subscribe('updated',mb);g.subscribe('sidebar/invalidate',mb);wb.setScrollContainer(ba.byClass(wb.getRoot(),'uiScrollableAreaWrap'));wb.subscribe(['render','show','hide'],ma(function(cc){if(cc==='render'&&!va){va=true;ub.inform('sidebar/chatRendered',null,g.BEHAVIOR_PERSISTENT);}var dc=wb.getRoot(),ec=da.getInstance(dc);ec&&ec.adjustGripper();}));wb.subscribe(['editStart','editEnd'],function(cc){r.conditionClass(za.getView().element,"_4-d6",cc=='editStart');});if(ga.firefox()>=17)v.listen(window,'storage',function(cc){if(cc.key=='_socialfox_active'&&cc.oldValue!=cc.newValue)mb();});g.subscribe('chat/option-changed',function(cc,dc){if(dc.name=="sidebar_mode"){qa=!!p.getSetting('sidebar_mode');mb();}});xb.getCore().subscribe('sidebar/typeahead/active',ub.updateOnActiveTypeahead);xb.subscribe('reset',function(){if(!xb.getCore().getValue()&&!wa.isVisible())ub.updateOnActiveTypeahead(null,false);});if(db){xb.getCore().subscribe('sidebar/typeahead/preActive',function(cc,dc){if(qa&&za.getView().isVisible()){g.inform(cc,dc);}else mb();});}else g.subscribe('buddylist-nub/initialized',function(cc,dc){v.listen(dc.getButton(),'click',function(event){var ec=ra;ra=false;ub.enable();var fc=ub.shouldShowSidebar();ra=ec&&!fc;return !fc;});});qa=!!p.getSetting('sidebar_mode');ga.ie()&&v.listen(vb,'click',function(cc){if(ba.byClass(cc.getTarget(),"_57du"))nb();});ca.subscribe('privacy-user-presence-changed',mb);mb();o.init(wa);if(!db)ha.addRight(ub.getVisibleWidth);ub.inform('sidebar/initialized',ub,g.BEHAVIOR_PERSISTENT);g.inform('sidebar/initialized',ub,g.BEHAVIOR_PERSISTENT);if(m.get('sidebar_below_bluebar')){var ac=s.find(vb,"._5qqe");fb=new ea(ac);fb.subscribe('resized',mb);}if(m.get('chat_sidebar_load_log')){var bc={loaded:true,session_token:yb.session_token,buddylist_short:m.get('buddylist_short_group'),bootloader_retry:u.bootloader_retry_on_timeout};new j('/ajax/chat/sidebar_load_log.php',bc).send();}},updateOnActiveTypeahead:function(vb,wb){if(!sa)return;if(wb){wa.hide();if(db){r.addClass(xa,"_5384");var xb=ob();if(gb)xb+=t.getElementDimensions(gb).height;fa.set(pa,'height',xb+'px');}}else{wa.show();if(db){fa.set(pa,'height','auto');r.removeClass(xa,"_5384");g.inform('sidebar/typeahead/active',false);mb();}else mb();}},isInitialized:function(){return ta;},disable:function(){if(!ub.isEnabled())return;qa=false;qb();lb();},enable:function(){if(ub.isEnabled())return;qa=true;qb();mb();setTimeout(nb,0);},forceEnsureLoaded:function(){if(ua)return;if(oa('pagelet_sidebar'))return;d(['UIPagelet'],function(vb){var wb=y.div({id:"pagelet_sidebar"});s.appendContent(document.body,wb);vb.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});ua=true;},ensureLoaded:function(){if(!qa)return;ub.forceEnsureLoaded();},hide:function(){if(ra)return;ra=true;lb();},unhide:function(){if(!ra)return;ra=false;mb();},getBody:function(){return pa;},getRoot:function(){return xa;},getVisibleWidth:function(){if(!sa||!xa)return 0;if(bb===null)bb=xa.offsetWidth;return bb;},isEnabled:function(){return qa;},isViewportCapable:function(){ab=t.getViewportWithoutScrollbarDimensions();if(db)return true;var vb=m.get('sidebar.minimum_width');return ab.width>vb;},shouldShowSidebar:function(){var vb=ub.isViewportCapable();return db||(vb&&!ra&&(!sb()||m.get('litestand_blended_sidebar',false))&&!w.shouldSuppressSidebar());},isVisible:function(){return sa;},resize:mb,toggle:function(){if(db){db.toggle();}else ub.isEnabled()?ub.disable():ub.enable();},isLitestandSidebar:function(){return !!db;}};ia(ub,h);e.exports=ub;});
__d("VideoCallingTour",["Arbiter","ArbiterMixin","Chat","ChatSidebar","ChatVisibility","CSS","DOM","PresencePrivacy","Run","Toggler","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Chat'),j=b('ChatSidebar'),k=b('ChatVisibility'),l=b('CSS'),m=b('DOM'),n=b('PresencePrivacy'),o=b('Run'),p=b('Toggler'),q=b('Vector'),r=b('copyProperties'),s,t,u,v,w=[],x=function(){};function y(){if(j.isVisible()){z();}else if(u)aa();}function z(){s.setContext(t.getBody());ba();s.show();ca();}function aa(){if(!v)v=p.createInstance(u.getRoot());var fa=m.scry(u.getRoot(),'div.fbNubFlyout')[0];if(fa){s.setContext(fa);ba();s.show();ca();}}function ba(){var fa=q.getElementDimensions(s.getContext()).y;s.setOffsetY(fa*.6);s.updatePosition();}function ca(){if(u)w.push(u.subscribe('hide',function(){da();if(!j.isVisible())s.hide();}),u.subscribe('show',function(){s.show();}),u.subscribe('resize',function(){ba();s.updatePosition();}));w.push(g.subscribe('sidebar/show',z),g.subscribe('sidebar/hide',aa),g.subscribe('sidebar/resized',ba));}function da(){if(v){v.setSticky(false);v=null;}}function ea(){while(w.length)w.pop().unsubscribe();if(u)da();s.hide();l.show('fbVideoCallingGetStarted');}r(x,h,{start:function(fa){s=fa;l.hide('fbVideoCallingGetStarted');k.goOnline(function(){w.push(n.subscribe('privacy-user-presence-changed',ea));o.onLeave(ea);i.openBuddyList();var ga=null;w.push(j.subscribe('sidebar/initialized',function(ha,ia){t=ia;clearTimeout(ga);ga=setTimeout(y,0);}),x.subscribe('videocallingtour/end',ea));w.push(g.subscribe('buddylist-nub/initialized',function(ha,ia){u=ia;clearTimeout(ga);ga=setTimeout(y,0);}));});x.inform('videocallingtour/start');}});e.exports=x;});
__d("ActiveXSupport",["UserAgent"],function(a,b,c,d,e,f){var g=b('UserAgent'),h=null,i={isSupported:function(){if(h!==null)return h;try{if(g.ie()>=11){h=!!new ActiveXObject("htmlfile");}else h=!!window.ActiveXObject&&!!new ActiveXObject("htmlfile");}catch(j){h=false;}return h;}};e.exports=i;});
__d("VideoCallSupport",["MercuryConfig","UserAgent"],function(a,b,c,d,e,f){var g=b('MercuryConfig'),h=b('UserAgent'),i={newVCIsSupported:function(){return g.NewVCGK&&(h.chrome()>=24||h.firefox()>=22);}};e.exports=i;});
__d("VideoCallRecordMessageDialog",["AsyncDialog","AsyncRequest","Dialog","URI","tx"],function(a,b,c,d,e,f){var g=b('AsyncDialog'),h=b('AsyncRequest'),i=b('Dialog'),j=b('URI'),k=b('tx'),l={get:function(m,n){var o="Would you like to leave a message?",p="New Message";return new i().setTitle(k._("{firstname} is Unavailable",{firstname:n})).setBody(o).setButtons([{name:'record-message',label:p},i.CANCEL]).setHandler(function(){var q=j('/ajax/messaging/composer.php').setQueryData({ids:[m],autoloadvideo:true}).toString();g.send(new h(q));});}};e.exports=l;});
__d("VideoCallCore",["Event","ActiveXSupport","Arbiter","AsyncRequest","AvailableList","AvailableListConstants","Bootloader","ChannelConstants","Cookie","CSS","Dialog","MercuryConfig","UserAgent","VideoCallSupport","emptyFunction","ge","VideoCallTemplates","ShortProfiles","VideoCallRecordMessageDialog"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ActiveXSupport'),i=b('Arbiter'),j=b('AsyncRequest'),k=b('AvailableList'),l=b('AvailableListConstants'),m=b('Bootloader'),n=b('ChannelConstants'),o=b('Cookie'),p=b('CSS'),q=b('Dialog'),r=b('MercuryConfig'),s=b('UserAgent'),t=b('VideoCallSupport'),u=b('emptyFunction'),v=b('ge');b('VideoCallTemplates');var w=[],x=[],y={isSupported:function(){if(t.newVCIsSupported())return true;if(s.windows()){var ca=navigator.userAgent;if(/Windows NT 6.3/.exec(ca))return false;if(s.ie()>=9&&!s.ie64()){return h.isSupported();}else return (s.ie()>=7&&!s.ie64())||s.firefox()>=3.6||s.chrome()>=5||s.opera()>=12;}else if(s.osx()>10.4&&s.osx()<10.9)return (s.firefox()>=3.6||s.chrome()>=5||s.webkit()>=500||s.opera()>=12);return false;},isInstalled:function(){var ca=false;if(this.isSupported())if(z()){var da=null;try{da=new ActiveXObject('SkypeLimited.SkypeWebPlugin');ca=!!da;}catch(ea){}da=null;}else{ca=aa();if(r.VideoCallingNoJavaGK)if(ca&&s.osx()>=10.8)if(ca.description&&ca.description.charAt(0)!='v')ca=false;}return ca;},mightReloadPostInstall:function(){return s.windows();},onVideoMessage:function(ca){w.push(ca);m.loadModules(['VideoCallController'],u);},onRTCMessage:function(ca){if(t.newVCIsSupported()){x.push(ca);m.loadModules(['FBRTCCallController'],u);}},setMessageHandler:function(ca){this.onVideoMessage=ca;if(ca)while(w.length)ca(w.shift());},setRTCMessageHandler:function(ca){this.onRTCMessage=ca;if(ca)while(x.length)ca(x.shift());},availableForCall:function(ca){var da=k.get(ca);return da==l.ACTIVE||da==l.IDLE;},onProfileButtonClick:function(ca){y.startCallOrLeaveMessage(ca,'profile_button_click');},attachListenerToProfileButton:function(ca){var da=v('videoCallProfileButton');if(da){if(!y.isSupported()){p.hide(da);return;}g.listen(da,'click',function(event){y.startCallOrLeaveMessage(ca,'profile_button_click_timeline');});}},startCallOrLeaveMessage:function(ca,da){if(this.availableForCall(ca)){y.showOutgoingCallDialog(ca,da);}else b('ShortProfiles').get(ca,function(ea){b('VideoCallRecordMessageDialog').get(ca,ea.firstName).show();});},showOutgoingCallDialog:function(ca,da){var ea=da||'unknown';y.logClick(ca,ea);var fa=y.isInstalled()||r.NewVCGK?'outgoing_dialog.php':'intro.php',ga='/ajax/chat/video/'+fa+'?idTarget='+ca;new q().setAllowCrossPageTransition(true).setAsync(new j(ga).setHandler(u).setServerDialogCancelHandler(u)).show();},logClick:function(ca,da){new j().setURI('/ajax/chat/video/log_click.php').setData({targetUserID:ca,clickSource:da}).setAllowCrossPageTransition(true).setErrorHandler(u).send();}};function z(){return s.ie()&&s.windows()&&!s.opera();}function aa(){if(!navigator)return null;navigator.plugins.refresh(false);var ca=navigator.mimeTypes['application/skypesdk-plugin'];return ca&&ca.enabledPlugin;}function ba(){if(!y.mightReloadPostInstall())return;var ca=o.get('vcpwn');if(ca){o.clear('vcpwn');var da=o.get('vctid');if(da){o.clear('vctid');if(o.get('vctid'))return;if(da&&y.isInstalled()){var ea='/ajax/chat/video/outgoing_dialog.php?idTarget='+da;new q().setAllowCrossPageTransition(true).setAsync(new j(ea)).show();}}}}i.subscribe(n.getArbiterType('video'),function(ca,da){y.onVideoMessage(da.obj);});i.subscribe(n.getArbiterType('webrtc'),function(ca,da){y.onRTCMessage(da.obj);});i.subscribe(n.getArbiterType('chat_event'),function(ca,da){if(da.obj.event_name=="missed-call")m.loadModules(['VideoCallController'],function(ea){ea.onMissedCallEvent(da.obj);});});ba();e.exports=y;});
__d("VideoCallPromo",["ArbiterMixin","AsyncRequest","ChatConfig","ChatVisibility","LegacyContextualDialog","CSS","MercuryParticipants","MercuryThreads","ChatTabTemplates","VideoCallCore","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('ChatConfig'),j=b('ChatVisibility'),k=b('LegacyContextualDialog'),l=b('CSS'),m=b('MercuryParticipants'),n=b('MercuryThreads').get(),o=b('ChatTabTemplates'),p=b('VideoCallCore'),q=b('copyProperties'),r=b('emptyFunction');function s(){this._dialog=null;}function t(v){if(!(p.isSupported()&&i.get('video.show_promo')))return false;var w=n.getCanonicalUserInThread(v);if(!w)return false;return j.isOnline()&&p.availableForCall(w);}function u(v){new h().setURI('/ajax/chat/video/log_promo.php').setData({viewedUserID:v}).setAllowCrossPageTransition(true).setErrorHandler(r).send();}q(s.prototype,g);q(s.prototype,{render:function(v,w){var x=t(w);if(!x)return;var y=n.getCanonicalUserInThread(w);m.get('fbid:'+y,function(z){if(!z.call_promo)return;var aa=o[':fb:mercury:call:promo'].build();this._dialog=new k();this._dialog.init(aa.getRoot()).setWidth(250).setAlignH('center').setContext(v).show();l.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');l.addClass(v,'video_call_promo');u(n.getCanonicalUserInThread(w));this.inform('chat/dialog-rendered',{dialog:this,thread_id:w});}.bind(this));},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=s;});
__d("VideoCallTourDialog",["ArbiterMixin","LegacyContextualDialog","CSS","MercuryThreads","ChatTabTemplates","VideoCallCore","VideoCallingTour","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('LegacyContextualDialog'),i=b('CSS'),j=b('MercuryThreads').get(),k=b('ChatTabTemplates'),l=b('VideoCallCore'),m=b('VideoCallingTour'),n=b('copyProperties');function o(){this._dialog=null;}n(o.prototype,g);n(o.prototype,{render:function(p,q){var r=j.getCanonicalUserInThread(q);if(!r||!l.availableForCall(r))return;var s=k[':fb:mercury:call:tour'].build();this._dialog=new h();this._dialog.init(s.getRoot()).setWidth(250).setAlignH('center').setContext(p).show();i.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');i.addClass(p,'video_call_tour');this.inform('chat/dialog-rendered',{dialog:this,thread_id:q});m.inform('videocallingtour/end');},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=o;});
__d("ChatContextualDialogController",["Event","ArbiterMixin","ChatTabModel","VideoCallingTour","VideoCallPromo","VideoCallTourDialog","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('ChatTabModel'),j=b('VideoCallingTour'),k=b('VideoCallPromo'),l=b('VideoCallTourDialog'),m=b('copyProperties'),n=b('setTimeoutAcrossTransitions'),o=60000,p=false,q=false,r=function(y,z){this._videoCallPromo=new k();this._videoCallTour=new l();this._threadID=y;this._tabMainElement=z;this._openDialog=null;this._subscriptionTokens=[];this._scrollListener=null;this._timeout=null;};function s(y,event,z){if(y._openDialog)y._openDialog.updatePosition();}function t(y){if(y._openDialog)y._openDialog.updatePosition();}function u(y){if(y._openDialog){y._openDialog.hide();y._openDialog=null;}if(y._timeout){clearTimeout(y._timeout);y._timeout=null;}while(y._subscriptionTokens.length)y._subscriptionTokens.pop().unsubscribe();if(y._scrollListener){y._scrollListener.remove();y._scrollListener=null;}}function v(y,event,z){if(z.thread_id===y._threadID){y._openDialog=z.dialog;p=true;x(y);y._timeout=n(y.destroy.bind(y,y._threadID),o);y._scrollListener=g.listen(window,'scroll',t.bind(null,y));}}function w(y,z){if(!y._openDialog){y._subscriptionTokens.push(z.subscribe('chat/dialog-rendered',v.bind(null,y)));z.render(y._tabMainElement,y._threadID);}}function x(y){y._subscriptionTokens.push(i.subscribe('chat/tabs-changed',s.bind(null,y)),r.subscribe('dialog/close-all',u.bind(null,y)));}m(r,h);m(r.prototype,{destroy:function(){u(this);},tabFocused:function(){if(q){w(this,this._videoCallTour);return;}if(!p)w(this,this._videoCallPromo);},tabNotActive:function(){u(this);},hideVideoCallouts:function(){u(this);}});j.subscribe('videocallingtour/start',function(){q=true;r.inform('dialog/close-all');});j.subscribe('videocallingtour/end',function(){q=false;});e.exports=r;});
__d("ChatPhotoEditorContextualDialog",["ContextualDialog","CSS","Event","LayerHideOnBlur","PhotoEditorConfig","URI"],function(a,b,c,d,e,f){var g=b('ContextualDialog'),h=b('CSS'),i=b('Event'),j=b('LayerHideOnBlur'),k=b('PhotoEditorConfig'),l=b('URI');function m(n,o,p,q,r){"use strict";var s=l(k.Constants.CHAT_DIALOG_PATH).addQueryData({thread_id:r}).toString(),t=l(k.Constants.BROWSE_ALBUMS_PATH).addQueryData({browse_mode:k.BrowseModes.CHOOSE_CHAT_TARGET,browse_args:{thread_id:r}}).toString();o.setAttribute('ajaxify',t);p.setAttribute('ajaxify',s);this.$ChatPhotoEditorContextualDialog0=n;this.$ChatPhotoEditorContextualDialog1=q;i.listen(n,'click',this.$ChatPhotoEditorContextualDialog2.bind(this));i.listen(q,'click',this.$ChatPhotoEditorContextualDialog3.bind(this));}m.prototype.$ChatPhotoEditorContextualDialog2=function(){"use strict";var n=this.$ChatPhotoEditorContextualDialog4();if(n.isShown()){n.hide();}else n.show();};m.prototype.$ChatPhotoEditorContextualDialog3=function(){"use strict";this.$ChatPhotoEditorContextualDialog4().hide();};m.prototype.$ChatPhotoEditorContextualDialog4=function(){"use strict";if(!this.$ChatPhotoEditorContextualDialog5){var n={context:this.$ChatPhotoEditorContextualDialog0,width:115,alignment:'center',addedBehaviors:[j]};this.$ChatPhotoEditorContextualDialog5=new g(n,this.$ChatPhotoEditorContextualDialog1);h.show(this.$ChatPhotoEditorContextualDialog1);}return this.$ChatPhotoEditorContextualDialog5;};e.exports=m;});
__d("MercuryShareLinkUploader",["ArbiterMixin","AsyncRequest","CSS","DOM","Form","URLScraper","WebMessengerEvents","mixin","Event"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('Form'),l=b('URLScraper'),m=b('WebMessengerEvents'),n=b('mixin'),o=b('Event'),p=n(g);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t,u,v,w,x){"use strict";this.$MercuryShareLinkUploader0=t;this.$MercuryShareLinkUploader1=u;this.$MercuryShareLinkUploader2=v;this.$MercuryShareLinkUploader3=x;this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;o.listen(w,'click',this.close.bind(this));o.listen(x,'keyup',function(){!x.value.length&&this.$MercuryShareLinkUploader7.enable();}.bind(this));this.$MercuryShareLinkUploader7=new l(x);this.$MercuryShareLinkUploader7.subscribe('match',function(y,z){this.loadShare(z&&z.url);}.bind(this));}s.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$MercuryShareLinkUploader4,this.$MercuryShareLinkUploader0,this.$MercuryShareLinkUploader3);};s.prototype.loadAttachData=function(t,u,v){"use strict";if(t){var w=k.serialize(u),x=w.attachment&&w.attachment.params,y=w.link_metrics?w.link_metrics.no_image:true;if(!x||!x.url)return null;if(v.value.indexOf(x.url)===-1)return w;if(!x.summary&&!x.favicon&&y){var z=x.url.substr(0,x.title.length);if(!x.title||x.title===z)return null;}return w;}return null;};s.prototype.check=function(){"use strict";this.$MercuryShareLinkUploader7.check();};s.prototype.close=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.disable();this.inform('closed');};s.prototype.clear=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.enable();};s.prototype.enable=function(){"use strict";this.$MercuryShareLinkUploader7.enable();};s.prototype.disable=function(){"use strict";this.$MercuryShareLinkUploader7.disable();};s.prototype.loadShare=function(t){"use strict";this.$MercuryShareLinkUploader5=t;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=new h().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:t}).setHandler(this.$MercuryShareLinkUploader9.bind(this).bind(null,t)).setStatusElement(this.$MercuryShareLinkUploader2);this.$MercuryShareLinkUploader6.send();this.inform('link-detected');};s.prototype.$MercuryShareLinkUploader9=function(t,u){"use strict";if(this.$MercuryShareLinkUploader5!==t)return;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;i.show(this.$MercuryShareLinkUploader0);j.empty(this.$MercuryShareLinkUploader1);j.setContent(this.$MercuryShareLinkUploader1,u.payload);this.$MercuryShareLinkUploader4=true;if(!this.getAttachData()){this.close();return;}m.detailDOMChanged();};s.prototype.$MercuryShareLinkUploader8=function(){"use strict";i.hide(this.$MercuryShareLinkUploader0);this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7.reset();m.detailDOMChanged();};e.exports=s;});
__d("MercuryAudioPlayer",["Event","Arbiter","DOM","Flash","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('DOM'),j=b('Flash'),k=b('copyProperties'),l=200;function m(){var v=i.create('audio'),w=false;try{if(!!v.canPlayType)if(v.canPlayType('video/mp4;').replace(/^no$/,''))w=true;}finally{return w;}}function n(){return j.isAvailable();}var o=function(){this.interval=null;this.arbiterInstance=null;this.audio=i.create('audio');g.listen(this.audio,'playing',function(){this.informAttachment('playing',this.audio.currentTime);this.interval=setInterval(function(){this.informAttachment('playing',this.audio.currentTime);}.bind(this),l);}.bind(this));g.listen(this.audio,'ended',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};k(o.prototype,{setAudio:function(v,w){this.audio.setAttribute('src',v);this.arbiterInstance=w;},informAttachment:function(v,w){if(this.arbiterInstance)this.arbiterInstance.inform(v,w);},play:function(){this.audio.play();this.informAttachment('played');},resume:function(){this.audio.play();this.informAttachment('played');},pause:function(){this.audio.pause();clearInterval(this.interval);this.informAttachment('paused');},getType:function(){return 'html5';}});var p=function(){this.src=null;this.arbiterInstance=null;var v=i.create('div');document.body.appendChild(v);this.swf=j.embed('/swf/SoundStreamPlayer.swf',v,null,{});this.interval=null;h.subscribe('soundstream/finished',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};k(p.prototype,{setAudio:function(v,w){this.src=v;this.arbiterInstance=w;},informAttachment:function(v,w){if(this.arbiterInstance)this.arbiterInstance.inform(v,w);},play:function(){this.swf.playSound(this.src);this.interval=setInterval(function(){var v=this.swf.getCurrentTime();this.informAttachment('playing',v);}.bind(this),l);this.informAttachment('played');},resume:function(){this.swf.resume();this.informAttachment('played');},pause:function(){clearInterval(this.interval);this.swf.pause();this.informAttachment('paused');},getType:function(){return 'flash';}});function q(){if(m()){return new o();}else if(n())return new p();return false;}var r=null,s=null,t=0;function u(v,w){this.src=v;this.arbiterInstance=w;this.audio_id=++t;r!==null||(r=q());if(!r)return false;}k(u.prototype,{getType:function(){if(!r){return false;}else return r.getType();},play:function(v){if(v&&s==this.audio_id){r.resume();}else{this.pause();s=this.audio_id;r.setAudio(this.src,this.arbiterInstance);r.play();}},pause:function(){r.pause();}});e.exports=u;});
__d("MercuryAttachmentAudioClip.react",["Arbiter","ArbiterMixin","MercuryAudioPlayer","CurrentUser","JSLogger","LeftRight.react","React","cx","shield","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('MercuryAudioPlayer'),j=b('CurrentUser'),k=b('JSLogger'),l=b('LeftRight.react'),m=b('React'),n=b('cx'),o=b('shield'),p=b('tx'),q='MercuryAttachmentAudioClip/play',r=k.create('mercury_audio_clip'),s=m.createClass({displayName:'AudioClip',mixins:[h],getInitialState:function(){this.subscribe('playing',this.updateTime);this.subscribe('played',o(this.setState,this,{playing:true,started:true}));this.subscribe('paused',o(this.setState,this,{playing:false}));this.subscribe('finished',o(this.setState,this,{playing:false,started:false,time:this.props.duration}));this.logged=false;var t=this.props.downloadOnly?false:new i(this.props.src,this);g.subscribe(q,function(u,v){if(this.props.src!=v)this.setState({time:0});}.bind(this));return {time:0,playing:false,started:false,duration:this.props.duration,audioPlayer:t};},updateTime:function(t,u){this.setState({time:u});},play:function(){if(this.state.playing){this.state.audioPlayer.pause();}else{this.state.audioPlayer.play(this.state.started);g.inform(q,this.props.src);if(!this.logged){this.logged=true;r.log('play',{uid:j.getID(),duration:this.props.duration});}}},_formatSeconds:function(t){if(t){t=Math.ceil(t);var u=t%60;if(u<10)u='0'+u;var v=Math.floor(t/60);return v+':'+u;}else return null;},_renderPlayer:function(t,u){return (m.DOM.a({className:"_1miz",style:{width:t},onClick:this.play},m.DOM.span({className:"_1mi-"},m.DOM.i({className:"_1mi_"})),m.DOM.span({className:"_1mj0"},u),m.DOM.div({className:"_1mj1"})));},render:function(){var t=this.state.time,u=this.state.playing,v=this._formatSeconds(this.state.duration),w=this.props.width||170,x=null,y=Math.ceil((t*(w+2))/this.state.duration);if(this.state.audioPlayer&&this.state.audioPlayer.getType()){var z=this._renderPlayer(w,v),aa=this._renderPlayer(w,v),ba=(("_1mj2")+(u&&(t!==0)?' '+"_1mj3":'')+(u&&(t===0)?' '+"_4g4x":''));x=(m.DOM.div({className:ba},z,m.DOM.div({className:"_1mj4",style:{width:y}},aa)));}else x=(m.DOM.div({className:"_1mj2"},m.DOM.div({className:"_1miz"},l(null,m.DOM.a({className:"_1mj5",href:this.props.src},m.DOM.span({className:"_3qi6"},m.DOM.i({className:"_1mj6"})),m.DOM.span({className:"_1mj7"},"Voice Message"),m.DOM.span({className:"_1mj8"},v)),m.DOM.a({href:this.props.src,className:"_1mj9"},m.DOM.i({className:"_1mja"}))))));return (m.DOM.div({className:"_1mjb"},x));}});e.exports=s;});
__d("DateConsts",["fbt"],function(a,b,c,d,e,f){var g=b('fbt'),h=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],j=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],k=["January","February","March","April","May","June","July","August","September","October","November","December"],l=['',"st","nd","rd","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th","st"],m={getWeekdayName:function(n){return i[n];},getWeekdayNameShort:function(n){return h[n];},getMonthName:function(n){return k[n-1];},getMonthNameShort:function(n){return j[n-1];},getOrdinalSuffix:function(n){return l[n];},getDaysInMonth:function(n,o){return (new Date(n,o,0)).getDate();}};e.exports=m;});
__d("formatDate",["DateConsts","DateFormatConfig","fbt","invariant"],function(a,b,c,d,e,f){var g=b('DateConsts'),h=b('DateFormatConfig'),i=b('fbt'),j=b('invariant');function k(o,p,q){q=q||{};if(!p||!o)return '';if(typeof o==='string')o=parseInt(o,10);if(typeof o==='number')o=new Date(o*1000);j(o instanceof Date);j(!isNaN(o.getTime()));j(o.getTime()<1e+15);if(typeof p!=='string'){var r=m();for(var s in r){var t=r[s];if(t.start<=o.getTime()&&p[t.name]){p=p[t.name];break;}}}var u;if(q.skipPatternLocalization||n()||p.length===1){u=p;}else{j(h.formats[p]);u=h.formats[p];}var v=q.utc?'getUTC':'get',w=o[v+'Date'](),x=o[v+'Day'](),y=o[v+'Month'](),z=o[v+'FullYear'](),aa=o[v+'Hours'](),ba=o[v+'Minutes'](),ca=o[v+'Seconds'](),da=o[v+'Milliseconds'](),ea='';for(var fa=0;fa<u.length;fa++){var ga=u.charAt(fa);switch(ga){case '\\':fa++;ea+=u.charAt(fa);break;case 'd':ea+=l(w,2);break;case 'j':ea+=w;break;case 'S':ea+=g.getOrdinalSuffix(w);break;case 'D':ea+=g.getWeekdayNameShort(x);break;case 'l':ea+=g.getWeekdayName(x);break;case 'F':case 'f':ea+=g.getMonthName(y+1);break;case 'M':ea+=g.getMonthNameShort(y+1);break;case 'm':ea+=l(y+1,2);break;case 'n':ea+=y+1;break;case 'Y':ea+=z;break;case 'y':ea+=(''+z).slice(2);break;case 'a':if(aa<12){ea+="am";}else ea+="pm";break;case 'A':if(aa<12){ea+="AM";}else ea+="PM";break;case 'g':ea+=(aa===0||aa===12)?12:aa%12;break;case 'G':ea+=aa;break;case 'h':if(aa===0||aa===12){ea+=12;}else ea+=l(aa%12,2);break;case 'H':ea+=l(aa,2);break;case 'i':ea+=l(ba,2);break;case 's':ea+=l(ca,2);break;case 'X':ea+=l(da,3);break;default:ea+=ga;}}return ea;}function l(o,p){return Array(p-(''+o).length+1).join('0')+o;}function m(){var o=new Date(),p=o.getTime(),q=o.getFullYear(),r=o.getDate()-((o.getDay()-h.weekStart+6)%7),s=new Date(q,o.getMonth()+1,0).getDate(),t=new Date(q,1,29).getMonth()===1?366:365,u=1000*60*60*24;return [{name:'today',start:o.setHours(0,0,0,0)},{name:'withinDay',start:p-u},{name:'thisWeek',start:new Date(o.getTime()).setDate(r)},{name:'withinWeek',start:p-u*7},{name:'thisMonth',start:o.setDate(1)},{name:'withinMonth',start:p-u*s},{name:'thisYear',start:o.setMonth(0)},{name:'withinYear',start:p-u*t},{name:'older',start:-Infinity}];}k.periodNames=['today','thisWeek','thisMonth','thisYear','withinDay','withinWeek','withinMonth','withinYear','older'];function n(){if(!window||!window.location)return false;var o=window.location.pathname,p='/intern';return o.substr(0,p.length)===p;}e.exports=k;});
__d("MercuryMessages",["AsyncRequest","CurrentUser","KeyedCallbackManager","MercuryActionStatus","MercuryActionTypeConstants","MercuryAssert","MercuryAttachmentType","MercuryGenericConstants","MercuryIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryMessageSourceTags","MercuryPayloadSource","MercurySendLogger","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercuryMessageIDs","MercuryParticipants","PresenceUtil","RangedCallbackManager","ReportState","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","copyProperties","debounceAcrossTransitions","formatDate","invariant","isNode","randomInt","tx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CurrentUser'),i=b('KeyedCallbackManager'),j=b('MercuryActionStatus'),k=b('MercuryActionTypeConstants'),l=b('MercuryAssert'),m=b('MercuryAttachmentType'),n=b('MercuryGenericConstants'),o=b('MercuryIDs'),p=b('MercuryLogMessageType'),q=b('MercuryMessageClientState'),r=b('MercuryMessageSourceTags'),s=b('MercuryPayloadSource'),t=b('MercurySendLogger'),u=b('MercurySingletonMixin'),v=b('MercurySourceType'),w=b('MercuryTimePassed'),x=b('MercuryMessageIDs'),y=b('MercuryParticipants'),z=b('PresenceUtil'),aa=b('RangedCallbackManager'),ba=b('ReportState'),ca=b('MercuryServerRequests'),da=b('MercuryThreadInformer'),ea=b('MercuryThreads'),fa=b('copyProperties'),ga=b('debounceAcrossTransitions'),ha=b('formatDate'),ia=b('invariant'),ja=b('isNode'),ka=b('randomInt'),la=b('tx');function ma(eb,fb){var gb=fb;if(eb._localIdsMap[fb])gb=eb._localIdsMap[fb];return eb._messages[gb];}var na=new i();function oa(eb,fb){if(fb.status===undefined)fb.status=j.UNSENT;fb.timestamp_absolute="Today";fb.message_id=fb.message_id||eb.generateNewClientMessageID(fb.timestamp);var gb=y.getIDForUser(eb._fbid);fb.specific_to_list=fb.specific_to_list||[];if(fb.specific_to_list.length&&fb.specific_to_list.indexOf(gb)===-1)fb.specific_to_list.push(gb);if(!fb.thread_id){if(fb.specific_to_list.length==1){fb.thread_id='user:'+eb._fbid;}else if(fb.specific_to_list.length==2){var hb=fb.specific_to_list[0]==gb?fb.specific_to_list[1]:fb.specific_to_list[0];if(o.tokenize(hb).type=='email'){fb.thread_id=n.PENDING_THREAD_ID;}else fb.thread_id=eb._threads.getThreadIDForParticipant(hb);}fb.thread_id=fb.thread_id||'root:'+fb.message_id;}if(!fb.specific_to_list.length){var ib=eb._serverRequests.tokenizeThreadID(fb.thread_id);if(ib.type=='user')fb.specific_to_list=['fbid:'+ib.value,gb];}}function pa(eb,fb,gb,hb){var ib=ab(gb)?[r.CHAT]:[],jb=Date.now(),kb=ha(new Date(jb),'g:ia'),lb={action_type:fb,thread_id:hb,author:y.getIDForUser(eb._fbid),author_email:null,coordinates:null,timestamp:jb,timestamp_absolute:(new Date(jb)).toLocaleDateString(),timestamp_relative:kb,timestamp_time_passed:w.TODAY,is_unread:false,is_cleared:false,is_forward:false,is_filtered_content:false,is_spoof_warning:false,source:gb,source_tags:ib};return lb;}function qa(eb){switch(eb){case s.UNKNOWN:case s.SERVER_INITIAL_DATA:case s.SERVER_FETCH_THREAD_INFO:case s.SERVER_THREAD_SYNC:return true;}return false;}function ra(eb){return eb&&eb.substr(0,6)==='server';}function sa(eb,fb){if(!eb._threadsToMessages[fb])eb._threadsToMessages[fb]=new aa(function(gb){return ma(eb,gb).timestamp;},function(gb,hb){return hb-gb;});return eb._threadsToMessages[fb];}function ta(eb){var fb=[];return JSON.stringify(eb,function(gb,hb){if(typeof hb==='object'&&hb!==null){if(ja(hb))return '<'+hb.nodeName+'>';if(fb.indexOf(hb)!==-1)return 'CIRCULAR';fb.push(hb);}return hb;});}ba.registerCallback('mercury-messages',function(){var eb={},fb={},gb=va._getInstances();for(var hb in gb){eb[hb]={};for(var ib in gb[hb]._messages){var jb=gb[hb]._messages[ib];if(Object.keys(jb).length===0)continue;var kb=jb.thread_id;eb[hb][kb]=eb[hb][kb]||{};eb[hb][kb][jb.message_id]=JSON.parse(ta(jb));}fb[hb]=fa({},gb[hb]._localIdsMap);}var lb={};lb.local_message_ids=fb;lb.messages=eb;return lb;});function ua(eb,fb,gb){fb.forEach(function(hb){var ib=sa(eb,hb);ib.setReachedEndOfArray();eb._threadInformer.reorderedMessages(hb,gb);});}function va(eb){this._fbid=eb;this._serverRequests=ca.getForFBID(this._fbid);this._threadInformer=da.getForFBID(this._fbid);this._threads=ea.getForFBID(this._fbid);this._failedHistoryFetchThreads={};this._threadsToMessages={};this._titanMessagesCount={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(fb,gb){var hb=(gb.actions||[]).filter(function(jb){var kb=jb.action_type;return (jb.is_forward||jb.thread_id)&&(kb==k.LOG_MESSAGE||kb==k.USER_GENERATED_MESSAGE||kb==k.SEND_MESSAGE||kb==k.CLEAR_CHAT||kb==k.DELETE_THREAD||kb==k.DELETE_MESSAGES);}),ib=qa(gb.payload_source);if(ra(gb.payload_source))hb.forEach(function(jb){if(!jb.is_forward){var kb=this._threads.getThreadMetaNow(jb.thread_id);if(kb)jb.is_cleared=jb.timestamp<kb.chat_clear_time;}}.bind(this));this.handleUpdates(hb,ib,gb.payload_source,gb.from_client);if(gb.end_of_history)ua(this,gb.end_of_history,gb.payload_source);}.bind(this));}fa(va.prototype,{getMessagesFromIDs:function(eb){return (eb||[]).map(ma.bind(null,this)).filter(function(fb){return fb;});},hasLoadedNMessages:function(eb,fb){var gb=sa(this,eb);return gb.hasReachedEndOfArray()||gb.getCurrentArraySize()>=fb;},hasLoadedExactlyNMessages:function(eb,fb){var gb=sa(this,eb);return gb.getCurrentArraySize()==fb;},getThreadMessagesRange:function(eb,fb,gb,hb,ib,jb){var kb=sa(this,eb),lb=function(rb){hb(wa(this,rb));}.bind(this),mb=kb.executeOrEnqueue(fb,gb,lb),nb=kb.getUnavailableResources(mb),ob=this._failedHistoryFetchThreads[eb];if(nb.length&&!ob){var pb=(this._titanMessagesCount[eb]||0)-(this._localTitanMessagesCount[eb]||0),qb=nb.length+(this._localTitanMessagesCount[eb]||0);this._serverRequests.fetchThreadMessages(eb,pb,qb,ib,jb);}else this._failedHistoryFetchThreads[eb]=false;return mb;},getThreadMessagesSinceTimestamp:function(eb,fb){var gb=sa(this,eb),hb=gb.getElementsUntil(fb);return wa(this,hb);},hasLoadedAllMessages:function(eb){return sa(this,eb).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(eb){var fb=sa(this,eb).getAllResources();return wa(this,fb);},unsubscribe:function(eb,fb){l.isThreadID(fb);var gb=sa(this,fb);gb.unsubscribe(eb);},addAttachmentData:function(eb,fb,gb){var hb=ma(this,eb);if(hb){var ib=hb.attachments.indexOf(fb);if(ib!=-1){hb.attachments[ib]=gb;this._threadInformer.updatedMessage(hb.thread_id,hb.message_id,'attach');}}else{if(!this._attachmentData[eb])this._attachmentData[eb]=[];this._attachmentData[eb].push({attach_key:fb,data:gb});}},handleUpdates:function(eb,fb,gb,hb){var ib,jb={},kb={};for(var lb=0;lb<eb.length;lb++){var mb=eb[lb];if(mb.is_forward||gb==s.SERVER_SEARCH){if(!this._messages[mb.message_id]){this._messages[mb.message_id]=mb;bb(this,mb);}continue;}if(mb.client_state===q.SEND_TO_SERVER){this._messages[mb.message_id]=mb;bb(this,mb);continue;}var nb=mb.action_type;if(nb==k.SEND_MESSAGE){var ob=mb.client_message_id;if(ob&&this._localIdsMap[ob]&&mb.status){if(mb.status==j.UNCONFIRMED){if(!kb[mb.thread_id])kb[mb.thread_id]=[];kb[mb.thread_id].push(mb.client_message_id);}else if(!jb[mb.thread_id])jb[mb.thread_id]=[];var pb=ma(this,mb.client_message_id),qb=pb.status;pb.status=mb.status;if(mb.status===j.SUCCESS||mb.error_data)pb.error_data=mb.error_data;if(mb.status==j.SUCCESS){this.updateLocalMessage(mb,gb);if(mb.client_thread_id==n.PENDING_THREAD_ID){pb.thread_id=mb.thread_id;jb[mb.thread_id].push(pb.message_id);na.setResource(pb.message_id,pb.thread_id);}}if(typeof qb!='undefined'||mb.status==j.FAILED_UNKNOWN_REASON||mb.status==j.UNABLE_TO_CONFIRM||mb.status==j.SUCCESS||mb.status==j.ERROR)this._threadInformer.updatedMessage(mb.thread_id,ma(this,mb.client_message_id).message_id,gb);}continue;}else if(nb==k.DELETE_THREAD){sa(this,mb.thread_id).removeAllResources();continue;}else if(nb==k.DELETE_MESSAGES){var rb=mb.message_ids.map(function(yb){return ma(this,yb).message_id;}.bind(this));ib=sa(this,mb.thread_id);ib.removeResources(rb);this._threadInformer.reorderedMessages(mb.thread_id,gb);continue;}else if(nb==k.LOG_MESSAGE){if(mb.log_message_type==p.SERVER_ERROR)this._failedHistoryFetchThreads[mb.thread_id]=true;}else if(nb==k.CLEAR_CHAT){var sb=sa(this,mb.thread_id).getAllResources();sb.map(ma.bind(null,this)).forEach(function(yb){yb.is_cleared=true;});continue;}var tb=ma(this,mb.message_id);if((mb.threading_id&&this._localIdsMap[mb.threading_id])||(tb&&!tb.is_forward))continue;if(!jb[mb.thread_id])jb[mb.thread_id]=[];jb[mb.thread_id].push(mb.message_id);this._messages[mb.message_id]=mb;bb(this,mb);if(mb.threading_id&&mb.threading_id!=mb.message_id)x.addServerID(mb.threading_id,mb.message_id);if(!fb)this._threadInformer.receivedMessage(mb);}for(var ub in jb){ib=sa(this,ub);var vb=ib.getAllResources(),wb=vb.filter(function(yb){var zb=this._messages[yb];return zb.action_type==k.LOG_MESSAGE&&zb.log_message_type==p.SERVER_ERROR;}.bind(this));ib.removeResources(wb);xa(this,ub,jb[ub]);if(hb)ya(this,ub,jb[ub]);if(fb){ib.addResources(jb[ub]);this._threadInformer.reorderedMessages(ub,gb);}else ib.addResourcesWithoutSorting(jb[ub].reverse(),0);this._threadInformer.updatedThread(ub);}var xb=Object.keys(kb);if(xb.length)this._serverRequests.requestMessageConfirmation(kb);},sendMessage:function(eb,fb,gb){var event=t.CLIENT_SEND_ATTEMPTED;if(eb.status===j.RESENDING)event=t.CLIENT_RESEND_ATTEMPTED;var hb=false;if(o.isValid(eb.thread_id))hb=!o.isMultichat(eb.thread_id);setTimeout(function(){t.log(event,eb.message_id,{canonical:hb});},0);fb=fb||Function.prototype;oa(this,eb);this._localIdsMap[eb.message_id]=eb.message_id;if(eb.thread_id=='root:'+eb.message_id)sa(this,eb.thread_id).setReachedEndOfArray();this._serverRequests.sendNewMessage(eb,gb);if(eb.thread_id==n.PENDING_THREAD_ID){this._messages[eb.message_id]=eb;return na.executeOrEnqueue(eb.message_id,fb);}else fb(eb.thread_id);},isOutbound:function(eb){return eb.author==y.user;},isInbound:function(eb){return !this.isOutbound(eb);},isFirstMessage:function(eb){var fb=sa(this,eb.thread_id);if(fb.getCurrentArraySize()===0)return false;var gb=fb.getResourceAtIndex(fb.getCurrentArraySize()-1),hb=ma(this,gb).message_id,ib=ma(this,eb.message_id).message_id;return fb.hasReachedEndOfArray()&&hb==ib;},unsubscribeSend:function(eb){na.unsubscribe(eb);},resendMessage:function(eb,fb){var gb=fa({},eb);gb.status=j.RESENDING;gb.timestamp=Date.now();gb.message_id=eb.message_id;this._messages[eb.message_id]=gb;var hb=sa(this,eb.thread_id);hb.resortResources([eb.message_id]);this.sendMessage(gb,null,fb);this._threadInformer.reorderedMessages(eb.thread_id,s.CLIENT_SEND_MESSAGE);},deleteMessages:function(eb,fb){if(fb.length){var gb=sa(this,eb),hb=gb.getCurrentArraySize()==fb.length&&gb.hasReachedEndOfArray();this._serverRequests.deleteMessages(eb,fb,hb);}},deleteLocalMessage:function(eb){if(this._localTitanMessagesCount[eb])this._localTitanMessagesCount[eb]--;},markMessagesSpam:function(eb,fb){if(fb.length){var gb=sa(this,eb),hb=gb.getCurrentArraySize()==fb.length&&gb.hasReachedEndOfArray();if(hb){this._serverRequests.markThreadSpam(eb);}else this._serverRequests.markMessagesSpam(eb,fb);}},updateLocalMessage:function(eb,fb){var gb=eb.message_id,hb=eb.client_message_id;this._localIdsMap[hb]=gb;this._messages[gb]=this._messages[hb];x.addServerID(hb,gb);this._messages[hb]={};var ib=ma(this,hb);if(eb.timestamp)ib.timestamp=eb.timestamp;if(eb.attachments&&eb.attachments.length){ib.raw_attachments=null;ib.attachments=eb.attachments;bb(this,ib,gb);}if(eb.log_message_data)ib.log_message_data=eb.log_message_data;if(za(ib))this._localTitanMessagesCount[ib.thread_id]--;},constructUserGeneratedMessageObject:function(eb,fb,gb,hb){var ib=pa(this,k.USER_GENERATED_MESSAGE,fb,gb);ib.body=eb;ib.has_attachment=false;ib.html_body=false;ib.attachments=[];ib.specific_to_list=hb||[];return ib;},constructLogMessageObject:function(eb,fb,gb,hb){var ib=pa(this,k.LOG_MESSAGE,eb,fb);ib.log_message_type=gb;ib.log_message_data=hb;return ib;},generateNewClientMessageID:function(eb){var fb=eb+':'+(ka(0,4294967295)+1)+'-'+z.getSessionID();return '<'+fb+'@mail.projektitan.com>';},getNumberLocalMessages:function(eb){return this._localTitanMessagesCount[eb]||0;},_uploadMessages:{},updateNewMessage:function(eb,fb,gb){if(gb.preview_attachments.length>0){eb.has_attachment=true;eb.preview_attachments=gb.preview_attachments;}eb.client_state=q.DO_NOT_SEND_TO_SERVER;eb.status=j.RESENDING;this._uploadMessages[fb]=eb;return eb;},updateMessageAfterUpload:function(eb,fb){var gb=this._uploadMessages[eb];ia(gb);gb.image_ids=fb.image_ids;gb.client_state=q.SEND_TO_SERVER;return gb;},clearUploadedMessage:function(eb){var fb=this._uploadMessages[eb];if(fb&&fb.preview_attachments)fb.preview_attachments.forEach(function(gb){gb.cancel_subscription&&gb.cancel_subscription.remove();});delete this._uploadMessages[eb];}});fa(va,u,{addAttachmentData:function(eb,fb,gb,hb){hb=hb||h.getID();va.getForFBID(hb).addAttachmentData(eb,fb,gb);}});function wa(eb,fb){var gb=fb.map(ma.bind(null,eb));return gb.reverse();}function xa(eb,fb,gb){var hb=gb.filter(function(ib){return za(ma(eb,ib));});if(!eb._titanMessagesCount[fb])eb._titanMessagesCount[fb]=0;eb._titanMessagesCount[fb]+=hb.length;}function ya(eb,fb,gb){var hb=gb.filter(function(ib){return za(ma(eb,ib));});if(!eb._localTitanMessagesCount[fb])eb._localTitanMessagesCount[fb]=0;eb._localTitanMessagesCount[fb]+=hb.length;}function za(eb){var fb=eb.action_type;if(fb==k.USER_GENERATED_MESSAGE)return true;switch(eb.log_message_type){case p.SUBSCRIBE:case p.UNSUBSCRIBE:case p.SERVER_ERROR:case p.LIVE_LISTEN:return false;default:return true;}}function ab(eb){switch(eb){case v.CHAT_WEB:case v.CHAT_JABBER:case v.CHAT_IPHONE:case v.CHAT_MEEBO:case v.CHAT_ORCA:case v.CHAT_TEST:case v.CHAT:case v.DESKTOP:return true;default:return false;}}function bb(eb,fb,gb){gb=gb||fb.message_id;var hb=eb._attachmentData[gb];if(hb){hb.forEach(function(ib){var jb=fb.attachments.indexOf(ib.attach_key);if(jb!==-1)fb.attachments[jb]=ib.data;});delete eb._attachmentData[gb];}else if(!fb.is_forward&&cb(eb,fb)){eb._messagesNeedingAttachmentData[gb]=true;db(eb);}}function cb(eb,fb){if(!fb||!fb.attachments)return false;for(var gb=0;gb<fb.attachments.length;gb++){var hb=fb.attachments[gb];if(typeof hb==='string'&&hb.indexOf(m.SHARE)===0)return true;}var ib=fb.forward_message_ids||[];for(gb=0;gb<ib.length;gb++){var jb=ma(eb,ib[gb]);if(cb(eb,jb))return true;}return false;}var db=ga(function(eb){var fb={};for(var gb in eb._messagesNeedingAttachmentData){var hb=ma(eb,gb);if(cb(eb,hb))fb[gb]=true;}var ib=Object.keys(fb);if(ib.length){var jb={message_ids:ib};if(eb._fbid!=h.getID())jb.request_user_id=eb._fbid;new g('/ajax/mercury/attachments/fetch_shares.php').setData(jb).setAllowCrossPageTransition(true).send();}eb._messagesNeedingAttachmentData={};},0,this);e.exports=va;});
__d("GraphQLQuery",["createObjectFrom"],function(a,b,c,d,e,f){var g=b("createObjectFrom");function h(){"use strict";}h.prototype.addField=function(l){"use strict";if(this.fieldSet){this.fieldSet.fields.push(l);}else this.fieldSet=new k.FieldSet([l]);};h.prototype.addFields=function(l){"use strict";l.forEach(this.addField,this);};for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(l,m){"use strict";this.rootCall=l;this.fieldSet=m;}k.prototype.toString=function(){"use strict";return (this.rootCall||'')+(this.fieldSet||'');};k.Call=(function(){function l(m,n){"use strict";this.name=m;this.args=n||[];}l.prototype.toString=function(){"use strict";return this.name+'('+this.args.join(',')+')';};return l;})();k.CallValue=(function(){function l(m){"use strict";this.callValue=m;}l.prototype.toString=function(){"use strict";return this.callValue.replace(/[)(}{><,.\\]/g,'\\$&');};return l;})();k.CallVariable=(function(){function l(m){"use strict";this.callVariableName=m;}l.prototype.toString=function(){"use strict";return '<'+this.callVariableName+'>';};return l;})();k.Field=(function(){for(i in h)if(h.hasOwnProperty(i))l[i]=h[i];l.prototype=Object.create(j);l.prototype.constructor=l;l.__superConstructor__=h;function l(m,n,o,p,q){"use strict";this.name=p||m;this.fieldName=m;this.calls=n||[];this.fieldSet=o;this.alias=p;this.condition=q;}l.prototype.toString=function(){"use strict";var m='';if(this.condition)m+=this.condition+'?';m+=this.fieldName;if(this.calls.length!==0)m+='.'+this.calls.join('.');if(this.alias)m+=' as '+this.alias;if(this.fieldSet)m+=this.fieldSet;return m;};l.prototype.addCall=function(m){"use strict";this.calls.push(m);};l.prototype.removeCalls=function(m){"use strict";var n=g(m),o=[];for(var p=0;p<this.calls.length;p++)if(!n[this.calls[p].name])o.push(this.calls[p]);this.calls=o;};return l;})();k.FieldSet=(function(){function l(m){"use strict";this.fields=m||[];}l.prototype.toString=function(){"use strict";return '{'+this.fields.join(',')+'}';};return l;})();e.exports=k;});
__d("PagedQuery",["GraphQLParser","GraphQLQuery","keyOf","isEmpty"],function(a,b,c,d,e,f){var g=b("GraphQLParser"),h=b("GraphQLQuery"),i=b("keyOf"),j=b("isEmpty");function k(l,m){"use strict";this.$PagedQuery0=l;this.$PagedQuery1=m;}k.prototype.$PagedQuery2=function(){"use strict";var l=this.findFieldByPath(this.$PagedQuery0);l.removeCalls(['find','after','before','first','last']);return l;};k.prototype.$PagedQuery3=function(l,m,n){"use strict";var o=this.$PagedQuery2(),p=n?'after':'before';o.addCall(new h.Call(p,[l]));var q=n?'first':'last';o.addCall(new h.Call(q,[m]));return this.$PagedQuery0.toString();};k.prototype.$PagedQuery4=function(l){"use strict";var m=this.$PagedQuery1[l];if(typeof m=='object'&&!j(m))return i(m);return null;};k.prototype.$PagedQuery5=function(l){"use strict";var m=this.$PagedQuery4(l);if(m)return m;return this.$PagedQuery1[l];};k.prototype.$PagedQuery6=function(l){"use strict";var m=this.$PagedQuery4(l);if(m)return this.$PagedQuery1[l][m];return this.$PagedQuery1[l];};k.prototype.pageAfterQueryString=function(l,m){"use strict";return this.$PagedQuery3(l,m,true);};k.prototype.pageBeforeQueryString=function(l,m){"use strict";return this.$PagedQuery3(l,m,false);};k.prototype.pageFirstQueryString=function(l){"use strict";var m=this.$PagedQuery2();m.addCall(new h.Call('first',[l]));return this.$PagedQuery0.toString();};k.prototype.pageLastQueryString=function(l){"use strict";var m=this.$PagedQuery2();m.addCall(new h.Call('last',[l]));return this.$PagedQuery0.toString();};k.prototype.findFieldByPath=function(l){"use strict";var m=l,n=this.$PagedQuery5(0);if(l.rootCall.name!=n)throw new Error("Query path does not match root query at top node, "+"expected "+n+", "+"found "+l.name+" instead.");for(var o=1;o<this.$PagedQuery1.length;o++){var p=m.fieldSet.fields,q=false,r=this.$PagedQuery5(o);for(var s=0;s<p.length;s++)if(p[s].fieldName==r){m=p[s];q=true;break;}if(!q)throw new Error("Query path does not match query structure at location "+o+", "+"expected "+r+", "+"not located in "+p);}return m;};k.prototype.findDataByPath=function(l){"use strict";var m=l;for(var n=0;n<this.$PagedQuery1.length;n++){var o=this.$PagedQuery6(n);if(!m||!m[o])throw new Error("Query path does not match payload at location "+n+", "+"expected "+o);m=m[o];}return m;};k.constructFromPath=function(l,m){return new k(g.parseQuery(l),m);};e.exports=k;});
__d("PagedQueryCacheCore",["KeyedCallbackManager","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b("KeyedCallbackManager"),h=b("copyProperties"),i=b("emptyFunction");function j(k,l,m,n){"use strict";this.$PagedQueryCacheCore0=k;this.$PagedQueryCacheCore1=l;this.$PagedQueryCacheCore2=h({enableLooping:false},n);var o=this.$PagedQueryCacheCore1.findDataByPath(m),p=o.edges;this.$PagedQueryCacheCore3=o.page_info;this.$PagedQueryCacheCore4=new g();this.$PagedQueryCacheCore5={};this.$PagedQueryCacheCore6={};this.$PagedQueryCacheCore7={};this.$PagedQueryCacheCore8=0;this.$PagedQueryCacheCore9=0;this.$PagedQueryCacheCorea={};this.$PagedQueryCacheCoreb(p,0);if(this.$PagedQueryCacheCore2.allDataLoaded)this.$PagedQueryCacheCorec();}j.prototype.$PagedQueryCacheCoreb=function(k,l){"use strict";var m={},n=false;for(var o=0;o<k.length;o++){if(this.hasLooped())break;var p=l+o,q=k[o].cursor,r=k[o].node,s=this.$PagedQueryCacheCore5[q];if(this.$PagedQueryCacheCore2.enableLooping&&s!==undefined){n=true;continue;}var t=this.$PagedQueryCacheCore4.getResource(p);if(t!==undefined&&t!=q)throw new Error('Attempting to add cursor '+q+' at location '+p+' which already contains cursor '+t);this.$PagedQueryCacheCore7[r.id]=q;this.$PagedQueryCacheCore6[q]=r;m[p]=q;this.$PagedQueryCacheCore5[q]=p;this.$PagedQueryCacheCore8=Math.min(p,this.$PagedQueryCacheCore8);this.$PagedQueryCacheCore9=Math.max(p,this.$PagedQueryCacheCore9);}if(n)this.$PagedQueryCacheCorec();this.$PagedQueryCacheCore4.addResourcesAndExecute(m);};j.prototype.getItemsAfterCursor=function(k,l,m){"use strict";return this.$PagedQueryCacheCored(k,l,true,m);};j.prototype.getItemsBeforeCursor=function(k,l,m){"use strict";return this.$PagedQueryCacheCored(k,l,false,m);};j.prototype.$PagedQueryCacheCoree=function(k){"use strict";if(!this.hasLooped())return k;var l=this.$PagedQueryCacheCoref.end-this.$PagedQueryCacheCoref.start+1;while(k<this.$PagedQueryCacheCoref.start||k>this.$PagedQueryCacheCoref.end)if(k<this.$PagedQueryCacheCoref.start){k+=l;}else k-=l;return k;};j.prototype.$PagedQueryCacheCored=function(k,l,m,n){"use strict";var o=this.$PagedQueryCacheCoreg(k);if(!m)o=o-l-1;var p=[];for(var q=1;q<=l;q++)p.push(this.$PagedQueryCacheCoree(o+q));var r=this.$PagedQueryCacheCore4.getUnavailableResourcesFromRequest(p);if(r.length){r=this.$PagedQueryCacheCoreh(r);if(!r.length)return;var s;if(m){if(this.$PagedQueryCacheCore2.enableLooping&&!this.hasNextPage(k)){s=this.$PagedQueryCacheCore1.pageFirstQueryString(l);}else s=this.$PagedQueryCacheCore1.pageAfterQueryString(k,l);}else if(this.$PagedQueryCacheCore2.enableLooping&&!this.hasPreviousPage(k)){s=this.$PagedQueryCacheCore1.pageLastQueryString(l);}else s=this.$PagedQueryCacheCore1.pageBeforeQueryString(k,l);for(var t=0;t<r.length;++t)this.$PagedQueryCacheCorea[r[t]]=true;this.$PagedQueryCacheCorei&&this.$PagedQueryCacheCorei();this.$PagedQueryCacheCore0(s,this.$PagedQueryCacheCore1,r,m?this.$PagedQueryCacheCore2.first_query:this.$PagedQueryCacheCore2.last_query,this.$PagedQueryCacheCore2.persistent_params,this.$PagedQueryCacheCorej.bind(this));}var u=function(v){var w=[];for(var x=0;x<l;x++)w.push(this.$PagedQueryCacheCore6[v[p[x]]]);return w;}.bind(this);return this.$PagedQueryCacheCore4.deferredExecuteOrEnqueue(p).then(u).addCallback(n,this);};j.prototype.$PagedQueryCacheCorej=function(){"use strict";this.$PagedQueryCacheCorek.apply(this,arguments);};j.prototype.$PagedQueryCacheCoreg=function(k){"use strict";var l=this.$PagedQueryCacheCore5[k];if(l===undefined)throw new Error("Cursor not found: the request can still be made but the result "+"would not link to the existing data");return l;};j.prototype.setPayloadCallback=function(k){"use strict";this.$PagedQueryCacheCorek=k;};j.prototype.updateData=function(k){"use strict";var l=this.$PagedQueryCacheCore1.findDataByPath(k.query_results),m=l&&l.edges;if(!m)return;for(var n=0;n<m.length;++n)this.$PagedQueryCacheCore6[m[n].cursor]=m[n].node;};j.prototype.addData=function(k){"use strict";var l=false,m=null,n=0;for(var o in k.query_params){if(o=='after'||o=='before')m=k.query_params[o];if(o=='first'||o=='last'){l=(o=='first');n=k.query_params[o];}}if(this.$PagedQueryCacheCore2.enableLooping&&!m)m=l?this.$PagedQueryCacheCore3.end_cursor:this.$PagedQueryCacheCore3.start_cursor;if(!m||this.$PagedQueryCacheCore5[m]===undefined)return;var p=this.$PagedQueryCacheCore5[m],q=this.$PagedQueryCacheCore1.findDataByPath(k.query_results);if(!q.edges.length){this.$PagedQueryCacheCorel(k.requested_indices);if(l){this.$PagedQueryCacheCore3.has_next_page=false;this.$PagedQueryCacheCore2.enableLooping&&this.getItemsAfterCursor(m,n,i);}else{this.$PagedQueryCacheCore3.has_previous_page=false;this.$PagedQueryCacheCore2.enableLooping&&this.getItemsBeforeCursor(m,n,i);}return;}var r;if(l){r=p+1;this.$PagedQueryCacheCore3.end_cursor=q.page_info.end_cursor;this.$PagedQueryCacheCore3.has_next_page=q.page_info.has_next_page;}else{r=p-q.edges.length;this.$PagedQueryCacheCore3.start_cursor=q.page_info.start_cursor;this.$PagedQueryCacheCore3.has_previous_page=q.page_info.has_previous_page;}this.$PagedQueryCacheCoreb(q.edges,r);this.$PagedQueryCacheCorel(k.requested_indices);};j.prototype.hasNextPage=function(k){"use strict";var l=this.$PagedQueryCacheCoreg(k);if(this.$PagedQueryCacheCore4.getResource(l+1)){return true;}else if(k==this.$PagedQueryCacheCore3.end_cursor){return this.$PagedQueryCacheCore3.has_next_page;}else throw new Error('hasNextPage called on unknown cursor');};j.prototype.hasPreviousPage=function(k){"use strict";var l=this.$PagedQueryCacheCoreg(k);if(this.$PagedQueryCacheCore4.getResource(l-1)){return true;}else if(k==this.$PagedQueryCacheCore3.start_cursor){return this.$PagedQueryCacheCore3.has_previous_page;}else throw new Error('hasPreviousPage called on unknown cursor');};j.prototype.hasLooped=function(){"use strict";return this.$PagedQueryCacheCore2.enableLooping&&this.$PagedQueryCacheCoref;};j.prototype.getItemAtIndex=function(k,l){"use strict";k=this.$PagedQueryCacheCoree(k);var m=function(n){l(this.$PagedQueryCacheCore6[n[k]]);}.bind(this);this.$PagedQueryCacheCore4.deferredExecuteOrEnqueue([k]).addCallback(m,this);};j.prototype.getItemAtIndexImmediate=function(k){"use strict";k=this.$PagedQueryCacheCoree(k);var l=this.$PagedQueryCacheCore4.getResource(k),m;if(l)m=this.$PagedQueryCacheCore6[l];return m;};j.prototype.getAvailableRange=function(){"use strict";var k=this.$PagedQueryCacheCoreg(this.$PagedQueryCacheCore3.start_cursor),l=this.$PagedQueryCacheCoreg(this.$PagedQueryCacheCore3.end_cursor);return {offset:k,length:l-k+1};};j.prototype.getCursorForID=function(k){"use strict";return this.$PagedQueryCacheCore7[k];};j.prototype.getIndexForID=function(k){"use strict";var l=this.getCursorForID(k);return (l!==undefined)?this.$PagedQueryCacheCore5[l]:undefined;};j.prototype.$PagedQueryCacheCorel=function(k){"use strict";if(k)for(var l=0;l<k.length;++l)delete(this.$PagedQueryCacheCorea[k[l]]);};j.prototype.$PagedQueryCacheCoreh=function(k){"use strict";if(!this.$PagedQueryCacheCorea)return k;var l=[];for(var m=0;m<k.length;++m)if(!this.$PagedQueryCacheCorea[k[m]])l.push(k[m]);return l;};j.prototype.$PagedQueryCacheCorec=function(){"use strict";this.$PagedQueryCacheCoref={start:this.$PagedQueryCacheCore8,end:this.$PagedQueryCacheCore9};};j.prototype.setPreFetchCallback=function(k){"use strict";this.$PagedQueryCacheCorei=k;};e.exports=j;});
__d("PagedQueryCache",["AsyncRequest","GraphQLParser","PagedQueryCacheCore","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('GraphQLParser'),i=b('PagedQueryCacheCore'),j=b('copyProperties');function k(o,p,q,r,s,t){var u=h.parseQuery(o),v=p.findFieldByPath(u),w={};for(var x=0;x<v.calls.length;x++){var y=v.calls[x];w[y.name]=y.args[0].callValue;}j(w,s);new g('/ajax/graphql/query/').setData({queryName:r,params:w}).setHandler(function(z){var aa=z.getPayload();t({requested_indices:q,query_results:JSON.parse(aa.output),query_metadata:{query_string:aa.query},query_params:w});}).setAllowCrossPageTransition(true).send();}for(var l in i)if(i.hasOwnProperty(l))n[l]=i[l];var m=i===null?null:i.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=i;function n(o,p,q){"use strict";i.call(this,k,o,p,q);}e.exports=n;});
__d("PhotoCentralUpdates",["Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i={handleUpdate:function(j,k){var l=h({payloadsource:j},k);g.inform('update-photos',l);}};e.exports=i;});
__d("PhotoStore",["Arbiter","PagedQuery","PagedQueryCache","PhotoCentralUpdates","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('PagedQuery'),i=b('PagedQueryCache'),j=b('PhotoCentralUpdates'),k=b('copyProperties'),l={actions:{UPDATE:'update'},_photoCache:{},_postCreateCallbacks:{},getPhotoCache:function(m){if(!this._photoCache[m])throw new Error('Photo cache requested for unknown set ID');return this._photoCache[m];},hasBeenCreated:function(m){return !!this._photoCache[m];},clearSetCache:function(m){delete this._photoCache[m];delete this._postCreateCallbacks[m];},getByIndex:function(m,n,o){return this.getPhotoCache(m).getItemAtIndex(n,o);},getByIndexImmediate:function(m,n){if(this._photoCache[m])return this._photoCache[m].getItemAtIndexImmediate(n);return undefined;},getIndexForID:function(m,n){if(this._photoCache[m])return this._photoCache[m].getIndexForID(n);return undefined;},getCursorByIndexImmediate:function(m,n){var o=this.getByIndexImmediate(m,n);if(o)return this._photoCache[m].getCursorForID(o.id);return undefined;},getAvailableRange:function(m,n){return this.getPhotoCache(m).getAvailableRange();},hasLooped:function(m){return this.getPhotoCache(m).hasLooped();},fetchForward:function(m,n,o,p){return this.getPhotoCache(m).getItemsAfterCursor(n,o,p);},fetchBackward:function(m,n,o,p){return this.getPhotoCache(m).getItemsBeforeCursor(n,o,p);},executePostCreate:function(m,n){if(this._photoCache[m]){n&&n();}else this._postCreateCallbacks[m]=n;},runPostCreateCallback:function(m){var n=this._postCreateCallbacks[m];if(n){n();delete this._postCreateCallbacks[m];}},setPreFetchCallback:function(m,n){this.getPhotoCache(m).setPreFetchCallback(n);},_updateData:function(m){var n=m.query_results,o=m.query_metadata,p=o.set_id;if(!this._photoCache[p]){var q=h.constructFromPath(o.query_string,o.query_path);this._photoCache[p]=new i(q,n,k({enableLooping:true},o.config));this._photoCache[p].setPayloadCallback(function(r){r.query_metadata.set_id=p;j.handleUpdate(0,r);});this.runPostCreateCallback(p);}else if(m.query_metadata.action==l.actions.UPDATE){this._photoCache[p].updateData(m);}else this._photoCache[p].addData(m);}};g.subscribe('update-photos',function(event,m){l._updateData(m);});e.exports=l;});
__d("PhotoUtils",["Event","URI"],function(a,b,c,d,e,f){var g=b('Event'),h=b('URI'),i={getImagesFromData:function(j){var k=[];for(var l in j)if(l.indexOf('image')===0)k.push(j[l]);return k;},getFBIDFromData:function(j){return j&&j.id;},getOriginalImageFromData:function(j){return j.original||j.download_image;},getDownloadURLFromData:function(j){var k=this.getOriginalImageFromData(j);if(!k)return null;var l=new h(k.uri);l.addQueryData({dl:1});return l;},getPermalinkFromData:function(j){return j.permalink;},canViewerMakeCoverPhoto:function(j){return !!j.can_viewer_make_cover_photo;},getCoverPhotoURLFromData:function(j){return new h('/profile.php').addQueryData({preview_cover:i.getFBIDFromData(j)});},preload:function(j,k,l){var m=j.getDimensions();for(var n=0;n<k.length;++n){var o=m.getBestFitImageFromPhoto(k[n],m.getMaxStageDimensions()),p=new Image();l&&g.listen(p,'load',l.bind(null,k[n]));j.getLogger().log(o.uri);p.src=o.uri;}}};e.exports=i;});
__d("PhotoViewerDimensions",["Event","PhotoUtils","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('PhotoUtils'),i=b('Vector'),j=b('copyProperties');function k(l){"use strict";var m=['verticalPadding','horizontalPadding','normalResDim'];for(var n in l)if(m.indexOf(n)<0)throw new Error("Unsupported extraData value '"+n+"' should not be used");if(l){this._verticalPadding=l.verticalPadding;this._horizontalPadding=l.horizontalPadding;this._normalResDim=l.normalResDim;}this._listener=g.listen(window,'resize',this._resetMaxStageDimensions.bind(this));}k.prototype.destroy=function(){"use strict";this._listener.remove();};k.prototype.shouldUseHiRes=function(l){"use strict";if(!l.hasHiResDimensions())return false;var m=this.getStageDimensions(l.getHiResDimensions()),n=this.getImageDimensionsForStage(l.getHiResDimensions(),m);return (n.x>this._normalResDim.x||n.y>this._normalResDim.y);};k.prototype.getStageDimensions=function(l){"use strict";var m=this.getMaxStageDimensions(),n=new i(Math.min(l.x,m.x),Math.min(l.y,m.y)),o=n.x/n.y,p=l.x/l.y;if(o<p){n.y=Math.round(n.x/p);}else n.x=Math.round(n.y*p);return n;};k.prototype.getImageDimensionsForStage=function(l,m){"use strict";var n=l.x,o=l.y,p=m.x,q=m.y;if(n>=p||o>=q){var r=n/o,s=p/q;if(s<r){n=p;o=Math.round(p/r);}else if(s>r){n=Math.round(q*r);o=q;}else{n=p;o=q;}}return new i(n,o);};k.prototype.getMaxStageDimensions=function(){"use strict";if(!this._maxStageDimensions)this._maxStageDimensions=new i(i.getViewportDimensions().x-this._horizontalPadding,i.getViewportDimensions().y-this._verticalPadding);return this._maxStageDimensions;};k.prototype._resetMaxStageDimensions=function(){"use strict";this._maxStageDimensions=null;};k.prototype.getDimensionsFromImage=function(l){"use strict";return this.shouldUseHiRes(l)?l.getHiResDimensions():l.getNormalDimensions();};k.prototype.getMaxDimensionsFromImage=function(l){"use strict";return l.hasHiResDimensions()?l.getHiResDimensions():l.getNormalDimensions();};k.prototype.getSrcFromImage=function(l){"use strict";return this.shouldUseHiRes(l)?l.getHiResSrc():l.getNormalSrc();};k.prototype.getBestFitImageFromPhoto=function(l,m){"use strict";var n=null,o=h.getImagesFromData(l);o=o.sort(function(q,r){return r.width-q.width;});for(var p=0;p<o.length;p++)if(!n||o[p].width>=m.x||o[p].height>=m.y)n=o[p];return n;};k.prototype.getOriginalDimensionsFromPhoto=function(l){"use strict";var m=h.getOriginalImageFromData(l);return new i(m.width,m.height);};k.prototype.getBestFitDimensionsFromPhoto=function(l,m){"use strict";var n=this.getBestFitImageFromPhoto(l,m);return new i(n.width,n.height);};j(k.prototype,{_verticalPadding:40,_horizontalPadding:60,_normalResDim:{x:960,y:960}});e.exports=k;});
__d("SpotlightViewer",["React","ReactLayeredComponentMixin","Spotlight.react","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('ReactLayeredComponentMixin'),i=b('Spotlight.react'),j=b('cx'),k=g.createClass({displayName:'SpotlightViewer',mixins:[h],renderLayers:function(){return {photoLayer:i({shown:this.props.open,onHide:this.props.onHide},g.DOM.div({className:"_n3"},this.props.children))};},render:function(){return (g.DOM.div(null));}});e.exports=k;});
__d("TooltipLink.react",["React","ReactPropTypes","Tooltip","ReactComponent","DOM"],function(a,b,c,d,e,f){var g=b('React'),h=b('ReactPropTypes'),i=b('Tooltip'),j=b('ReactComponent'),k=b('DOM'),l=g.createClass({displayName:'TooltipLink',props:{tooltip:h.instanceOf(j).isRequired,position:h.oneOf(['above','below','left','right']),alignH:h.oneOf(['left','center','right'])},render:function(){return this.transferPropsTo(g.DOM.a({href:"#"},this.props.children));},componentDidMount:function(){var m=k.create('div');g.renderComponent(this.props.tooltip,m);i.set(this.getDOMNode(),m,this.props.position,this.props.alignH);}});e.exports=l;});
__d("PhotoViewState",["ArbiterMixin","PhotoStore","PhotoUtils","SpotlightViewerLoggingEvents","copyProperties","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('PhotoStore'),i=b('PhotoUtils'),j=b('SpotlightViewerLoggingEvents'),k=b('copyProperties'),l=b('mixin'),m=l(g);for(var n in m)if(m.hasOwnProperty(n))p[n]=m[n];var o=m===null?null:m.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=m;function p(q,r,s,t,u){"use strict";this._viewer=q;this._setID=r;this._updateCallback=t;this._position=s||0;this._preloaded={};this._reverse=u;}p.prototype.destroy=function(){"use strict";};p.prototype._fetchCallback=function(q){"use strict";if(!this._viewer.isOpen())return;this._preload(q);this._log(j.DATA_FETCH_COMPLETE);};p.prototype._preload=function(q){"use strict";i.preload(this._viewer,q,function(r){this._preloaded[i.getFBIDFromData(r)]=true;}.bind(this));};p.prototype._preloadPhotosInRange=function(q,r){"use strict";var s=[];for(var t=q;t<=r;++t){var u=h.getByIndexImmediate(this._setID,t);if(u&&!this._isPreloaded(u))s.push(u);}this._preload(s);};p.prototype._isPreloaded=function(q){"use strict";return this._preloaded[i.getFBIDFromData(q)];};p.prototype.getPosition=function(){"use strict";return this._position;};p.prototype.isValidMovement=function(q){"use strict";if(!h.hasBeenCreated(this._setID))return false;if(h.hasLooped(this._setID))return true;var r=this._position+q,s=h.getAvailableRange(this._setID),t=s.offset+s.length-1;return r>=s.offset-1&&r<=t+1;};p.prototype.getRelativeMovement=function(q){"use strict";return h.getIndexForID(this._setID,q)-this._position;};p.prototype.moveCursor=function(q){"use strict";if(!this.isValidMovement(q))return false;this._position+=q;return true;};p.prototype._page=function(q){"use strict";if(!this.moveCursor(q))return;this._log(j.PAGE_BEGIN);var r=h.getByIndexImmediate(this._setID,this._position);if(!r){this.inform('photo_fetch');this._log(j.PHOTO_FETCH);}else if(!this._isPreloaded(r))this._preload([r]);h.getByIndex(this._setID,this._position,this._updateCallback);this._loadMoreIfNecessary(q>0,p.BUFFER_SIZE);this._log(j.PAGE_COMPLETE);};p.prototype.loadMoreForwardIfNecessary=function(q){"use strict";var r=h.getAvailableRange(this._setID),s=r.offset+r.length-1,t=this._position+q;if(t>s&&!h.hasLooped(this._setID)){var u=h.getCursorByIndexImmediate(this._setID,s);h.fetchForward(this._setID,u,q,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(this._position+1,t);};p.prototype.loadMoreBackwardIfNecessary=function(q){"use strict";var r=h.getAvailableRange(this._setID),s=this._position-q;if(s<r.offset&&!h.hasLooped(this._setID)){var t=h.getCursorByIndexImmediate(this._setID,r.offset);h.fetchBackward(this._setID,t,q,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(s,this._position-1);};p.prototype._loadMoreIfNecessary=function(q,r){"use strict";if(q){this.loadMoreForwardIfNecessary(r);}else this.loadMoreBackwardIfNecessary(r);};p.prototype.displayFirst=function(){"use strict";if(!this._viewer.isOpen())return;h.setPreFetchCallback(this._setID,function(){this._log(j.DATA_FETCH_BEGIN);}.bind(this));var q=function(r){if(!this._isPreloaded(r))this._preload([r]);this._updateCallback(r);}.bind(this);h.getByIndex(this._setID,this._position,q);if(this._reverse){this.loadMoreBackwardIfNecessary(p.BUFFER_SIZE);}else this.loadMoreForwardIfNecessary(p.BUFFER_SIZE);};p.prototype.backward=function(){"use strict";this._page(this._reverse?1:-1);};p.prototype.forward=function(){"use strict";this._page(this._reverse?-1:1);};p.prototype._log=function(q){"use strict";this._viewer.log(q);};k(p,{BUFFER_SIZE:4});e.exports=p;});
__d("SpotlightViewerImage",["React","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('cx'),i=g.createClass({displayName:'SpotlightViewerImage',render:function(){return (g.DOM.img({className:"_4-od",src:this.props.src,style:{width:this.props.dimensions.x,height:this.props.dimensions.y}}));}});e.exports=i;});
__d("SpotlightViewerCoreMixin",["PhotoLogger","PhotoStore","PhotoUtils","PhotoViewState","SpotlightViewerImage","SpotlightViewerLoggingEvents"],function(a,b,c,d,e,f){var g=b('PhotoLogger'),h=b('PhotoStore'),i=b('PhotoUtils'),j=b('PhotoViewState'),k=b('SpotlightViewerImage'),l=b('SpotlightViewerLoggingEvents'),m={_displayFirstPhoto:function(){h.executePostCreate(this.props.setid,this.viewState.displayFirst.bind(this.viewState));},_getInitialPosition:function(){var n;if(!this.props.clearcache)n=h.getIndexForID(this.props.setid,this.props.photoid);if(n===undefined){h.clearSetCache(this.props.setid);n=0;}return n;},componentWillMount:function(){this._logger=new g(this.getViewerID());this.log(l.OPEN_BEGIN);var n=this._getInitialPosition();this.viewState=new j(this,this.props.setid,n,this._updatePhoto,this.props.reverse);this.behaviors&&this.enableBehaviors(this.behaviors);this.inform('open');this._displayFirstPhoto();},componentDidMount:function(){this._enableSubscriptions&&this._enableSubscriptions();this.log(l.OPEN_COMPLETE);},isOpen:function(){return this.state.open;},close:function(){if(!this.isOpen())return;this.log(l.CLOSE_BEGIN);this.setState({open:false},function(){this.inform('close');this.log(l.CLOSE_COMPLETE);}.bind(this));},componentWillUnmount:function(){this.viewState.destroy();delete this.viewState;this._resizer.destroy();delete this._resizer;this._dimensions.destroy();delete this._dimensions;this._subscriptions.release();this.destroyBehaviors();},getDimensions:function(){return this._dimensions;},_onClickViewport:function(n){n?this.viewState.forward():this.viewState.backward();},_getMedia:function(n,o){return (k({ref:"image",src:n.uri,dimensions:o.imageDimensions}));},_getCurrentFBID:function(){return i.getFBIDFromData(this.state.photoData);},_updatePhoto:function(n){this.log(l.PHOTO_CHANGE_BEGIN);var o=function(){this.inform('photo_change',n);this.log(l.PHOTO_CHANGE_COMPLETE);}.bind(this);if(i.getFBIDFromData(n)==this._getCurrentFBID()){this.setState({photoData:n},o);}else this.setState({updatingPhoto:true,photoData:n},this.setState.bind(this,{updatingPhoto:false},o));},getLogger:function(){return this._logger;},log:function(n){this._logger&&this._logger.logEvent(n);}};e.exports=m;});
__d("SpotlightViewerPagers",["LeftRight.react","Link.react","React","cx"],function(a,b,c,d,e,f){var g=b('LeftRight.react'),h=b('Link.react'),i=b('React'),j=b('cx'),k=i.createClass({displayName:'SpotlightViewerPagers',render:function(){return (g(null,h({className:"_4-oa _4-ob _50-m"}),h({className:"_4-oa _4-oc _50-m"})));}});e.exports=k;});
__d("SpotlightViewerThumbnailMixin",["PhotoStore","Vector"],function(a,b,c,d,e,f){var g=b('PhotoStore'),h=b('Vector'),i={_getInitialPhotoData:function(){var j=g.getIndexForID(this.props.setid,this.props.photoid),k=g.getByIndexImmediate(this.props.setid,j);return k?k:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function(){if(!this.props.dimensions||!this.props.thumbsrc)return null;var j={id:this.props.photoid};for(var k=0;k<this.props.dimensions.length;++k){var l=h.deserialize(this.props.dimensions[k]);j['image'+k]={width:l.x,height:l.y,uri:this.props.thumbsrc};}return j;}};e.exports=i;});
__d("SpotlightViewerUnmountOnClose",[],function(a,b,c,d,e,f){function g(h){"use strict";this.$SpotlightViewerUnmountOnClose0=h;}g.prototype.enable=function(){"use strict";this.$SpotlightViewerUnmountOnClose1=this.$SpotlightViewerUnmountOnClose0.subscribeOnce('close',this.$SpotlightViewerUnmountOnClose0.unmountComponent.bind(this.$SpotlightViewerUnmountOnClose0));};g.prototype.disable=function(){"use strict";this.$SpotlightViewerUnmountOnClose1&&this.$SpotlightViewerUnmountOnClose1.unsubscribe();delete this.$SpotlightViewerUnmountOnClose1;};e.exports=g;});
__d("SpotlightMessagesViewer",["ArbiterMixin","BehaviorsMixin","Event","PhotoViewerDimensions","React","SpotlightViewer","SpotlightViewerClose","SpotlightViewerCoreMixin","SpotlightViewerPagers","SpotlightViewerPageWithKeys","SpotlightViewerStageResizer","SpotlightViewerThumbnailMixin","SpotlightViewerUnmountOnClose","SpotlightViewport","SubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('BehaviorsMixin'),i=b('Event'),j=b('PhotoViewerDimensions'),k=b('React'),l=b('SpotlightViewer'),m=b('SpotlightViewerClose'),n=b('SpotlightViewerCoreMixin'),o=b('SpotlightViewerPagers'),p=b('SpotlightViewerPageWithKeys'),q=b('SpotlightViewerStageResizer'),r=b('SpotlightViewerThumbnailMixin'),s=b('SpotlightViewerUnmountOnClose'),t=b('SpotlightViewport'),u=b('SubscriptionsHandler'),v=k.createClass({displayName:'SpotlightMessagesViewer',mixins:[g,h,n,r],behaviors:[p,s],getViewerID:function(){return this.props.setid;},getInitialState:function(){this._dimensions=new j();this._subscriptions=new u();this._resizer=new q(this._dimensions);return {photoData:this._getInitialPhotoData(),open:true,maxStageDimensions:this._dimensions.getMaxStageDimensions(),updatingPhoto:false};},_enableSubscriptions:function(){this._subscriptions.addSubscriptions(i.listen(window,'resize',this._onResize));this.props.useloadingindicator&&this._subscriptions.addSubscriptions(this.viewState.subscribe('photo_fetch',this.setState.bind(this,{photoData:null},null)));},_onResize:function(){this.setState({maxStageDimensions:this._dimensions.getMaxStageDimensions()});},render:function(){var w,x,y,z=null;if(this.state.photoData){w=this._resizer.getImageAndStageDimensions(this._dimensions,this.state.photoData);x=this._dimensions.getBestFitImageFromPhoto(this.state.photoData,this.state.maxStageDimensions);y=w.stageDimensions;z=!this.state.updatingPhoto?this._getMedia(x,w):null;}else y=this._resizer.getCurrentStageDimensions();var aa=this.props.useloadingindicator&&!this.state.photoData;return (l({open:this.state.open,onHide:this.close},t({onClick:this._onClickViewport,stageDimensions:y,media:z,showLoadingIndicator:aa},m({onClick:this.close}),this.props.disablepaging?null:o(null))));}});e.exports=v;});
__d("MessagesViewer",["AsyncRequest","DOM","MessagesViewerSetID","PhotoStore","React","SpotlightMessagesViewer","ge"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('DOM'),i=b('MessagesViewerSetID'),j=b('PhotoStore'),k=b('React'),l=b('SpotlightMessagesViewer'),m=b('ge'),n={bootstrapWithElem:function(o){n.bootstrapWithConfig({fbid:o.getAttribute('data-fbid'),dimensions:o.getAttribute('data-dimensions'),src:o.getAttribute('href'),endpoint:o.getAttribute('data-endpoint'),disablePaging:o.getAttribute('data-disablepaging')},o);},bootstrapWithConfig:function(o,p){var q=o.setID;if(!q)q=i.MESSAGES;var r=l({open:true,setid:q,photoid:o.fbid,thumbsrc:o.src,dimensions:[o.dimensions],disablepaging:o.disablePaging,reverse:false});n.render(r);if(!j.hasBeenCreated(q)){var s=new g(o.endpoint);if(p)s.setRelativeTo(p);s.send();}},render:function(o){var p=m('messages_viewer');if(!p){p=h.create('div',{id:'messages_viewer'});document.body.appendChild(p);}k.renderComponent(o,p);o.subscribeOnce('close',function(){h.empty(p);});}};e.exports=n;});
__d("fileSlice",["UserAgent"],function(a,b,c,d,e,f){var g=b('UserAgent'),h='slice',i,j;if(i=g.chrome()){if(i<21)h='webkitSlice';}else if(i=g.firefox()){if(i<13)h='mozSlice';}else if(!(i=g.safari()))if(g.webkit())h='webkitSlice';j=a.File&&a.File.prototype[h];e.exports=j;});
__d("VideoUploadFeatureDetector",["UserAgent","fileSlice"],function(a,b,c,d,e,f){var g=b('UserAgent'),h=b('fileSlice'),i={supportsChunking:function(){return (typeof h==='function')&&this.supportsXHR();},supportsFullProgress:function(){return !g.firefox();},supportsFileAPI:function(){return ('FileList' in window);},supportsXHR:function(){return ('FormData' in window);}};e.exports=i;});
__d("VideoUploadFile",["arrayContains","fileSlice","VideoUploadFeatureDetector"],function(a,b,c,d,e,f){var g=b('arrayContains'),h=b('fileSlice'),i=b('VideoUploadFeatureDetector');function j(k){"use strict";this.$VideoUploadFile0=k;this.$VideoUploadFile1=j.getExtensionFromFileInput(k);if(i.supportsFileAPI()&&k.files.length){this.$VideoUploadFile2=k.files[0];this.$VideoUploadFile3=this.$VideoUploadFile2.size;}else{this.$VideoUploadFile2=null;this.$VideoUploadFile3=null;}}j.prototype.getFileInput=function(){"use strict";return this.$VideoUploadFile0;};j.prototype.getFile=function(){"use strict";return this.$VideoUploadFile2;};j.prototype.getSize=function(){"use strict";return this.$VideoUploadFile3;};j.prototype.getExtension=function(){"use strict";return this.$VideoUploadFile1;};j.prototype.getChunk=function(k,l){"use strict";return this.$VideoUploadFile2?h.call(this.$VideoUploadFile2,k,l):null;};j.getExtensionFromFileInput=function(k){"use strict";return g(k.value,'.')?k.value.split('.').pop().toLowerCase():'';};e.exports=j;});
__d("ComposerXMediaUploadHandler",["Arbiter","ComposerXController","VideoUploadConfig","VideoUploadFile"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ComposerXController'),i=b('VideoUploadConfig'),j=b('VideoUploadFile'),k='/ajax/composerx/attachment/media/upload/',l='/ajax/composerx/attachment/video/upload/';function m(n){"use strict";this.$ComposerXMediaUploadHandler0=n;}m.prototype.fetchAttachments=function(){"use strict";h.fetchAttachmentData(this.$ComposerXMediaUploadHandler0,k);h.fetchAttachmentData(this.$ComposerXMediaUploadHandler0,l);};m.prototype.handleFileSelected=function(n){"use strict";if(m.isVideoFile(n)){this.handleVideoSelected(n);}else this.handlePhotoSelected(n);};m.prototype.handleVideoSelected=function(n){"use strict";h.getAttachment(this.$ComposerXMediaUploadHandler0,l);g.inform('ComposerXFilesStore/filesAdded/'+this.$ComposerXMediaUploadHandler0+'/videoupload',{fileInput:n},g.BEHAVIOR_PERSISTENT);};m.prototype.handlePhotoSelected=function(n){"use strict";h.getAttachment(this.$ComposerXMediaUploadHandler0,k);g.inform('ComposerXFilesStore/filesAdded/'+this.$ComposerXMediaUploadHandler0+'/mediaupload',{fileInput:n},g.BEHAVIOR_PERSISTENT);};m.isVideoFile=function(n){"use strict";var o=j.getExtensionFromFileInput(n.getInput());return !!i.videoExtensions[o];};e.exports=m;});
__d("FileInputUploader",["ArbiterMixin","DOM","DTSG","FileForm","Form","copyProperties","mixin","submitForm"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('DOM'),i=b('DTSG'),j=b('FileForm'),k=b('Form'),l=b('copyProperties'),m=b('mixin'),n=b('submitForm'),o=m(g);for(var p in o)if(o.hasOwnProperty(p))r[p]=o[p];var q=o===null?null:o.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=o;function r(s){"use strict";this._inputElem=s;this._data={};}r.prototype.setInput=function(s){"use strict";this._inputElem=s;return this;};r.prototype.setURI=function(s){"use strict";this._uri=s;return this;};r.prototype.setData=function(s){"use strict";this._data=s;return this;};r.prototype.setPreprocessHandler=function(s){"use strict";this._preprocessHandler=s;return this;};r.prototype.setNetworkErrorRetryLimit=function(s){"use strict";this._retryLimit=s;return this;};r.prototype.setFiles=function(s){"use strict";this._files=s;return this;};r.prototype.setAllowCrossOrigin=function(s){"use strict";this._allowCrossOrigin=!!s;return this;};r.prototype.setUploadInParallel=function(s){"use strict";this._uploadInParallel=!!s;return this;};r.prototype.send=function(){"use strict";this._createForm();var s=this._inputElem.cloneNode(false);h.replace(this._inputElem,s);h.appendContent(this._formElem,this._inputElem);h.appendContent(document.body,this._formElem);n(this._formElem);h.replace(s,this._inputElem);this._cleanup();};r.prototype._onFileFormEvent=function(s,t){"use strict";this.inform(s,t);};r.prototype._createForm=function(){"use strict";this._formElem=h.create('form',{action:this._uri,method:'post'});this._fileForm=new j(this._formElem,null,{allowCrossOrigin:this._allowCrossOrigin,uploadInParallel:this._uploadInParallel,preprocessHandler:this._preprocessHandler,networkErrorRetryLimit:this._retryLimit});if(this._files)this._fileForm.setFiles(this._files);this._fileForm.subscribe(j.EVENTS,this._onFileFormEvent.bind(this));k.createHiddenInputs(l({fb_dtsg:i.getToken()},this._data),this._formElem);};r.prototype._cleanup=function(){"use strict";this._fileForm.destroy();this._fileForm=null;h.remove(this._formElem);this._formElem=null;};l(r.prototype,{_formElem:null,_fileForm:null,_uri:null,_files:null,_allowCrossOrigin:false,_uploadInParallel:false});e.exports=r;});
__d("XHRHttpError",[],function(a,b,c,d,e,f){var g='HTTP_CLIENT_ERROR',h='HTTP_PROXY_ERROR',i='HTTP_SERVER_ERROR',j='HTTP_TRANSPORT_ERROR',k='HTTP_UNKNOWN_ERROR';function l(m,n){if(n===0){var o=m.getProtocol();if(o==='file'||o==='ftp')return null;return j;}else if(n>=100&&n<200){return h;}else if(n>=200&&n<300){return null;}else if(n>=400&&n<500){return g;}else if(n>=500&&n<600){return i;}else if(n>=12001&&n<12156){return j;}else return k;}e.exports={getErrorCode:l,HTTP_CLIENT_ERROR:g,HTTP_PROXY_ERROR:h,HTTP_SERVER_ERROR:i,HTTP_TRANSPORT_ERROR:j,HTTP_UNKNOWN_ERROR:k};});
__d("xhrSimpleDataSerializer",[],function(a,b,c,d,e,f){function g(h){var i=[],j;for(j in h)i.push(encodeURIComponent(j)+'='+encodeURIComponent(h[j]));return i.join('&');}e.exports=g;});
__d("XHRRequest",["URI","XHRHttpError","getSameOriginTransport","invariant","xhrSimpleDataSerializer"],function(a,b,c,d,e,f){var g=b('URI'),h=b('XHRHttpError'),i=b('getSameOriginTransport'),j=b('invariant'),k=b('xhrSimpleDataSerializer'),l={errorCode:null,errorMsg:null,errorType:null},m={loadedBytes:null,totalBytes:null};function n(p){"use strict";this.setURI(p);this.setMethod('POST');this.setIsAsynchronous(true);this.setTransportBuilder(i);this.setDataSerializer(k);this.$XHRRequest0=this.$XHRRequest0.bind(this);}n.prototype.setURI=function(p){"use strict";this.$XHRRequest1=new g(p);return this;};n.prototype.getURI=function(){"use strict";return this.$XHRRequest1;};n.prototype.setMethod=function(p){"use strict";this.$XHRRequest2=p;return this;};n.prototype.getMethod=function(){"use strict";return this.$XHRRequest2;};n.prototype.setData=function(p){"use strict";this.$XHRRequest3=p;return this;};n.prototype.getData=function(){"use strict";return this.$XHRRequest3;};n.prototype.setRawData=function(p){"use strict";this.$XHRRequest4=p;return this;};n.prototype.setRequestHeaderField=function(p,q){"use strict";if(!this.$XHRRequest5)this.$XHRRequest5={};this.$XHRRequest5[p]=q;return this;};n.prototype.setTimeout=function(p){"use strict";this.$XHRRequest6=p;return this;};n.prototype.setResponseHandler=function(p){"use strict";this.$XHRRequest7=p;return this;};n.prototype.setErrorHandler=function(p){"use strict";this.$XHRRequest8=p;return this;};n.prototype.setAbortHandler=function(p){"use strict";this.$XHRRequest9=p;return this;};n.prototype.setTimeoutHandler=function(p){"use strict";this.$XHRRequesta=p;return this;};n.prototype.setUploadProgressHandler=function(p){"use strict";this.$XHRRequestb=p;return this;};n.prototype.setIsAsynchronous=function(p){"use strict";this.$XHRRequestc=p;return this;};n.prototype.setTransportBuilder=function(p){"use strict";this.$XHRRequestd=p;return this;};n.prototype.setDataSerializer=function(p){"use strict";this.$XHRRequeste=p;return this;};n.prototype.send=function(){"use strict";var p=this.$XHRRequest6,q=this.$XHRRequestd(),r=this.getURI();this.$XHRRequestf=q;var s;j(this.$XHRRequest2==='POST'||!this.$XHRRequest4);if(this.$XHRRequest2==='GET'||this.$XHRRequest4){r.addQueryData(this.$XHRRequest3);s=this.$XHRRequest4;}else s=this.$XHRRequeste(this.$XHRRequest3);q.onreadystatechange=this.$XHRRequest0;if(q.upload&&this.$XHRRequestb)q.upload.onprogress=this.$XHRRequestg.bind(this);if(p)this.$XHRRequesth=setTimeout(this.$XHRRequesta.bind(this),p);q.open(this.$XHRRequest2,r.toString(),this.$XHRRequestc);if(n.__inFlightRequests!==null){this.inFlight=true;n.__inFlightRequests.push(this);}if(this.$XHRRequest5)for(var t in this.$XHRRequest5)q.setRequestHeader(t,this.$XHRRequest5[t]);q.send(s);if(!this.$XHRRequestc)q.onreadystatechange(null,true);};n.prototype.abort=function(){"use strict";this.$XHRRequest9&&this.$XHRRequest9();this.$XHRRequestf&&this.$XHRRequestf.abort();this.$XHRRequesti();};n.prototype.$XHRRequesta=function(){"use strict";this.$XHRRequesta&&this.$XHRRequesta();this.$XHRRequesti();};n.prototype.$XHRRequest0=function(p,q){"use strict";if(!this.$XHRRequestc&&q!==true)return;var r=this.$XHRRequestf,s=r.readyState;if(s>=2){var t=this.getURI(),u=h.getErrorCode(t,r.status),v=this.$XHRRequest7;if(u!==null){l.errorCode=u;l.errorMsg=r.responseText;l.errorType='HTTP';this.$XHRRequest8&&this.$XHRRequest8(l);}else if(v){var w=null;if(v.includeHeaders)w=r.getAllResponseHeaders();if(s===4||v.parseStreaming&&s===3)v(r.responseText,w);}if(s===4)this.$XHRRequesti();}};n.prototype.$XHRRequestg=function(p){"use strict";m.loadedBytes=p.loaded;m.totalBytes=p.total;this.$XHRRequestb&&this.$XHRRequestb(m);};n.prototype.$XHRRequesti=function(){"use strict";if(this.$XHRRequesth!==undefined){clearTimeout(this.$XHRRequesth);this.$XHRRequesth=undefined;}delete this.$XHRRequestf;if(n.__inFlightRequests!==null){this.inFlight=false;n.__inFlightRequests=n.__inFlightRequests.filter(o);}};n.__inFlightRequests=null;if(window.attachEvent){n.__inFlightRequests=[];window.attachEvent('onunload',function p(){for(var q=0,r=n.__inFlightRequests.length;q<r;q++){n.__inFlightRequests[q].abort();delete n.__inFlightRequests[q];}n.__inFlightRequests.length=0;});}function o(p){return p&&p.inFlight;}e.exports=n;});
__d("getCrossOriginTransport",["ex"],function(a,b,c,d,e,f){var g=b('ex');function h(){try{var j=new XMLHttpRequest();if(!('withCredentials' in j))j=new XDomainRequest();return j;}catch(i){throw new Error(g('getCrossOriginTransport: %s',i.message));}}e.exports=h;});
__d("memoize",["invariant"],function(a,b,c,d,e,f){var g=b('invariant');function h(i){var j;return function(){var k=Array.prototype.slice.call(arguments,0);g(!k.length);if(i){j=i();i=null;}return j;};}e.exports=h;});
__d("PooledWebWorker",["WebWorker"],function(a,b,c,d,e,f){var g=b('WebWorker');for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){"use strict";i.constructor.call(this,m);this.$PooledWebWorker0=l;this.$PooledWebWorker1=k;}j.prototype.getIndex=function(){"use strict";return this.$PooledWebWorker0;};j.prototype.getPool=function(){"use strict";return this.$PooledWebWorker1;};e.exports=j;});
__d("WebWorkerPool",["PooledWebWorker","emptyFunction"],function(a,b,c,d,e,f){var g=b('PooledWebWorker'),h=b('emptyFunction');i.isSupported=function(){"use strict";return g.isSupported();};function i(j,k){"use strict";this.$WebWorkerPool0=[];for(var l=0;l<k;l++)this.$WebWorkerPool0.push(new g(this,l,j).setMessageHandler(this.$WebWorkerPool1).execute());this.$WebWorkerPool2=0;}i.prototype.setMessageHandler=function(j){"use strict";this.$WebWorkerPool3=j||h;return this;};i.prototype.postMessage=function(){"use strict";var j=Array.prototype.slice.call(arguments,0),k=this.getWorker();k.postMessage.apply(k,j);return k;};i.prototype.$WebWorkerPool1=function(){"use strict";var j=Array.prototype.slice.call(arguments,0);j.unshift(this);this.getPool().$WebWorkerPool3.apply(this.getPool(),j);};i.prototype.getWorker=function(){"use strict";var j=this.$WebWorkerPool0[this.$WebWorkerPool2];this.$WebWorkerPool2=(this.$WebWorkerPool2+1)%this.$WebWorkerPool0.length;return j;};e.exports=i;});
__d("JpegResizer",["JpegResizeWorkerResource","WebWorker","WebWorkerPool"],function(a,b,c,d,e,f){var g=b('JpegResizeWorkerResource'),h=b('WebWorker'),i=b('WebWorkerPool');j.isSupported=function(){"use strict";return i.isSupported();};function j(k){"use strict";k=k||j.DEFAULT_POOL_SIZE;h.prepareResource(g);this.$JpegResizer0=(new i(g,k)).setMessageHandler(this.$JpegResizer1.bind(this));this.$JpegResizer2={};}j.prototype.resizeBlob=function(k,l,m){"use strict";try{var o=this.$JpegResizer0.postMessage({blob:k,height:3072,width:3072}).getIndex();this.$JpegResizer3(o).unshift({done:l,progress:m});}catch(n){l(n);}return this;};j.prototype.$JpegResizer3=function(k){"use strict";if(!this.$JpegResizer2.hasOwnProperty(k))this.$JpegResizer2[k]=[];return this.$JpegResizer2[k];};j.prototype.$JpegResizer1=function(k,l){"use strict";if(l.done){this.$JpegResizer3(k.getIndex()).pop().done(l.error,l.blob,l.skipped);}else{var m=this.$JpegResizer3(k.getIndex()),n=m[m.length-1].progress;if(n)n({written:l.written,total:l.total});}};j.DEFAULT_POOL_SIZE=3;e.exports=j;});
__d("PhotosMimeType",[],function(a,b,c,d,e,f){function g(h){"use strict";if(this instanceof g===false)return new g(h);this.$PhotosMimeType0=h.split('/');}g.prototype.isImage=function(){"use strict";return this.$PhotosMimeType0[0]==='image';};g.prototype.isJpeg=function(){"use strict";return this.isImage()&&(this.$PhotosMimeType0[1]==='jpeg'||this.$PhotosMimeType0[1]==='pjpeg');};e.exports=g;});
__d("PhotosUploadWaterfallXMixin",["AsyncSignal","PhotosUploadWaterfallXConfig","copyProperties","invariant"],function(a,b,c,d,e,f){var g=b('AsyncSignal'),h=b('PhotosUploadWaterfallXConfig'),i=b('copyProperties'),j=b('invariant');function k(l,m){new g(h.loggingEndpoint,{data:JSON.stringify(l)}).setHandler(m).send();}e.exports={logStep:function(l,m,n){var o=this.getWaterfallID&&this.getWaterfallID(),p=this.getWaterfallAppName&&this.getWaterfallAppName();if(!o||!p)return;k(i({step:l,qn:o,uploader:p,ref:this.getWaterfallSource&&this.getWaterfallSource()},m),n);}};});
__d("str2rstr",[],function(a,b,c,d,e,f){function g(h){var i="",j,k;for(var l=0;l<h.length;l++){j=h.charCodeAt(l);k=l+1<h.length?h.charCodeAt(l+1):0;if(55296<=j&&j<=56319&&56320<=k&&k<=57343){j=65536+((j&1023)<<10)+(k&1023);l++;}if(j<=127){i+=String.fromCharCode(j);}else if(j<=2047){i+=String.fromCharCode(192|((j>>>6)&31),128|(j&63));}else if(j<=65535){i+=String.fromCharCode(224|((j>>>12)&15),128|((j>>>6)&63),128|(j&63));}else if(j<=2097151)i+=String.fromCharCode(240|((j>>>18)&7),128|((j>>>12)&63),128|((j>>>6)&63),128|(j&63));}return i;}e.exports=g;});
__d("md5",["str2rstr"],function(a,b,c,d,e,f){var g=b('str2rstr');function h(u,v){var w=u[0],x=u[1],y=u[2],z=u[3];w=j(w,x,y,z,v[0],7,-680876936);z=j(z,w,x,y,v[1],12,-389564586);y=j(y,z,w,x,v[2],17,606105819);x=j(x,y,z,w,v[3],22,-1044525330);w=j(w,x,y,z,v[4],7,-176418897);z=j(z,w,x,y,v[5],12,1200080426);y=j(y,z,w,x,v[6],17,-1473231341);x=j(x,y,z,w,v[7],22,-45705983);w=j(w,x,y,z,v[8],7,1770035416);z=j(z,w,x,y,v[9],12,-1958414417);y=j(y,z,w,x,v[10],17,-42063);x=j(x,y,z,w,v[11],22,-1990404162);w=j(w,x,y,z,v[12],7,1804603682);z=j(z,w,x,y,v[13],12,-40341101);y=j(y,z,w,x,v[14],17,-1502002290);x=j(x,y,z,w,v[15],22,1236535329);w=k(w,x,y,z,v[1],5,-165796510);z=k(z,w,x,y,v[6],9,-1069501632);y=k(y,z,w,x,v[11],14,643717713);x=k(x,y,z,w,v[0],20,-373897302);w=k(w,x,y,z,v[5],5,-701558691);z=k(z,w,x,y,v[10],9,38016083);y=k(y,z,w,x,v[15],14,-660478335);x=k(x,y,z,w,v[4],20,-405537848);w=k(w,x,y,z,v[9],5,568446438);z=k(z,w,x,y,v[14],9,-1019803690);y=k(y,z,w,x,v[3],14,-187363961);x=k(x,y,z,w,v[8],20,1163531501);w=k(w,x,y,z,v[13],5,-1444681467);z=k(z,w,x,y,v[2],9,-51403784);y=k(y,z,w,x,v[7],14,1735328473);x=k(x,y,z,w,v[12],20,-1926607734);w=l(w,x,y,z,v[5],4,-378558);z=l(z,w,x,y,v[8],11,-2022574463);y=l(y,z,w,x,v[11],16,1839030562);x=l(x,y,z,w,v[14],23,-35309556);w=l(w,x,y,z,v[1],4,-1530992060);z=l(z,w,x,y,v[4],11,1272893353);y=l(y,z,w,x,v[7],16,-155497632);x=l(x,y,z,w,v[10],23,-1094730640);w=l(w,x,y,z,v[13],4,681279174);z=l(z,w,x,y,v[0],11,-358537222);y=l(y,z,w,x,v[3],16,-722521979);x=l(x,y,z,w,v[6],23,76029189);w=l(w,x,y,z,v[9],4,-640364487);z=l(z,w,x,y,v[12],11,-421815835);y=l(y,z,w,x,v[15],16,530742520);x=l(x,y,z,w,v[2],23,-995338651);w=m(w,x,y,z,v[0],6,-198630844);z=m(z,w,x,y,v[7],10,1126891415);y=m(y,z,w,x,v[14],15,-1416354905);x=m(x,y,z,w,v[5],21,-57434055);w=m(w,x,y,z,v[12],6,1700485571);z=m(z,w,x,y,v[3],10,-1894986606);y=m(y,z,w,x,v[10],15,-1051523);x=m(x,y,z,w,v[1],21,-2054922799);w=m(w,x,y,z,v[8],6,1873313359);z=m(z,w,x,y,v[15],10,-30611744);y=m(y,z,w,x,v[6],15,-1560198380);x=m(x,y,z,w,v[13],21,1309151649);w=m(w,x,y,z,v[4],6,-145523070);z=m(z,w,x,y,v[11],10,-1120210379);y=m(y,z,w,x,v[2],15,718787259);x=m(x,y,z,w,v[9],21,-343485551);u[0]=s(w,u[0]);u[1]=s(x,u[1]);u[2]=s(y,u[2]);u[3]=s(z,u[3]);}function i(u,v,w,x,y,z){v=s(s(v,u),s(x,z));return s((v<<y)|(v>>>(32-y)),w);}function j(u,v,w,x,y,z,aa){return i((v&w)|((~v)&x),u,v,y,z,aa);}function k(u,v,w,x,y,z,aa){return i((v&x)|(w&(~x)),u,v,y,z,aa);}function l(u,v,w,x,y,z,aa){return i(v^w^x,u,v,y,z,aa);}function m(u,v,w,x,y,z,aa){return i(w^(v|(~x)),u,v,y,z,aa);}function n(u){var v=u.length,w=[1732584193,-271733879,-1732584194,271733878],x;for(x=64;x<=u.length;x+=64)h(w,o(u.substring(x-64,x)));u=u.substring(x-64);var y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(x=0;x<u.length;x++)y[x>>2]|=u.charCodeAt(x)<<((x&3)<<3);y[x>>2]|=128<<((x&3)<<3);if(x>55){h(w,y);for(x=0;x<16;x++)y[x]=0;}y[14]=v*8;h(w,y);return w;}function o(u){var v=[],w=0;while(w<64)v[w>>2]=u.charCodeAt(w++)|(u.charCodeAt(w++)<<8)|(u.charCodeAt(w++)<<16)|(u.charCodeAt(w++)<<24);return v;}var p='0123456789abcdef'.split('');function q(u){var v='',w=0;for(;w<4;w++)v+=p[(u>>((w<<3)+4))&15]+p[(u>>(w<<3))&15];return v;}function r(u){for(var v=0;v<u.length;v++)u[v]=q(u[v]);return u.join('');}var s=function(u,v){return (u+v)&4294967295;};function t(u){if(null===u||undefined===u){return null;}else{for(var v=0;v<u.length;v++)if(u[v]>"\u007F"){u=g(u);break;}return r(n(u));}}if(t('hello')!='5d41402abc4b2a76b9719d911017c592')s=function(u,v){var w=(u&65535)+(v&65535),x=(u>>16)+(v>>16)+(w>>16);return (x<<16)|(w&65535);};e.exports=t;});
__d("WaterfallIDGenerator",["CurrentUser","md5"],function(a,b,c,d,e,f){var g=b('CurrentUser'),h=b('md5');function i(){var l=2147483647;return Math.random()*l;}function j(){return Math.floor(Date.now()/1000);}var k={generate:function(){return h([g.getID(),j(),i()].join(':'));}};e.exports=k;});
__d("BanzaiScribe",["Banzai"],function(a,b,c,d,e,f){var g=b('Banzai');function h(j){return {log:function(k,l,m){var n=[l];if(m!=null)n.push(m);g.post('scribe:'+k,n,j);}};}var i=h({});i.create=h;e.exports=i;});
__d("SamplingPolicyBase",[],function(a,b,c,d,e,f){function g(){"use strict";throw 'Tried to instantiate SamplingPolicyBase';}g.prototype.getName=function(){"use strict";return this.name;};g.prototype.isSampled=function(){"use strict";if(typeof(this.sampled)=='undefined')this.sampled=this.decideIfSampled();return this.sampled;};e.exports=g;});
__d("FbtraceForcedByServerPolicy",["FbtraceForcedByServer","SamplingPolicyBase","copyProperties"],function(a,b,c,d,e,f){'use strict';var g=b('FbtraceForcedByServer'),h=b('SamplingPolicyBase'),i=b('copyProperties'),j;function k(){this.name='FbtraceForcedByServerPolicy';}k.get=function(){if(typeof(j)=='undefined')j=new k();return j;};function l(){return g.forced;}i(k.prototype,h.prototype,{decideIfSampled:l});e.exports=k;});
/**
 * @generated SignedSource<<091461a353d9b40c12f5a66d653a6b62>>
 * 
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * !! This file is a check-in of a static_upstream project!      !!
 * !!                                                            !!
 * !! You should not modify this file directly. Instead:         !!
 * !! 1) Use `fjs use-upstream` to temporarily replace this with !!
 * !!    the latest version from upstream.                       !!
 * !! 2) Make your changes, test them, etc.                      !!
 * !! 3) Use `fjs push-upstream` to copy your changes back to    !!
 * !!    static_upstream.                                        !!
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * 
 * Copyright (C) 2010 by Johannes Baagoe <baagoe@baagoe.org>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * @providesModule Alea
 * @preserve-header
 */__d("Alea",[],function(a,b,c,d,e,f){function g(){var i=4022871197,j=function(k){k=k.toString();for(var l=0;l<k.length;l++){i+=k.charCodeAt(l);var m=.02519603282416938*i;i=m>>>0;m-=i;m*=i;i=m>>>0;m-=i;i+=m*4294967296;}return (i>>>0)*2.3283064365386963e-10;};j.version='Mash 0.9';return j;}function h(){return (function(i){var j=0,k=0,l=0,m=1;if(i.length===0)i=[new Date()];var n=new g();j=n(' ');k=n(' ');l=n(' ');for(var o=0;o<i.length;o++){j-=n(i[o]);if(j<0)j+=1;k-=n(i[o]);if(k<0)k+=1;l-=n(i[o]);if(l<0)l+=1;}n=null;var p=function(){var q=2091639*j+m*2.3283064365386963e-10;j=k;k=l;l=q-(m=q|0);return l;};p.version='Alea 0.9';p.args=i;return p;}(Array.prototype.slice.call(arguments)));}e.exports=h;});
__d("Random",["Alea","ServerNonce"],function(a,b,c,d,e,f){'use strict';var g=b('Alea'),h=b('ServerNonce').ServerNonce,i=g(h),j={random:i,uint32:function(){return Math.floor(i()*4294967296);}};e.exports=j;});
__d("guardFunction",[],function(a,b,c,d,e,f){function g(h,i,j){return function(){if(h.apply(j||this,arguments))i.apply(j||this,arguments);};}e.exports=g;});
__d("Fbtrace",["BanzaiScribe","copyProperties","FbtraceForcedByServerPolicy","FbtraceForcedByServer","Env","Random","ErrorUtils","Arbiter","guardFunction"],function(a,b,c,d,e,f){'use strict';var g=b('BanzaiScribe'),h=b('copyProperties'),i=b('FbtraceForcedByServerPolicy'),j=b('FbtraceForcedByServer'),k=b('Env'),l=b('Random'),m=b('ErrorUtils'),n=b('Arbiter'),o=b('guardFunction'),p='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',q='AAAAAAAAAAA';for(var r in Error)if(Error.hasOwnProperty(r))t[r]=Error[r];var s=Error===null?null:Error.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=Error;function t(ia){Error.call(this,ia);}function u(ia){m.reportError(new t(ia));}function v(){var ia=function(){var la=0,ma=0,na='';for(var oa=10;oa>=0;oa--){if(la<6){ma=l.uint32();la=32;}if(oa===0)ma=ma&7;na=p.charAt(ma&63)+na;ma>>=6;la-=6;}return na;},ja,ka;for(ja=3;ja>0;ja--){ka=ia();if(ka!=q)return ka;}u('failed to generate valid Fbtrace id');return q;}function w(){h(this,w);}h(w,{isOn:function(){return false;},replySend:function(ia,ja){},requestSend:function(ia,ja,ka){ca(ia,ja);return {metadata:function(){return undefined;},replyReceive:function(la){}};}});var x=new w();function y(ia,ja,ka){if(!ia)throw {name:'ArgumentError',message:'no valid service name specified'};if(!ja)throw {name:'ArgumentError',message:'no valid version specified'};var la=g,ma=0,na=v(),oa=v(),pa=ba(na),qa={service:ia,version:ja},ra=function(wa){if(typeof(wa)=='undefined')return 'undefined';if(typeof(wa)!='string')wa=ra(JSON.stringify(wa));return wa;},sa=function(wa){var xa='';for(var ya in wa){if(xa.length>0)xa+='\x02';xa+=ra(ya)+'\x03'+ra(wa[ya]);}return xa;},ta=function(wa,xa,event,ya,za){ma++;return [za,ma,na,wa,xa,ra(event),sa(ya)].join('\x01');},ua=function(wa,xa,event,ya,za){if(!za&&typeof(za)=='undefined')za=Date.now()*1000;var ab=ta(wa,xa,event,ya,za);la.log('fbtrace',ab,pa);},va=function(){return oa;};ua(q,oa,'#rqrecv',h(ka,qa));h(this,y);h(this,{replySend:function(wa,xa){xa=h(xa,qa,{success:wa?'true':'false'});ua(q,oa,'#rpsend',xa);},requestSend:function(wa,xa,ya){ca(wa,xa);var za=va(),ab=v();ya=h(ya,qa,{op:wa,'remote:service':xa});ua(za,ab,'#rqsend',ya);return {metadata:function(){return na+ab;},replyReceive:function(bb){ua(za,ab,'#rprecv',h(bb,qa));},parentNode:this};}});}h(y,{isOn:function(){return true;}});function z(){return x;}function aa(ia,ja,ka){ka=ka||{};ka.init=true;var la=i.get();if(la.isSampled()){return new y(ia,ja,ka);}else return new w();}function ba(ia){var ja=ia.charAt(ia.length-1);return p.indexOf(ja)%32;}function ca(ia,ja){if(!ia)throw {name:'ArgumentError',message:'no valid operation specified'};if(!ja)throw {name:'ArgumentError',message:'no valid remote:service specified'};}function da(ia,ja){var ka=x,la;x=ia;try{la=ja();}finally{x=ka;}return la;}var ea=function(ia,ja){var ka=z(),la=ja.request;if(!ka.isOn()&&j.forced&&/\/upload\/(?:composer|photos)\/|\/ajax\/composerx\/attachment\/media\//.test(la.uri.toString()))ka=aa('photo_upload_kludge',String(k.svn_rev||'dev'),{policy:'PhotoUpload'});if(ka.isOn()){var ma={policy:'PhotoUpload'};if(la.userActionId)ma.user_action_id=la.userActionId;var na=ka.requestSend(la.uri.toString(),'www',ma);la.fbtraceRemoteNode=na;la.transport.setRequestHeader('X-Fbtrace-Meta',na.metadata());}},fa=function(ia,ja){ja.request.fbtraceRemoteNode.replyReceive({is_last:ja.response.is_last,success:true});setTimeout(function(){ja.request.fbtraceRemoteNode.parentNode.replySend(true,{});},0);},ga=function(ia,ja){ja.request.fbtraceRemoteNode.replyReceive({is_last:ja.response.is_last,success:false,error_code:ja.response.error,error_summary:ja.response.errorSummary,error_description:ja.response.errorDescription});setTimeout(function(){ja.request.fbtraceRemoteNode.parentNode.replySend(false,{});},0);},ha=function(ia,ja){return ja.request.fbtraceRemoteNode;};n.subscribe('AsyncRequest/send',ea);n.subscribe('AsyncRequest/response',o(ha,fa));n.subscribe('AsyncRequest/error',o(ha,ga));e.exports={defaultNode:z,requestReceive:aa,withDefaultNode:da};});
__d("PhotosMultiUploadInput",["Arbiter","Animation","AsyncUploadRequest","ComposerXController","ComposerXDragDrop","ComposerXMediaUploadHandler","CSS","Dialog","DOM","DOMQuery","DragDropTarget","Event","FileInputUploader","JpegResizer","JSLogger","Parent","PhotosMimeType","PhotosUploadID","PhotosUploadWaterfallXMixin","PUWApplications","PUWMethods","PUWSteps","ProgressBar","WaterfallIDGenerator","$","copyProperties","createArrayFrom","csx","cx","mixin","performanceNow","tx","Fbtrace"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Animation'),i=b('AsyncUploadRequest'),j=b('ComposerXController'),k=b('ComposerXDragDrop'),l=b('ComposerXMediaUploadHandler'),m=b('CSS'),n=b('Dialog'),o=b('DOM'),p=b('DOMQuery'),q=b('DragDropTarget'),r=b('Event'),s=b('FileInputUploader'),t=b('JpegResizer'),u=b('JSLogger'),v=b('Parent'),w=b('PhotosMimeType'),x=b('PhotosUploadID'),y=b('PhotosUploadWaterfallXMixin'),z=b('PUWApplications'),aa=b('PUWMethods'),ba=b('PUWSteps'),ca=b('ProgressBar'),da=b('WaterfallIDGenerator'),ea=b('$'),fa=b('copyProperties'),ga=b('createArrayFrom'),ha=b('csx'),ia=b('cx'),ja=u.create('composer'),ka=b('mixin'),la=b('performanceNow'),ma=b('tx');b("Fbtrace");function na(wa,xa,ya,za){"use strict";this._grid=ta.getInstance(za.gridID);this._grid.setProgressBarMarkup(wa).setVideoIconMarkup(xa).setConfig(za);ya.getInput().multiple=(za.maxselect!=1)&&i.isSupported();ya.subscribe('change',function(ab,event){if(event.getTarget().value)this._grid.doFileUpload(ya);}.bind(this));if(!this._grid.sessionStarted){this._grid.sessionStarted=true;this._grid.logStep(ba.CLIENT_FLOW_BEGIN);}this._grid.logStep(ba.CLIENT_SELECT_BEGIN);g.inform('PhotosMultiUploadInput/loaded/'+za.gridID,g.BEHAVIOR_PERSISTENT);}na.prototype.getGrid=function(){"use strict";return this._grid;};fa(na,{imageUploadDone:function(wa,xa,ya,za){oa[wa].imageUploadDone(xa,ya,za);},initDragDrop:function(wa,xa){g.inform('PhotosMultiUploadInput/initDragDrop/'+wa,{dragDropArea:xa},g.BEHAVIOR_PERSISTENT);},imageUploadFail:function(wa,xa){oa[wa].removeLoadingIndicator(xa.getFile().uploadID);},doFileUpload:function(wa,xa){oa[wa].doFileUpload(xa);},onFilesDrop:function(wa,xa){oa[wa].onFilesDrop(xa);},getWaterfallID:function(wa){return ta.getInstance(wa).getWaterfallID();},clearSession:function(wa){oa[wa].clearSession();},getConfig:function(wa){return oa[wa].getConfig();},updateProgressBar:function(wa,event){if(event.loaded!=event.total){wa.setPosition(50*event.loaded/event.total);}else{wa.setPosition(50);wa.setTarget(100,2000);}}});var oa={},pa=0,qa=ka(y);for(var ra in qa)if(qa.hasOwnProperty(ra))ta[ra]=qa[ra];var sa=qa===null?null:qa.prototype;ta.prototype=Object.create(sa);ta.prototype.constructor=ta;ta.__superConstructor__=qa;function ta(wa){"use strict";this._loadingIndicators={};this._numRemainingFiles=0;this._progressBarMarkup=null;this._videoIconMarkup=null;this._gridID=wa;this._dragDropTarget=null;this._submitListener=null;this._fileInputInstances=[];this._uploadTimers={};this._sessionsStarted=false;this._waterfallID=null;this._resizer=null;g.subscribe('multi-upload/video-removed/'+this._gridID,function(){o.remove(this._videoIconMarkup);this._submitListener&&this._submitListener.remove();this._submitListener=null;this._fileInputInstances.forEach(function(xa){xa.clear();});}.bind(this));g.subscribe('PhotosMultiUploadInput/initDragDrop/'+wa,function(xa,ya){this.initDragDrop(ya.dragDropArea);}.bind(this));g.subscribe('AttachmentsPhotoEditor/newImage'+wa,this._onEditedImage.bind(this));}ta.prototype.getWaterfallID=function(){"use strict";if(!this._waterfallID)this._waterfallID=da.generate();return this._waterfallID;};ta.prototype.getWaterfallAppName=function(){"use strict";return z.WEB_COMPOSER;};ta.prototype.getLoadingIndicator=function(wa){"use strict";var xa=this._loadingIndicators[wa];return xa;};ta.prototype.initDragDrop=function(wa){"use strict";this._dragDropTarget&&this._dragDropTarget.disable();this._dragDropTarget=new q(wa).setOnFilesDropCallback(this.onFilesDrop.bind(this)).setFileFilter(k.filterImages).enable();};ta.prototype.setConfig=function(wa){"use strict";this._config=wa;if(!t.isSupported()){this.logStep(ba.CLIENT_PROCESS_UNAVAILABLE);}else if(this._config.useResizer)this._resizer=new t(this._config.maxselect===1?1:t.DEFAULT_POOL_SIZE);if(!this._waterfallID)this._waterfallID=wa.waterfallID;return this;};ta.prototype.setProgressBarMarkup=function(wa){"use strict";this._progressBarMarkup=wa;return this;};ta.prototype.setVideoIconMarkup=function(wa){"use strict";this._videoIconMarkup=wa;var xa=o.find(wa,"._3ev");r.listen(xa,'click',this._onVideoRemoved.bind(this));return this;};ta.prototype.imageUploadDone=function(wa,xa,ya){"use strict";var za=this.getLoadingIndicator(xa);if(!za)return;if(o.contains(document.body,za.getRoot()))o.replace(za.getRoot(),wa);g.inform(['multi-upload/images-added/'+this._gridID,'multi-upload/images-added'],{fbids:[ya],tagInfo:{}});this._numRemainingFiles--;if(this._numRemainingFiles===0)g.inform('multi-upload/images-upload-completed/'+this._gridID);this._loadingIndicators[xa]=null;};ta.prototype._generateLoadingIndicator=function(wa){"use strict";this._numRemainingFiles++;var xa=this._progressBarMarkup.cloneNode(true);this.insertIntoGrid(xa);this._loadingIndicators[wa]=new ca(xa);};ta.prototype._generateUploadIDsAndLoadingIndicators=function(wa){"use strict";for(var xa=0;xa<wa.length;xa++){if(!wa[xa].uploadID)wa[xa].uploadID=x.getNewID();this._generateLoadingIndicator(wa[xa].uploadID);}};ta.prototype.fileUploadFailure=function(wa,xa){"use strict";var ya=Date.now()-this._uploadTimers[wa],za=0;if(xa.upload)za=xa.upload.getRetryCount?xa.upload.getRetryCount():0;this.logStep(ba.CLIENT_TRANSFER_FAIL,{dt:ya,error_code:xa.response?xa.response.getError():undefined,bytes:xa.upload?xa.upload.getFile().size:null,auto_retry_count:za});this._showUploadFailedMessage(wa);this._fadeOutFileUpload(wa);};ta.prototype._fadeOutFileUpload=function(wa){"use strict";new h(this.getLoadingIndicator(wa).getRoot()).duration(2000).checkpoint().from('opacity',1).to('opacity',0).duration(1000).ondone(this.removeFileUpload.bind(this,wa)).go();};ta.prototype._showUploadFailedMessage=function(wa){"use strict";m.hide(p.find(this.getLoadingIndicator(wa).getRoot(),"._5l83"));m.show(p.find(this.getLoadingIndicator(wa).getRoot(),"._5l82"));};ta.prototype.fileUploadCanceled=function(wa,xa){"use strict";var ya=Date.now()-this._uploadTimers[wa];this.logStep(ba.CLIENT_TRANSFER_CANCEL,{dt:ya,bytes:xa.upload.getFile().size});this.removeFileUpload(wa);};ta.prototype.removeFileUpload=function(wa){"use strict";this._numRemainingFiles=Math.max(0,this._numRemainingFiles-1);this.removeLoadingIndicator(wa);if(this._numRemainingFiles===0)g.inform('multi-upload/images-upload-completed/'+this._gridID);};ta.prototype.doFileUpload=function(wa){"use strict";var xa=false,ya=false;switch(this._config.supportedFileTypes){case 'photos':ya=true;break;case 'videos':xa=true;break;case 'both':xa=ya=true;break;}var za=xa&&l.isVideoFile(wa);this._submitListener&&this._submitListener.remove();if(za){var ab=v.byTag(ea(this._gridID),'form'),bb=j.getComposerID(ab),cb=new l(bb);cb.handleVideoSelected(wa);}else if(ya){this._photosSelected(wa);}else new n().setBody("Sorry, you can only select video files.").setTitle("Unsupported File").setModal(true).setButtons(n.OK).show();};ta.prototype.getConfig=function(){"use strict";return this._config;};ta.prototype._resizeUpload=function(wa,xa){"use strict";var ya=wa.getFile();if(!w(ya.type).isJpeg())return xa(wa);var za=la();this.logStep(ba.CLIENT_PROCESS_BEGIN,{bytes:ya.size});this._resizer.resizeBlob(ya,function(ab,bb,cb){bb=bb||ya;if(ab){this.logStep(ba.CLIENT_PROCESS_FAIL,{dt:la()-za,bytes:bb.size,error_code:ab.message});return xa(wa);}bb.uploadID=ya.uploadID;wa.setFile(bb);this.logStep(ba.CLIENT_PROCESS_SUCCESS,{dt:la()-za,media_data_size:ya.size,bytes:bb.size,custom_tags:{skipped_resizing:cb}});xa(wa);}.bind(this),this._onResizeProgress.bind(this,ya.uploadID));};ta.prototype._photosSelected=function(wa){"use strict";var xa=wa.getInput(),ya=ua(xa);if(this._config.maxselect>1&&ya>this._config.maxselect){new n().setTitle("Too Many Photos").setBody(ma._("Sorry, you can only add {maxselect} photos to a message. If you'd like, you can add photos to additional messages.",{maxselect:this._config.maxselect})).setButtons(n.OK).setModal(true).show();return;}this._onBeforeAddUploadedImages();var za=this._config.uploadData,ab=null;if(!va(xa)){xa.uploadID=x.getNewID();this._generateLoadingIndicator(xa.uploadID);za.upload_id=xa.uploadID;}else{ab=ga(xa.files);this._generateUploadIDsAndLoadingIndicators(ab);}g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:ya});if(this._config.waterfallID)za.qn=this._config.waterfallID;var bb=new s(xa).setURI(this._config.photoEndpoint).setData(za).setAllowCrossOrigin(true).setUploadInParallel(true);if(bb.setNetworkErrorRetryLimit)bb.setNetworkErrorRetryLimit(this._config.retryLimit);if(ab){bb.setFiles(ab);if(this._resizer)bb.setPreprocessHandler(this._resizeUpload.bind(this));}bb.subscribe('progress',this._onUploadProgress.bind(this));bb.subscribe('failure',function(db,eb){this.fileUploadFailure(this._getUploadID(eb,xa),eb);}.bind(this));bb.subscribe('start',this._onFileUploadStart.bind(this));bb.subscribe('success',function(db,eb){this._onFileUploadSuccess(this._getUploadID(eb,xa),eb);}.bind(this));try{bb.send();wa.clear();}catch(cb){ja.error('error_send_unpublished_files',cb);throw cb;}this.logStep(ba.CLIENT_SELECT_SUCCESS,{times_selected:pa++,volume:ya,method:'file_selector'});};ta.prototype._onVideoRemoved=function(){"use strict";this._dragDropTarget&&this._dragDropTarget.enable();g.inform('multi-upload/video-removed/'+this._gridID);};ta.prototype.removeLoadingIndicator=function(wa){"use strict";var xa=this.getLoadingIndicator(wa);xa&&o.remove(xa.getRoot());delete this._loadingIndicators[wa];};ta.prototype._onFileUploadStart=function(wa,xa){"use strict";var ya=xa.upload.getFile().uploadID,za=o.find(this.getLoadingIndicator(ya).getRoot(),"._639");m.show(za);r.listen(za,'click',function(){xa.upload.abort();this.fileUploadCanceled(ya,xa);}.bind(this));this._uploadTimers[ya]=Date.now();this.logStep(ba.CLIENT_TRANSFER_BEGIN,{bytes:xa.upload.getFile().size});};ta.prototype._onUploadProgress=function(wa,xa){"use strict";var ya=xa.upload.getFile().uploadID,za=this.getLoadingIndicator(ya);if(!za)return;this._showProgressBar(za);m.removeClass(za.getRoot(),"_5v_0");na.updateProgressBar(za,xa.event);};ta.prototype._onResizeProgress=function(wa,event){"use strict";var xa=this.getLoadingIndicator(wa);if(!xa)return;this._showProgressBar(xa);m.addClass(xa.getRoot(),"_5v_0");xa.setPosition(100*event.written/event.total);};ta.prototype._showProgressBar=function(wa){"use strict";m.hide(o.find(wa.getRoot(),"._2om"));m.show(o.find(wa.getRoot(),"._5e4h"));};ta.prototype._onFileUploadSuccess=function(wa,xa){"use strict";var ya=Date.now()-this._uploadTimers[wa],za={dt:ya};if(xa.upload){za.bytes=xa.upload.getFile().size;za.auto_retry_count=xa.upload.getRetryCount?xa.upload.getRetryCount():0;}this.logStep(ba.CLIENT_TRANSFER_SUCCESS,za);};ta.prototype._onEditedImage=function(wa,xa){"use strict";this._onBeforeAddUploadedImages();this.logStep(ba.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators([xa]);g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1,method:aa.EDITOR});var ya=new i().setData(this._config.uploadData).setFiles([xa]).setAllowCrossOrigin(true).setURI(this._config.photoEndpoint);ya.subscribe('failure',function(za,ab){this.fileUploadFailure(ab.getFile().uploadID,{upload:ab});}.bind(this));ya.subscribe('progress',function(za,ab){this._onUploadProgress(za,{upload:ab,event:ab.getProgressEvent()});}.bind(this));ya.subscribe('start',function(za,ab){this._onFileUploadStart(za,{upload:ab});}.bind(this));ya.subscribe('success',function(za,ab){this._onFileUploadSuccess(ab.getFile().uploadID,{upload:ab});}.bind(this));ya.send();this.logStep(ba.CLIENT_SELECT_SUCCESS,{volume:1,method:aa.EDITOR});};ta.prototype.onFilesDrop=function(wa){"use strict";this._onBeforeAddUploadedImages();this.logStep(ba.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators(wa);g.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:wa.length,method:aa.DRAGDROP||'dragdrop'});var xa=new i().setData(this._config.uploadData).setFiles(wa).setAllowCrossOrigin(true).setURI(this._config.photoEndpoint);xa.subscribe('failure',function(ya,za){this.fileUploadFailure(za.getFile().uploadID,{upload:za});}.bind(this));xa.subscribe('progress',function(ya,za){this._onUploadProgress(ya,{upload:za,event:za.getProgressEvent()});}.bind(this));xa.subscribe('start',function(ya,za){this._onFileUploadStart(ya,{upload:za});}.bind(this));xa.subscribe('success',function(ya,za){this._onFileUploadSuccess(za.getFile().uploadID,{upload:za});}.bind(this));xa.send();this.logStep(ba.CLIENT_SELECT_SUCCESS,{volume:wa.length,method:'drag_drop'});};ta.prototype._onBeforeAddUploadedImages=function(){"use strict";if(!this.sessionStarted)this.logStep(ba.CLIENT_FLOW_BEGIN);if(this._config.maxselect==1)g.inform('multi-upload/composer-reset/'+this._gridID);this.sessionStarted=true;};ta.prototype.clearSession=function(){"use strict";this.sessionStarted=false;};ta.prototype.insertIntoGrid=function(wa){"use strict";var xa=o.scry(ea(this._gridID),"._577")[0];if(xa){o.insertBefore(xa,wa);}else o.prependContent(ea(this._gridID),wa);};ta.prototype._getUploadID=function(wa,xa){"use strict";if(wa.upload){return wa.upload.getFile().uploadID;}else return xa.uploadID;};ta.getInstance=function(wa){"use strict";oa[wa]=oa[wa]||new ta(wa);return oa[wa];};function ua(wa){if(!va(wa))return 1;return wa.files.length;}function va(wa){return !!wa.files;}e.exports=na;});
__d("LinkshimHandler",["Event","LinkshimAsyncLink","LinkshimHandlerConfig","URI","XLinkshimLogControllerURIBuilder","shield"],function(a,b,c,d,e,f){var g=b('Event'),h=b('LinkshimAsyncLink'),i=b('LinkshimHandlerConfig'),j=b('URI'),k=b('XLinkshimLogControllerURIBuilder'),l=b('shield'),m={setUpLinkshimHandling:function(s){try{var u=j(s.getAttribute('href')),v=n(u);if(v&&o(u)){g.listen(s,'mouseover',l(h.swap,null,s,v));var w=q(u);g.listen(s,'click',function(){if(i.supports_meta_referrer){h.referrer_log(s,w,p(u).toString());}else h.swap(s,u);});}}catch(t){}}};function n(s){return s.getQueryData().u?new j(s.getQueryData().u):null;}function o(s){return s.getQueryData().hasOwnProperty('s');}function p(s){var t=s.getQueryData().hasOwnProperty('enc')?s.getQueryData().enc:'';return (new k()).setString('u',s.getQueryData().u).setString('h',s.getQueryData().h).setBool('render_verification',s.getQueryData().hasOwnProperty('render_verification')).setString('enc',t).getURI();}function q(s){var t;if(r()){t=j(s).addQueryData({render_verification:true});}else t=n(s);return t;}function r(){var s=i.render_verification_rate||0;return Math.floor(Math.random()*s+1)===s;}e.exports=m;});
__d("MercuryAttachmentRenderer",["MercuryAttachmentTemplates","MercuryAttachmentAudioClip.react","CSS","MercuryConstants","DOM","Event","JSXDOM","MercuryAttachment","MercuryAttachmentType","MercuryConfig","MercuryMessages","MercuryParticipants","MessagesViewer","PhotosMultiUploadInput","ProgressBar","React","Sticker.react","Style","URI","UserAgent","cx","invariant","tx"],function(a,b,c,d,e,f){"use strict";var g=b('MercuryAttachmentTemplates'),h=b('MercuryAttachmentAudioClip.react'),i=b('CSS'),j=b('MercuryConstants'),k=b('DOM'),l=b('Event'),m=b('JSXDOM'),n=b('MercuryAttachment'),o=b('MercuryAttachmentType'),p=b('MercuryConfig'),q=b('MercuryMessages').get(),r=b('MercuryParticipants'),s=b('MessagesViewer'),t=b('PhotosMultiUploadInput'),u=b('ProgressBar'),v=b('React'),w=b('Sticker.react'),x=b('Style'),y=b('URI'),z=b('UserAgent'),aa=b('cx'),ba=b('invariant'),ca=b('tx'),da=z.ie()<=8;function ea(ha,ia){var ja=g[ia].build().setNodeContent('filename',ha.name),ka=ja.getNode('link');ka.setAttribute('href',ha.url);ha.rel&&ka.setAttribute('rel',ha.rel);i.addClass(ja.getRoot(),n.getAttachIconClass(ha.icon_type));return ja;}function fa(ha,ia){var ja=g[ia].build().setNodeContent('filename',ha.name);i.addClass(ja.getRoot(),n.getAttachIconClass(ha.icon_type));return ja;}var ga={renderAttachment:function(ha,ia,ja,ka,la){var ma=100,na=ha?160:400,oa=null,pa=null,qa=j.MercurySupportedShareType;if(this.isErrorAttachment(ia))oa=ga.renderError(ia);if(this.isShareAttachment(ia)&&ia.share_xhp)if(ia.share_data_type===qa.FB_BROWSE_QUERY||!ha)pa=ga.renderShareXHP(ia,ja.id);if(this.isStickerAttachment(ia))pa=ga.renderSticker(ia,ja,ha);if(!pa&&this.isShareAttachment(ia)){var ra=ia.share_data_type;switch(ra){case qa.FB_PHOTO:pa=ga.renderPreview(ia,ja,ka,la);break;case qa.FB_VIDEO:pa=ga.renderVideoThumb(ia);break;case qa.FB_MUSIC_ALBUM:case qa.FB_SONG:case qa.FB_PLAYLIST:case qa.FB_MUSICIAN:case qa.FB_RADIO_STATION:pa=ga.renderMusic(ia);break;case qa.EXTERNAL:case qa.FB_TEMPLATE:case qa.FB_SOCIAL_REPORT_PHOTO:pa=ga.renderExternalLink(ia);break;case qa.FB_COUPON:case qa.FB_EVENT:pa=ga.renderChatXHP(ia);break;case qa.FB_SOCIAL_RESOLUTION:pa=ga.renderSocialResolution(ia);break;default:if(ia.name)pa=ga.renderShareLink(ia,ja&&ja.id,ha);break;}}if(!pa&&ia.preview_loading)pa=ga.renderPreview(null);if(!pa&&ia.preview_url)pa=ga.renderPreview(ia,ja,ka,la);if(!pa&&this.isFileAttachment(ia))if(ia.metadata&&ia.metadata.type==j.MercuryAttachmentAudioClip){pa=k.create('div');var sa=ga.renderAudioClip(ia,ja.message_id,ma,na);v.renderComponent(sa,pa);}else pa=ha?ga.renderFileLink(ia):ga.renderExtendedFileLink(ia);return {error:oa,content:pa,bubblePreferred:this.isBubblePreferred(ia)};},isBubblePreferred:function(ha){return !this.isStickerAttachment(ha);},renderError:function(ha){var ia=g[':fb:mercury:attachment:error'].build();k.appendContent(ia.getNode('error'),ha.error_msg);return ia.getRoot();},renderSocialResolution:function(ha){var ia=g[':fb:mercury:attachment:social-resolution'].build();ia.setNodeContent('post',ha.share_xhp);return ia.getRoot();},renderChatXHP:function(ha){var ia=g[':fb:mercury:attachment:social-resolution'].build();ia.setNodeContent('post',ha.chat_xhp);return ia.getRoot();},renderExternalLink:function(ha){var ia=g[':fb:mercury:attachment:external-link'].build().setNodeContent('name',ha.name);ha.base_url&&ia.setNodeContent('shortLink',ha.base_url);var ja=ia.getNode('preview'),ka=ia.getNode('image-link');ka.setAttribute('href',ha.url);ha.rel&&ka.setAttribute('rel',ha.rel);if(ha.preview_url){var la=ia.getNode('preview-image');la.setAttribute('src',ha.preview_url);i.addClass(ja,ha.preview_class);i.show(la);}else{i.addClass(ia.getRoot(),'noMedia');i.hide(ja);}ia.getNode('name').setAttribute('href',ha.url);d(['LinkshimHandler'],function(ma){ma.setUpLinkshimHandling(ia.getNode('name'));ma.setUpLinkshimHandling(ia.getNode('image-link'));});if(ha.rel)ia.getNode('name').setAttribute('rel',ha.rel);return ia.getRoot();},renderFileLink:function(ha){var ia=null;if(ha.url===''){ia=':fb:mercury:attachment:file-name';return fa(ha,ia).getRoot();}else{ia=':fb:mercury:attachment:file-link';return ea(ha,ia).getRoot();}},renderAudioClip:function(ha,ia,ja,ka){var la=ha.metadata.duration/1000,ma=200;if(ja&&ka)if(la<5){ma=ja;}else ma=(1-Math.pow(10,(la-5)/-30))*(ka-ja)+ja;return h({src:ha.url,duration:ha.metadata.duration/1000,showHelp:false,width:ma});},renderExtendedFileLink:function(ha){var ia=null;if(ha.url===''){ia=':fb:mercury:attachment:file-name';return fa(ha,ia).getRoot();}var ia=':fb:mercury:attachment:extended-file-link',ja=ea(ha,ia);if(ha.open_url){var ka=ja.getNode('openLinkContainer');i.show(ka);var la=ja.getNode('openFile');la.setAttribute('href',ha.open_url);}var ma=ja.getNode('downloadFile');ma.setAttribute('href',ha.url);ha.rel&&ma.setAttribute('rel',ha.rel);return ja.getRoot();},renderMusic:function(ha){var ia=g[':fb:mercury:attachment:music'].build().setNodeContent('filename',ha.name),ja=ia.getNode('link');ja.setAttribute('href',ha.url);ja.setAttribute('target','_blank');ha.rel&&ja.setAttribute('rel',ha.rel);var ka=ia.getNode('image-link');ka.setAttribute('href',ha.url);ha.rel&&ka.setAttribute('rel',ha.rel);var la=ia.getNode('preview-image');la.setAttribute('src',ha.preview_url);i.show(la);i.addClass(ia.getNode('icon_link'),'MercuryMusicIcon');return ia.getRoot();},resizeContain:function(ha,ia){var ja=ha.width/ha.height,ka=ia.width/ia.height;if(ka<ja){return {width:Math.min(ha.height*ka,ia.width),height:Math.min(ha.height,ia.height)};}else return {width:Math.min(ha.width,ia.width),height:Math.min(ha.width/ka,ia.height)};},renderPreview:function(ha,ia,ja,ka){var la=g[':fb:mercury:attachment:preview'].build(),ma=la.getNode('image-link');if(ha){if(ha.url){var na=new y(ha.url).getQueryData().uri;if(na&&ha.rel==='async'){ma.setAttribute('href',na);ma.setAttribute('ajaxify',ha.url);}else ma.setAttribute('href',ha.url);}ha.rel&&ma.setAttribute('rel',ha.rel);var oa;if(ha.preview_uploading){var pa=la.getNode('cancel-button-container');i.show(pa);var qa=la.getNode('cancel-button');ha.cancel_subscription=l.listen(qa,'click',function(){ha.upload_canceled(ha.upload_id);i.hide(la.getRoot());});ha.on_success(function(event,xa){if(xa.upload_id==ha.upload_id)i.hide(pa);});var ra=la.getNode('progress-bar'),sa=new u(ra),ta=la.getNode('progress-bar-container');ba(ha.upload_id);ha.on_progress(function(event,xa){if(xa.upload_id==ha.upload_id){i.show(ta);t.updateProgressBar(sa,xa.event);}});i.addClass(ma,"_57jm");if(ja>=176){oa='/images/photos/dots_large.png';}else if(ja>=86){oa='/images/photos/dots_medium.png';}else oa='/images/photos/dots_small.png';x.set(ma,'width',ja+'px');x.set(ma,'max-width',ja+'px');if(ha.preview_width&&ha.preview_height)x.set(ma,'padding-bottom',((ha.preview_height/ha.preview_width)*100)+'%');}else if(ha.metadata&&ha.metadata.fbid){oa=y('/ajax/mercury/attachments/photo.php').addQueryData({fbid:ha.metadata.fbid,request_user_id:ha.metadata.pageid,mode:ka,width:ja,height:ja}).toString();if(p.MessagesViewerReactGK){var ua=ma.getAttribute('ajaxify');ma.removeAttribute('ajaxify');ma.removeAttribute('rel');l.listen(ma,'click',function(event){s.bootstrapWithConfig({src:oa,endpoint:ua,fbid:ha.metadata.fbid,dimensions:ha.metadata.dimensions,disablePaging:ia.attachments.length==1},ma);event.prevent();});}}else oa=y(ha.preview_url).addQueryData({mode:ka,width:ja,height:ja}).toString();var va=la.getNode('preview-image');if(oa){if(ka==='contain'&&ha.preview_width&&ha.preview_height){var wa=ga.resizeContain({width:ja,height:ja},{width:ha.preview_width,height:ha.preview_height});va.setAttribute('width',wa.width);va.setAttribute('height',wa.height);}if(ha.preview_uploading||(ka==='cover'&&!da)){i.addClass(ma,"_55pj");x.set(ma,'backgroundImage','url('+oa+')');}else{va.onload=function(){va.removeAttribute('width');va.removeAttribute('height');};va.setAttribute('src',oa);}}if(ia)this.renderReportRespondLink(la.getRoot(),ha,ia.message_id);}else i.addClass(ma,"_ksa");return la.getRoot();},renderShareLink:function(ha,ia,ja){var ka=g[':fb:mercury:attachment:share-link'].build().setNodeContent('name',ha.name),la=ka.getNode('link');la.setAttribute('href',ha.url);ha.rel&&la.setAttribute('rel',ha.rel);return ka.getRoot();},renderVideoThumb:function(ha){var ia=g[':fb:mercury:attachment:video-thumb'].build(),ja=ia.getNode('thumb');ja.setAttribute('href',ha.url);ja.setAttribute('rel',ha.rel);var ka=k.find(ia.getRoot(),'img');ka.src=ha.preview_url;return ia.getRoot();},renderShareXHP:function(ha,ia){var ja=k.create('div');if(ha){k.appendContent(ja,ha.share_xhp);this.renderReportRespondLink(ja,ha,ia);}return ja;},renderSticker:function(ha,ia,ja){var ka=ja?'chatScrolled/':'messengerScrolled/';ka+=ia.thread_id;var la=k.create('div'),ma=w({animationTrigger:'click',className:'mvs',frameCount:ha.metadata.frameCount||1,frameRate:ha.metadata.frameRate||83,framesPerCol:ha.metadata.framesPerCol||1,framesPerRow:ha.metadata.framesPerRow||1,sourceHeight:ha.metadata.height,sourceURI:ha.url,sourceWidth:ha.metadata.width,spriteURI:ha.metadata.spriteURI,subscribedThreadID:ka});v.renderComponent(ma,la);return la;},renderReportRespondLink:function(ha,ia,ja){if(!ia.is_social_report_attachment)return null;switch(ia.share_data_type){case j.MercurySupportedShareType.FB_PHOTO:break;case j.MercurySupportedShareType.FB_SOCIAL_REPORT_PHOTO:return null;default:return null;}var ka=null;if(ja)ka=q.getMessagesFromIDs([ja])[0];if(!ka)return null;if(ka.author===r.user)return null;var la=null;r.get(ka.author,function(ma){la=k.create('a',{rel:'dialog-post',className:"_z6l",id:'respond-link',ajaxify:y('/ajax/report/social_resolution/post/').setQueryData({attachment_fbid:ia.attach_id,post_fbid:ia.shared_object_id,sender_id:r.getUserID(ma.id)}).toString()});k.setContent(la,ca._("Respond to {name}'s request",{name:ma.name}));k.appendContent(ha,la);});},renderPhotoAttachments:function(ha,ia,ja,ka){var la=ha.length;if(!la)return null;var ma=m.div({className:"_55pk"});if(la===1){var na=ga.renderPreview(ha[0],ia,ja,'contain');k.appendContent(ma,na);return ma;}var oa=(la==2||la==4)?2:3,pa=(ja-(oa-1)*ka)/oa,qa=Math.ceil(la/oa),ra=qa*pa+(qa-1)*ka,sa=(m.div({className:"_55pm",style:'padding-bottom: '+(ra/ja*100)+'%;'}));k.appendContent(ma,sa);for(var ta=0;ta<la;++ta){var ua=ga.renderPreview(ha[ta],ia,pa,'cover'),va=ta%oa,wa=Math.floor(ta/oa);i.addClass(ua,"_55pn");x.apply(ua,{width:(pa/ja*100)+'%',left:((va*(pa+ka))/ja*100)+'%',top:((wa*(pa+ka))/ra*100)+'%'});k.appendContent(sa,ua);}return ma;},isPhotoAttachment:function(ha){return ha.attach_type==o.PHOTO||(ha.attach_type==o.FILE&&ha.preview_url);},isShareAttachment:function(ha){return ha.attach_type==o.SHARE;},isFileAttachment:function(ha){return ha.attach_type==o.FILE;},isErrorAttachment:function(ha){return ha.attach_type==o.ERROR;},isStickerAttachment:function(ha){return ha.attach_type==o.STICKER;},booleanLexicographicComparator:function(ha){return function(ia,ja){for(var ka=0;ka<ha.length;++ka){var la=ha[ka](ia),ma=ha[ka](ja);if(la&&!ma){return -1;}else if(!la&&ma)return 1;}return 0;};}};e.exports=ga;});
__d("MercuryResizableMixin.react",["DOMDimensions","Event"],function(a,b,c,d,e,f){var g=b('DOMDimensions'),h=b('Event'),i={_prevDimensions:{width:0,height:0},triggerResizeGetDimensions:function(){if(this.isMounted()){return g.getElementDimensions(this.getDOMNode());}else return this._prevDimensions;},triggerResizeGetDimensionsChange:function(){var j=this.triggerResizeGetDimensions();return {heightChange:j.height-this._prevDimensions.height,widthChange:j.width-this._prevDimensions.width};},triggerResizeMaybe:function(){var j=this.triggerResizeGetDimensionsChange();if(j.heightChange!==0||j.widthChange!==0)this.triggerResize();},triggerResize:function(){var j=this.triggerResizeGetDimensions(),k=this.triggerResizeGetDimensionsChange();this.props&&this.props.onResize&&this.props.onResize(k);this.componentDidResize&&this.componentDidResize(k);this._prevDimensions=j;},componentDidUpdate:function(){this.triggerResizeMaybe();},componentDidMount:function(){this.triggerResizeMaybe();h.listen(this.getDOMNode(),'load',this.triggerResizeMaybe);}};e.exports=i;});
__d("ChatLogMessage.react",["React","ReactPropTypes","MercuryLogMessageType","MercuryParticipants","TooltipLink.react","MercuryResizableMixin.react","fbt","cx","copyProperties"],function(a,b,c,d,e,f){var g=b('React'),h=b('ReactPropTypes'),i=b('MercuryLogMessageType'),j=b('MercuryParticipants'),k=b('TooltipLink.react'),l=b('MercuryResizableMixin.react'),m=b('fbt'),n=b('cx'),o=b('copyProperties'),p=g.createClass({displayName:'ChatLogMessage',props:{message:h.object.isRequired},mixins:[l],getInitialState:function(){return {};},isYou:function(q){return q===j.user;},render:function(){var q=this.props.message,r=q.log_message_data,s=false;j.getMap({author:q.author,joined:r.joined_user,caller:r.caller,callee:r.callee,added:r.added_participants},function(u){if(u.added)for(var v=0;v<u.added.length;v++)if(v!==0&&this.isYou(u.added[v].id)){var w=u.added[0];u.added[0]=u.added[v];u.added[v]=w;}if(this.isMounted()){this.setState(u);}else o(this.state,u);s=true;}.bind(this));var t;if(s){t=this._messageRenderers[this.getType()].call(this);}else t=null;return this.transferPropsTo(g.DOM.div({className:"_5w0o"},t));},renderUserLink:function(q){return g.DOM.a({href:q.href,className:"_5w0p"},q.name);},renderMoreLink:function(q){return k({tooltip:this.renderMoreTooltip(q),alignH:"center",position:"above"},m._("{num} more",[m.param("num",q.length)]));},renderMoreTooltip:function(q){return g.DOM.div(null,q.map(function(r){return g.DOM.div(null,r.name);}));},getType:function(){var q=this.props.message,r=q.author,s=q.log_message_data,t=q.log_message_type,u=s.event_name,v=this.isYou(r)?'You':'Other',w=this.isYou(r)?'Outgoing':'Incoming',x=s.answered?'Answered':'Missed';if(t===i.JOINABLE_CREATED){return 'joinableCreated'+v;}else if(t===i.JOINABLE_JOINED){return 'joinableJoined'+v;}else if(t===i.SUBSCRIBE){if(this.isYou(r)){return 'subscribedByYou';}else if(this.isYou(s.added_participants[0])){return 'subscribedYou';}else return 'subscribedOther';}else if(t===i.UNSUBSCRIBE){return 'unsubscribed'+v;}else if(t===i.VIDEO_CALL){if(u==='installing'){return 'videoInstalling';}else if(u==='install_canceled'){return 'videoInstallCancelled';}else return 'videoCall'+w+x;}else if(t===i.PHONE_CALL){return 'phoneCall'+w+x;}else if(t===i.THREAD_NAME){var y=s.name?'Changed':'Cleared';return 'threadName'+y+v;}else if(t===i.THREAD_IMAGE){var z=s.image?'Changed':'Cleared';return 'threadImage'+z+v;}else if(t===i.SERVER_ERROR)return 'error';},_messageRenderers:{joinableCreatedYou:function(){return "Other people can join this chat from News Feed and add their friends.";},joinableCreatedOther:function(){var q=this.state.author;return m._("{actor} shared this chat to News Feed. Other people can join and add their friends.",[m.param("actor",this.renderUserLink(q))]);},joinableJoinedYou:function(){return "You joined the chat. Other people can join from News Feed and add their friends.";},joinableJoinedOther:function(){var q=this.state.author;return m._("{actor} joined the chat.",[m.param("actor",this.renderUserLink(q))]);},videoInstalling:function(){var q=this.state.author;return m._("{firstname} is setting up video calling...",[m.param("firstname",this.renderUserLink(q))]);},videoInstallCancelled:function(){return "You canceled the video calling installation.";},videoCallOutgoingAnswered:function(){var q=this.state.caller;return m._("You called {firstname}.",[m.param("firstname",this.renderUserLink(q))]);},videoCallOutgoingMissed:function(){var q=this.state.callee;return m._("{firstname} missed a call from you.",[m.param("firstname",this.renderUserLink(q))]);},videoCallIncomingAnswered:function(){var q=this.state.caller;return m._("{firstname} called you.",[m.param("firstname",this.renderUserLink(q))]);},videoCallIncomingMissed:function(){var q=this.state.caller;return m._("You missed a call from {firstname}.",[m.param("firstname",this.renderUserLink(q))]);},unsubscribedYou:function(){return "You left the conversation.";},unsubscribedOther:function(){var q=this.state.author;return m._("{actor} left the conversation.",[m.param("actor",this.renderUserLink(q))]);},error:function(){return "We were unable to fetch previous messages in this conversation.";},phoneCallOutgoingAnswered:function(){var q=this.state.callee;return m._("You called {firstname}.",[m.param("firstname",this.renderUserLink(q))]);},phoneCallOutgoingMissed:function(){var q=this.state.callee;return m._("{firstname} missed a call from you.",[m.param("firstname",this.renderUserLink(q))]);},phoneCallIncomingAnswered:function(){var q=this.state.caller;return m._("{firstname} called you.",[m.param("firstname",this.renderUserLink(q))]);},phoneCallIncomingMissed:function(){var q=this.state.caller;return m._("You missed a call from {firstname}.",[m.param("firstname",this.renderUserLink(q))]);},threadImageChangedYou:function(){return "You changed the conversation picture.";},threadImageClearedYou:function(){return "You removed the conversation picture.";},threadImageChangedOther:function(){var q=this.state.author;return m._("{actor} changed the conversation picture.",[m.param("actor",this.renderUserLink(q))]);},threadImageClearedOther:function(){var q=this.state.author;return m._("{actor} removed the conversation picture.",[m.param("actor",this.renderUserLink(q))]);},threadNameChangedYou:function(){var q=this.props.message,r=q.log_message_data.name;return m._("You named the conversation: {name}.",[m.param("name",g.DOM.b(null,r))]);},threadNameClearedYou:function(){return "You removed the conversation name.";},threadNameChangedOther:function(){var q=this.state.author,r=this.props.message,s=r.log_message_data.name;return m._("{actor} named the conversation: {name}.",[m.param("actor",this.renderUserLink(q)),m.param("name",g.DOM.b(null,s))]);},threadNameClearedOther:function(){var q=this.state.author;return m._("{actor} removed the conversation name.",[m.param("actor",this.renderUserLink(q))]);},subscribedByYou:function(){var q=this.state.added;if(q.length===1){return m._("You added {subscriber1}.",[m.param("subscriber1",this.renderUserLink(q[0]))]);}else if(q.length===2){return m._("You added {subscriber1} and {subscriber2}.",[m.param("subscriber1",this.renderUserLink(q[0])),m.param("subscriber2",this.renderUserLink(q[1]))]);}else if(q.length===3){return m._("You added {subscriber1}, {subscriber2} and {subscriber3}.",[m.param("subscriber1",this.renderUserLink(q[0])),m.param("subscriber2",this.renderUserLink(q[1])),m.param("subscriber3",this.renderUserLink(q[2]))]);}else return m._("You added {subscriber1}, {subscriber2} and {more_people}.",[m.param("subscriber1",this.renderUserLink(q[0])),m.param("subscriber2",this.renderUserLink(q[1])),m.param("more_people",this.renderMoreLink(q.slice(2)))]);},subscribedYou:function(){var q=this.state.added,r=this.state.author;if(q.length===1){return m._("{actor} added you.",[m.param("actor",this.renderUserLink(r))]);}else if(q.length===2){return m._("{actor} added you and {subscriber2}.",[m.param("actor",this.renderUserLink(r)),m.param("subscriber2",this.renderUserLink(q[1]))]);}else if(q.length===3){return m._("{actor} added you, {subscriber2} and {subscriber3}.",[m.param("actor",this.renderUserLink(r)),m.param("subscriber2",this.renderUserLink(q[1])),m.param("subscriber3",this.renderUserLink(q[2]))]);}else return m._("{actor} added you, {subscriber2} and {more_people}.",[m.param("actor",this.renderUserLink(r)),m.param("subscriber2",this.renderUserLink(q[1])),m.param("more_people",this.renderMoreLink(q.slice(2)))]);},subscribedOther:function(){var q=this.state.added,r=this.state.author;if(q.length===1){return m._("{actor} added {subscriber1}.",[m.param("actor",this.renderUserLink(r)),m.param("subscriber1",this.renderUserLink(q[0]))]);}else if(q.length===2){return m._("{actor} added {subscriber1} and {subscriber2}",[m.param("actor",this.renderUserLink(r)),m.param("subscriber1",this.renderUserLink(q[0])),m.param("subscriber2",this.renderUserLink(q[1]))]);}else if(q.length===3){return m._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",[m.param("actor",this.renderUserLink(r)),m.param("subscriber1",this.renderUserLink(q[0])),m.param("subscriber2",this.renderUserLink(q[1])),m.param("subscriber3",this.renderUserLink(q[2]))]);}else return m._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",[m.param("actor",this.renderUserLink(r)),m.param("subscriber1",this.renderUserLink(q[0])),m.param("subscriber2",this.renderUserLink(q[1])),m.param("more_people",this.renderMoreLink(q.slice(2)))]);}}});e.exports=p;});
__d("MercuryShrinkwrapableMixin.react",["DOMDimensions","Style"],function(a,b,c,d,e,f){var g=b('DOMDimensions'),h=b('Style');function i(j){return {_shrinkwrap:function(){if(!this.isMounted())return;var k=this.getDOMNode(),l=-1;for(var m=0;m<k.childNodes.length;m++){var n=k.childNodes[m];l=Math.max(l,this._shrinkwrapChildWidth(n));}if(l!==-1){h.set(k,'width','');var o=g.getElementDimensions(k).width,p=Math.min(o,l);h.set(k,'width',''+p+'px');}},componentDidUpdate:function(){this._shrinkwrap();},componentDidMount:function(){this._shrinkwrap();},_shrinkwrapChildWidth:function(k){var l=g.getElementDimensions(k).width,m;if(j&&j.boxWidth!==undefined){m=j.boxWidth;}else m=g.measureElementBox(k,'width',true,true,true);return l+m;}};}e.exports=i;});
__d("ChatBubble.react",["cx","MercuryShrinkwrapableMixin.react","React","ReactPropTypes"],function(a,b,c,d,e,f){var g=b('cx'),h=b('MercuryShrinkwrapableMixin.react'),i=b('React'),j=b('ReactPropTypes'),k=i.createClass({displayName:'ChatBubble',propTypes:{direction:j.oneOf(['left','right']).isRequired,color:j.oneOf(['white','blue']).isRequired},mixins:[h({boxWidth:0})],_directionClassName:{left:"_5w1n",right:"_5w1o"},_colorClassName:{blue:"_5w1p",white:"_5w1q"},render:function(){var l=["_5w1r",this._colorClassName[this.props.color],this._directionClassName[this.props.direction]].join(' ');return this.transferPropsTo(i.DOM.div({className:l},this.props.children));}});e.exports=k;});
__d("MercuryMessageAttachments.react",["MercuryAttachmentRenderer","DOM","MercuryResizableMixin.react","React","ReactPropTypes","cx"],function(a,b,c,d,e,f){var g=b('MercuryAttachmentRenderer'),h=b('DOM'),i=b('MercuryResizableMixin.react'),j=b('React'),k=b('ReactPropTypes'),l=b('cx'),m=j.createClass({displayName:'MercuryMessageAttachments',propTypes:{message:k.object.isRequired,attachments:k.array.isRequired},mixins:[i],render:function(){return this.transferPropsTo(j.DOM.div({className:"_5h9y"},j.DOM.div({className:"_55pl",ref:"content"})));},componentDidMount:function(){this._render();},_render:function(){var n=this.refs.content.getDOMNode(),o=this.props.message,p=this.props.attachments;p.sort(g.booleanLexicographicComparator([g.isPhotoAttachment,g.isShareAttachment,g.isFileAttachment,g.isErrorAttachment]));var q=g.renderPhotoAttachments(p.filter(g.isPhotoAttachment),o,176,4);if(q)h.appendContent(n,q);for(var r=0;r<p.length;r++){var s=p[r];if(!g.isPhotoAttachment(s)){var t=g.renderAttachment(true,s,o);t.error&&h.appendContent(n,t.error);t.content&&h.appendContent(n,t.content);}}this.triggerResizeMaybe();}});e.exports=m;});
__d("DOMHyperlink",["Env","JSXDOM","TransformTextToDOMMixin","UntrustedLink","URI","URLScraper","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('Env'),h=b('JSXDOM'),i=b('TransformTextToDOMMixin'),j=b('UntrustedLink'),k=b('URI'),l=b('URLScraper'),m=b('copyProperties'),n=b('cx'),o={MAX_ITEMS:40,match:function(p,q){var r=l.match(p);if(!r)return false;var s=p.indexOf(r),t=s+r.length;return {startIndex:s,endIndex:t,element:this._element(r,q)};},_element:function(p,q){var r=p,s=r.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(p)))s='http://'+s;if(!k.isValidURI(s))return r;var t=h.a({className:"_553k",href:s,target:"_blank",rel:"nofollow"},r);if(q&&!k(s).isFacebookURI())t.onmousedown=function(u){j.bootstrap(this,g.lhsh,u);};return t;}};e.exports=m(o,i);});
__d("MercuryMessageRenderer",["MercuryAttachmentRenderer","CSS","DOM","DOMEmoji","DOMEmote","DOMHyperlink","DOMQuery","FBIDEmote","JSXDOM","MercuryLogMessageType","MercuryParticipants","Tooltip","cx","transformTextToDOM","tx"],function(a,b,c,d,e,f){var g=b('MercuryAttachmentRenderer'),h=b('CSS'),i=b('DOM'),j=b('DOMEmoji'),k=b('DOMEmote'),l=b('DOMHyperlink'),m=b('DOMQuery'),n=b('FBIDEmote'),o=b('JSXDOM'),p=b('MercuryLogMessageType'),q=b('MercuryParticipants'),r=b('Tooltip'),s=b('cx'),t=b('transformTextToDOM'),u=b('tx'),v={renderTooltipFlyout:function(oa,pa){pa.forEach(function(qa){var ra=i.create('div');i.setContent(ra,qa.name);i.appendContent(oa,ra);});},renderLogMessage:function(oa,pa,qa,ra){y(oa,ra);z(pa,ra);aa(qa,ra);},formatMessageBody:function(oa,pa,qa){var ra=(oa||'').replace(/\s+$/,'');if(!pa)return x(ra,false,qa);var sa=Object.keys(pa).map(function(va){return window.parseInt(va);}).sort(function(va,wa){return va-wa;}),ta=[],ua=0;sa.forEach(function(va){var wa=ra.slice(ua,va);if(wa)ta.push(x(wa,false,qa));ua=va+pa[va].length;var xa=ra.slice(va,ua);if(xa)ta.push(x(xa,true,qa));});if(ua<ra.length)ta.push(x(ra.slice(ua),false,qa));return ta.length===0?null:ta.length===1?ta[0]:i.create('span',{},ta);}};function w(oa,pa){var qa=oa.replace(/\r\n?/g,'\n').split(/\n{2,}/);return qa.filter(function(ra){return ra.length;}).map(function(ra){return o.p(null,pa(ra));});}function x(oa,pa,qa){if(oa.length===0&&!pa)return null;var ra=function(sa){return t(sa,[l.params(true),j,n,k]);};return (o.span({className:pa?'highlight':null},qa?w(oa,ra):ra(oa)));}function y(oa,pa){var qa='',ra;switch(pa.log_message_type){case p.JOINABLE_CREATED:case p.JOINABLE_JOINED:case p.SUBSCRIBE:qa='mercurySubscribeIcon';break;case p.UNSUBSCRIBE:qa='mercuryUnsubscribeIcon';break;case p.THREAD_NAME:qa='mercuryThreadNameIcon';break;case p.THREAD_IMAGE:qa='mercuryThreadImageIcon';break;case p.VIDEO_CALL:ra=pa.log_message_data.answered;if(ra||na(pa)){qa='mercuryVideoCallIcon';}else qa='mercuryMissedVideoCallIcon';break;case p.PHONE_CALL:ra=pa.log_message_data.answered;if(ra){qa='mercuryPhoneCallIcon';}else qa='mercuryMissedPhoneCallIcon';break;case p.SERVER_ERROR:qa='mercuryErrorIcon';break;}h.addClass(oa,qa);}function z(oa,pa){switch(pa.log_message_type){case p.JOINABLE_CREATED:fa(oa,pa);break;case p.JOINABLE_JOINED:ga(oa,pa);break;case p.SUBSCRIBE:ka(oa,pa);break;case p.UNSUBSCRIBE:la(oa,pa);break;case p.VIDEO_CALL:if(na(pa)){ba(oa,pa);}else da(oa,pa);break;case p.PHONE_CALL:ca(oa,pa);break;case p.THREAD_NAME:ea(oa,pa);break;case p.THREAD_IMAGE:ha(oa,pa);break;case p.SERVER_ERROR:ma(oa,pa);break;}}function aa(oa,pa){var qa=pa.log_message_type;if(qa==p.THREAD_IMAGE){var ra=pa.log_message_data.image;if(ra){var sa=g.renderPreview(ra.preview_url?ra:null);i.setContent(oa,sa);h.addClass(sa,"_z6a");h.show(oa);}}}var ba=function(oa,pa){q.get(pa.author,function(qa){var ra=i.create('span',{className:"_511e"},qa.short_name),sa;switch(pa.log_message_data.event_name){case 'installing':sa=i.tx._("{firstname} is setting up video calling...",{firstname:ra});break;case 'installed':sa=i.tx._("{firstname} finished setting up video calling.",{firstname:ra});break;case 'install_canceled':sa=i.tx._("You canceled the video calling installation. ",{firstname:ra});break;}if(sa)i.setContent(oa,sa);});},ca=function(oa,pa){var qa=pa.log_message_data.caller,ra=pa.log_message_data.callee,sa=[qa,ra];q.getMulti(sa,function(ta){if(qa==q.user){var ua=i.create('span',{className:"_511e"},ta[ra].short_name),va;if(pa.log_message_data.answered){va=i.tx._("You called {firstname}.",{firstname:ua});}else va=i.tx._("{firstname} missed a call from you. ",{firstname:ua});}else{var wa=i.create('span',{className:"_511e"},ta[qa].short_name);if(pa.log_message_data.answered){va=i.tx._("{firstname} called you.",{firstname:wa});}else va=i.tx._("You missed a call from {firstname}. ",{firstname:wa});}i.setContent(oa,va);});},da=function(oa,pa){var qa=pa.log_message_data.caller,ra=pa.log_message_data.callee,sa=[qa,ra];q.getMulti(sa,function(ta){if(qa==q.user){var ua=i.create('span',{className:"_511e"},ta[ra].short_name),va;if(pa.log_message_data.answered){va=i.tx._("You called {firstname}.",{firstname:ua});}else va=i.tx._("{firstname} missed a call from you. ",{firstname:ua});}else{var wa=i.create('span',{className:"_511e"},ta[qa].short_name);if(pa.log_message_data.answered){va=i.tx._("{firstname} called you.",{firstname:wa});}else va=i.tx._("You missed a call from {firstname}. ",{firstname:wa});}i.setContent(oa,va);});},ea=function(oa,pa){var qa=pa.log_message_data.name,ra=i.create('b',{},qa);if(pa.author==q.user){if(qa){i.setContent(oa,i.tx._("You named the conversation: {name}.",{name:ra}));}else i.setContent(oa,i.tx._("You removed the conversation name."));}else q.get(pa.author,function(sa){var ta,ua=ia(sa);if(qa){ta=i.tx._("{actor} named the conversation: {name}.",{actor:ua,name:ra});}else ta=i.tx._("{actor} removed the conversation name.",{actor:ua});i.setContent(oa,ta);});},fa=function(oa,pa){if(pa.author==q.user){i.setContent(oa,i.tx._("Other people can join this chat from News Feed and add their friends."));}else q.get(pa.author,function(qa){var ra=ia(qa);i.setContent(oa,i.tx._("{actor} shared this chat to News Feed. Other people can join and add their friends.",{actor:ra}));});},ga=function(oa,pa){var qa=pa.log_message_data.joined_participant;if(qa==q.user){i.setContent(oa,i.tx._("You joined the chat. Other people can join from News Feed and add their friends."));}else q.get(qa,function(ra){var sa=ia(ra);i.setContent(oa,i.tx._("{actor} joined the chat.",{actor:sa}));});},ha=function(oa,pa){if(pa.author==q.user){if(pa.log_message_data.image){i.setContent(oa,i.tx._("You changed the conversation picture."));}else i.setContent(oa,i.tx._("You removed the conversation picture."));}else q.get(pa.author,function(qa){var ra=ia(qa),sa;if(pa.log_message_data.image){sa=i.tx._("{actor} changed the conversation picture.",{actor:ra});}else sa=i.tx._("{actor} removed the conversation picture.",{actor:ra});i.setContent(oa,sa);});},ia=function(oa){if(oa.href)return i.create('a',{href:oa.href,className:"_511e"},oa.name);return oa.name;},ja=function(oa){var pa=oa.indexOf(q.user);if(pa>0)return oa.splice(pa,1).concat(oa);return oa;},ka=function(oa,pa){var qa=ja(pa.log_message_data.added_participants),ra=null,sa;if(qa.length==1){ra=[pa.author,qa[0]];q.getMulti(ra,function(ta){if(pa.author==q.user){sa=i.tx._("You added {subscriber1}.",{subscriber1:ia(ta[qa[0]])});}else if(qa[0]==q.user){sa=i.tx._("{actor} added you.",{actor:ia(ta[pa.author])});}else sa=i.tx._("{actor} added {subscriber1}.",{actor:ia(ta[pa.author]),subscriber1:ia(ta[qa[0]])});i.setContent(oa,sa);});}else if(qa.length==2){ra=[pa.author].concat(qa);q.getMulti(ra,function(ta){if(pa.author==q.user){sa=i.tx._("You added {subscriber1} and {subscriber2}.",{subscriber1:ia(ta[qa[0]]),subscriber2:ia(ta[qa[1]])});}else if(qa[0]==q.user){sa=i.tx._("{actor} added you and {subscriber2}.",{actor:ia(ta[pa.author]),subscriber2:ia(ta[qa[1]])});}else sa=i.tx._("{actor} added {subscriber1} and {subscriber2}.",{actor:ia(ta[pa.author]),subscriber1:ia(ta[qa[0]]),subscriber2:ia(ta[qa[1]])});i.setContent(oa,sa);});}else if(qa.length==3){ra=[pa.author].concat(qa);q.getMulti(ra,function(ta){if(pa.author==q.user){sa=i.tx._("You added {subscriber1}, {subscriber2} and {subscriber3}.",{subscriber1:ia(ta[qa[0]]),subscriber2:ia(ta[qa[1]]),subscriber3:ia(ta[qa[2]])});}else if(qa[0]==q.user){sa=i.tx._("{actor} added you, {subscriber2} and {subscriber3}.",{actor:ia(ta[pa.author]),subscriber2:ia(ta[qa[1]]),subscriber3:ia(ta[qa[2]])});}else sa=i.tx._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",{actor:ia(ta[pa.author]),subscriber1:ia(ta[qa[0]]),subscriber2:ia(ta[qa[1]]),subscriber3:ia(ta[qa[2]])});i.setContent(oa,sa);});}else{ra=[pa.author].concat(qa);q.getMulti(ra,function(ta){var ua=i.tx._("{num} more",{num:qa.length-2}),va=i.create('span',{className:'more'},ua),wa=i.create('div');v.renderTooltipFlyout(wa,qa.slice(2).map(function(ya){return ta[ya];}));if(pa.author==q.user){sa=i.tx._("You added {subscriber1}, {subscriber2} and {more_people}.",{subscriber1:ia(ta[qa[0]]),subscriber2:ia(ta[qa[1]]),more_people:va});}else if(qa[0]==q.user){sa=i.tx._("{actor} added you, {subscriber2} and {more_people}.",{actor:ia(ta[pa.author]),subscriber2:ia(ta[qa[1]]),more_people:va});}else sa=i.tx._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",{actor:ia(ta[pa.author]),subscriber1:ia(ta[qa[0]]),subscriber2:ia(ta[qa[1]]),more_people:va});i.setContent(oa,sa);var xa=m.find(oa,'span.more');r.set(xa,wa,'above','center');});}},la=function(oa,pa){q.get(pa.author,function(qa){var ra;if(pa.author==q.user){ra=i.tx._("You left the conversation.");}else ra=i.tx._("{actor} left the conversation.",{actor:ia(qa)});i.setContent(oa,ra);});},ma=function(oa,pa){var qa="We were unable to fetch previous messages in this conversation.";i.setContent(oa,qa);},na=function(oa){return oa.log_message_data.event_name==='installing'||oa.log_message_data.event_name==='install_canceled';};e.exports=v;});
__d("MercuryMessageBody.react",["React","ReactPropTypes","DOM","MercuryMessageRenderer","DOMDimensions"],function(a,b,c,d,e,f){var g=b('React'),h=b('ReactPropTypes'),i=b('DOM'),j=b('MercuryMessageRenderer'),k=b('DOMDimensions'),l=g.createClass({displayName:'MercuryMessageBody',propTypes:{children:h.string},render:function(){return this.transferPropsTo(g.DOM.span(null));},isShort:function(){var m=this.getDOMNode(),n=m.getClientRects(),o=k.getElementDimensions(m).height;return !(n&&n.length>1&&n[0].height<o);},componentDidMount:function(){var m=this.props.children||'',n=j.formatMessageBody(m);i.appendContent(this.getDOMNode(),n);}});e.exports=l;});
__d("MercuryMessageStatus.react",["arrayContains","cx","fbt","formatDate","getObjectValues","MercuryActionStatus","MercuryErrorInfo","MercuryIDs","MercuryMessages","MercuryMessageSourceTags","MercuryParticipants","MercuryThreads","React","ReactPropTypes","TooltipLink.react"],function(a,b,c,d,e,f){var g=b('arrayContains'),h=b('cx'),i=b('fbt'),j=b('formatDate'),k=b('getObjectValues'),l=b('MercuryActionStatus'),m=b('MercuryErrorInfo'),n=b('MercuryIDs'),o=b('MercuryMessages').get(),p=b('MercuryMessageSourceTags'),q=b('MercuryParticipants'),r=b('MercuryThreads').get(),s=b('React'),t=b('ReactPropTypes'),u=b('TooltipLink.react'),v=s.createClass({displayName:'MercuryMessageStatus',propTypes:{message:t.object.isRequired,showSentFrom:t.bool,seen:t.object},getInitialState:function(){return {seenUsers:[]};},componentWillMount:function(){this.seenUsersUpdate();},componentWillReceiveProps:function(){this.seenUsersUpdate();},seenUsersUpdate:function(){if(this.props.seen){var w=Object.keys(this.props.seen);q.getMulti(w,function(x){x=k(x);this.setState({seenUsers:x});}.bind(this));}},render:function(){var w=this._typeRenderer[this.getType()],x="_5frt"+' '+w.className,y=this.props.message,z=y.error_data;return this.transferPropsTo(s.DOM.div({className:x,tabIndex:m.isTransient(z)?0:null,onClick:m.isTransient(z)?this.messageResend:null},s.DOM.div({className:"_5ihg"}),s.DOM.span(null,w.text.call(this))));},getType:function(){var w=this.props.message,x=w.status,y=o.isInbound(w),z=n.isMultichat(w.thread_id),aa=this.props.showSentFrom;if(x===l.RESENDING){return 'resending';}else if(x===l.FAILED_UNKNOWN_REASON||x===l.UNABLE_TO_CONFIRM||x===l.ERROR){var ba=w.error_data,ca=m.isTransient(ba)?'Transient':'Permanent',da=m.isConnectionError(ba),ea=da?'Connection':'Generic';return 'error'+ea+ca;}else if(aa&&!z&&y){var fa=w.source_tags;if(w.location_text){return 'sentFromLocation';}else if(g(fa,p.MESSENGER)){return 'sentFromOrca';}else if(g(fa,p.MOBILE)){return 'sentFromMobile';}else if(g(fa,p.EMAIL)){return 'sentFromEmail';}else return 'none';}else if(!y&&this.state&&this.state.seenUsers.length){if(z){return 'seenBy';}else return 'seenAt';}else return 'none';},messageResend:function(){o.resendMessage(this.props.message);},_typeRenderer:{className:"_5fry",resending:{text:function(){return "Sending...";}},errorConnectionPermanent:{className:"_5fru _5frz _5ihh",text:function(){return "Unable to connect to Facebook. This message failed to send.";}},errorConnectionTransient:{className:"_5fru _5frz _5ihi",text:function(){return i._("{message} Check your network connection or click to try again.",[i.param("message",this._typeRenderer.errorConnectionPermanent.text.call(this))]);}},errorGenericPermanent:{className:"_5fru _5fr- _5ihh",text:function(){var w=this.props.message;if(w.error_data&&w.error_data.description){return w.error_data.description;}else return "This message failed to send.";}},errorGenericTransient:{className:"_5fru _5fr- _5ihi",text:function(){return i._("{message} Click to send again.",[i.param("message",this._typeRenderer.errorGenericPermanent.text.call(this))]);}},seenBy:{className:"_5ihj _5ihk",text:function(){var w=this.props.message,x=r.getThreadMetaNow(w.thread_id),y=x?x.participants.length:[],z=this.state.seenUsers;if(z.length===y.length){return "Seen by everyone";}else if(z.length===1){return i._("Seen by {user}",[i.param("user",z[0].short_name)]);}else if(z.length===2){return i._("Seen by {user1}, {user2}",[i.param("user1",z[0].short_name),i.param("user2",z[1].short_name)]);}else if(z.length===3){return i._("Seen by {user1}, {user2}, {user3},",[i.param("user1",z[0].short_name),i.param("user2",z[1].short_name),i.param("user3",z[2].short_name)]);}else{var aa=s.DOM.div(null,z.slice(2).map(function(ba){return s.DOM.div(null,ba.short_name);}));return i._("Seen by {user1}, {user2}, {more link}",[i.param("user1",z[0].short_name),i.param("user2",z[1].short_name),i.param("more link",u({tooltip:aa},i._("{num} more",[i.param("num",z.length-2)])))]);}}},seenAt:{className:"_5ihj _5ihl",text:function(){var w=this.props.seen[Object.keys(this.props.seen)[0]],x=j(w,{withinDay:'g:ia',withinWeek:'D g:ia',older:'M j'});return i._("Seen {timestamp}",[i.param("timestamp",x)]);}},sentFromLocation:{className:"_5ihm _5ihn",text:function(){var w=this.props.message;return i._("Sent from {location}",[i.param("location",w.location_text)]);}},sentFromMobile:{className:"_5ihm _5ihn",text:function(){return s.DOM.a({href:"/mobile",className:"fcg",target:"_blank"},"Sent from Mobile");}},sentFromOrca:{className:"_5ihm _5ihn",text:function(){return s.DOM.a({href:"/mobile/messenger",className:"fcg",target:"_blank"},"Sent from Messenger");}},sentFromEmail:{className:"_5ihm _5ihn _5iho",text:function(){return "Sent from email";}},none:{className:"_5frx",text:function(){}}}});e.exports=v;});
__d("JoinableConversationMessageFilter",["MercuryLogMessageType","MercuryThreads","MercuryParticipants"],function(a,b,c,d,e,f){var g=b('MercuryLogMessageType'),h=b('MercuryThreads').get(),i=b('MercuryParticipants'),j={_isFilterable:function(k){var l=k.log_message_type;if(!l)return false;if(l==g.JOINABLE_JOINED)return k.log_message_data.joined_participant!==i.user;if(l==g.UNSUBSCRIBE||l==g.SUBSCRIBE){var m=h.getThreadMetaNow(k.thread_id);if(m&&m.is_joinable)return k.author!==i.user;return false;}return false;},filterMessages:function(k,l,m){var n=[];for(var o=0;o<l.length;o++){var p=l[o];if(j._isFilterable(p)){if(m)k(p);}else n.push(p);}return n;}};e.exports=j;});
__d("MercuryRoger",["ArbiterMixin","MercuryActionStatus","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('MercuryActionStatus'),i=b('MercuryServerRequests').get(),j=b('copyProperties'),k={},l={getSeenBy:function(m,n){if(!m)return [];var o=[],p=k[m.thread_id],q=h.SUCCESS;for(var r in p)if(p[r]>m.timestamp&&(m.status===undefined||m.status===q)&&(!n||r!=m.author))o.push(r);return o;},getSeenTimestamp:function(m,n){var o=k[m];return o?o[n]:null;}};j(l,g);i.subscribe('update-roger',function(m,n){for(var o in n){if(!k[o])k[o]={};for(var p in n[o]){var q=k[o][p],r=n[o][p];if(!q||r>q)k[o][p]=r;}}if(n)l.inform('state-changed',n);});e.exports=l;});
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","MercuryMessages","MercuryRoger","MercuryThreadInformer","MercuryThreads","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('LiveTimer'),i=b('MercuryActionStatus'),j=b('MercuryConfig'),k=b('MercuryMessages').get(),l=b('MercuryRoger'),m=b('MercuryThreadInformer').get(),n=b('MercuryThreads').get(),o=b('copyProperties'),p=b('setTimeoutAcrossTransitions'),q={},r={},s=j['roger.seen_delay'],t=o({getSeenBy:function(x,y){if(r[x])return [];if(!q[x]){var z=n.getThreadMetaNow(x);if(z)q[x]={thread_id:x,author:z.participants[0],timestamp:z.timestamp};}return l.getSeenBy(q[x],y);}},g);function u(x){var y=false;k.getThreadMessagesRange(x,0,1,function(z){var aa=z[0];if(!aa)return;var ba=aa.timestamp;if(aa.action_id||aa.status==i.SUCCESS)ba-=h.getServerTimeOffset();var ca=t.getSeenBy(x);if(r[x]){clearTimeout(r[x]);delete r[x];}var da=ba+s,ea=da-Date.now();if(ea>0)r[x]=p(function(){delete r[x];v(x);},ea);q[x]=aa;var fa=t.getSeenBy(x);if(ca.length||fa.length)y=true;});return y;}function v(x){var y={};y[x]=true;t.inform('state-changed',y);}function w(event,x){var y={};for(var z in x)if(u(z))y[z]=true;for(var aa in y){t.inform('state-changed',y);break;}}l.subscribe('state-changed',function(x,y){for(var z in y)!r[z]&&v(z);});m.subscribe('messages-received',w);m.subscribe('messages-reordered',w);m.subscribe('messages-updated',w);e.exports=t;});
__d("EventValidator",["copyProperties"],function(a,b,c,d,e,f){'use strict';var g=b('copyProperties'),h={addValidation:function(k,l){var m=Object.keys(l),n=Object.create(k);g(n,{emit:function o(p,q,r,s,t,u,v){i(p,m);return k.emit.call(this,p,q,r,s,t,u,v);}});return n;}};function i(k,l){if(l.indexOf(k)===-1)throw new TypeError(j(k,l));}function j(k,l){var m='Unknown event type "'+k+'". ';m+='Known event types: '+l.join(', ')+'.';return m;}e.exports=h;});
__d("mixInEventEmitter",["EventEmitter","EventEmitterWithHolding","EventHolder","EventValidator","copyProperties","invariant","keyOf"],function(a,b,c,d,e,f){var g=b('EventEmitter'),h=b('EventEmitterWithHolding'),i=b('EventHolder'),j=b('EventValidator'),k=b('copyProperties'),l=b('invariant'),m=b('keyOf'),n=m({__types:true});function o(q,r){l(r);l(!this.__eventEmitter);var s=q.prototype||q,t=q.constructor;if(t)l(t===Object||t===Function);if(s.hasOwnProperty(n)){k(s.__types,r);}else if(s.__types){s.__types=k({},s.__types,r);}else s.__types=r;k(s,p);}var p={emit:function(q,r,s,t,u,v,w){return this.__getEventEmitter().emit(q,r,s,t,u,v,w);},emitAndHold:function(q,r,s,t,u,v,w){return this.__getEventEmitter().emitAndHold(q,r,s,t,u,v,w);},addListener:function(q,r,s){return this.__getEventEmitter().addListener(q,r,s);},once:function(q,r,s){return this.__getEventEmitter().once(q,r,s);},addRetroactiveListener:function(q,r,s){return this.__getEventEmitter().addRetroactiveListener(q,r,s);},addListenerMap:function(q,r){return this.__getEventEmitter().addListenerMap(q,r);},addRetroactiveListenerMap:function(q,r){return this.__getEventEmitter().addListenerMap(q,r);},removeAllListeners:function(){this.__getEventEmitter().removeAllListeners();},removeCurrentListener:function(){this.__getEventEmitter().removeCurrentListener();},releaseHeldEventType:function(q){this.__getEventEmitter().releaseHeldEventType(q);},__getEventEmitter:function(){if(!this.__eventEmitter){var q=new g();q=j.addValidation(q,this.__types);var r=new i();this.__eventEmitter=new h(q,r);}return this.__eventEmitter;}};e.exports=o;});
__d("MercuryTypingReceiver",["Arbiter","ChannelConstants","MercuryActionTypeConstants","MercuryParticipants","MercuryPayloadSource","MercuryServerRequests","MercuryThreads","TypingDetector","mixInEventEmitter","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('MercuryActionTypeConstants'),j=b('MercuryParticipants'),k=b('MercuryPayloadSource'),l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get(),n=b('TypingDetector'),o=b('mixInEventEmitter'),p=b('setTimeoutAcrossTransitions'),q,r={},s=30000,t={};o(t,{'state-changed':true});function u(aa){var ba=r[aa]||{},ca=Object.keys(ba);ca.sort(function(da,ea){return ba[da]-ba[ea];});return ca;}function v(){q=null;var aa=Date.now(),ba={},ca=false;for(var da in r){var ea=false;for(var fa in r[da]||{})if(r[da][fa]<aa-s){delete r[da][fa];ea=true;}else ca=true;if(ea)ba[da]=u(da);}for(var ga in ba){x(ba);break;}if(ca)q=p(v,3000);}function w(aa,ba){if(aa in r)if(ba in r[aa]){delete r[aa][ba];y(aa);}}function x(aa){t.releaseHeldEventType('state-changed');t.emitAndHold('state-changed',aa);}function y(aa){var ba={};ba[aa]=u(aa);x(ba);}function z(aa){if(aa.thread)return l.getClientThreadIDNow(aa.thread);if(aa.type==='typ')return m.getThreadIdForUser(aa.from);return null;}g.subscribe([h.getArbiterType('typ'),h.getArbiterType('ttyp')],function(aa,ba){var ca=ba.obj,da=z(ca);if(da){var ea=j.getIDForUser(ca.from);if(ca.st==n.TYPING){r[da]=r[da]||{};var fa=r[da][ea];r[da][ea]=Date.now();if(!q)q=p(v,3000);!fa&&y(da);}else if(ca.st==n.INACTIVE)w(da,ea);}});l.subscribe('update-typing-state',function(aa,ba){var ca=ba.payload_source;if(ca!=k.CLIENT_CHANNEL_MESSAGE)return;var da=ba.actions;if(!da||!da.length)return;var ea=i.USER_GENERATED_MESSAGE;da.forEach(function(fa){if(fa.action_type==ea&&fa.author!=j.user)w(fa.thread_id,fa.author);});});e.exports=t;});
__d("MercuryIndicatorController",["ArbiterMixin","DOM","MercuryActionTypeConstants","MercuryConfig","MercuryDelayedRoger","MercuryMessageSourceTags","MercuryParticipants","MercuryRoger","MercuryThreads","MercuryTypingReceiver","arrayContains","copyProperties","formatDate","removeFromArray","tx"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('DOM'),i=b('MercuryActionTypeConstants'),j=b('MercuryConfig'),k=b('MercuryDelayedRoger'),l=b('MercuryMessageSourceTags'),m=b('MercuryParticipants'),n=b('MercuryRoger'),o=b('MercuryThreads').get(),p=b('MercuryTypingReceiver'),q=b('arrayContains'),r=b('copyProperties'),s=b('formatDate'),t=b('removeFromArray'),u=b('tx'),v=[];function w(x){this._threadID=x;this._canonicalUser=o.getCanonicalUserInThread(x);v.push(this);}r(w.prototype,g,{destroy:function(){t(v,this);},setLastMessage:function(x){this._lastMsg=x;this._handleStateChange();},_informStateChanged:function(x){if(x.activity=='none'&&this._currentActivity=='none')return;if(this._lastMsg&&m.isAuthor(this._lastMsg.author))x.self_authored=true;this._currentActivity=x.activity;this.inform('state-changed',x);},_notifySentFrom:function(){var x,y,z=this._lastMsg.location_text,aa=this._lastMsg.source_tags||[];if(z){x=u._("Sent from {location}",{location:z});y='sentFromMobile';}else if(q(aa,l.MESSENGER)){x=h.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},"Sent from Messenger");y='sentFromMobile';}else if(q(aa,l.MOBILE)){x=h.create('a',{href:'/mobile','class':'fcg',target:'_blank'},"Sent from Mobile");y='sentFromMobile';}else if(q(aa,l.EMAIL)){x="Sent from email";y='sentFromEmail';}else{this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:y,text:x});},_notifySeenTimestamp:function(x){var y=n.getSeenTimestamp(this._threadID,x[0])*.001,z=Date.now()*.001,aa;if(y<z-518400){aa='M j';}else if(y<z-86400){aa='D g:ia';}else aa='g:ia';this._informStateChanged({activity:'seen-timestamp',text:u._("Seen {timestamp}",{timestamp:s(y,aa)})});},_checkNamesForCollision:function(x,y){var z=false;m.getMulti(x,function(aa){function ba(ea){if(typeof aa[ea]!=="undefined"){return aa[ea].short_name.toLowerCase();}else return ea;}var ca=y.map(ba),da=x.map(ba);z=ca.some(function(ea){return da.indexOf(ea)!==da.lastIndexOf(ea);});});return z;},_notifySeenBy:function(x){var y=this._lastMsg,z=true;m.getMulti(x,function(aa){z=false;if(this._lastMsg!=y)return;var ba=o.getThreadMetaNow(this._threadID),ca=ba?ba.participants.length:0,da=x.length+(y.author!=m.user),ea,fa=false,ga=false,ha=ca>2&&da>=ca-1;if(!(ha)&&ca>0)ga=this._checkNamesForCollision(ba.participants,x);if(ha){ea="Seen by everyone";}else if(x.length==1){ea=u._("Seen by {user}",{user:aa[x[0]].short_name});}else if(x.length==2){ea=u._("Seen by {user1}, {user2}",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name});}else if(x.length==3){ea=u._("Seen by {user1}, {user2}, {user3}",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name,user3:aa[x[2]].short_name});}else if(x.length>3){var ia=Object.keys(aa).length-2,ja=u._("{num} more",{num:ia}),ka=h.create('span',{className:'more'},ja);ea=h.tx._("Seen by {user1}, {user2}, {=num more link}",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name,'=num more link':ka});fa=true;}fa=fa||ga;this._informStateChanged({activity:'seen-by',text:ea,seenBy:x,hasNameCollision:ga,tooltip:fa});}.bind(this));z&&this._informStateChanged({activity:'none'});},_notifyTyping:function(x){var y=this._lastMsg,z=true;m.getMulti(x,function(aa){z=false;if(this._lastMsg!=y)return;if(this._canonicalUser||j.ChatMultiTypGK){var ba=o.getThreadMetaNow(this._threadID),ca=ba?ba.participants.length:0,da,ea=false;if(ca>2&&x.length>=ca-1){da="Everyone is typing...";}else if(x.length==1){da=u._("{name} is typing...",{name:aa[x[0]].short_name});}else if(x.length==2){da=u._("{user1} and {user2} are typing...",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name});}else if(x.length==3){da=u._("{user1}, {user2}, and {user3} are typing...",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name,user3:aa[x[2]].short_name});}else if(x.length>3){var fa=Object.keys(aa).length-2,ga=u._("{num} more",{num:fa}),ha=h.create('a',{href:'#'},ga);da=h.tx._("{user1}, {user2}, and {=num more link} are typing...",{user1:aa[x[0]].short_name,user2:aa[x[1]].short_name,'=num more link':ha});ea=true;}this._informStateChanged({activity:'typing',text:da,typing:x,tooltip:ea});}}.bind(this));z&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var x=i.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==x){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=m.user){this._notifySentFrom();return;}var y=k.getSeenBy(this._threadID,true);if(y.length)if(this._canonicalUser){this._notifySeenTimestamp(y);return;}else{this._notifySeenBy(y);return;}this._informStateChanged({activity:'none'});}});p.addRetroactiveListener('state-changed',function(x){v.forEach(function(y){var z=x[y._threadID];if(z!==undefined){y._typing=z;y._handleStateChange();}});});k.subscribe('state-changed',function(x,y){v.forEach(function(z){y[z._threadID]&&z._handleStateChange();});});e.exports=w;});
__d("MercuryLastMessageIndicator",["CSS","MercuryIndicatorController","DOM","MercuryParticipants","Tooltip","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('MercuryIndicatorController'),i=b('DOM'),j=b('MercuryParticipants'),k=b('Tooltip'),l=b('copyProperties'),m=b('csx'),n=b('cx');function o(p,q,r,s){this._lastMessageIndicator=q;this._hideTyping=r||false;this._messagesView=s;this._controller=new h(p);this._subscription=this._controller.subscribe('state-changed',this._handleStateChanged.bind(this));}l(o.prototype,{destroy:function(){this._setClass(null);this._subscription.unsubscribe();this._controller.destroy();},setLastMessage:function(p){this._controller.setLastMessage(p);},_handleStateChanged:function(p,q){var r=this._messagesView.isScrolledToBottom();this._rerender(q);r&&this._messagesView.scrollToBottom();},_rerender:function(p){if(p.activity=='none'){this._setClass(null);return;}if(this._hideTyping&&p.activity=='typing'){this._setClass(null);return;}g.conditionClass(this._lastMessageIndicator,"_510e",p.self_authored);var q=i.find(this._lastMessageIndicator,"._510f");if(p.text){i.setContent(q,p.text);}else i.empty(q);if(p.activity.substring(0,4)=='seen'){this._setClass('seen');if(p.activity=='seen-by'&&p.tooltip){j.getMulti(p.seenBy,function(r){var s=i.create('div');for(var t in r){var u=i.create('div');i.setContent(u,r[t].name);i.appendContent(s,u);}var v=p.hasNameCollision,w;if(v){w=this._lastMessageIndicator;}else w=i.find(this._lastMessageIndicator,'span.more');k.set(w,s,'above','center');}.bind(this));}else k.remove(this._lastMessageIndicator);}else this._setClass(p.activity);},_setClass:function(p){if(this._lastClass===p)return;this._lastClass&&g.removeClass(this._lastMessageIndicator,this._lastClass);p&&g.addClass(this._lastMessageIndicator,p);this._lastClass=p;}});e.exports=o;});
__d("loadImage",[],function(a,b,c,d,e,f){"use strict";function g(h,i){var j=new Image();j.onload=function(){i(j.width,j.height,j);};j.src=h;}e.exports=g;});
__d("PixelzFocus",[],function(a,b,c,d,e,f){"use strict";var g={search:function(h,i){var j=0,k=h.length-1;while(j<=k){var l=j+Math.floor((k-j)/2),m=h[l];if(m>i){k=l-1;}else if(m<i){j=l+1;}else return l;}return Math.min(j,k);},forceSpecificPoint:function(h,i,j){var k=1e-09,l=g.search(h,i-j-k)+1,m=g.search(h,i+j);return h.slice(l,m+1);},findBiggestSets:function(h,i){var j=[],k=-1;for(var l=0;l<h.length;++l){var m=h[l],n=l,o=g.search(h,m+i),p=o-n;if(p>k)j=[];if(p>=k){k=p;j.push({low:n,high:o});}}return j;},getBestSet:function(h,i,j){var k=-1,l=null;for(var m=0;m<i.length;++m){var n=i[m],o=h[n.low],p=h[n.high],q=o+(p-o)/2,r=Math.min(o-(q-j),(q+j)-p);if(r>k){k=r;l=n;}}return l;},getFocusFromSet:function(h,i){var j=h[i.low],k=h[i.high];return j+(k-j)/2;},clampFocus:function(h,i){var j=i/2,k=1-(i/2);if(h<j)return j;if(h>k)return k;return h;},convertFromCenterToCSS:function(h,i){if(Math.abs(1-i)<1e-05)return 0;return (h-i/2)/(1-i);},convertFromCSSToCenter:function(h,i){return h*(1-i)+i/2;},getVisible:function(h,i){if(h<i)return h/i;return i/h;},getHidden:function(h,i){return 1-g.getVisible(h,i);},focusHorizontally:function(h,i){return h<i;},convertVectorFromCenterToCSS:function(h,i,j){var k=g.focusHorizontally(i,j),l;if(k){l=h.x/100;}else l=h.x/100;var m=g.convertFromCenterToCSS(l,g.getVisible(i,j));if(k){return {x:m,y:0};}else return {x:0,y:m};},getCropRect:function(h,i,j){var k=g.focusHorizontally(i,j),l=g.getVisible(i,j);if(k){var m=(1-l)*h.x;return {left:m,top:0,width:l,height:1};}else{var n=(1-l)*h.y;return {left:0,top:n,width:1,height:l};}}};e.exports=g;});
__d("Pixelz.react",["arrayContains","copyProperties","cx","invariant","loadImage","React","ReactPropTypes","PixelzFocus"],function(a,b,c,d,e,f){"use strict";var g=b('arrayContains'),h=b('copyProperties'),i=b('cx'),j=b('invariant'),k=b('loadImage'),l=b('React'),m=b('ReactPropTypes'),n=b('PixelzFocus'),o=l.createClass({displayName:'Pixelz',propTypes:{width:m.number,height:m.number,resizeMode:m.oneOf(['contain','cover','stretch']),alt:m.string,letterbox:m.bool,borderRadius:m.number,insetBorderColor:m.string,animated:m.bool,upscale:m.bool,cropRect:function(p,q,r){var s=p[q],t=('Invalid prop `'+q+'` supplied to `'+r+'`, expected a rectangle with values normalized '+'between 0 and 1');j(s.left>=0);j(s.top>=0);j(s.width>=0);j(s.height>=0);j(s.left+s.width<=1);j(s.top+s.height<=1);},focus:function(p,q,r){var s=p[q],t=('Invalid prop `'+q+'` supplied to `'+r+'`, expected either a {x, y, type} vector where type '+'is `css` or `center` or an array of {x, y} vectors. All the vectors '+'have with values normalized between 0 and 1');if(Array.isArray(s)){for(var u=0;u<s.length;++u){j(s[u].x>=0&&s[u].x<=1);j(s[u].y>=0&&s[u].y<=1);}}else{if(!s.type)s.type='css';j(s.x>=0&&s.x<=1);j(s.y>=0&&s.y<=1);j(g(['center','css'],s.type));}}},getDefaultProps:function(){return {resizeMode:'cover',alt:'',letterbox:true,upscale:true,cropRect:{width:1,height:1,top:0,left:0},focus:{x:.5,y:.5,type:'css'}};},getInitialState:function(){return {srcDimensions:{}};},getSrcDimensions:function(){var p=this.props.src,q=this.state.srcDimensions[p];if(q)return q;k(p,function(r,s){var t={};t[p]={width:r,height:s};this.setState({srcDimensions:t});}.bind(this));return null;},getCropSrcDimensions:function(){var p=this.getSrcDimensions();return {width:p.width*this.props.cropRect.width,height:p.height*this.props.cropRect.height};},getUpscaleCropDimensions:function(){var p=this.getCropSrcDimensions(),q=p.width/p.height,r=this.props.width/this.props.height;if(this.props.width&&this.props.height&&this.props.resizeMode==='stretch')return {width:this.props.width,height:this.props.height};if((!this.props.width&&this.props.height)||((this.props.resizeMode==='contain')!==(q>=r)))return {width:this.props.height*q,height:this.props.height};if(this.props.width)return {width:this.props.width,height:this.props.width/q};return p;},getCropDimensions:function(){var p=this.getUpscaleCropDimensions(),q=this.getCropSrcDimensions();if(!this.props.upscale)return {width:Math.min(p.width,q.width),height:Math.min(p.height,q.height)};return p;},getCropAspectRatio:function(){var p=this.getCropDimensions();return p.width/p.height;},getContainerDimensions:function(){if(this.props.letterbox&&this.props.width&&this.props.height)return {width:this.props.width,height:this.props.height};return this.getCropDimensions();},getContainerAspectRatio:function(){var p=this.getContainerDimensions();return p.width/p.height;},getContainerPosition:function(){return {left:0,top:0};},getFocus:function(){var p=this.props.focus;if(!Array.isArray(p)&&p.type==='css')return {x:p.x,y:p.y};var q=this.getContainerAspectRatio(),r=this.getCropAspectRatio(),s=n.getVisible(q,r),t=n.focusHorizontally(q,r),u;if(!Array.isArray(p)){u=n.convertFromCenterToCSS(t?p.x:p.y,s);}else{var v=p.map(function(y){return t?y.x:y.y;});v.sort();var w=n.findBiggestSets(v,s),x=n.getBestSet(v,w,s);u=n.getFocusFromSet(v,x);}return {x:t?u:.5,y:t?.5:u};},getCropPosition:function(){var p=this.getCropDimensions(),q=this.getContainerDimensions(),r=this.getFocus();return {left:r.x*(q.width-p.width),top:r.y*(q.height-p.height)};},getScaleDimensions:function(){var p=this.getCropDimensions();return {width:p.width/this.props.cropRect.width,height:p.height/this.props.cropRect.height};},getScalePosition:function(){var p=this.getScaleDimensions();return {left:-p.width*this.props.cropRect.left,top:-p.height*this.props.cropRect.top};},getClipCropRectangle:function(){var p=this.getContainerDimensions(),q=this.getCropDimensions(),r=this.getContainerPosition(),s=this.getCropPosition(),t=Math.max(r.left,s.left),u=Math.max(r.top,s.top),v=Math.min(r.top+p.height,s.top+q.height),w=Math.min(r.left+p.width,s.left+q.width);return {left:t,top:u,width:w-t,height:v-u};},getClipCropPosition:function(){var p=this.getClipCropRectangle();return {left:p.left,top:p.top};},getClipCropDimensions:function(){var p=this.getClipCropRectangle();return {width:p.width,height:p.height};},getClipScalePosition:function(){var p=this.getScalePosition(),q=this.getClipCropPosition(),r=this.getCropPosition();return {left:p.left+(r.left-q.left),top:p.top+(r.top-q.top)};},getClipScaleDimensions:function(){return this.getScaleDimensions();},areDimensionsEqual:function(p,q){return p.width===q.width&&p.height===q.height;},shouldAddAllNodesAndStyles:function(){return this.props.animated;},hasCrop:function(){if(this.shouldAddAllNodesAndStyles())return true;var p=this.getContainerDimensions(),q=this.getClipCropDimensions(),r=this.getClipScaleDimensions();if(this.areDimensionsEqual(p,q)||this.areDimensionsEqual(q,r))return false;return true;},hasContainer:function(){if(this.shouldAddAllNodesAndStyles()||this.hasInsetBorder())return true;var p=this.getContainerDimensions(),q=this.getClipScaleDimensions();if(this.areDimensionsEqual(p,q))return false;return true;},hasInsetBorder:function(){return this.shouldAddAllNodesAndStyles()||this.props.insetBorderColor;},applyPositionStyle:function(p,q){if(this.shouldAddAllNodesAndStyles()||q.left)p.left=Math.round(q.left);if(this.shouldAddAllNodesAndStyles()||q.top)p.top=Math.round(q.top);},applyDimensionsStyle:function(p,q){p.width=Math.round(q.width);p.height=Math.round(q.height);},applyBorderRadiusStyle:function(p){if(this.shouldAddAllNodesAndStyles()||this.props.borderRadius)p.borderRadius=this.props.borderRadius||0;},getScaleStyle:function(){var p={},q=this.getClipCropDimensions(),r=this.getClipScaleDimensions();if(this.shouldAddAllNodesAndStyles()||!this.areDimensionsEqual(q,r)){this.applyPositionStyle(p,this.getClipScalePosition());}else this.applyPositionStyle(p,this.getClipCropPosition());this.applyDimensionsStyle(p,this.getClipScaleDimensions());this.applyBorderRadiusStyle(p);return p;},getCropStyle:function(){var p={};this.applyPositionStyle(p,this.getClipCropPosition());this.applyDimensionsStyle(p,this.getClipCropDimensions());this.applyBorderRadiusStyle(p);return p;},getInsetBorderStyle:function(){var p={borderColor:this.props.insetBorderColor||'transparent'};this.applyPositionStyle(p,this.getClipCropPosition());this.applyDimensionsStyle(p,this.getClipCropDimensions());this.applyBorderRadiusStyle(p);return p;},getContainerStyle:function(){var p={};this.applyDimensionsStyle(p,this.getContainerDimensions());this.applyBorderRadiusStyle(p);return p;},getScale:function(){var p=this.getScaleStyle(),q=p.width,r=p.height;p=h({},p);delete p.width;delete p.height;return this.transferPropsTo(l.DOM.img({alt:this.props.alt,className:(("_56wb")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),src:this.props.src,style:p,width:q,height:r}));},getCrop:function(){var p=this.getScale();if(!this.hasCrop())return p;return (l.DOM.div({className:(("_56ma")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getCropStyle()},p));},getInsetBorder:function(){if(!this.hasInsetBorder())return null;return (l.DOM.div({className:(("_56lv")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getInsetBorderStyle()}));},getContainer:function(){var p=this.getCrop();if(!this.hasContainer())return p;var q=this.getInsetBorder();return (l.DOM.div({className:(("_56jj")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getContainerStyle()},p,q));},render:function(){var p=this.getSrcDimensions();if(!p)return l.DOM.span(null);return this.getContainer();}});e.exports=o;});
__d("MercurySeenByAll",["CSS","DataStore","DOM","MercuryParticipants","MercuryDelayedRoger","MercuryThreads"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DataStore'),i=b('DOM'),j=b('MercuryParticipants'),k=b('MercuryDelayedRoger'),l=b('MercuryThreads').get(),m={},n={updateOnSeenChange:function(p,q){m[p.tagName]=true;h.set(p,'thread-id',q.thread_id);g.addClass(p,'seenByListener');o(p,q);}};function o(p,q){var r=q.participants.filter(function(t){return t!==j.user;}),s=q.participants.length>0&&q.participants[0]===j.user;g.conditionClass(p,'repliedLast',s);g.conditionClass(p,'seenByAll',s&&k.getSeenBy(q.thread_id).length===r.length);}k.subscribe('state-changed',function(p,q){for(var r in m){var s=i.scry(document.body,r+'.seenByListener');for(var t=0;t<s.length;t++){var u=s[t],v=h.get(u,'thread-id');if(q[v])l.getThreadMeta(v,function(w){o(u,w);});}}});e.exports=n;});
__d("StickerConstants",[],function(a,b,c,d,e,f){var g={LIKE_STICKER_ID:227878347358915};e.exports=g;});
__d("MercuryThreadMetadataRenderer",["CSS","DOM","Emoji","EmoticonsList","HTML","JSLogger","MercuryAttachment","MercuryAttachmentType","MercuryMessageSourceTags","MercurySingletonMixin","MercuryThreadMetadataRawRenderer","MercuryParticipants","MercuryParticipantsConstants","Pixelz.react","React","MercurySeenByAll","MercuryServerRequests","SplitImage.react","StickerConstants","Style","MercuryThreadlistIconTemplates","MercuryThreads","Tooltip","URI","arrayContains","createArrayFrom","copyProperties","cx","emojiAndEmote","fbt","formatDate","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Emoji'),j=b('EmoticonsList'),k=b('HTML'),l=b('JSLogger'),m=b('MercuryAttachment'),n=b('MercuryAttachmentType'),o=b('MercuryMessageSourceTags'),p=b('MercurySingletonMixin'),q=b('MercuryThreadMetadataRawRenderer'),r=b('MercuryParticipants'),s=b('MercuryParticipantsConstants'),t=b('Pixelz.react'),u=b('React'),v=b('MercurySeenByAll'),w=b('MercuryServerRequests'),x=b('SplitImage.react'),y=b('StickerConstants'),z=b('Style'),aa=b('MercuryThreadlistIconTemplates'),ba=b('MercuryThreads'),ca=b('Tooltip'),da=b('URI'),ea=b('arrayContains'),fa=b('createArrayFrom'),ga=b('copyProperties'),ha=b('cx'),ia=b('emojiAndEmote'),ja=b('fbt'),ka=b('formatDate'),la=b('tx'),ma=l.create('wm_timestamp');function na(ta){this._fbid=ta;this._serverRequests=w.getForFBID(ta);this._threads=ba.getForFBID(ta);}ga(na,p);ga(na.prototype,{renderTimestamp:function(ta,ua,va,wa){if(wa){if(!ua){ma.warn('no_title');ua=(new Date(wa)).toLocaleDateString();}ta.setAttribute('title',ua);ta.setAttribute('data-utime',wa/1000);if(!va){ma.warn('no_display');va=ka(new Date(wa),'g:ia');}h.setContent(ta,va);g.show(ta);}},renderMessageSourceTags:function(ta,ua,va,wa){var xa='',ya='',za='';if(ea(va,o.MESSENGER)){xa="Sent from Messenger";ya=new da('/mobile/messenger');za="_9g";}else if(ea(va,o.MOBILE)){xa="Sent from Mobile";ya=new da('/mobile/');za="_9j";}else if(ea(va,o.CHAT)){xa="Sent from chat";za="_9h";}else if(ea(va,o.EMAIL)){if(wa){xa=la._("Sent from {email}",{email:wa});}else xa="Sent from email";za="_9i";}if(za){ca.set(ta,xa);g.addClass(ua,za);if(ya){ta.setAttribute('href',ya);}else ta.removeAttribute('href');}else g.hide(ta);},renderMessageLocation:function(ta,ua,va){var wa=da('/ajax/messaging/hovercard/map.php').setQueryData(va);ta.setAttribute('data-hovercard',wa);g.removeClass(ta,"_b9");g.show(ua);},renderSpoofWarning:function(ta,ua,va){if(ua){g.addClass(ta,"_sa");ca.set(ta,la._("Unable to confirm {name_or_email} as the sender.",{name_or_email:va.name}));}},renderChatSpoofWarning:function(ta,ua,va){if(ua)h.appendContent(ta,la._("Unable to confirm {name_or_email} as the sender.",{name_or_email:va.name}));},renderCoreThreadlist:function(ta,ua,va,wa,xa){wa=wa||{};this.renderThreadImage(ta,ua.getNode('image'));var ya=ua.getNode('accessibleName'),za=[ua.getNode('name')];if(ya)za.push(ya);sa(this,ta,za,wa);if(ta.folder&&xa)ra(ua.getNode('folderBadge'),ta.folder);var ab=ua.getNode('timestamp');this.renderTimestamp(ab,ta.timestamp_absolute,ta.timestamp_relative,ta.timestamp);this.renderSnippet(ta,ua.getNode('snippet'));pa(ua,ta);va(ua,ta);},renderAndSeparatedParticipantList:function(ta,ua,va){va=va||{};va.last_separator_uses_and=true;this._threads.getThreadMeta(ta,function(wa){sa(this,wa,ua,va);}.bind(this));},renderSnippet:function(ta,ua){var va=false,wa=h.create('span');g.addClass(wa,'MercuryRepliedIndicator');h.appendContent(ua,wa);v.updateOnSeenChange(wa,ta);var xa=ta.snippet;if(xa){if(ta.snippet_has_attachment)h.appendContent(ua,h.create('span',{className:'MercuryAttachmentIndicator'}));if(ta.is_forwarded_snippet)h.appendContent(ua,h.create('strong',{className:"_55q_"},"Forwarded Message:"));if(xa.substr(0,4)=='?OTR'){xa="[encrypted message]";}else xa=xa.replace(/\r\n|[\r\n]/g," ");xa=k(i.htmlEmojiAndEmote(xa));}else{if(ta.is_forwarded_snippet)h.appendContent(ua,h.create('strong',{className:"_55q_"},"Forwarded Message"));if(ta.snippet_has_attachment&&ta.snippet_attachments&&ta.snippet_attachments.length){va=true;xa=h.create('span');qa(this,ta,xa);}}var ya=ta.participants.length;if(ta.is_subscribed)ya--;if(!va&&ta.snippet_sender&&r.getIDForUser(this._fbid)!=ta.snippet_sender&&ya>1){r.get(ta.snippet_sender,function(za){if(za.short_name){h.appendContent(ua,la._("{name}: {conversation_snippet}",{name:za.short_name,conversation_snippet:xa}));}else h.appendContent(ua,xa);});}else h.appendContent(ua,xa);},getTitanURL:function(ta,ua,va){if(ta.substr(0,ta.indexOf(':'))=='user'){q.getUserCanonicalTitanURL(ta,ua,va);}else this._serverRequests.getServerThreadID(ta,function(wa){q.getTitanURLWithServerID(wa,ua,va);});},renderTitanLink:function(ta,ua,va,wa){if(ta.substr(0,ta.indexOf(':'))=='user'){q.renderUserCanonicalTitanLink(ta,ua,va,wa);}else this._serverRequests.getServerThreadID(ta,function(xa){q.renderTitanLinkWithServerID(xa,ua,va,wa);});},renderThreadImage:function(ta,ua){if(ta.image_src){var va=t({height:s.BIG_IMAGE_SIZE,resizeMode:'cover',src:ta.image_src,width:s.BIG_IMAGE_SIZE});u.renderComponent(va,ua);return;}var wa=r.getIDForUser(this._fbid),xa=[],ya=ta.participants.filter(function(za){return za!=wa;});if(!ya.length){xa=[wa];}else if(ya.length==1){xa=[ya[0]];}else xa=ya.slice(0,3);this.renderParticipantImages(xa,ua);},renderParticipantImages:function(ta,ua){r.getOrderedBigImageMulti(ta,function(va){var wa=x({srcs:va,border:true,size:s.BIG_IMAGE_SIZE});u.renderComponent(wa,ua);});},renderParticipantList:function(ta,ua,va,wa){return q.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(ta),ua,va,wa);},renderThreadNameAndParticipantList:function(ta,ua,va,wa){var xa=q.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(ta),ua,va,wa),ya=this._threads.getThreadMetaNow(ta);if(!ya.name)return xa;return la._("{conversation_name} [with {participant_list}]",{conversation_name:ya.name,participant_list:xa});},renderParticipantCount:function(ta,ua){return q.renderRawParticipantCount(this._serverRequests.getServerThreadIDNow(ta),ua);}});function oa(ta){if(!ta.snippet_attachments)return [];return ta.snippet_attachments.filter(function(ua){return ua.attach_type===n.PHOTO;});}function pa(ta,ua){var va=oa(ua);if(va.length===0)return;var wa=va[0].thumbnail_url;if(!wa)return;var xa=(va.length==1)?'snippet-thumbnail-single':'snippet-thumbnail-multiple',ya=ta.getNode(xa);if(!ya)return;var za=h.find(ya,'i');z.set(za,'background-image','url('+wa+')');g.show(ya);}function qa(ta,ua,va){var wa=ua.snippet_sender&&r.getIDForUser(ta._fbid)==ua.snippet_sender,xa=function(db){if(!ua.snippet_sender||wa){db(null);return;}r.get(ua.snippet_sender,function(eb){db(eb.short_name);});},ya=oa(ua),za=ya.length==ua.snippet_attachments.length,ab=ua.snippet_attachments.length===1&&ua.snippet_attachments[0].metadata&&ua.snippet_attachments[0].metadata.type=='fb_voice_message',bb=ua.snippet_attachments.length===1&&ua.snippet_attachments[0].attach_type===n.STICKER,cb=ua.snippet_attachments.length===1&&ua.snippet_attachments[0].attach_type===n.SHARE;xa(function(db){var eb=null;if(za){var fb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();if(ya.length===1){eb=wa?"You sent a photo.":la._("{name} sent a photo.",{name:db});}else eb=wa?la._("You sent {num_photos} photos.",{num_photos:ya.length}):la._("{name} sent {num_photos} photos.",{name:db,num_photos:ya.length});g.addClass(fb,m.getAttachIconClass(ya[0].icon_type));h.appendContent(fb,eb);h.appendContent(va,fb);}else if(ab){var gb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();eb=wa?"You sent a voice message.":la._("{name} sent a voice message.",{name:db});g.addClass(gb,m.getAttachIconClass(ua.snippet_attachments[0].icon_type));h.appendContent(gb,eb);h.appendContent(va,gb);}else if(bb){if(ua.snippet_attachments[0].metadata.stickerID==y.LIKE_STICKER_ID){eb=ia(j.symbols.like);}else eb=wa?"You sent a sticker.":la._("{name} sent a sticker.",{name:db});h.appendContent(va,eb);}else if(cb){var hb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();if(wa){eb="You shared a link.";}else eb=ja._("{sender name} shared a link.",[ja.param("sender name",db)]);g.addClass(hb,m.getAttachIconClass(ua.snippet_attachments[0].icon_type));h.appendContent(hb,eb);h.appendContent(va,hb);}else ua.snippet_attachments.filter(function(ib){return ib.attach_type==n.FILE||ib.attach_type==n.PHOTO;}).forEach(function(ib){var jb=aa[':fb:mercury:attachment-icon-text'].build().getRoot();h.appendContent(jb,ib.name);g.addClass(jb,m.getAttachIconClass(ib.icon_type));h.appendContent(va,jb);});});}function ra(ta,ua){fa(ta).forEach(function(va){h.setContent(va,ua);});}function sa(ta,ua,va,wa){va=fa(va);if(ua.name){var xa=q.renderRawTitleWithUnreadCount(ua.name,wa.show_unread_count?ua.unread_count:0);va.forEach(function(za){h.setContent(za,xa);});wa.callback&&wa.callback(xa);return;}var ya=ua.participants;if(ua.participants.length>1)ya=ua.participants.filter(function(za){return za!=r.getIDForUser(ta._fbid);});r.getMulti(ya,function(za){q.renderParticipantListWithNoThreadName(ta._serverRequests.getServerThreadIDNow(ua.thread_id),ua,ya,za,va,wa);});}e.exports=na;});
__d("MercuryTypingIndicator",["Animation","CSS","DOM","MercuryTypingReceiver","MercuryParticipants","Style","ChatTabTemplates","MercuryThreadInformer","Tooltip","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('CSS'),i=b('DOM'),j=b('MercuryTypingReceiver'),k=b('MercuryParticipants'),l=b('Style'),m=b('ChatTabTemplates'),n=b('MercuryThreadInformer').get(),o=b('Tooltip'),p=b('copyProperties'),q=b('cx'),r=b('tx'),s=[];n.subscribe('messages-received',function(v,w){s.forEach(function(x){var y=w[x._threadID];y&&x.receivedMessages(y);});});j.addRetroactiveListener('state-changed',function(v){s.forEach(function(w){var x=v[w._threadID];x&&w._handleStateChanged(x);});});function t(v){var w=m[':fb:chat:conversation:message-group'].build(),x=m[':fb:mercury:typing-indicator:typing'].build();h.addClass(w.getRoot(),"_50kd");var y=w.getNode('profileLink');o.set(y,v.name,'left');y.href=v.href;w.setNodeContent('profileName',v.name);w.setNodeProperty('profilePhoto','src',v.image_src);var z=r._("{name} is typing...",{name:v.short_name});o.set(x.getRoot(),z,'above');i.appendContent(w.getNode('messages'),x.getRoot());return w;}function u(v,w,x){this._animations={};this._activeUsers={};this._typingIndicator=w;this._messagesView=x;this._threadID=v;this._subscription=j.addRetroactiveListener('state-changed',function(y){var z=y[this._threadID];z&&this._handleStateChanged(z);}.bind(this));s.push(this);}p(u.prototype,{destroy:function(){Object.keys(this._activeUsers).forEach(this._removeUserBubble.bind(this));this._controller.destroy();s.remove(this);},receivedMessages:function(v){v.forEach(function(w){if(!k.isAuthor(w.author))this._removeUserBubble(w.author);}.bind(this));},_handleStateChanged:function(v){for(var w in this._activeUsers)if(v.indexOf(w)===-1){this._slideOutUserBubble(w);delete this._activeUsers[w];}if(v.length)k.getMulti(v,function(x){var y=this._messagesView.isScrolledToBottom(),z={};for(var aa in x){var ba=this._activeUsers[aa];z[aa]=ba||t(x[aa]).getRoot();if(!ba)i.appendContent(this._typingIndicator,z[aa]);}var ca=Object.keys(z).length>0;y&&this._messagesView.scrollToBottom(ca);this._activeUsers=z;}.bind(this));},_removeUserBubble:function(v,w){var x=this._getCurrentAnimation(v,w);if(x){x.animation.stop();i.remove(x.elem);delete this._animations[v];}if(v in this._activeUsers){i.remove(this._activeUsers[v]);delete this._activeUsers[v];}w&&i.remove(w);},_slideOutUserBubble:function(v){var w=this._activeUsers[v];if(this._getCurrentAnimation(v,w)){return;}else if(w){l.set(w,'overflow','hidden');var x=(new g(w)).from('opacity',1).from('height',w.offsetHeight).to('height',0).to('opacity',0).ease(g.ease.end).duration(250).ondone(this._removeUserBubble.bind(this,v,w)).go();this._animations[v]={animation:x,elem:w};}},_getCurrentAnimation:function(v,w){if(this._animations[v]&&(!w||this._animations[v].elem===w))return this._animations[v];}});e.exports=u;});
__d("MercuryDateBreak.react",["React","ReactPropTypes","Timestamp.react","formatDate","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('ReactPropTypes'),i=b('Timestamp.react'),j=b('formatDate'),k=b('cx'),l=g.createClass({displayName:'MercuryMessageBody',propTypes:{date:h.instanceOf(Date).isRequired},render:function(){var m=this.props.date,n=j(m,{today:'g:ia',withinWeek:'l g:ia',thisYear:'F jS, g:ia',older:'F j, Y g:i a'}),o=Math.round(m.getTime()/1000);return this.transferPropsTo(g.DOM.div({className:"_5hde"},g.DOM.div({className:"_5hdf"},i({time:o,verbose:n,text:n}))));}});e.exports=l;});
__d("ChatTabMessagesView",["Animation","Arbiter","ArbiterMixin","MercuryAttachment","MercuryAttachmentRenderer","ChannelConstants","ChatConfig","ChatLogMessage.react","ChatMessage.react","ChatVisibility","CSS","CurrentUser","DOM","Event","JSXDOM","JoinableConversationMessageFilter","LiveTimer","MercuryActionTypeConstants","MercuryAPIArgsSource","MercuryLastMessageIndicator","MercuryLogMessageType","MercurySourceType","MercuryMessages","MercuryServerRequests","MercuryMessageStatus.react","MercuryThreadMetadataRenderer","MercuryThreadlistConstants","MercuryThreads","MercuryTypingIndicator","MercuryDateBreak.react","MercuryMessageRenderer","Parent","MercuryParticipants","React","ServerTime","MercuryStatusTemplates","Style","SubscriptionsHandler","ChatTabTemplates","MercuryThreadInformer","Timestamp.react","Tooltip","UserAgent","VideoCallCore","copyProperties","createArrayFrom","csx","cx","extendArray","formatDate","getElementPosition","isRTL","removeFromArray","shield","startsWith","throttle","tx"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('MercuryAttachment'),k=b('MercuryAttachmentRenderer'),l=b('ChannelConstants'),m=b('ChatConfig'),n=b('ChatLogMessage.react'),o=b('ChatMessage.react'),p=b('ChatVisibility'),q=b('CSS'),r=b('CurrentUser'),s=b('DOM'),t=b('Event'),u=b('JSXDOM'),v=b('JoinableConversationMessageFilter'),w=b('LiveTimer'),x=b('MercuryActionTypeConstants'),y=b('MercuryAPIArgsSource'),z=b('MercuryLastMessageIndicator'),aa=b('MercuryLogMessageType'),ba=b('MercurySourceType'),ca=b('MercuryMessages').get(),da=b('MercuryServerRequests').get(),ea=b('MercuryMessageStatus.react'),fa=b('MercuryThreadMetadataRenderer').get(),ga=b('MercuryThreadlistConstants'),ha=b('MercuryThreads').get(),ia=b('MercuryTypingIndicator'),ja=b('MercuryDateBreak.react'),ka=b('MercuryMessageRenderer'),la=b('Parent'),ma=b('MercuryParticipants'),na=b('React'),oa=b('ServerTime'),pa=b('MercuryStatusTemplates'),qa=b('Style'),ra=b('SubscriptionsHandler'),sa=b('ChatTabTemplates'),ta=b('MercuryThreadInformer').get(),ua=b('Timestamp.react'),va=b('Tooltip'),wa=b('UserAgent'),xa=b('VideoCallCore'),ya=b('copyProperties'),za=b('createArrayFrom'),ab=b('csx'),bb=b('cx'),cb=b('extendArray'),db=b('formatDate'),eb=b('getElementPosition'),fb=b('isRTL'),gb=b('removeFromArray'),hb=b('shield'),ib=b('startsWith'),jb=b('throttle'),kb=b('tx'),lb,mb=34,nb=1000*60*60,ob=70,pb=null,qb=20;function rb(bc){return db(new Date(bc),'g:ia');}function sb(bc){var cc=sa[':fb:chat:conversation:message-group'].build(),dc=cc.getNode('profileLink'),ec=ma.isAuthor(bc.author),fc=da.tokenizeThreadID(bc.thread_id),gc=fc.type!=='user',hc=!ec;q.conditionClass(cc.getRoot(),"_50kd",!ec);q.conditionClass(cc.getRoot(),"_50x4",gc&&!ec);q.conditionShow(dc,hc);ma.get(bc.author,function(ic){if(hc){dc.href=ic.href;var jc="You";if(!ec)jc=u.div({className:"_522l"},u.div({className:"_522m"},rb(bc.timestamp)),ic.name);va.set(dc,jc,'left');if(!ec&&gc)cc.setNodeContent('profileName',ic.name);cc.setNodeProperty('profilePhoto','src',ic.image_src);}});return cc;}function tb(bc){if(m.get('chat_react')){var cc=s.create('div'),dc=n({message:bc});na.renderComponent(dc,cc);return cc;}else{var ec=sa[':fb:chat:conversation:message:event'].build(),fc=rb(bc.timestamp);ec.getRoot().setAttribute('title',fc);ka.renderLogMessage(ec.getNode('icon'),ec.getNode('message'),ec.getNode('attachment'),bc);var gc=vb(bc);if(gc)s.appendContent(ec.getNode('message'),gc);return ec.getRoot();}}function ub(bc,cc){if(pb===null){var dc=cc.childNodes[0];qa.set(cc,'overflow','scroll');pb=dc.clientWidth-ob;qa.set(cc,'overflow','');}if(!q.hasClass(bc,"_kso")){var ec=s.scry(bc,"._kso");if(ec.length===1){bc=ec[0];}else return;}qa.set(bc,'max-width',pb+'px');var fc,gc,hc=bc.firstChild;if(bc.childNodes.length===1&&hc.getAttribute('data-measureme')){fc=hc.getClientRects();var ic=hc.offsetHeight;if(fc&&fc.length>1&&fc[0].height<ic){gc=true;if(!lb){s.remove(hc);lb=bc.offsetWidth;s.appendContent(bc,hc);}var jc=hc.offsetWidth,kc=bc.offsetWidth-jc-lb;if(kc>0)qa.set(bc,'max-width',jc+'px');}}var lc=la.byClass(bc,"_50x4");if(lc)q.conditionClass(lc,"_51lo",fc?!gc:bc.offsetHeight<mb);}function vb(bc){var cc,dc;if(bc.log_message_type==aa.VIDEO_CALL)if(bc.log_message_data.event_name=='install_canceled'){cc=s.tx._("Retry setup and call back.");dc='callback_cancelinstall_link';return wb(cc,bc.thread_id,bc.log_message_data.to,dc);}else if(!bc.log_message_data.event_name&&bc.log_message_data.callee==ma.user&&!bc.log_message_data.answered){cc=s.tx._("Call Back");dc='callback_link';return wb(cc,bc.thread_id,bc.log_message_data.caller.split(':')[1],dc);}return null;}function wb(bc,cc,dc,ec){if(xa.isSupported()){var fc=!p.isOnline()||!xa.availableForCall(dc),gc=s.create('a',{href:'#',className:'callBackLink'},bc);if(fc)q.hide(gc);gc.setAttribute('data-gt',JSON.stringify({videochat:'clicked_callback_link'}));t.listen(gc,'click',function(){zb.inform('video-call-clicked',{userID:dc,threadID:cc,clickSource:ec});});return gc;}return null;}function xb(bc){var cc=sa[':fb:mercury:chat:message:forward'].build(),dc=cc.getNode('forwardText');if(dc){q.hide(cc.getRoot());fa.renderTitanLink(bc.thread_id,cc.getNode('forwardLink'),q.show.bind(q,cc.getRoot()));if(bc.forward_count>1){s.appendContent(dc,kb._("{count} forwarded messages",{count:bc.forward_count}));}else s.appendContent(dc,"1 forwarded message");}return cc.getRoot();}var yb=[];function zb(bc,cc,dc,ec,fc,gc,hc,ic){this.loadingIcon=fc;this.threadID=bc;this.sheetController=cc;this.scrollContainer=dc;this.conversationElem=ec;this.messageElements={};this.tabView=ic;this.messageGroup=null;this.prevMessage=null;w.restart(oa.get()/1000);this._fetchMultiplier=1;this._oldestMessageDisplayedTimestamp=null;this._loadingMoreMessages=false;this._currentMessageCount=0;this._hasReachedClearedMessages=false;var jc=ga.MESSAGE_TIMESTAMP_THRESHOLD;this._oldestMessageDisplayedTimestamp=Date.now()-jc;yb.push(this);function kc(){zb.inform('interaction-with-tab',bc);}this._subscriptions=new ra();this._subscriptions.addSubscriptions(h.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),t.listen(this.scrollContainer,'mousedown',kc));if(wa.firefox()){var lc=('WheelEvent' in window)?'wheel':'DOMMouseScroll';this.scrollContainer.addEventListener(lc,kc,false);}else this._subscriptions.addSubscriptions(t.listen(this.scrollContainer,'mousewheel',kc));this._subscriptions.addSubscriptions(t.listen(this.scrollContainer,'scroll',jb(this.scrolling,50,this)));this.lastMessageIndicator=new z(this.threadID,gc,true,this);this.typingIndicator=new ia(this.threadID,hc,this);ca.getThreadMessagesRange(this.threadID,0,ga.RECENT_MESSAGES_LIMIT,this._updateTimestamp.bind(this));this.rerender();}ya(zb,i);ya(zb.prototype,{scrolling:function(){this._checkToAnimateSticker();if(!this._loadingMoreMessages&&this.isScrolledNearTop()&&!this.isScrolledToBottom()&&!this._hasReachedClearedMessages&&!this.tabView._isDragDropActive)this.loadMoreMessages();if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},getScrollTop:function(){return this.scrollContainer&&this.scrollContainer.scrollTop;},destroy:function(){s.empty(this.conversationElem);this._subscriptions&&this._subscriptions.release();gb(yb,this);this.lastMessageIndicator&&this.lastMessageIndicator.destroy();this.destroyed=true;},_appendMessage:function(bc){if(bc==this.prevMessage)return;if(bc.is_cleared){this._hasReachedClearedMessages=true;return;}this._appendDateBreak(bc);if(m.get('chat_react')){this._appendUserMessageReact(bc);}else this._appendUserMessageXHP(bc);this.prevMessage=bc;},_appendUserMessageXHP:function(bc){var cc=ga.GROUPING_THRESHOLD,dc=this._renderMessageWithStatus(bc);if(bc.action_type==x.LOG_MESSAGE){s.appendContent(this.conversationElem,dc);this.messageGroup=null;}else{if(!this.messageGroup||bc.author!==ma.user||this.prevMessage.author!=bc.author||this.prevMessage.timestamp<bc.timestamp-cc){this.messageGroup=sb(bc);s.appendContent(this.conversationElem,this.messageGroup.getRoot());}s.appendContent(this.messageGroup.getNode('messages'),dc);ub(dc,this.scrollContainer);}},_appendUserMessageReact:function(bc){var cc=s.create('div');s.appendContent(this.conversationElem,cc);function dc(event){if(this.isScrolledToBottom(event.heightChange))this.scrollToBottom();}var ec=(o({onResize:dc.bind(this),message:bc}));na.renderComponent(ec,cc);this.messageElements[bc.message_id]=ec;},_appendDateBreak:function(bc){var cc=(bc.action_type===x.LOG_MESSAGE)&&(bc.log_message_type===aa.SERVER_ERROR),dc;if(this.prevMessage!==null){dc=bc.timestamp-this.prevMessage.timestamp;}else dc=Infinity;if(!cc&&(dc>=nb)){if(m.get('chat_react')){var ec=s.create('div'),fc=new Date(bc.timestamp);na.renderComponent(ja({date:fc}),ec);s.appendContent(this.conversationElem,ec);}else{var gc=Math.round(bc.timestamp/1000),hc=bc.timestamp_datetime,ic=sa[':fb:chat:conversation:date-break'].build();na.renderComponent(ua({time:gc,verbose:hc,text:hc}),ic.getNode('date'));s.appendContent(this.conversationElem,ic.getRoot());}this.messageGroup=null;}},rerender:function(){if(!this._oldestMessageDisplayedTimestamp)return;var bc=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollHeight,cc=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollTop,dc=this.isScrolledToBottom();s.empty(this.conversationElem);this.messageElements={};this.messageGroup=null;this.prevMessage=null;var ec=ca.getThreadMessagesSinceTimestamp(this.threadID,this._oldestMessageDisplayedTimestamp);this._renderOlderMessages(ec,bc,cc,dc);this._finishedFetchingMoreMessages=false;},update:function(bc){for(var cc in bc){var dc=this.messageElements[cc];if(dc){var ec=this.isScrolledToBottom(),fc=ca.getMessagesFromIDs([cc])[0];if(m.get('chat_react')){dc.setState({message:fc});}else{var gc=this._renderMessageWithStatus(fc);s.replace(dc,gc);ub(gc,this.scrollContainer);}if(ec)this.scrollToBottom();}}if(this.scrollContainer.scrollTop===0)this._checkToAnimateSticker();},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_appendMessages:function(bc){var cc=this.scrollContainer.style.overflowY;qa.set(this.scrollContainer,'overflow-y','scroll');bc.forEach(this._appendMessage.bind(this));this.lastMessageIndicator&&this.lastMessageIndicator.setLastMessage(this.prevMessage);qa.set(this.scrollContainer,'overflow-y',cc);},_appendNewMessages:function(bc){bc=v.filterMessages(function(ec){this.sheetController.openUserJoinStatusSheet(ec);}.bind(this),bc,true);var cc=this.isScrolledToBottom(),dc=this._messagesOnlySentFromSelf(bc);this._appendMessages(bc);if(cc){this.scrollToBottom();}else if(!dc){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}},_messagesOnlySentFromSelf:function(bc){for(var cc=0;cc<bc.length;cc++)if(bc[cc].author!==ma.user)return false;return true;},_renderOlderMessages:function(bc,cc,dc,ec){if(!bc)return;bc=v.filterMessages(function(fc){this.sheetController.openUserJoinStatusSheet(fc);}.bind(this),bc,false);this._appendMessages(bc);if(ec){this.scrollToBottom();}else if(this._finishedFetchingMoreMessages)this.scrollToPosition(this.scrollContainer.scrollHeight-cc-this.loadingHeight+dc);},_updateTimestamp:function(bc){if(bc&&bc.length){this._oldestMessageDisplayedTimestamp=bc[0].timestamp;this._currentMessageCount=bc.length;}this._loadingMoreMessages=false;this._finishedFetchingMoreMessages=true;q.hide(this.loadingIcon);},isScrolledToBottom:function(bc){var cc=this.scrollContainer;bc=bc||qb;return cc.scrollTop+cc.clientHeight>=cc.scrollHeight-bc;},isScrolledNearTop:function(){return this.scrollContainer.scrollTop<this.scrollContainer.clientHeight;},scrollToBottom:function(bc){this.scrollToPosition(this.scrollContainer.scrollHeight,bc);},scrollToPosition:function(bc,cc){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(cc===true){this._scrollTopAnimation=(new g(this.scrollContainer)).to('scrollTop',bc).ease(g.ease.end).duration(400).go();}else this.scrollContainer.scrollTop=bc;},loadMoreMessages:function(){if(ca.hasLoadedExactlyNMessages(this.threadID,this._currentMessageCount)&&ca.hasLoadedAllMessages(this.threadID))return;if(ha.isNewEmptyLocalThread(this.threadID))return;q.show(this.loadingIcon);this.loadingHeight=this._getLoadingHeight();this._loadingMoreMessages=true;if(this._fetchMultiplier<10)this._fetchMultiplier+=1;var bc=ga.RECENT_MESSAGES_LIMIT*this._fetchMultiplier,cc=this._currentMessageCount+bc,dc=ca.hasLoadedNMessages(this.threadID,cc);ca.getThreadMessagesRange(this.threadID,0,cc,this._updateTimestamp.bind(this),null,y.CHAT);if(dc)this.rerender();},_renderMessageWithStatus:function(bc){var cc=(bc.action_type===x.LOG_MESSAGE)?tb(bc):this._makeSingleMessage(bc),dc=ea({message:bc}),ec=dc.getType();if(ec!=='none'){var fc=sa[':fb:chat:conversation:message:status'].build();q.conditionClass(fc.getRoot(),"_542q",ib(ec,'error'));s.appendContent(fc.getNode('message'),cc);na.renderComponent(dc,fc.getNode('status'));cc=fc.getRoot();}this.messageElements[bc.message_id]=cc;return cc;},_makeSingleMessage:function(bc){var cc=this._renderSingleMessage(bc);q.addClass(cc,"_55r0");return cc;},_renderSingleMessage:function(bc){var cc=sa[':fb:chat:conversation:message'].render();cc.setAttribute('title',rb(bc.timestamp));if(bc.subject){var dc=sa[':fb:chat:conversation:message:subject'].render();s.setContent(dc,bc.subject);s.appendContent(cc,dc);}function ec(kc){return u.span({'data-measureme':"1"},kc);}if(bc.is_filtered_content){var fc=pa[':fb:mercury:filtered-message'].build();s.appendContent(cc,ec(fc.getRoot()));return cc;}if(bc.body.substr(0,4)=='?OTR'){s.setContent(cc,ec("[encrypted message]"));q.addClass(cc,"_542c");}else{q.addClass(cc,fb(bc.body)?'direction_rtl':'direction_ltr');var gc=ka.formatMessageBody(bc.body);s.appendContent(cc,ec(gc));}if(bc.has_attachment){var hc=u.div(null),ic=this._appendMessageAttachments(hc,bc);if(!bc.body&&!ic)return hc;s.appendContent(cc,za(hc.childNodes));}if(bc.forward_count)s.appendContent(cc,xb(bc));if(bc.is_spoof_warning){var jc=sa[':fb:chat:conversation:message:undertext'].build();s.appendContent(jc.getNode('message'),cc);ma.get(bc.author,function(kc){fa.renderChatSpoofWarning(jc.getNode('status'),bc.is_spoof_warning,kc);});return jc.getRoot();}return cc;},_appendMessageAttachments:function(bc,cc){var dc=0,ec=cc.attachments;ec.sort(k.booleanLexicographicComparator([k.isPhotoAttachment,k.isShareAttachment,k.isFileAttachment,k.isErrorAttachment]));if(cc.raw_attachments&&cc.raw_attachments.length>0)ec=j.convertRaw(cc.raw_attachments);if(cc.attachments.length===0&&cc.preview_attachments&&cc.preview_attachments.length>0)cb(ec,cc.preview_attachments);var fc=k.renderPhotoAttachments(ec.filter(k.isPhotoAttachment),cc,176,4);if(fc)s.appendContent(bc,u.div({className:"_55pl"},fc));for(var gc=0;gc<ec.length;gc++){if(k.isPhotoAttachment(ec[gc])){dc=1;continue;}var hc=k.renderAttachment(true,ec[gc],cc);hc.error&&s.appendContent(bc,hc.error);hc.content&&s.appendContent(bc,hc.content);dc|=hc.bubblePreferred;}var ic=s.scry(bc,'img');ic.forEach(function(jc){this._subscriptions.addSubscriptions(t.listen(jc,'load',hb(this._thumbLoaded,this,jc)));}.bind(this));return !!dc;},_thumbLoaded:function(bc){var cc=this.scrollContainer.scrollTop+this.scrollContainer.clientHeight;if(cc+bc.offsetHeight>=this.scrollContainer.scrollHeight)this.scrollToBottom();},_checkToAnimateSticker:function(){var bc=eb(this.scrollContainer);h.inform('chatScrolled/'+this.threadID,{scrollTop:this.scrollContainer.scrollTop,top:bc.y,viewHeight:bc.height});},setNewThreadID:function(bc){this._newThreadID=bc;}});ta.subscribe('messages-reordered',function(bc,cc){yb.forEach(function(dc){cc[dc.threadID]&&dc.rerender();});});ta.subscribe('messages-updated',function(bc,cc){yb.forEach(function(dc){cc[dc.threadID]&&dc.update(cc[dc.threadID]);});});ta.subscribe('messages-received',function(bc,cc){yb.forEach(function(dc){var ec=cc[dc.threadID];if(ec&&ec.length){dc._currentMessageCount+=ec.length;dc._appendNewMessages(ec);}if(dc._newThreadID){var fc=cc[dc._newThreadID];if(fc&&fc.length){dc._currentMessageCount+=fc.length;dc._appendNewMessages(fc);dc._newThreadID=null;}}});});h.subscribe(l.getArbiterType('chat_event'),function(bc,cc){if(ac(cc.obj)){var dc=(r.getID()==cc.obj.from)?cc.obj.to:cc.obj.from,ec=ha.getThreadIdForUser(dc),fc=yb.filter(function(ic){return ic.threadID===ec;});if(fc.length>0){var gc=fc[0],hc=ca.constructLogMessageObject(ba.CHAT_WEB,ec,aa.VIDEO_CALL,cc.obj);hc.author='fbid:'+cc.obj.from;gc._appendNewMessages([hc]);}}});function ac(bc){return (bc.event_name==='installing'||bc.event_name==='install_canceled');}e.exports=zb;});
__d("ChatPeopleSuggestionList.react",["ChatSidebarItem.react","fbt","React","ShortProfiles","PresenceStatus","cx"],function(a,b,c,d,e,f){var g=b('ChatSidebarItem.react'),h=b('fbt'),i=b('React'),j=b('ShortProfiles'),k=b('PresenceStatus'),l=b('cx'),m=i.createClass({displayName:'ChatPeopleSuggestionList',_renderPeopleList:function(){var n=[];this.props.uids.map(function(o){var p=j.getNow(o);if(p)n.push(i.DOM.li(null,g({isAdded:false,showEditButton:true,images:p.thumbSrc,name:p.name,status:k.get(o),onClick:this.props.onClick.bind(null,o)})));}.bind(this));return n;},render:function(){return (i.DOM.div(null,i.DOM.div({className:"_57zm"},i.DOM.span({className:"_57zn"},"SUGGESTIONS")),i.DOM.ul({className:"_56ym"},this._renderPeopleList())));}});e.exports=m;});
__d("MercuryPeopleSuggestions",["KeyedCallbackManager","MercuryServerDispatcher","OrderedFriendsList","ShortProfiles","arrayContains"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=b('MercuryServerDispatcher'),i=b('OrderedFriendsList'),j=b('ShortProfiles'),k=b('arrayContains'),l=new g(),m=6;function n(s){return s.sort().join(',');}function o(s,t){if(s.length<m){var u=i.getList();for(var v=0;v<u.length;v++)if(!(k(s,u[v])||k(t,u[v]))){s.push(u[v]);if(s.length>=m)break;}}return s;}function p(s){h.trySend('/ajax/chat/people_suggest.php',s);}function q(s,t,u){s=s.filter(function(w){return !k(t,w);});var v=o(s,t);j.getMulti(v,function(){u(v);});}var r={getPeopleSuggestions:function(s,t){if(s)if(s.length){var u=n(s),v=l.executeOrEnqueue(u,function(x){q(x,s,t);}),w=l.getUnavailableResources(v);if(w.length)p({query:u,size:m});return v;}else q([],[],t);return 0;},handleUpdate:function(s){if(s.query){var t=s.suggestions||"",u=t.length?t.split(','):[];l.setResource(s.query,u);}}};h.registerEndpoints({'/ajax/chat/people_suggest.php':{mode:h.IMMEDIATE,handler:r.handleUpdate}});e.exports=r;});
__d("ChatTabPeopleSuggestionView",["ChatPeopleSuggestionList.react","ChatQuietLinks","CSS","DOM","Event","MercuryPeopleSuggestions","MercuryIDs","React","ShortProfiles","Style","copyProperties"],function(a,b,c,d,e,f){var g=b('ChatPeopleSuggestionList.react'),h=b('ChatQuietLinks'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('MercuryPeopleSuggestions'),m=b('MercuryIDs'),n=b('React'),o=b('ShortProfiles'),p=b('Style'),q=b('copyProperties');function r(s,t,u){this.sheetController=s;this.viewNode=t;this.loadingIcon=u;this.addFriendsSheet=s.getAddFriendsTabSheet();this.mercuryTypeahead=this.addFriendsSheet&&this.addFriendsSheet._typeahead;this.typeaheadInput=this.mercuryTypeahead&&this.mercuryTypeahead._input;this.typeaheadView=this.mercuryTypeahead&&this.mercuryTypeahead.getTypeahead().getView();var v=this.showSuggestions.bind(this);if(this.typeaheadInput)k.listen(this.typeaheadInput,'focus',v);if(this.typeaheadView){this.typeaheadView.subscribe('reset',v);this.typeaheadView.subscribe('render',this.clearSuggestions.bind(this));}this.tokenizer=this.mercuryTypeahead&&this.mercuryTypeahead.getTokenizer();if(this.tokenizer)this.tokenizer.subscribe('removeToken',v);this.showSuggestions();}q(r.prototype,{addSelectedParticipant:function(s){var t=o.getNow(s);if(t&&this.tokenizer){this.tokenizer.addToken(this.tokenizer.createToken({uid:s,text:t.name}));this.showSuggestions();}},showSuggestions:function(){if(this.mercuryTypeahead){var s=this.mercuryTypeahead.getSelectedParticipantIDs();s=s.map(m.getUserIDFromParticipantID);j.empty(this.viewNode);i.show(this.loadingIcon);l.getPeopleSuggestions(s,function(t){var u=g({uids:t,onClick:this.addSelectedParticipant.bind(this)});i.hide(this.loadingIcon);n.renderComponent(u,this.viewNode);h.removeAllHrefs(this.viewNode);}.bind(this));}},clearSuggestions:function(){j.empty(this.viewNode);i.hide(this.loadingIcon);p.set(this.viewNode,'margin-top',0);},destroy:function(){this.clearSuggestions();}});e.exports=r;});
__d("MercuryTypeahead",["Event","ArbiterMixin","DOM","DOMDimensions","Input","Keys","MercuryTypeaheadTemplates","Tokenizer","Typeahead","TypeaheadCore","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('DOMDimensions'),k=b('Input'),l=b('Keys'),m=b('MercuryTypeaheadTemplates'),n=b('Tokenizer'),o=b('Typeahead'),p=b('TypeaheadCore'),q=b('copyProperties'),r=b('cx'),s=function(t,u){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeOrID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._heightPrev=null;this._dataSource=t;this._view=u;};q(s.prototype,h);q(s.prototype,{setPlaceholder:function(t){this._placeholder=t;return this;},setExcludedParticipantsFromThreadMeta:function(t){if(!t)return;if(!t.former_participants){this.setExcludedParticipants(t.participants);return;}var u=t.former_participants.filter(function(v){return v.is_friend===false;}).map(function(v){return v.id;});this.setExcludedParticipants(u.concat(t.participants));},setExcludedParticipants:function(t){this._exclusions=[];t.forEach(function(u){var v=u.indexOf(':');if(u.substr(0,v)=='fbid')this._exclusions.push(u.substr(v+1));}.bind(this));return this;},setViewNodeID:function(t){this._viewNodeOrID=t;},setViewNode:function(t){this._viewNodeOrID=t;},setFullWidthView:function(t){var u=i.create('div',{className:"_4ck uiTypeaheadView"});i.setContent(t,u);this.setViewNode(u);},setViewOption:function(t,u){this._viewOptions[t]=u;},addTokenizerBehavior:function(t){this._tokenizerBehaviors.push(t);},build:function(t){if(this._domElement)return;var u=m[':fb:mercury:tokenizer'].build(),v=m[':fb:mercury:typeahead'].build();this._domElement=u.getRoot();i.appendContent(this._domElement,v.getRoot());var w=v.getNode('textfield');k.setPlaceholder(w,this._placeholder);w.setAttribute('data-placeholder',this._placeholder);this._input=w;var x={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions},y={ctor:p,options:{setValueOnSelect:true}};this._typeahead=new o(this._dataSource,x,y,v.getRoot());this._typeahead.init();var z={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new n(this._domElement,this._typeahead);this._tokenizer.init(u.getNode('tokenarea'),'participants',[],z);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],this._tokensChanged.bind(this));this._tokenizer.subscribe('resize',function(){this.inform('resize');}.bind(this));g.listen(w,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));g.listen(this._domElement,'click',this.focus.bind(this));g.listen(w,'keydown',this.keydown.bind(this));this._heightPrev=j.getElementDimensions(this._domElement).height;},getElement:function(){return this._domElement;},getSelectedParticipantIDs:function(){var t=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(u){t.push('fbid:'+u);});return t;},getTokens:function(){var t=[];if(this._tokenizer)t=this._tokenizer.getTokens();return t;},getTokenizer:function(){return this._tokenizer;},keydown:function(event){if(this._tokenizer.inline&&event.keyCode==l.ESC){if(k.isEmpty(this._input)){var t=this._tokenizer.getLastToken();if(t&&t.isRemovable())this._tokenizer.removeToken(t);}else this._typeahead.getCore().reset();return false;}if(k.isEmpty(this._input)&&this._tokenizer.inline&&event.keyCode===l.RETURN)return this.inform('tokens-return');},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function(){return this._typeahead;},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions);},_tokensChanged:function(){this.inform('tokens-changed');}});e.exports=s;});
__d("MultiChatController",["Arbiter","AsyncSignal","copyProperties","Form","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncSignal'),i=b('copyProperties'),j=b('Form'),k=b('MercuryMessages').get(),l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get();function n(){}i(n,{subscribe:function(o,p){o.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(o,p);}.bind(this));},createGroupThreadFromChooserDialog:function(o,p){var q=j.serialize(o.getRoot()),r=JSON.parse(q.profileChooserItems),s=[];for(var t in r)if(r[t])s.push(t);var u=n.createThreadForFBIDs(s);l.subscribe('update-thread-ids',function(v,w){for(var x in w)if(w[x]==u)new h('/ajax/groups/chat/log',{group_id:p,message_id:x}).send();});o.hide();},createThreadForTokens:function(o){if(!o.length)return;var p;if(o.length==1){p='user:'+o[0].split(':')[1];}else p='root:'+k.generateNewClientMessageID(Date.now());m.createNewLocalThread(p,o);g.inform('chat/open-tab',{thread_id:p});return p;},createThreadForFBIDs:function(o){var p=[];for(var q=0;q<o.length;q++)p.push("fbid:"+o[q]);return n.createThreadForTokens(p);}});e.exports=n;});
__d("ChatAddFriendsTabSheet",["Arbiter","ArbiterMixin","ChatAddFriendsTabSheetRawRenderer","MercuryLogMessageType","MercurySourceType","MercuryMessages","MultiChatController","Style","MercuryThreads","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatAddFriendsTabSheetRawRenderer'),j=b('MercuryLogMessageType'),k=b('MercurySourceType'),l=b('MercuryMessages').get(),m=b('MultiChatController'),n=b('Style'),o=b('MercuryThreads').get(),p=b('copyProperties');function q(t,u,v){this._threadID=t;this._rootElement=u;this._sheetView=v;this._typeahead=null;}p(q.prototype,h,{render:function(){o.getThreadMeta(this._threadID,function(t){var u=t.is_canonical_user?r:s;this._typeahead=i.render(this,this._sheetView,this._rootElement,t,u.bind(null,t),o.isNewEmptyLocalThread(this._threadID));this._typeahead.subscribe('tokens-changed',function(){this.inform('chat/tokens-changed',{token_count:this._typeahead.getTokens().length});}.bind(this));this._typeahead.subscribe('resize',function(){this._sheetView.resize();}.bind(this));}.bind(this));},getParticipants:function(){if(!this._typeahead)return null;return this._typeahead.getSelectedParticipantIDs();},isPermanent:function(){return true;},getType:function(){return 'add_friends_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);},getHeight:function(){return n.get(this._rootElement,'height');}});function r(t,u){var v=t.participants;m.createThreadForTokens(v.concat(u));}function s(t,u){var v=t.thread_id;if(o.isEmptyLocalThread(v)){o.addParticipantsToThreadLocally(v,u);g.inform('chat/open-tab',{thread_id:v});}else{l.sendMessage(l.constructLogMessageObject(k.CHAT_WEB,v,j.SUBSCRIBE,{added_participants:u}));g.inform('chat/open-tab',{thread_id:v});}}e.exports=q;});
__d("ChatNameConversationTabSheetRawRenderer",["DOM","Event","Input","Keys","ChatTabTemplates","fbt"],function(a,b,c,d,e,f){"use strict";var g=b('DOM'),h=b('Event'),i=b('Input'),j=b('Keys'),k=b('ChatTabTemplates'),l=b('fbt'),m={render:function(n,o,p,q,r,s){var t=k[':fb:mercury:chat:tab-sheet:name-conversation'].build(),u=t.getNode('nameInput'),v=t.getNode('doneButton'),w="Done",x="Hide",y=q.name;if(y){i.setValue(u,y);}else g.setContent(v,x);var z=function(){var aa=i.getValue(u);if(aa)r(aa);s();o.close(n);};h.listen(u,'input',function(){g.setContent(v,i.getValue(u).length===0?x:w);});h.listen(v,'click',z);h.listen(u,'keyup',function(aa){if(aa.keyCode===j.RETURN){z();return false;}});g.setContent(p,t.getRoot());!n.isAutomatic()&&u.focus();}};e.exports=m;});
__d("ChatNameConversationTabSheet",["AsyncRequest","ChatNameConversationTabSheetRawRenderer","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('ChatNameConversationTabSheetRawRenderer'),i=b('MercuryAPIArgsSource'),j=b('MercuryLogMessageType'),k=b('MercurySourceType'),l=b('MercuryMessages').get(),m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o='/ajax/chat/multichat/name_conversation/dismiss.php',p={};function q(r,s,t){"use strict";this.$ChatNameConversationTabSheet0=r;this.$ChatNameConversationTabSheet1=s;this.$ChatNameConversationTabSheet2=t;this.$ChatNameConversationTabSheet3=false;}q.prototype.render=function(){"use strict";n.getThreadMeta(this.$ChatNameConversationTabSheet0,function(r){h.render(this,this.$ChatNameConversationTabSheet2,this.$ChatNameConversationTabSheet1,r,this.$ChatNameConversationTabSheet4.bind(null,r),this.$ChatNameConversationTabSheet5.bind(this,r));this.$ChatNameConversationTabSheet2.resize();}.bind(this));};q.prototype.isPermanent=function(){"use strict";return true;};q.prototype.getType=function(){"use strict";return 'name_conversation_type';};q.prototype.open=function(r){"use strict";this.$ChatNameConversationTabSheet3=r;if(!(this.$ChatNameConversationTabSheet3&&this.$ChatNameConversationTabSheet6()))this.$ChatNameConversationTabSheet2.open(this);};q.prototype.close=function(){"use strict";this.$ChatNameConversationTabSheet2.close(this);};q.prototype.isAutomatic=function(){"use strict";return this.$ChatNameConversationTabSheet3;};q.prototype.$ChatNameConversationTabSheet6=function(){"use strict";return !!p[this.$ChatNameConversationTabSheet0];};q.prototype.$ChatNameConversationTabSheet7=function(){"use strict";p[this.$ChatNameConversationTabSheet0]=true;};q.prototype.$ChatNameConversationTabSheet5=function(r){"use strict";if(!r.name_conversation_sheet_dismissed||!this.$ChatNameConversationTabSheet6()){this.$ChatNameConversationTabSheet7();m.getServerThreadID(r.thread_id,function(s){new g(o).setData({thread_id:s}).send();});}};q.prototype.$ChatNameConversationTabSheet4=function(r,s){"use strict";var t=r.name;if((s||t)&&(s!=t))l.sendMessage(l.constructLogMessageObject(k.CHAT_WEB,r.thread_id,j.THREAD_NAME,{name:s}),null,i.CHAT);};e.exports=q;});
__d("ChatNewMessagesTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('ChatTabTemplates'),k=b('copyProperties');function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:clickable-message-icon-sheet'].build();i.setContent(m.getNode('text'),i.tx._("Scroll down to see new messages."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getRoot(),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return true;},getType:function(){return 'new_messages_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;});
__d("ChatNoRecipientsTabSheet",["DOM","fbt","MercuryParticipants","ChatTabTemplates","MercuryThreadInformer","MercuryThreads","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('fbt'),i=b('MercuryParticipants'),j=b('ChatTabTemplates'),k=b('MercuryThreadInformer').get(),l=b('MercuryThreads').get(),m=b('copyProperties');function n(o,p,q){this._threadID=o;this._rootElement=p;this._sheetView=q;k.subscribe('threads-updated',this._handleThreadsUpdated.bind(this));}m(n.prototype,{render:function(){var o=j[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(o.getNode('text'),"Everyone has left the conversation.");g.setContent(this._rootElement,o.getRoot());},isPermanent:function(){return true;},getType:function(){return 'no_recipients_type';},_handleThreadsUpdated:function(){l.getThreadMeta(this._threadID,function(o){var p=i.user,q=o.participants.filter(function(r){return r!=p;});if(q.length<1&&!o.is_joinable&&!l.isNewEmptyLocalThread(this._threadID)){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));}});e.exports=n;});
__d("ChatOfflineTabSheet",["ChatPrivacyActionController","ChatVisibility","CSS","DOM","Event","JSLogger","MercuryParticipants","MercuryThreads","ChatTabTemplates","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('ChatPrivacyActionController'),h=b('ChatVisibility'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('JSLogger'),m=b('MercuryParticipants'),n=b('MercuryThreads').get(),o=b('ChatTabTemplates'),p=b('copyProperties'),q=b('cx');function r(s,t,u){this._rootElement=t;this._sheetView=u;this._logger=l.create('blackbird');this._canonicalUser=n.getCanonicalUserInThread(s);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}p(r.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('offline_sheet_open_with_non_friend');return;}var s=o[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),t='fbid:'+this._canonicalUser;m.get(t,function(u){var v='fbChatGoOnlineLink',w=j.tx._("turn on chat"),x=j.create('a',{href:'#',className:v},w),y=j.tx._("To chat with {name} and other friends, {link}.",{name:u.short_name,link:x});j.setContent(s.getNode('text'),y);i.addClass(s.getRoot(),"_1sk1");j.setContent(this._rootElement,s.getRoot());k.listen(this._rootElement,'click',function(event){if(i.hasClass(event.getTarget(),v)){if(h.isOnline())this._logger.error('tab_sheet_already_online');this._privacyActionController.togglePrivacy();this._logger.log('tab_sheet_go_online',{tab_id:this._canonicalUser});return false;}}.bind(this));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(s){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(s){case g.OFFLINE:this._sheetView.open(this);break;case g.NORMAL:case g.BLOCKED:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'offline_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=r;});
__d("ChatUploadWarningTabSheet",["DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ChatTabTemplates'),i=b('copyProperties');function j(k,l,m){this._threadID=k;this._rootElement=l;this._sheetView=m;}i(j.prototype,{render:function(){var k=h[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(k.getNode('text'),g.tx._("Please wait until the upload is complete before you send your message."));g.setContent(this._rootElement,k.getRoot());},isPermanent:function(){return false;},getType:function(){return 'upload_warning_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=j;});
__d("ChatThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('ChatTabTemplates'),k=b('copyProperties');function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:message-mute-sheet'].build();i.setContent(m.getNode('text'),i.tx._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getNode('unmuteButton'),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return false;},getType:function(){return 'chat-thread-is-muted';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;});
__d("ChatUserBlockedTabSheet",["ChatPrivacyActionController","CSS","DOM","Event","GenderConst","JSLogger","MercuryParticipants","MercuryThreads","ChatTabTemplates","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('ChatPrivacyActionController'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('GenderConst'),l=b('JSLogger'),m=b('MercuryParticipants'),n=b('MercuryThreads').get(),o=b('ChatTabTemplates'),p=b('copyProperties'),q=b('cx'),r=b('tx');function s(t,u,v){this._rootElement=u;this._sheetView=v;this._logger=l.create('blackbird');this._canonicalUser=n.getCanonicalUserInThread(t);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}p(s.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('user_blocked_sheet_open_with_non_friend');return;}var t=o[':fb:mercury:chat:tab-sheet:user-blocked'].build(),u='fbid:'+this._canonicalUser;m.get(u,function(v){var w=null;switch(v.gender){case k.FEMALE_SINGULAR:case k.FEMALE_SINGULAR_GUESS:w=r._("You turned off chat for {name} but you can still send her a message. ",{name:v.short_name});break;case k.MALE_SINGULAR:case k.MALE_SINGULAR_GUESS:w=r._("You turned off chat for {name} but you can still send him a message. ",{name:v.short_name});break;default:w=r._("You turned off chat for {name} but you can still send them a message. ",{name:v.short_name});}i.setContent(t.getNode('text'),w);var x=r._("Turn on chat for {name}?",{name:v.short_name});i.setContent(t.getNode('actionLink'),x);h.addClass(t.getRoot(),"_1sk0");i.setContent(this._rootElement,t.getRoot());j.listen(t.getNode('actionLink'),'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(t){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(t){case g.BLOCKED:this._sheetView.open(this);break;case g.NORMAL:case g.OFFLINE:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'user_blocked_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=s;});
__d("JoinStatusTabSheet",["DOM","MercuryLogMessageType","MercuryParticipants","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryLogMessageType'),i=b('MercuryParticipants'),j=b('copyProperties'),k=b('setTimeoutAcrossTransitions');function l(m,n){this._rootElement=m;this._messageQueue=[];this._sheetView=n;}j(l.prototype,{_setMessage:function(m,n){var o=m.author,p=m.log_message_type;if(p==h.JOINABLE_JOINED){var q=m.log_message_data.joined_participant;if(q!==i.user)i.get(q,function(t){g.setContent(n,g.tx._("{actor} joined the chat.",{actor:t.name}));});}else if(p==h.UNSUBSCRIBE){if(o!==i.user)i.get(o,function(t){g.setContent(n,g.tx._("{actor} left the conversation.",{actor:t.name}));});}else if(p==h.SUBSCRIBE)if(o!==i.user){var r=m.log_message_data.added_participants;if(r&&r.length>0){var s=[o,r[0]];i.getMulti(s,function(t){g.setContent(n,g.tx._("{actor} added {subscriber1}.",{actor:t[o].name,subscriber1:t[r[0]].name}));});}}},isPermanent:function(){return false;},getCloseTimeout:function(){return 3000;},getType:function(){return 'join_status_type';},addToQueue:function(m){this._messageQueue.push(m);if(this._messageQueue.length===1)this._open();},render:function(){var m=this._messageQueue[0],n=this._getTemplate().build();this._setMessage(m,n.getNode('text'));g.setContent(this._rootElement,n.getRoot());},_open:function(){this._sheetView.open(this);},autoCloseCallback:function(){this._messageQueue.shift();if(this._messageQueue.length>0)this._open();},couldNotReplace:function(){k(this._open.bind(this),this.getCloseTimeout());}});e.exports=l;});
__d("ChatUserJoinStatusTabSheet",["JoinStatusTabSheet","ChatTabTemplates"],function(a,b,c,d,e,f){var g=b('JoinStatusTabSheet'),h=b('ChatTabTemplates');for(var i in g)if(g.hasOwnProperty(i))k[i]=g[i];var j=g===null?null:g.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=g;function k(){"use strict";if(g!==null)g.apply(this,arguments);}k.prototype._getTemplate=function(){"use strict";return h[':fb:mercury:chat:tab-sheet:message-icon-sheet'];};e.exports=k;});
__d("MercurySheetView",["Animation","ArbiterMixin","MercurySheetPolicy","CSS","DOM","Style","MercurySheetTemplates","Vector","copyProperties","cx","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('ArbiterMixin'),i=b('MercurySheetPolicy'),j=b('CSS'),k=b('DOM'),l=b('Style'),m=b('MercurySheetTemplates'),n=b('Vector'),o=b('copyProperties'),p=b('cx'),q=b('setTimeoutAcrossTransitions'),r=5000,s=function(t,u,v){this._threadID=t;this._rootElement=u;this._tabMainElement=v;this._openSheet=null;};o(s.prototype,h,{destroy:function(){k.empty(this._rootElement);},_openCommon:function(t,u){if(this._openSheet&&!i.canReplaceOpenSheet(this._openSheet,t)){if(t.couldNotReplace)t.couldNotReplace();return;}this.clear(function(){this._openSheet=t;var v=m[':fb:mercury:tab-sheet:loading'].build().getRoot();k.setContent(this._rootElement,v);j.show(v);j.show(this._rootElement);t.render();if(u){j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var w=n.getElementDimensions(this._rootElement).y;l.set(this._rootElement,'bottom',w+'px');this.resize();this._animation=new g(this._rootElement).to('bottom',0).duration(150).ease(g.ease.both).ondone(function(){j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this.resize();}.bind(this)).go();}else this.resize();if(!t.isPermanent()){var x=r;if(t.getCloseTimeout)x=t.getCloseTimeout();var y=this.getAutoCloseCallback(t);this._sheetCloseHandler=q(this.close.bind(this,t,y),x);if(t.timeoutCanBeReset)t.setResetTimeoutCallback(this.resetTimeout.bind(this));}}.bind(this));},getAutoCloseCallback:function(t){if(!t.autoCloseCallback)return null;return t.autoCloseCallback.bind(t);},resetTimeout:function(t,u){clearTimeout(this._sheetCloseHandler);var v=this.getAutoCloseCallback(t);this._sheetCloseHandler=q(this.close.bind(this,t,v),u);},set:function(t){return this._openCommon(t,false);},open:function(t){return this._openCommon(t,true);},close:function(t,u){if(this._openSheet!=t)return;if(!this._openSheet){u&&u();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var v=n.getElementDimensions(this._rootElement).y;this.resize();this._animation=new g(this._rootElement).to('bottom',v+'px').duration(100).ease(g.ease.begin).ondone(function(){k.empty(this._rootElement);j.hide(this._rootElement);j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this._openSheet=null;this.resize();u&&u();}.bind(this)).go();},clear:function(t){this.close(this._openSheet,t);},resize:function(){this.inform('resize');}});e.exports=s;});
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatNameConversationTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatUploadWarningTabSheet","ChatThreadIsMutedTabSheet","ChatUserBlockedTabSheet","ChatUserJoinStatusTabSheet","copyProperties","MercurySheetView","MercuryThreads"],function(a,b,c,d,e,f){var g=b('ChatAddFriendsTabSheet'),h=b('ChatNameConversationTabSheet'),i=b('ChatNewMessagesTabSheet'),j=b('ChatNoRecipientsTabSheet'),k=b('ChatOfflineTabSheet'),l=b('ChatUploadWarningTabSheet'),m=b('ChatThreadIsMutedTabSheet'),n=b('ChatUserBlockedTabSheet'),o=b('ChatUserJoinStatusTabSheet'),p=b('copyProperties'),q=b('MercurySheetView'),r=b('MercuryThreads').get(),s=function(t,u,v){this._sheetView=new q(t,u,v);this._addFriendsTabSheet=new g(t,u,this._sheetView);this._nameConversationTabSheet=new h(t,u,this._sheetView);this._userBlockedTabSheet=new n(t,u,this._sheetView);this._offlineTabSheet=new k(t,u,this._sheetView);this._newMessagesTabSheet=new i(t,u,this._sheetView);this._uploadWarningTabSheet=new l(t,u,this._sheetView);this._threadIsMutedTabSheet=new m(t,u,this._sheetView);this._userJoinStatusTabSheet=new o(u,this._sheetView);if(!r.getCanonicalUserInThread(t))this._noRecipientsTabSheet=new j(t,u,this._sheetView);};p(s.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},openUserJoinStatusSheet:function(t){this._userJoinStatusTabSheet.addToQueue(t);},getAddFriendsTabSheet:function(){return this._addFriendsTabSheet;},getAddFriendsParticipants:function(){var t=this._addFriendsTabSheet.getParticipants();this._addFriendsTabSheet.close();return t;},openNameConversationSheet:function(t){this._nameConversationTabSheet.open(t);},openNewMessagesSheet:function(){this._newMessagesTabSheet.open();},openUploadWarningTabSheet:function(){this._uploadWarningTabSheet.open();},openThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.open();},closeAutomaticNameConversationSheet:function(){if(this._nameConversationTabSheet.isAutomatic())this._nameConversationTabSheet.close();},closeThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.close();},closeNewMessagesSheet:function(){this._newMessagesTabSheet.close();},closeUploadWarningTabSheet:function(){this._uploadWarningTabSheet.close();},onClickNewMessagesSheet:function(t){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',t);},onClickThreadIsMutedSheet:function(t){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',t);},onResize:function(t){this._sheetView.subscribe('resize',t);},onTokensChanged:function(t){this._addFriendsTabSheet.subscribe('chat/tokens-changed',t);},destroy:function(){this._sheetView&&this._sheetView.destroy();this._offlineTabSheet&&this._offlineTabSheet.destroy();this._userBlockedTabSheet&&this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();}});e.exports=s;});
__d("MercuryFileUploader",["ArbiterMixin","CSS","Dialog","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","MercuryAttachment","MercuryAttachmentTemplates","MercuryConstants","PhotosUploadID","SubscriptionsHandler","csx","fbt","getObjectValues","mixin","shield","startsWith","tx"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('CSS'),i=b('Dialog'),j=b('DOM'),k=b('Event'),l=b('FileForm'),m=b('FileFormResetOnSubmit'),n=b('FileInput'),o=b('FormSubmitOnChange'),p=b('MercuryAttachment'),q=b('MercuryAttachmentTemplates'),r=b('MercuryConstants'),s=b('PhotosUploadID'),t=b('SubscriptionsHandler'),u=b('csx'),v=b('fbt'),w=b('getObjectValues'),x=b('mixin'),y=b('shield'),z=b('startsWith'),aa=b('tx'),ba=x(g);for(var ca in ba)if(ba.hasOwnProperty(ca))ea[ca]=ba[ca];var da=ba===null?null:ba.prototype;ea.prototype=Object.create(da);ea.prototype.constructor=ea;ea.__superConstructor__=ba;function ea(ga,ha,ia,ja){"use strict";this.$MercuryFileUploader0=ga;this.$MercuryFileUploader1={};this.$MercuryFileUploader2={};this.$MercuryFileUploader3={};this.$MercuryFileUploader4={};this.$MercuryFileUploader5={};this.$MercuryFileUploader6=new t();this.$MercuryFileUploader7=new l(ha,[o,m]);this.$MercuryFileUploader7.setAllowCrossOrigin(true);this.$MercuryFileUploader7.setUploadInParallel(true);var ka=j.find(ha,"._4q60"),la=j.find(ka,"._4q61");new n(ka,la,ia);h.hide(this.$MercuryFileUploader0);this.$MercuryFileUploader6.addSubscriptions(this.$MercuryFileUploader7.subscribe('submit',function(){var ma={count:0,file_sizes:[]};if(ia.files){for(var na=0;na<ia.files.length;na++)if(ia.files[na].size>r.AttachmentMaxSize){this.$MercuryFileUploader7.abort();this.$MercuryFileUploader7.clear();new i().setTitle("The file you have selected is too large").setBody("The file you have selected is too large. The maximum size is 25MB.").setButtons(i.OK).setSemiModal(true).show();return false;}var oa={};for(var pa=0;pa<ia.files.length;pa++){var qa=this.$MercuryFileUploader8();this.$MercuryFileUploader9(qa,ia.files[pa].name);ma.count++;ma.file_sizes.push(ia.files[pa].size);oa[qa]=ia.files[pa];}this.$MercuryFileUploader7.setFiles(oa);}else{ja.value=this.$MercuryFileUploader8();this.$MercuryFileUploader9(ja.value,ia.value);ma.count=1;}this.inform('submit',ma);}.bind(this)),this.$MercuryFileUploader7.subscribe('success',this.$MercuryFileUploadera.bind(this)),this.$MercuryFileUploader7.subscribe('failure',this.$MercuryFileUploaderb.bind(this)),k.listen(la,'click',y(this.inform,this,'open')));}ea.prototype.isUploading=function(){"use strict";return !!Object.keys(this.$MercuryFileUploader3).length;};ea.prototype.addCachedAttachments=function(ga){"use strict";ga.forEach(function(ha){var ia=this.$MercuryFileUploader8();this.$MercuryFileUploader9(ia,ha.filename);this.$MercuryFileUploaderc(ia,ha);}.bind(this));};ea.prototype.addCachedImageFiles=function(ga){"use strict";var ha="Photo";ga.forEach(function(ia){var ja=this.$MercuryFileUploader8();this.$MercuryFileUploader9(ja,ha);this.$MercuryFileUploaderc(ja,{filename:ia,image_id:ia,filetype:'image/jpeg'});}.bind(this));};ea.prototype.getAttachments=function(){"use strict";return w(this.$MercuryFileUploader1);};ea.prototype.getImageFiles=function(){"use strict";return w(this.$MercuryFileUploader2);};ea.prototype.removeAttachments=function(){"use strict";w(this.$MercuryFileUploader4).forEach(function(ga){if(ga)j.remove(ga.getRoot());});this.$MercuryFileUploader1={};this.$MercuryFileUploader2={};this.$MercuryFileUploader4={};this.$MercuryFileUploader3={};this.$MercuryFileUploader5={};h.hide(this.$MercuryFileUploader0);this.inform('dom-updated');};ea.prototype.destroy=function(){"use strict";this.$MercuryFileUploader6&&this.$MercuryFileUploader6.release();this.$MercuryFileUploader7&&this.$MercuryFileUploader7.destroy();this.removeAttachments();};ea.prototype.$MercuryFileUploader9=function(ga,ha){"use strict";var ia=q[':fb:mercury:upload-file-row'].build();this.$MercuryFileUploader4[ga]=ia;this.$MercuryFileUploader3[ga]=true;this.$MercuryFileUploader5[ga]=Date.now();j.appendContent(ia.getNode('iconText'),fa(ha));k.listen(ia.getNode('closeFileUpload'),'click',this.$MercuryFileUploaderd.bind(this,ga));j.appendContent(this.$MercuryFileUploader0,ia.getRoot());h.show(this.$MercuryFileUploader0);this.inform('dom-updated');};ea.prototype.$MercuryFileUploaderd=function(ga,event){"use strict";if(this.$MercuryFileUploader3[ga]){this.inform('upload-canceled-during-upload');}else if(this.$MercuryFileUploader1[ga]||this.$MercuryFileUploader2[ga])this.inform('upload-canceled-after-uploaded');delete this.$MercuryFileUploader1[ga];delete this.$MercuryFileUploader2[ga];delete this.$MercuryFileUploader3[ga];delete this.$MercuryFileUploader5[ga];var ha=this.$MercuryFileUploader4[ga];delete this.$MercuryFileUploader4[ga];if(ha){j.remove(ha.getRoot());this.inform('dom-updated');}this.inform('upload-canceled');return false;};ea.prototype.$MercuryFileUploadere=function(ga,ha){"use strict";var ia=this.$MercuryFileUploader4[ga],ja=p.getAttachIconClassByMime(ha);h.addClass(ia.getNode('iconText'),ja);h.addClass(ia.getRoot(),'done');};ea.prototype.$MercuryFileUploaderc=function(ga,ha){"use strict";if(this.$MercuryFileUploader3[ga]){delete this.$MercuryFileUploader3[ga];if(ha.image_id){this.$MercuryFileUploader2[ga]=ha.image_id;}else this.$MercuryFileUploader1[ga]=ha;this.$MercuryFileUploadere(ga,ha.filetype);this.inform('one-upload-completed',{upload_time_ms:Date.now()-this.$MercuryFileUploader5[ga]});}if(!this.isUploading())this.inform('all-uploads-completed',{count:this.getAttachments().length});};ea.prototype.$MercuryFileUploadera=function(event,ga){"use strict";var ha=ga.response.getPayload(),ia;if(ga.upload){ia=ga.upload.getName();}else ia=ha.uploadID;this.$MercuryFileUploaderc(ia,ha.metadata[0]);};ea.prototype.$MercuryFileUploaderb=function(event,ga){"use strict";this.inform('one-upload-failed');};ea.prototype.$MercuryFileUploader8=function(){"use strict";return 'upload_'+s.getNewID();};function fa(ga){if(ga&&z(ga,'C:\\fakepath\\'))return ga.substring(12);return ga;}e.exports=ea;});
__d("MercuryThreadMuter",["AsyncDialog","AsyncRequest","CurrentUser","DOM","MercuryThreads"],function(a,b,c,d,e,f){var g=b('AsyncDialog'),h=b('AsyncRequest'),i=b('CurrentUser'),j=b('DOM'),k=b('MercuryThreads').get(),l={getUserIDEmail:function(){return i.getID()+'@facebook.com';},getThreadMuteSettingForUser:function(m){return m.mute_settings&&m.mute_settings[l.getUserIDEmail()];},isThreadMuted:function(m){return l.getThreadMuteSettingForUser(m)!==undefined;},showMuteChangeDialog:function(m){g.send(new h('/ajax/mercury/mute_thread_dialog.php'),function(n){n.subscribe('confirm',function(){this.hide();var o;j.scry(this.getRoot(),'input[type="radio"]').forEach(function(r){if(r.checked)o=r.value;});switch(o){case 'always':o=-1;break;case '1hour':o=3600;break;case '8am':var p=new Date(),q=new Date();q.setHours(8);q.setMinutes(0);q.setSeconds(0);if(q>p){o=q-p;}else o=q-p+(24*3600);o/=1000;break;default:o=0;}k.updateThreadMuteSetting(m,o);}.bind(n));});}};e.exports=l;});
__d("MessagesEmoticonView",["DOM","EmoticonsList","Event","Focus","InputSelection","Keys","Parent","SubscriptionsHandler","TextAreaControl","Toggler","copyProperties","endsWith","startsWith"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('EmoticonsList'),i=b('Event'),j=b('Focus'),k=b('InputSelection'),l=b('Keys'),m=b('Parent'),n=b('SubscriptionsHandler'),o=b('TextAreaControl'),p=b('Toggler'),q=b('copyProperties'),r=b('endsWith'),s=b('startsWith'),t=h.symbols;function u(w,x,y){var z=m.byClass(w,'emoticon');if(!z)return;var aa='emoticon_',ba=null;z.className.split(' ').forEach(function(ia){if(s(ia,aa))ba=ia.substring(aa.length);});if(!t[ba])return;var ca=o.getInstance(x),da=ca.getValue(),ea=t[ba],fa=da.substring(0,y.start),ga=da.substring(y.end);if(y.start>0&&!r(fa,' '))ea=' '+ea;if(!s(ga,' '))ea+=' ';var ha=fa+ea+ga;y.start+=ea.length;y.end=y.start;ca.setValue(ha);k.set(x,y.start,y.end);return true;}function v(w,x){var y={start:0,end:0};function z(){y=k.get(x);}var aa=g.find(w,'.uiToggleFlyout');this._subscriptions=new n();this._subscriptions.addSubscriptions(p.subscribe('show',function(ba,ca){if(ca.active&&g.contains(w,ca.active)){k.set(x,y.start,y.end);var da=g.scry(aa,'a.emoticon')[0];da&&j.setWithoutOutline(da);}}),i.listen(aa,'click',function(event){var ba=u(event.getTarget(),x,y);ba&&p.hide(w);}),i.listen(aa,'keyup',function(event){if(event.keyCode===l.ESC){p.hide(w);k.set(x,y.start,y.end);}}),i.listen(x,'keyup',z),i.listen(x,'click',z));}q(v.prototype,{destroy:function(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;}});q(v,{create:function(w,x){return new v(w,x);}});e.exports=v;});
__d("NubController",["ArbiterMixin","Dock","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('Dock'),i=b('copyProperties');function j(){}i(j.prototype,g,{init:function(k){this.el=k;h.registerNubController(k,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){h.hide(this.el);},show:function(){h.show(this.el);}});e.exports=j;});
__d("MessagesEmoticons.react",["Grid.react","React","cx","fbt"],function(a,b,c,d,e,f){var g=b('Grid.react'),h=b('React'),i=b('cx'),j=b('fbt'),k=g.GridItem,l={smile:"smile",frown:"frown",tongue:"tongue",grin:"grin",gasp:"gasp",wink:"wink",pacman:"pacman",grumpy:"grumpy",unsure:"unsure",cry:"cry",kiki:"kiki",glasses:"glasses",sunglasses:"sunglasses",heart:"heart",devil:"devil",angel:"angel",squint:"squint",confused:"confused",upset:"upset",colonthree:"colonthree",like:"like"},m=h.createClass({displayName:'MessagesEmoticons',getEmoticons:function(){var n=Object.keys(l).map(function(o){return (k(null,h.DOM.div({className:"panelCell"},h.DOM.a({'aria-label':l.emoticon,className:'emoticon emoticon_'+o}))));});return n;},render:function(){return (h.DOM.div({className:"emoticonsTable"},g({cols:7,alignv:"middle",alignh:"center",spacing:"pam"},this.getEmoticons())));}});e.exports=m;});
__d("DialogFitHeight",["CSS","DOM","Event","Style","SubscriptionsHandler","Vector","csx","cx","throttle"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Event'),j=b('Style'),k=b('SubscriptionsHandler'),l=b('Vector'),m=b('csx'),n=b('cx'),o=b('throttle'),p=450,q=100,r=67,s=67;function t(u){"use strict";this.$DialogFitHeight0=u;}t.prototype.enable=function(){"use strict";this.$DialogFitHeight1=new k();this.$DialogFitHeight1.addSubscriptions(this.$DialogFitHeight0.subscribe('beforeshow',this.$DialogFitHeight2.bind(this)),i.listen(window,'resize',o(this.$DialogFitHeight2.bind(this))));this.$DialogFitHeight3=h.find(this.$DialogFitHeight0.getRoot(),"._4-i2");g.addClass(this.$DialogFitHeight3,"_5pfh");this.$DialogFitHeight4=q;if(h.scry(this.$DialogFitHeight0.getRoot(),"._4-i0").length)this.$DialogFitHeight4+=r;if(h.scry(this.$DialogFitHeight0.getRoot(),"._5a8u").length)this.$DialogFitHeight4+=s;};t.prototype.disable=function(){"use strict";this.$DialogFitHeight1.release();this.$DialogFitHeight1=null;g.removeClass(this.$DialogFitHeight3,"_5pfh");};t.prototype.$DialogFitHeight2=function(){"use strict";var u=l.getViewportDimensions().y,v=u-this.$DialogFitHeight4;j.set(this.$DialogFitHeight3,'height',Math.max(p,v)+'px');this.$DialogFitHeight0.updatePosition();};e.exports=t;});
__d("StickerStoreHeader.react",["InlineBlock.react","React","Image.react","XUICloseButton.react","XUIText.react","cx","fbt","ix"],function(a,b,c,d,e,f){var g=b('InlineBlock.react'),h=b('React'),i=b('Image.react'),j=b('XUICloseButton.react'),k=b('XUIText.react'),l=b('cx'),m=b('fbt'),n=b('ix'),o=h.createClass({displayName:'StickerStoreHeader',render:function(){return (h.DOM.div({className:"_5r5i"},h.DOM.div({className:"_5r5f"},i({className:"_5r5j",src:n('/images/messaging/stickers/store/characters.png')}),g({alignv:"middle",height:192},h.DOM.div({className:"_5r5l ellipsis"},i({className:"_5r5n",src:n('/images/messaging/stickers/store/basket.png')}),"Sticker Store"),k({className:"_5r5m",size:"large"},"Find new stickers to send to friends."))),this.renderCloseButton()));},renderCloseButton:function(){if(this.props.isPermalink)return null;return (j({className:"layerCancel _5r5k"}));}});e.exports=o;});
__d("XStickerStateInitialDataControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/stickers\/state\/",{});});
__d("XStickerStatePackDataControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/stickers\/state\/pack\/",{pack_id:{type:"Int",required:true}});});
__d("XStickerStateStoreDataControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/stickers\/state\/store\/",{});});
__d("StickerState",["Arbiter","AsyncRequest","Deferred","XStickerStateInitialDataControllerURIBuilder","XStickerStatePackDataControllerURIBuilder","XStickerStateStoreDataControllerURIBuilder","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Deferred'),j=b('XStickerStateInitialDataControllerURIBuilder'),k=b('XStickerStatePackDataControllerURIBuilder'),l=b('XStickerStateStoreDataControllerURIBuilder'),m=b('copyProperties'),n={},o,p,q={},r=[],s=[],t={onTrayDataReady:function(z){!p&&u();p.addCallback(z);},onStoreDataReady:function(z){!o&&v();o.addCallback(z);},onPackDataReady:function(z,aa){!n[z]&&w(z);n[z].addCallback(aa);},getPacksInTray:function(){return r;},getPackIDsInTray:function(){return r.map(function(z){return z.id;});},getPacksInStore:function(){return s;},getPack:function(z){return q[z];},addPack:function(z){y(z);q[z.id].isPurchased=true;q[z.id].isInTray=true;r.unshift(q[z.id]);g.inform(this.PACKS_CHANGED);},removePack:function(z){r=r.filter(function(aa){return aa.id!==z;});q[z].isInTray=false;g.inform(this.PACKS_CHANGED);}};t.PACKS_CHANGED='StickerState/packsChanged';function u(){p=x(new j().getURI(),function(z){r=z.packs.map(function(aa){return y(aa);});});}function v(){o=x(new l().getURI(),function(z){s=z.packs.map(function(aa){return y(aa);});});}function w(z){n[z]=x(new k().setInt('pack_id',z).getURI(),function(aa){y(aa);});}function x(z,aa){var ba=new i();new h(z).setHandler(function(ca){aa(ca.payload);ba.succeed();}).send();return ba;}function y(z){var aa=z.id;if(!q[aa]){return (q[aa]=z);}else return m(q[aa],z);}e.exports=t;});
__d("XStickersAddPackControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/stickers\/addpack\/",{size:{type:"String"},pack_id:{type:"Int",required:true}});});
__d("XStickersRemovePackControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/stickers\/removepack\/",{size:{type:"String"},pack_id:{type:"Int",required:true}});});
__d("StickerStorePurchaseButton.react",["Arbiter","React","ReactPropTypes","StickerState","XUIButton.react","XStickersAddPackControllerURIBuilder","XStickersRemovePackControllerURIBuilder","cx","fbt"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('React'),i=b('ReactPropTypes'),j=b('StickerState'),k=b('XUIButton.react'),l=b('XStickersAddPackControllerURIBuilder'),m=b('XStickersRemovePackControllerURIBuilder'),n=b('cx'),o=b('fbt'),p=h.createClass({displayName:'StickerStorePurchaseButton',propTypes:{size:i.string,stickerPack:i.object.isRequired},getDefaultProps:function(){return {size:'medium'};},getInitialState:function(){return this.calculateState();},componentDidMount:function(){this.subscription=g.subscribe(j.PACKS_CHANGED,function(){this.isMounted()&&this.setState(this.calculateState());}.bind(this));},componentWillUnmount:function(){this.subscription&&g.unsubscribe(this.subscription);},render:function(){return (k({ajaxify:this.state.ajaxify.toString(),className:"_5r5d",href:"#",label:this.state.label,tooltip:this.state.tooltip,size:this.props.size,rel:"async-post",use:this.state.use}));},calculateState:function(){return {ajaxify:this.getAjaxify(),label:this.getLabel(),tooltip:this.getTooltip(),use:this.getUse()};},getAjaxify:function(){var q=this.props.stickerPack.isInTray?new m():new l();return (q.setInt('pack_id',this.props.stickerPack.id).setString('size',this.props.size).getURI());},getLabel:function(){if(this.props.stickerPack.isInTray){return ("Remove");}else if(this.props.stickerPack.isPurchased){return ("Add");}else return ("Free");},getTooltip:function(){if(!this.props.stickerPack.isInTray)return null;return ("Remove from your sticker packs.");},getUse:function(){return this.props.stickerPack.isInTray?'default':'special';}});e.exports=p;});
__d("BoundingDimensions",["PooledClass"],function(a,b,c,d,e,f){"use strict";var g=b('PooledClass'),h=g.twoArgumentPooler;function i(j,k){this.width=j;this.height=k;}i.getPooledFromElement=function(j){return i.getPooled(j.offsetWidth,j.offsetHeight);};g.addPoolingTo(i,h);e.exports=i;});
__d("Position",["PooledClass"],function(a,b,c,d,e,f){"use strict";var g=b('PooledClass'),h=g.twoArgumentPooler;function i(j,k){this.left=j;this.top=k;}g.addPoolingTo(i,h);e.exports=i;});
__d("Touchable",["BoundingDimensions","Position","TouchEventUtils","invariant","keyMirror"],function(a,b,c,d,e,f){"use strict";var g=b('BoundingDimensions'),h=b('Position'),i=b('TouchEventUtils'),j=b('invariant'),k=b('keyMirror'),l=k({NOT_RESPONDER:null,RESPONDER_INACTIVE_PRESS_IN:null,RESPONDER_INACTIVE_PRESS_OUT:null,RESPONDER_ACTIVE_PRESS_IN:null,RESPONDER_ACTIVE_PRESS_OUT:null,ERROR:null}),m={RESPONDER_ACTIVE_PRESS_OUT:true,RESPONDER_ACTIVE_PRESS_IN:true},n={RESPONDER_INACTIVE_PRESS_IN:true,RESPONDER_ACTIVE_PRESS_IN:true},o=k({DELAY:null,RESPONDER_GRANT:null,RESPONDER_RELEASE:null,RESPONDER_TERMINATED:null,ENTER_PRESS_RECT:null,LEAVE_PRESS_RECT:null}),p={NOT_RESPONDER:{DELAY:l.ERROR,RESPONDER_GRANT:l.RESPONDER_INACTIVE_PRESS_IN,RESPONDER_RELEASE:l.ERROR,RESPONDER_TERMINATED:l.ERROR,ENTER_PRESS_RECT:l.ERROR,LEAVE_PRESS_RECT:l.ERROR},RESPONDER_INACTIVE_PRESS_IN:{DELAY:l.RESPONDER_ACTIVE_PRESS_IN,RESPONDER_GRANT:l.ERROR,RESPONDER_RELEASE:l.NOT_RESPONDER,RESPONDER_TERMINATED:l.NOT_RESPONDER,ENTER_PRESS_RECT:l.RESPONDER_INACTIVE_PRESS_IN,LEAVE_PRESS_RECT:l.RESPONDER_INACTIVE_PRESS_OUT},RESPONDER_INACTIVE_PRESS_OUT:{DELAY:l.RESPONDER_ACTIVE_PRESS_OUT,RESPONDER_GRANT:l.ERROR,RESPONDER_RELEASE:l.NOT_RESPONDER,RESPONDER_TERMINATED:l.NOT_RESPONDER,ENTER_PRESS_RECT:l.RESPONDER_INACTIVE_PRESS_IN,LEAVE_PRESS_RECT:l.RESPONDER_INACTIVE_PRESS_OUT},RESPONDER_ACTIVE_PRESS_IN:{DELAY:l.ERROR,RESPONDER_GRANT:l.ERROR,RESPONDER_RELEASE:l.NOT_RESPONDER,RESPONDER_TERMINATED:l.NOT_RESPONDER,ENTER_PRESS_RECT:l.RESPONDER_ACTIVE_PRESS_IN,LEAVE_PRESS_RECT:l.RESPONDER_ACTIVE_PRESS_OUT},RESPONDER_ACTIVE_PRESS_OUT:{DELAY:l.ERROR,RESPONDER_GRANT:l.ERROR,RESPONDER_RELEASE:l.NOT_RESPONDER,RESPONDER_TERMINATED:l.NOT_RESPONDER,ENTER_PRESS_RECT:l.RESPONDER_ACTIVE_PRESS_IN,LEAVE_PRESS_RECT:l.RESPONDER_ACTIVE_PRESS_OUT},error:{DELAY:l.NOT_RESPONDER,RESPONDER_GRANT:l.RESPONDER_INACTIVE_PRESS_IN,RESPONDER_RELEASE:l.NOT_RESPONDER,RESPONDER_TERMINATED:l.NOT_RESPONDER,ENTER_PRESS_RECT:l.NOT_RESPONDER,LEAVE_PRESS_RECT:l.NOT_RESPONDER}},q=130,r=20,s={touchableResponderDidGrant:function(){if(!this.state)this.state={};this.state.touchState=l.NOT_RESPONDER;this._receiveSignal(o.RESPONDER_GRANT);this.timeout=window.setTimeout(this._onDelay,q);},touchableResponderDidRelease:function(){this._receiveSignal(o.RESPONDER_RELEASE);},touchableResponderDidTerminate:function(){this._receiveSignal(o.RESPONDER_TERMINATED);},touchableResponderDidMove:function(u){if(this.state.touchState===l.RESPONDER_INACTIVE_PRESS_IN)return;var v=this.state.globalPositionOnActivate,w=this.state.dimensionsOnActivate,x=this.props.pressExpandLeft||r,y=this.props.pressExpandRight||r,z=this.props.pressExpandTop||r,aa=this.props.pressExpandBottom||r,ba=i.extractSingleTouch(u),ca=ba&&ba.pageX,da=ba&&ba.pageY,ea=ca>v.left-x&&da>v.top-z&&ca<v.left+w.width+y&&da<v.top+w.height+aa;if(ea){this._receiveSignal(o.ENTER_PRESS_RECT);}else this._receiveSignal(o.LEAVE_PRESS_RECT);},_remeasureMetricsOnActivation:function(){var u=this.getHitRectNode?this.getHitRectNode():this.getDOMNode(),v=u.getBoundingClientRect(),w=window.pageXOffset,x=window.pageYOffset,y=v.left+w,z=v.top+x;this.state.globalPositionOnActivate&&h.release(this.state.globalPositionOnActivate);this.state.globalPositionOnActivate=h.getPooled(y,z);this.state.dimensionsOnActivate&&g.release(this.state.dimensionsOnActivate);this.state.dimensionsOnActivate=g.getPooled(v.width,v.height);},_onDelay:function(){this._receiveSignal(o.DELAY);},_receiveSignal:function(u){var v=this.state.touchState;j(p[v]&&p[v][u]);var w=p[v][u];j(w!==l.ERROR);if(v!==w){this._performSideEffectsForTransition(v,w,u);this.state.touchState=w;}},_performSideEffectsForTransition:function(u,v,w){var x=u===l.RESPONDER_ACTIVE_PRESS_IN,y=v===l.RESPONDER_ACTIVE_PRESS_IN;if(!m[u]&&m[v])this._remeasureMetricsOnActivation();if(y&&!x){this.activePressInTouchable&&this.activePressInTouchable();}else if(!y&&x)this.activePressOutTouchable&&this.activePressOutTouchable();if(n[u]&&w===o.RESPONDER_RELEASE)this.selectTouchable&&this.selectTouchable();this.timeout&&window.clearTimeout(this.timeout);this.timeout=null;}},t={mixin:s};e.exports=t;});
__d("XUIBlock",["ReactPropTypes","cx"],function(a,b,c,d,e,f){var g=b('ReactPropTypes'),h=b('cx'),i={propTypes:{background:g.oneOf(['base-wash','light-wash','white','highlight','transparent'])},getDefaultProps:function(){return {background:'transparent'};},getBackgroundClass:function(j){var k=((j.background==='base-wash'?"_4-u5":'')+(j.background==='light-wash'?' '+"_57d8":'')+(j.background==='white'?' '+"_4-u8":'')+(j.background==='highlight'?' '+"_4-u7":''));return k;}};e.exports=i;});
__d("XUICard.react",["React","Touchable","XUIBlock","cx","emptyFunction","joinClasses"],function(a,b,c,d,e,f){var g=b('React'),h=b('Touchable'),i=b('XUIBlock'),j=b('cx'),k=b('emptyFunction'),l=b('joinClasses'),m=g.createClass({displayName:'XUICard',propTypes:i.propTypes,getDefaultProps:i.getDefaultProps,render:function(){var p=l("_4-u2",i.getBackgroundClass(this.props));return this.transferPropsTo(g.DOM.div({className:p},this.props.children));}});m.Section=g.createClass({propTypes:i.propTypes,getDefaultProps:i.getDefaultProps,render:function(){var p=l("_4-u3",i.getBackgroundClass(this.props));return this.transferPropsTo(g.DOM.div({className:p},this.props.children));}});var n=m.Section;m.FullBleedSection=g.createClass({propTypes:i.propTypes,getDefaultProps:i.getDefaultProps,render:function(){return this.transferPropsTo(n({className:"_57u_"},this.props.children));}});var o=m.FullBleedSection;m.TouchSection=g.createClass({mixins:[h.mixin],propTypes:i.propTypes,getDefaultProps:i.getDefaultProps,getInitialState:function(){return {isHighlighted:false};},activePressInTouchable:function(){this.setState({isHighlighted:true});},activePressOutTouchable:function(){this.setState({isHighlighted:false});},selectTouchable:function(){this.activePressInTouchable();setTimeout(this.activePressOutTouchable,120);this.props.onTap&&this.props.onTap();},render:function(){var p=this.state.isHighlighted?this.props.highlightClassName:'',q=this.state.isHighlighted?this.props.highlightBackground:this.props.baseBackground;return this.transferPropsTo(n({className:p,background:q,onResponderGrant:this.touchableResponderDidGrant,onResponderMove:this.touchableResponderDidMove,onResponderRelease:this.touchableResponderDidRelease,onResponderTerminate:this.touchableResponderDidTerminate,onStartShouldSetResponder:k.thatReturnsTrue},this.props.children));}});m.PhotoSection=g.createClass({propTypes:i.propTypes,getDefaultProps:i.getDefaultProps,render:function(){return this.transferPropsTo(o({className:"_4-u4"},this.props.children));}});e.exports=m;});
__d("StickerStorePackDetail.react",["BanzaiLogger","ImageBlock.react","React","Image.react","ReactPropTypes","StickerState","StickerStorePurchaseButton.react","XUICard.react","XUIGrayText.react","XUISpinner.react","XUIText.react","cx","emptyFunction"],function(a,b,c,d,e,f){var g=b('BanzaiLogger'),h=b('ImageBlock.react'),i=b('React'),j=b('Image.react'),k=b('ReactPropTypes'),l=b('StickerState'),m=b('StickerStorePurchaseButton.react'),n=b('XUICard.react'),o=b('XUIGrayText.react'),p=b('XUISpinner.react'),q=b('XUIText.react'),r=b('cx'),s=b('emptyFunction'),t=i.createClass({displayName:'StickerStorePackDetail',propTypes:{packID:k.number.isRequired},getDefaultProps:function(){return {onDataReady:s};},getInitialState:function(){return {stickerPack:null};},componentDidMount:function(){l.onPackDataReady(this.props.packID,function(){this.isMounted()&&this.setState({stickerPack:l.getPack(this.props.packID)});this.props.onDataReady();}.bind(this));g.log('StickersLoggerConfig',{event:'open_pack_details',packid:this.props.packID});},render:function(){if(!this.state.stickerPack)return (i.DOM.div({className:"_5r5e"},p({size:"large"})));return (i.DOM.div({className:"pvm"},h({className:"_5ra6",spacing:"none"},j({className:"_5ra5 _5r5s",src:this.state.stickerPack.profileImage}),this.renderMetadata()),n({className:"pam _5ra7"},j({className:"_5ra8",src:this.state.stickerPack.previewImage}),this.renderCopyright())));},renderMetadata:function(){return (i.DOM.div({className:"mtm"},q({className:"_5raa",display:"block",weight:"bold"},this.state.stickerPack.name),i.DOM.div({className:"_5rac"},this.state.stickerPack.artist),i.DOM.div({className:"_5rab"},this.state.stickerPack.description),m({size:"large",stickerPack:this.state.stickerPack})));},renderCopyright:function(){return (i.DOM.div(null,this.state.stickerPack.copyrightLines.map(function(u){return (o({key:u,className:"_5ra9",display:"block"},u));})));}});e.exports=t;});
__d("FlexibleBlock.react",["LeftRight.react","React","cx","invariant","keyMirror","merge"],function(a,b,c,d,e,f){var g=b('LeftRight.react'),h=b('React'),i=b('cx'),j=b('invariant'),k=b('keyMirror'),l=b('merge'),m=k({left:true,right:true});function n(p){j(p.flex&&p.flex in o.FLEX);j(p.children&&p.children.length===2);}var o=h.createClass({displayName:'FlexibleBlock',render:function(){n(this.props);var p,q=this.props.children[0],r=this.props.children[1],s=this.props.flex==m.left,t=h.DOM.div({className:"_42ef"});if(s){t.props.children=[q];p=g.DIRECTION.right;}else{t.props.children=[r];p=g.DIRECTION.left;}var u=g({direction:p},s?t:this.props.children[0],s?this.props.children[1]:t);u.props=l(this.props,u.props);return u;}});o.FLEX=m;e.exports=o;});
__d("XStickerPackPermalinkControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/stickers\/{pack_id}\/",{pack_id:{type:"Int",required:true}});});
__d("StickerStorePack.react",["FlexibleBlock.react","LeftRight.react","Link.react","React","Image.react","ReactPropTypes","StickerStorePurchaseButton.react","XUIButton.react","XUICard.react","XUIText.react","XStickerPackPermalinkControllerURIBuilder","cx","fbt"],function(a,b,c,d,e,f){var g=b('FlexibleBlock.react'),h=b('LeftRight.react'),i=b('Link.react'),j=b('React'),k=b('Image.react'),l=b('ReactPropTypes'),m=b('StickerStorePurchaseButton.react'),n=b('XUIButton.react'),o=b('XUICard.react'),p=b('XUIText.react'),q=b('XStickerPackPermalinkControllerURIBuilder'),r=b('cx'),s=b('fbt'),t="Preview",u=j.createClass({displayName:'StickerStorePack',propTypes:{stickerPack:l.object.isRequired,onPackSelect:l.func},render:function(){return (o({className:"_5r9y"},i({className:"_5r5d",href:this.getPreviewURI(),onClick:this.onPreviewLinkClicked},this.renderPreviews()),g({className:"_5rah",flex:"left"},this.renderTitleAndArtist(),this.renderActionButtons())));},renderPreviews:function(){return (h(null,j.DOM.div({className:"_5rad"},k({className:"_5r5s",src:this.props.stickerPack.thumbnail||''})),j.DOM.div({className:"_5rae"},this.renderSmallPreviews())));},renderSmallPreviews:function(){return this.props.stickerPack.previews.map(function(v){return (j.DOM.div({key:v,className:"_5raf"},k({className:"_5rag",src:v})));});},renderTitleAndArtist:function(){return (j.DOM.div(null,p({className:"_5rai ellipsis",display:"block",weight:"bold"},this.props.stickerPack.name),j.DOM.div({className:"_5raj ellipsis"},this.props.stickerPack.artist,"   ")));},renderActionButtons:function(){return (j.DOM.div({className:"_5rr1"},n({className:"_5r5d",href:this.getPreviewURI(),label:t,onClick:this.onPreviewLinkClicked}),m({stickerPack:this.props.stickerPack})));},getPreviewURI:function(){return !!this.props.onPackSelect?'#':new q().setInt('pack_id',this.props.stickerPack.id).getURI();},onPreviewLinkClicked:function(){this.props.onPackSelect&&this.props.onPackSelect(this.props.stickerPack.id);}});e.exports=u;});
__d("StickerStorePackList.react",["React","StickerState","StickerStorePack.react","XUISpinner.react","cx","emptyFunction"],function(a,b,c,d,e,f){var g=b('React'),h=b('StickerState'),i=b('StickerStorePack.react'),j=b('XUISpinner.react'),k=b('cx'),l=b('emptyFunction'),m=g.createClass({displayName:'StickerStorePackList',getDefaultProps:function(){return {onDataReady:l};},getInitialState:function(){return {dataReady:false};},componentDidMount:function(){h.onStoreDataReady(function(){this.isMounted()&&this.setState({dataReady:true});this.props.onDataReady();}.bind(this));},render:function(){return (g.DOM.div({className:"clearfix _5r5r"},this.renderPacks()));},renderPacks:function(){if(!this.state.dataReady)return (g.DOM.div({className:"_5r5e"},j({size:"large"})));return h.getPacksInStore().map(function(n){return (i({key:n.id,stickerPack:n,onPackSelect:this.props.onPackSelect}));}.bind(this));}});e.exports=m;});
__d("StickerStore.react",["BanzaiLogger","LegacyScrollableArea.react","Link.react","React","Image.react","StickerStoreHeader.react","StickerStorePackDetail.react","StickerStorePackList.react","XUIDialogBody.react","XUIDialogTitle.react","XUIText.react","cx","fbt","ix"],function(a,b,c,d,e,f){var g=b('BanzaiLogger'),h=b('LegacyScrollableArea.react'),i=b('Link.react'),j=b('React'),k=b('Image.react'),l=b('StickerStoreHeader.react'),m=b('StickerStorePackDetail.react'),n=b('StickerStorePackList.react'),o=b('XUIDialogBody.react'),p=b('XUIDialogTitle.react'),q=b('XUIText.react'),r=b('cx'),s=b('fbt'),t=b('ix'),u=j.createClass({displayName:'StickerStore',getInitialState:function(){return {currentPackID:null};},componentDidMount:function(){this.props.shown&&this.logOpen();},componentWillReceiveProps:function(v){if(!this.props.shown&&v.shown)this.logOpen();if(this.props.shown&&!v.shown)this.logClose();},shouldComponentUpdate:function(v){return v.shown;},componentDidUpdate:function(){this.pokeScrollbar();},render:function(){return (o({className:"_5rq-"},this.renderHeader(),j.DOM.div({className:this.getContentClass()},h({fade:false,persistent:true,ref:"scrollableArea",shadow:true,width:688},this.renderContent()))));},renderHeader:function(){if(!this.state.currentPackID)return l(null);return (j.DOM.div({className:"_5r5i"},p({className:"_5r5g"},i({className:"_5r5c",onClick:this.packSelected.bind(null,null)},k({className:"_5r5t",src:t('/images/messaging/stickers/store/backarrow.png')}),q({className:"_5rq_",weight:"normal"},"Sticker Store")))));},renderContent:function(){if(!this.props.shown)return null;if(this.state.currentPackID)return (m({packID:this.state.currentPackID,onDataReady:this.pokeScrollbar}));return (n({onPackSelect:this.packSelected,onDataReady:this.pokeScrollbar}));},getContentClass:function(){return ((!this.state.currentPackID?"_5rzk":'')+(!!this.state.currentPackID?' '+"_5rzl":''));},packSelected:function(v){this.setState({currentPackID:v});},logOpen:function(){g.log('StickersLoggerConfig',{event:'open_store'});},logClose:function(){g.log('StickersLoggerConfig',{event:'close_store'});},pokeScrollbar:function(){this.refs.scrollableArea.getArea().poke();}});e.exports=u;});
__d("StickersFlyoutStoreButton.react",["DialogFitHeight","LayerFadeOnHide","React","Image.react","ReactLayeredComponentMixin","StickerStore.react","XUIDialog.react","requestAnimationFrame","cx","fbt","ix"],function(a,b,c,d,e,f){var g=b('DialogFitHeight'),h=b('LayerFadeOnHide'),i=b('React'),j=b('Image.react'),k=b('ReactLayeredComponentMixin'),l=b('StickerStore.react'),m=b('XUIDialog.react'),n=b('requestAnimationFrame'),o=b('cx'),p=b('fbt'),q=b('ix'),r=688,s="Sticker Store",t=i.createClass({displayName:'StickersFlyoutStoreButton',mixins:[k],getInitialState:function(){return {dialogShown:false};},renderLayers:function(){return {dialog:m({causalElementRef:"button",behaviors:{LayerFadeOnHide:h,DialogFitHeight:g},onToggle:this._onToggle,shown:this.state.dialogShown,width:r},l({shown:this.state.dialogShown}))};},_onToggle:function(u){n(this.setState.bind(this,{dialogShown:u},null));},_openStore:function(){this.setState({dialogShown:true});},render:function(){return (i.DOM.a({'aria-label':s,className:"_5r86 rfloat",'data-hover':"tooltip",onClick:this._openStore,ref:"button"},j({className:"_5r87",src:q('/images/messaging/stickers/selector/store.png')})));}});e.exports=t;});
__d("StickersFlyoutPackSelector.react",["Animation","React","Image.react","StickersFlyoutStoreButton.react","cx","ix"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('React'),i=b('Image.react'),j=b('StickersFlyoutStoreButton.react'),k=b('cx'),l=b('ix'),m=5,n=h.createClass({displayName:'StickersFlyoutPackSelector',_calculateNumPages:function(p){return Math.max(1,Math.ceil((p.length-1)/m));},getInitialState:function(){return {animating:false,selectedId:null,page:0,numPages:this._calculateNumPages(this.props.packs)};},componentWillReceiveProps:function(p){this.setState({numPages:this._calculateNumPages(p.packs),selectedId:p.selectedPackID||this.props.selectedId});},shouldComponentUpdate:function(p,q){return !q.animating;},_canGoPrev:function(){return this.state.page>0;},_canGoNext:function(){return this.state.page+1<this.state.numPages;},_setPage:function(p){if(this.state.animating)return;this.setState({animating:true,page:p});var q=this.refs.positioner.getDOMNode();new g(q).to('marginLeft',-q.childNodes[p].offsetLeft+'px').ondone(function(){this.setState({animating:false});}.bind(this)).duration(200).go();},_back:function(){this._canGoPrev()&&this._setPage(this.state.page-1);},_next:function(){this._canGoNext()&&this._setPage(this.state.page+1);},render:function(){var p=this.props.packs,q=this.props.onPackClick,r=[];p.forEach(function(x,y){r.push(o({key:x.id,onClick:function(){q&&q(x.id);this.setState({selectedId:x.id});}.bind(this),pack:x,selected:this.state.selectedId===x.id}));}.bind(this));var s=[],t=[];r.forEach(function(x,y){t.push(x);if(y>0&&(y%m===0||y===r.length-1)){s.push(h.DOM.div({className:"_5r81"},t));t=[];}});var u=(("_5r82")+(' '+"lfloat")+(!this._canGoPrev()?' '+"hidden_elem":'')),v=(("_5r83")+(' '+"rfloat")+(!this._canGoNext()?' '+"hidden_elem":'')),w;if(s.length>1)w=h.DOM.a({className:v,onClick:this._next},i({className:"_5r84",src:l('/images/messaging/stickers/selector/rightarrow.png')}));return (h.DOM.div({className:"_5r85"},j({ref:"store"}),h.DOM.a({className:u,onClick:this._back},i({className:"_5r84",src:l('/images/messaging/stickers/selector/leftarrow.png')})),w,h.DOM.div({className:"_5r88"},h.DOM.div({className:"_5r89",ref:"positioner"},s))));}}),o=h.createClass({displayName:'PackIcon',render:function(){var p=this.props.pack,q=(("_5r8a")+(this.props.selected?' '+"_5r8b":''));return (h.DOM.a({'aria-label':p.name,className:q,'data-id':p.id,'data-hover':"tooltip",onClick:function(){this.props.onClick&&this.props.onClick(p.id);}.bind(this),tabIndex:"0"},h.DOM.img({className:"_5r8c",src:p.icon}),h.DOM.img({className:"_5r8d",src:p.selectedIcon})));}});e.exports=n;});
__d("XStickerPackImagesControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/stickers\/{pack_id}\/images\/",{pack_id:{type:"Int",required:true}});});
__d("StickersFlyoutStickerSelector.react",["AsyncRequest","Grid.react","LegacyScrollableArea.react","ReactPropTypes","React","Sticker.react","XUISpinner.react","XStickerPackImagesControllerURIBuilder","cx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Grid.react'),i=b('LegacyScrollableArea.react'),j=b('ReactPropTypes'),k=b('React'),l=b('Sticker.react'),m=b('XUISpinner.react'),n=b('XStickerPackImagesControllerURIBuilder'),o=b('cx'),p=h.GridItem,q=148,r=256,s=52,t={},u=k.createClass({displayName:'StickersFlyoutStickerSelector',propTypes:{packID:j.number},getInitialState:function(){return {loading:false,stickers:[]};},componentDidMount:function(){this.requestStickers(this.props.packID);},componentWillReceiveProps:function(v){if(v.packID!==this.props.packID)this.requestStickers(v.packID);},getScaledDimensions:function(v,w){var x,y,z;if(w>v){z=s/w;x=v*z;y=w*z;}else{z=s/v;x=v*z;y=w*z;}return {height:Math.round(x),width:Math.round(y)};},requestStickers:function(v){if(!v)return;if(v in t){this.setState({stickers:t[v]});return;}new g().setURI(new n().setInt('pack_id',v).getURI()).setMethod("POST").setHandler(function(w){t[v]=w.payload;this.setState({loading:false,stickers:w.payload});}.bind(this)).send();this.setState({loading:true});},renderStickers:function(){var v=this.state.stickers.map(function(w){var x=this.getScaledDimensions(w.height,w.width);return (p({key:w.id},k.DOM.div({className:"_5r8h",'data-id':w.id},l({animationTrigger:"hover",className:"_5r8i",frameCount:w.frameCount,frameRate:w.frameRate||83,framesPerCol:w.framesPerCol,framesPerRow:w.framesPerRow,sourceHeight:x.height,sourceURI:w.sourceURI,sourceWidth:x.width,spriteURI:w.spriteURI,style:{cursor:'pointer'}}))));}.bind(this));return v;},render:function(){if(this.state.loading)return (m({className:"_5r8j"}));return (i({height:q,width:r,fade:true},k.DOM.div({className:"_5r8k"},h({cols:4,fixed:true},this.renderStickers()))));}});e.exports=u;});
__d("StickersFlyout.react",["Arbiter","BanzaiLogger","MessagesEmoticons.react","Parent","React","ReactPropTypes","StickersFlyoutPackSelector.react","StickersFlyoutStickerSelector.react","StickerState","SubscriptionsHandler","Toggler","cx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('BanzaiLogger'),i=b('MessagesEmoticons.react'),j=b('Parent'),k=b('React'),l=b('ReactPropTypes'),m=b('StickersFlyoutPackSelector.react'),n=b('StickersFlyoutStickerSelector.react'),o=b('StickerState'),p=b('SubscriptionsHandler'),q=b('Toggler'),r=b('cx'),s=k.createClass({displayName:'StickersFlyout',propTypes:{onStickerSelect:l.func.isRequired},getInitialState:function(){return {currentPackID:null,dataReady:false,showFlyout:false};},componentDidMount:function(){var t=j.byClass(this.getDOMNode(),'uiToggle');if(t){q.listen('show',t,function(){h.log('StickersLoggerConfig',{event:'open_tray'});this.setState({showFlyout:true});}.bind(this));}else this.setState({showFlyout:true});this.subscriptions=new p();this.subscriptions.addSubscriptions(g.subscribe(o.PACKS_CHANGED,this.packsUpdated));},componentDidUpdate:function(){if(!this.state.dataReady&&this.state.showFlyout)o.onTrayDataReady(function(){this.setState({currentPackID:this.state.currentPackID||o.getPacksInTray()[0].id,dataReady:true});}.bind(this));},componentWillUnmount:function(){this.subscriptions.release();},selectPack:function(t){this.setState({currentPackID:t});},loadPack:function(){if(this.state.currentPackID==='emoticons')return (k.DOM.div({className:"_5r8l",'data-id':this.state.currentPackID},i(null)));h.log('StickersLoggerConfig',{event:'select_pack',packid:this.state.currentPackID});return (k.DOM.div({className:"_5r8l",'data-id':this.state.currentPackID},n({packID:this.state.currentPackID})));},packsUpdated:function(){var t=o.getPackIDsInTray();if(t.indexOf(this.state.currentPackID)<0){this.setState({currentPackID:t[0]});return;}this.forceUpdate(null);},selectedSticker:function(event){var t=j.byClass(event.target,"_5r8h");if(t){this.props.onStickerSelect(t.getAttribute('data-id'));var u=j.byClass(this.getDOMNode(),'uiToggle');u&&q.hide(u);}},render:function(){if(!this.state.showFlyout)return k.DOM.div(null);return (k.DOM.div(null,k.DOM.div({className:"_5r8e"},m({onPackClick:this.selectPack,selectedPackID:this.state.currentPackID,packs:o.getPacksInTray()})),k.DOM.div({className:"_5r8m",onClick:this.selectedSticker},this.loadPack())));}});e.exports=s;});
__d("TypingDetectorController",["AsyncRequest","AvailableList","AvailableListConstants","ChannelConnection","ChatVisibility","Keys","PresencePrivacy","ShortProfiles","TypingDetector","copyProperties","emptyFunction","setTimeoutAcrossTransitions","shield"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('ChannelConnection'),k=b('ChatVisibility'),l=b('Keys'),m=b('PresencePrivacy'),n=b('ShortProfiles'),o=b('TypingDetector'),p=b('copyProperties'),q=b('emptyFunction'),r=b('setTimeoutAcrossTransitions'),s=b('shield');function t(v){if(!k.isOnline())return false;if(v){var w=n.getNow(v);return w&&w.type=="friend"&&m.allows(v);}return true;}function u(v,w,x,y,z){"use strict";this.userID=v;this.input=w;this.source=x;this.threadID=z;this.remoteState=o.INACTIVE;this.notifyTimer=null;y=y||{};this.notifyDelay=y.notifyDelay||this.notifyDelay;this._typingDetector=new o(w);this._typingDetector.init(y);this._typingDetector.subscribe('change',this._stateChange.bind(this));}u.prototype.setUserAndThread=function(v,w){"use strict";if(this.userID!==v||this.threadID!==w){this.resetState();this.userID=v;this.threadID=w;}};u.prototype.setIgnoreEnter=function(v){"use strict";var w=v?[l.RETURN]:[];this._typingDetector.setIgnoreKeys(w);};u.prototype.resetState=function(){"use strict";this.remoteState=u.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;};u.prototype._stateChange=function(v,w){"use strict";if(w!=o.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=r(s(this._notifyState,this,w),this.notifyDelay);}else this._notifyState(w,true);};u.prototype._notifyState=function(v,w){"use strict";if(!this.userID&&!this.threadID)return;var x=this.userID,y=t(x);if(y&&v!=this.remoteState){this.remoteState=v;if(j.disconnected())return;var z={typ:v,to:x,source:this.source,thread:this.threadID};new g().setHandler(this._onTypResponse.bind(this,x)).setErrorHandler(q).setData(z).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous',!w).send();}};u.prototype._onTypResponse=function(v,w){"use strict";var x=w.getPayload()||{};if(x.offline)h.set(v,i.OFFLINE,'typing_response');};p(u.prototype,{notifyDelay:1000});e.exports=u;});
__d("ChatTabView",["Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AsyncSignal","AvailableListConstants","ChatAutoSendPhotoUploader","ChatBehavior","ChatConfig","ChatContextualDialogController","ChatPhotoEditorContextualDialog","ChatPrivacyActionController","ChatQuietLinks","ChatShareLinkUploader","ChatTabMessagesView","ChatTabPeopleSuggestionView","ChatTabSheetController","ChatVisibility","MercuryConstants","CSS","CurrentLocale","Dialog","Dock","DOM","Event","Focus","Input","Keys","Locale","MercuryConfig","MercuryFileUploader","MercuryLogMessageType","MercuryParticipants","MercurySourceType","MercuryThreadMetadataRawRenderer","MercuryThreadMuter","MercuryTypingReceiver","MessagesEmoticonView","NubController","Parent","PhotosUploadWaterfall","PresencePrivacy","PresenceStatus","React","Run","StickersFlyout.react","Style","SubscriptionsHandler","ChatTabTemplates","TextAreaControl","Toggler","Tooltip","TypingDetectorController","URI","UserAgent","VideoCallCore","WaterfallIDGenerator","copyProperties","cx","fbt","isEmpty","setIntervalAcrossTransitions","tx","MercuryMessages","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f){"use strict";var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncDialog'),j=b('AsyncRequest'),k=b('AsyncSignal'),l=b('AvailableListConstants'),m=b('ChatAutoSendPhotoUploader'),n=b('ChatBehavior'),o=b('ChatConfig'),p=b('ChatContextualDialogController'),q=b('ChatPhotoEditorContextualDialog'),r=b('ChatPrivacyActionController'),s=b('ChatQuietLinks'),t=b('ChatShareLinkUploader'),u=b('ChatTabMessagesView'),v=b('ChatTabPeopleSuggestionView'),w=b('ChatTabSheetController'),x=b('ChatVisibility'),y=b('MercuryConstants'),z=b('CSS'),aa=b('CurrentLocale'),ba=b('Dialog'),ca=b('Dock'),da=b('DOM'),ea=b('Event'),fa=b('Focus'),ga=b('Input'),ha=b('Keys'),ia=b('Locale'),ja=b('MercuryConfig'),ka=b('MercuryFileUploader'),la=b('MercuryLogMessageType'),ma=b('MercuryParticipants'),na=b('MercurySourceType'),oa=b('MercuryThreadMetadataRawRenderer'),pa=b('MercuryThreadMuter'),qa=b('MercuryTypingReceiver'),ra=b('MessagesEmoticonView'),sa=b('NubController'),ta=b('Parent'),ua=b('PhotosUploadWaterfall'),va=b('PresencePrivacy'),wa=b('PresenceStatus'),xa=b('React'),ya=b('Run'),za=b('StickersFlyout.react'),ab=b('Style'),bb=b('SubscriptionsHandler'),cb=b('ChatTabTemplates'),db=b('TextAreaControl'),eb=b('Toggler'),fb=b('Tooltip'),gb=b('TypingDetectorController'),hb=b('URI'),ib=b('UserAgent'),jb=b('VideoCallCore'),kb=b('WaterfallIDGenerator'),lb=b('copyProperties'),mb=b('cx'),nb=b('fbt'),ob=b('isEmpty'),pb=b('setIntervalAcrossTransitions'),qb=b('tx'),rb=b('MercuryMessages').get(),sb=b('MercuryServerRequests').get(),tb=b('MercuryThreadInformer').get(),ub=b('MercuryThreadMetadataRenderer').get(),vb=b('MercuryThreads').get(),wb=/^\s*$/,xb={},yb=null,zb,ac=10;function bc(wc,xc){var yc=da.create('div');xc=xc.filter(function(bd){return bd!=ma.user;});if(!xc.length)return fb.remove(wc);var zc=xc.length,ad=zc-ac;if(ad>1)xc=xc.slice(0,ac);ma.getMulti(xc,function(bd){for(var cd in bd){var dd=bd[cd],ed=cb[':fb:mercury:chat:multichat-tooltip-item'].build();da.setContent(ed.getNode('name'),dd.name);var fd=ma.getUserID(cd),gd=fd&&wa.get(fd)==l.ACTIVE;z.conditionShow(ed.getNode('icon'),gd);z.conditionClass(ed.getNode('name'),'tooltipItemWithIcon',gd);da.appendContent(yc,ed.getRoot());}if(ad>1){var hd=nb._("and {number of hidden chat participants} more.",[nb.param("number of hidden chat participants",ad)]);da.appendContent(yc,da.create('div',{},hd));}fb.set(wc,yc,'above');});}var cc={},dc=null,ec=false;function fc(wc,xc,yc){if(yc){cc[wc]=xc;if(!dc)dc=pb(gc,600);}else{z.removeClass(xc,'highlightTitle');delete cc[wc];}}function gc(){for(var wc in cc){var xc=cc[wc];if(xc.parentNode){z.conditionClass(xc,'highlightTitle',ec);}else delete cc[wc];}ec=!ec;if(!Object.keys(cc).length){clearInterval(dc);dc=null;}}function hc(wc){var xc=sb.tokenizeThreadID(wc);switch(xc.type){case 'user':return cb[':fb:mercury:chat:user-tab'].build();}return cb[':fb:mercury:chat:multichat-tab'].build();}function ic(wc){var xc=wc._tabTemplate.getNode('input').value||'',yc=wc._fileUploader.getAttachments();if(oc(wc))kc(wc,xc,yc,function(zc){var ad=wc._fileUploader.getImageFiles();if(ad.length>0){zc.image_ids=ad;zc.has_attachment=true;}rb.sendMessage(zc);wc._fileUploader.removeAttachments();o.get('chat_tab_share_sheet')&&wc._shareLinkUploader.clear();wc._getNode('input').value='';wc._lastMessageIndicator&&wc._lastMessageIndicator.resetState();wc._messagesView&&wc._messagesView.scrollToBottom();});}function jc(wc,xc){if(xc===0)return;sc(wc,ua.POST_PUBLISHED,{count:xc});wc._waterfallID=kb.generate();}function kc(wc,xc,yc,zc){vb.getThreadMeta(wc._threadID,function(ad){var bd=rb.constructUserGeneratedMessageObject(xc,na.CHAT_WEB,wc._threadID);if(yc.length>0){bd.has_attachment=true;bd.raw_attachments=yc;}if(o.get('chat_tab_share_sheet')){var cd=wc._shareLinkUploader.getAttachData();if(cd){bd.has_attachment=true;bd.content_attachment=cd;}}if(vb.isNewEmptyLocalThread(wc._threadID)){var dd=wc._sheetController.getAddFriendsParticipants();if(dd===null||dd.length===0){return;}else if(dd.length===1){var ed='user:'+ma.getUserID(dd[0]);bd.thread_id=ed;}else vb.addParticipantsToThreadLocally(wc._threadID,dd);}if(vb.isEmptyLocalThread(wc._threadID)){var fd=sb.tokenizeThreadID(wc._threadID);bd.message_id=fd.value;bd.specific_to_list=ad.participants;}if(typeof bd!='undefined')bd.signatureID=wc._signatureID;bd.ui_push_phase=y.UIPushPhase;zc(bd);if(wc._threadID!==bd.thread_id&&!wc._photoUploader.isUploading()){tc.inform('closed-tab',wc._threadID);g.inform('chat/open-tab',{thread_id:bd.thread_id});}});}function lc(wc){wc._blocked=true;wc._sheetController.openUploadWarningTabSheet();}function mc(wc){return (wc._fileUploader.isUploading()||wc._photoUploader.isUploading());}function nc(wc){return wc._fileUploader.isUploading();}function oc(wc){var xc=wc._tabTemplate.getNode('input').value||'';if(!wb.test(xc))return true;if(wc._fileUploader.getAttachments().length>0||wc._fileUploader.getImageFiles().length>0)return true;if(o.get('chat_tab_share_sheet')&&wc._shareLinkUploader.getAttachData())return true;return false;}function pc(wc){if(wc._blocked){if(nc(wc))return;wc._blocked=false;ic(wc);wc._sheetController.closeUploadWarningTabSheet();}}function qc(wc){wc._nubController.flyoutContentChanged();wc._attachmentsDiv.scrollTop=wc._attachmentsDiv.scrollHeight;}function rc(wc,xc,yc){wc._subscriptionsHandler.addSubscriptions(wc._photoUploader.subscribe(xc,function(zc,ad){sc(wc,yc,ad);}));}function sc(wc,xc,yc){ua.sendSignal(lb({qn:wc._waterfallID,step:xc,uploader:ua.APP_CHAT},yc||{}));}function tc(wc,xc,yc){if(xc)sb.ensureThreadIsFetched(xc);this._threadID=wc;this._signatureID=yc;this._eventListeners=[];this._isDragDropActive=false;this._tabTemplate=hc(wc);this._tabElem=this._tabTemplate.getRoot();this._titlebar=this._getNode('nubFlyoutTitlebar');this._iconsContainerNode=this._getNode('iconsContainer');this._inputContainerNode=this._getNode('inputContainer');this._waterfallID=kb.generate();this._subscriptionsHandler=new bb();this._fileUploader=new ka(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('attachButtonForm'),this._tabTemplate.getNode('fileInput'),this._tabTemplate.getNode('attachID'));this._initializeUploader(this._fileUploader);this._initializeAutoSendPhotoUploader();this._attachmentsDiv=this._getNode('attachmentShelf');if(o.get('chat_tab_share_sheet')){this._shareLinkUploader=new t(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('input'));this._initializeUploader(this._shareLinkUploader);}this._sheetController=new w(this._threadID,this._getNode('sheet'),this._tabElem);this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();tc.inform('read',this._threadID);}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){vb.updateThreadMuteSetting(this._threadID,0);this.focus();}.bind(this));this._nubController=new sa().init(this._tabElem);this._sheetController.onResize(this._nubController.flyoutContentChanged.bind(this._nubController));this._sheetController.onTokensChanged(function(ld,md){vb.getThreadMeta(this._threadID,function(nd){this._updateInputContainers((nd.participants.length+md.token_count)>0);}.bind(this));}.bind(this));this._contextualDialogController=new p(this._threadID,this._getNode('videoCallLink'));if(yb===null)yb=!o.get('seen_autosend_photo_nux');this._messagesView=null;var zc=this._getNode('conversationLink');if(zc){z.hide(zc);ub.renderTitanLink(wc,zc,z.show.bind(z,zc));}if(!vb.getCanonicalUserInThread(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var ad=this._getCanonicalUserID(),bd=this._getNode('titlebarText'),cd=function(ld){bd.setAttribute('href',ld);bd.removeAttribute('rel');z.removeClass(bd,'noLink');};if(this._isTitleTextLinked())if(this._getCanonicalUserID()){ma.get(ma.getIDForUser(ad),function(ld){if(ld.href)cd(ld.href);});}else if(zc.href)cd(zc.href);var dd=this._inputContainerNode.clientHeight;db.getInstance(this._getNode('input')).subscribe('resize',function(){var ld=this._inputContainerNode.clientHeight;if(ld!=dd)this._nubController.flyoutContentChanged();dd=ld;}.bind(this));this._nubController.subscribe('resize',function(){this._resizeInputContainer();}.bind(this));var ed=o.get('chat_tab_height');if(ed){var fd=this._tabTemplate.getNode('chatWrapper');ab.set(fd,'height',ed+'px');}this._setNameConversationLink();this._listen('closeButton','click',this._closeClicked);this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('inputContainer','click',this._inputContainerClicked);this._listen('addFriendLink','click',this._addFriendLinkClicked,true);this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);this._listen('nameConversationLink','click',this._nameConversationLinkClicked,true);this._listen('clearWindowLink','click',this._clearHistory,true);this._listen('unsubscribeLink','click',this._unsubscribeLinkClicked,true);this._listen('videoCallLink','click',this._callClicked,true);this._listen('reportSpamLink','click',this._reportSpamClicked,true);this._listen('muteThreadLink','click',pa.showMuteChangeDialog.bind(null,this._threadID),true);this._listen('unmuteThreadLink','click',function(){vb.updateThreadMuteSetting(this._threadID,0);eb.hide();}.bind(this),true);this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===ha.TAB){this._getNode('input').focus();event.kill();}}.bind(this));var gd=this._getNode('emoticons');this._emoticonView=null;if(gd)this._emoticonView=new ra(gd,this._getNode('input'));var hd=this._getNode('stickers');if(hd)xa.renderComponent(za({onStickerSelect:function(ld){this._stickerSelected(ld);}.bind(this)}),hd);if(ib.firefox()&&aa.get()=='ko_KR'){this._listen('input','keyup',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._privacyLink=this._getNode('privacyLink');if(this._privacyLink){this._privacyActionController=new r(ad,this._updatePrivacyLink.bind(this));this._eventListeners.push(ea.listen(this._privacyLink,'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController)));}vb.getThreadMeta(this._threadID,function(ld){var md=ad||(o.get('chat_multi_typ_send')&&!ld.is_canonical);if(md)sb.getServerThreadID(this._threadID,function(od){this._lastMessageIndicator=new gb(ad,this._getNode('input'),'mercury-chat',null,od);}.bind(this));this._setUpMutingSettings(ld);if(ja.PicassoWebChatGK){var nd=this._tabTemplate.getNode('photoAttachmentMenu');new q(this._tabTemplate.getNode('photoAttachLink'),this._tabTemplate.getNode('editPhotoLink'),this._tabTemplate.getNode('newPhotoLink'),nd,this._threadID);}}.bind(this));var id=this._getNode('muteGroupLink');if(id){var jd=vb.getCanonicalGroupInThread(this._threadID);if(jd)id.setAttribute('ajaxify',hb(id.getAttribute('ajaxify')).addQueryData({id:jd}));}s.removeEmptyHrefs(this._tabElem);xb[wc]=this;this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);var kd={threadID:wc,userID:ad,signatureID:this._signatureID};new k('/ajax/chat/opentab_tracking.php',kd).send();ya.onBeforeUnload(function(){if(this._hasUnfinishedPost())return "You haven't sent your message yet. Do you want to leave without sending?";if(rb.getNumberLocalMessages(this._threadID))return "Your message is still being sent. Are you sure you want to leave?";return null;}.bind(this),false);ya.onUnload(function(){uc(this);}.bind(this));}function uc(wc){if(wc._photoUploader.isUploading())sc(wc,ua.CANCEL_DURING_UPLOAD);}function vc(){for(var wc in xb){xb[wc].updateAvailableStatus();xb[wc].updateMultichatTooltip();}}g.subscribe(['buddylist/availability-changed'],vc);va.subscribe(['privacy-changed','privacy-availability-changed'],vc);n.subscribe(n.ON_CHANGED,function(){for(var wc in xb)vb.getThreadMeta(wc,function(xc){xb[wc]._updateUnreadCount(xc);});});qa.addRetroactiveListener('state-changed',function(wc){for(var xc in wc){var yc=wc[xc]&&wc[xc].length,zc=xb[xc];zc&&zc.showTypingIndicator(yc);}});tb.subscribe('threads-updated',function(wc,xc){for(var yc in xb){var zc=xb[yc];xc[yc]&&zc.updateTab();if(zc._newThreadIDFromPhotoUpload&&!zc._photoUploader.isUploading()&&xc[zc._newThreadIDFromPhotoUpload]){tc.inform('closed-tab',zc._threadID);g.inform('chat/open-tab',{thread_id:zc._newThreadIDFromPhotoUpload});zc._newThreadIDFromPhotoUpload=null;}}});tb.subscribe('threads-deleted',function(wc,xc){for(var yc in xb)xc[yc]&&tc.inform('thread-deleted',yc);});lb(tc,h,{get:function(wc){return xb[wc];}});lb(tc.prototype,{getThreadID:function(){return this._threadID;},showAddFriend:function(){setTimeout((function(){this._sheetController.openAddFriendsSheet();}).bind(this),0);},showPeopleSuggestions:function(){setTimeout((function(){this._peopleSuggestions=new v(this._sheetController,this._getNode('conversation'),this._getNode('loadingIndicator'));}).bind(this),0);},showNameConversation:function(wc){setTimeout((function(){this._sheetController.openNameConversationSheet(wc);}).bind(this),0);},hideAutomaticNameConversation:function(){setTimeout((function(){this._sheetController.closeAutomaticNameConversationSheet();}).bind(this),0);},isVisible:function(){return z.shown(this._tabElem);},setVisibleState:function(wc,xc){var yc=z.shown(this._tabElem),zc=z.hasClass(this._tabElem,'opened');z.conditionShow(this._tabElem,wc);z.conditionClass(this._tabElem,'opened',xc);if(!(yc&&zc)&&wc&&xc){if(!this._messagesView)this._messagesView=new u(this._threadID,this._sheetController,this._getNode('chatConv'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this);this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(yc&&zc&&!(wc&&xc))this._contextualDialogController.tabNotActive();},focus:function(){var wc=z.hasClass(this._tabElem,'opened')?'input':'dockButton';this._getNode(wc).focus();},isFocused:function(){var wc=document.activeElement;return ta.byClass(wc,"_50mz")===this._tabElem;},hasEmptyInput:function(){return wb.test(this._getNode('input').value);},getInputElem:function(){return this._getNode('input');},setInput:function(wc){this._getNode('input').value=wc;},insertBefore:function(wc){da.insertBefore(wc._tabElem,this._tabElem);},appendTo:function(wc){da.appendContent(wc,this._tabElem);},nextTabIs:function(wc){var xc=wc&&wc._tabElem;return this._tabElem.nextSibling==xc;},getScrollTop:function(){return da.find(this._tabElem,'.scrollable').scrollTop;},setScrollTop:function(wc){da.find(this._tabElem,'.scrollable').scrollTop=wc;},destroy:function(){da.remove(this._tabElem);this._emoticonView&&this._emoticonView.destroy();while(this._eventListeners.length)this._eventListeners.pop().remove();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();this._fileUploader&&this._fileUploader.destroy();this._photoUploader&&this._photoUploader.destroy();this._subscriptionsHandler&&this._subscriptionsHandler.release();this._contextualDialogController&&this._contextualDialogController.destroy();this._privacyActionController&&this._privacyActionController.destroy();delete xb[this._threadID];ca.unregisterNubController(this._nubController);ga.reset(this._getNode('input'));},updateAvailableStatus:function(){vb.getThreadMeta(this._threadID,function(wc){var xc=l.OFFLINE,yc=this._getCanonicalUserID();if(yc){xc=wa.get(yc);}else{var zc=wc.participants.map(function(bd){return ma.getUserID(bd);});xc=wa.getGroup(zc);}if(!x.isOnline())xc=l.OFFLINE;if(yc)this._updateCallLink(xc);z.conditionClass(this._tabElem,"_5238",xc===l.ACTIVE);z.conditionClass(this._tabElem,"_5239",xc===l.MOBILE);var ad=this._getNode('presenceIndicator');switch(xc){case l.ACTIVE:ad.setAttribute('alt',"Online");break;case l.MOBILE:ad.setAttribute('alt',"Mobile");break;default:ad.removeAttribute('alt');break;}}.bind(this));},updateTab:function(){this._setNameConversationLink();vb.getThreadMeta(this._threadID,function(wc){this._updateInputContainers(!ob(wc.participants));if(!wc.is_subscribed){tc.inform('unsubscribed',this._threadID);return;}ub.renderAndSeparatedParticipantList(this._threadID,[this._getNode('name'),this._getNode('titlebarText')],{names_renderer:oa.renderShortNames,check_length:true});if(wc.is_joinable&&!o.get('joinable_conversation_is_modal'))this._updateJoinableAddFriendSheet(wc);this._updateMutingSettings(wc);this._updateUnreadCount(wc);this.updateMultichatTooltip();this._updateArchiveWarning(wc);this._updateNewThread(wc);this._updateNameConversationSheet(wc);}.bind(this));},_setNameConversationLink:function(){var wc=this._getNode('nameConversationLink');if(wc)vb.isEmptyLocalThread(this._threadID)?z.hide(wc):z.show(wc);},_updateNameConversationSheet:function(wc){if(!wc.name&&!wc.is_canonical&&!wc.name_conversation_sheet_dismissed&&!vb.isEmptyLocalThread(wc.thread_id)){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateJoinableAddFriendSheet:function(wc){var xc=ma.user,yc=wc.participants.filter(function(zc){return zc!=xc;});if(wc.is_joinable&&yc.length<1)this.showAddFriend();},updateSignatureID:function(wc){this._signatureID=wc;},_showPhotoNUXIfNecessary:function(){if(yb){yb=false;new j('/ajax/chat/photo_nux.php').setRelativeTo(this._getNode('photoAttachLink')).setData({threadID:this._threadID}).send();return true;}},_setUpMutingSettings:function(wc){var xc=pa.isThreadMuted(wc);if(xc)this._sheetController.openThreadIsMutedTabSheet();this._updateActionMenu(xc);},_updateMutingSettings:function(wc){var xc=pa.isThreadMuted(wc);if(xc&&z.shown(this._getNode('muteThreadLink').parentNode)){this._sheetController.openThreadIsMutedTabSheet();}else if(!xc&&z.shown(this._getNode('unmuteThreadLink').parentNode))this._sheetController.closeThreadIsMutedTabSheet();this._updateActionMenu(xc);},_updateActionMenu:function(wc){z.conditionShow(this._getNode('muteThreadLink').parentNode,!wc);z.conditionShow(this._getNode('unmuteThreadLink').parentNode,wc);},_updateArchiveWarning:function(wc){var xc=false;ma.get(ma.user,function(yc){xc=yc.employee;if(xc)ma.getMulti(wc.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_updateInputContainers:function(wc){z.conditionShow(this._inputContainerNode,wc);z.conditionShow(this._iconsContainerNode,wc);this._resizeInputContainer();},_resizeInputContainer:function(){var wc=this._tabElem.clientWidth,xc=2,yc=wc-(this._inputContainerNode.clientWidth+xc),zc=ia.isRTL()?'left':'right';ab.set(this._iconsContainerNode,zc,yc+'px');db.getInstance(this._getNode('input')).update();},_updateNewThread:function(wc){var xc=vb.isNewEmptyLocalThread(wc.thread_id);z.conditionShow(this._getNode('dropdown'),!xc);z.conditionShow(this._getNode('addToThreadLink'),!xc);if(xc){this.showAddFriend();if(o.get('www_chat_compose_suggestions',0))this.showPeopleSuggestions();}else if(this._peopleSuggestions){this._peopleSuggestions.destroy();this._peopleSuggestions=null;}},_showArchiveWarningIfAllParticipantsAreEmployees:function(wc){var xc=true;for(var yc in wc)xc=xc&&wc[yc].employee;var zc=this._getNode('titanArchiveWarning');if(zc){if(this._titlebarTooltipAnchor)z.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',xc);z.conditionShow(zc,xc);}},updateMultichatTooltip:function(){vb.getThreadMeta(this._threadID,function(wc){if(!wc.is_canonical)bc(this._titlebarTooltipAnchor,wc.participants);}.bind(this));},_getNode:function(wc){return this._tabTemplate.getNode(wc);},_getCanonicalUserID:function(){return vb.getCanonicalUserInThread(this._threadID);},_listen:function(wc,event,xc,yc){var zc=this._getNode(wc);if(zc){this._eventListeners.push(ea.listen(zc,event,xc.bind(this)));}else if(!yc)throw new Error('Could not find node "'+wc+'"');},_closePreClicked:function(wc){this._closeMouseDown=true;},_closeClicked:function(wc){uc(this);tc.inform('closed-tab',this._threadID);wc.kill();},_closeEnter:function(wc){if(wc.keyCode===ha.RETURN)this._closeClicked(wc);},_nubClicked:function(wc){if(!this._isDragDropActive){wc.kill();return tc.inform('nub-activated',this._threadID);}},_dockKeyDown:function(event){if(event.keyCode===ha.RETURN||event.keyCode===ha.SPACE){tc.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===ha.ESC){this._handleEscape();event.kill();}else if(event.keyCode===ha.TAB&&!event.ctrlKey){var wc=tc.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!wc&&event.kill();}},_handleEscape:function(){uc(this);if(this.hasEmptyInput()){tc.inform('esc-pressed',this._threadID);}else{var wc="Are you sure you want to close this chat window?",xc="You haven't sent your message.",yc=new ba().setTitle(wc).setBody(xc).setButtons([ba.CLOSE,ba.CANCEL]).setHandler(tc.inform.bind(tc,'esc-pressed',this._threadID,null)).setModal(true).show(),zc=yc.getButtonElement('yes');zc&&fa.set(zc);}},_handlePhotoUploadFailed:function(){var wc="Photo Upload Failed",xc="Please try again. Make sure you are uploading a valid photo.";new ba().setTitle(wc).setBody(xc).setButtons(ba.OK).show();},_isTitleTextLinked:function(){return o.get('chat_tab_title_link_timeline');},_titleClicked:function(event){var wc=event.getTarget(),xc=ta.byClass(wc,'titlebarText'),yc=xc&&this._isTitleTextLinked();if(!yc&&!ta.byClass(wc,'uiSelector')&&!ta.byClass(wc,'addToThread')&&!this._isDragDropActive){tc.inform('lower-activated',this._threadID);event.kill();}},_callClicked:function(wc){var xc=this._getCanonicalUserID();if(jb.availableForCall(xc)){var yc='chat_tab_icon';if(wc.target&&z.hasClass(wc.target,'video_call_promo')){yc='chat_tab_icon_promo';}else if(wc.target&&z.hasClass(wc.target,'video_call_tour'))yc='chat_tab_icon_tour';tc.inform('video-call-clicked',{threadID:this._threadID,userID:xc,clickSource:yc});}return false;},_addFriendLinkClicked:function(){this.showAddFriend();},_nameConversationLinkClicked:function(){this.showNameConversation();},_clearHistory:function(){var wc=vb.getThreadMetaNow(this._threadID);if(wc){var xc=this._getCanonicalUserID();sb.clearChat(this._threadID,xc,wc.timestamp);}},_unsubscribeLinkClicked:function(){var wc=[];wc.push({name:'unsubscribe',label:"Leave Conversation",handler:this._unsubscribeToThread.bind(this)});wc.push(ba.CANCEL);new ba().setTitle("Leave Conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(wc).show();},_reportSpamClicked:function(){var wc=this._getCanonicalUserID(),xc=hb('/ajax/chat/report.php').addQueryData({id:wc}).addQueryData({src:'top_report_link'});i.send(new j(xc));},_focusTab:function(){z.addClass(this._tabElem,'focusedTab');if(this._peopleSuggestions)this._peopleSuggestions.clearSuggestions();this.tryMarkAsRead();this._contextualDialogController.tabFocused();if(!zb&&this._showPhotoNUXIfNecessary())g.subscribe(['ChatNUX/show','ChatNUX/hide'],function(event){zb=event==='ChatNUX/show';});this._closeMouseDown=false;this._setCloseTooltip(true);tc.inform('focus-tab',this._threadID);},_blurTab:function(){z.removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(wc){var xc=this._getNode('titlebarCloseButton'),yc=wc?"Press Esc to close":"Close tab";fb.set(xc,yc,'above');},_inputKeyDown:function(event){if(event.keyCode===ha.RETURN&&!event.shiftKey){if(nc(this)){lc(this);event.kill();return;}ic(this);event.kill();return;}if(event.keyCode===ha.DOWN&&event.shiftKey&&this._getNode('input').value===''){tc.inform('lower-activated',this._threadID);event.kill();return;}this._handleHotkeyPressed(event);},_hasUnfinishedPost:function(){return oc(this)||mc(this);},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){tc.inform('read',this._threadID);return true;}return false;},_chatConvClicked:function(wc){this.tryMarkAsRead();if(ta.byTag(wc.getTarget(),'a')||da.getSelection())return;this.focus();},_inputContainerClicked:function(wc){this.tryMarkAsRead();this.focus();},showTypingIndicator:function(wc){var xc=vb.getThreadMetaNow(this._threadID),yc=this._getCanonicalUserID()||(o.get('chat_multi_typ')&&xc&&!xc.is_canonical);if(yc)z.conditionClass(this._tabElem,'typing',wc);},_updateUnreadCount:function(wc){var xc=wc.unread_count;if(typeof xc!='undefined'){var yc=!!xc&&(!n.showsTabUnreadUI||n.showsTabUnreadUI()),zc=this._getNode('numMessages');z.conditionShow(zc,yc);z.conditionClass(this._tabElem,'highlightTab',yc);fc(this._threadID,this._tabElem,yc);da.setContent(zc,xc);}},_updateCallLink:function(wc){var xc=this._getNode('videoCallLink');if(x.isOnline()){var yc=this._getCanonicalUserID(),zc='fbid:'+yc;ma.get(zc,function(ad){if(jb.availableForCall(yc)){fb.set(xc,qb._("Start a video call with {firstname}",{firstname:ad.short_name}));this._updateCallBackLinks(this._tabElem,true);}else{fb.set(xc,qb._("{firstname} is currently unavailable for video calling",{firstname:ad.short_name}));this._hideVideoCallouts();this._updateCallBackLinks(this._tabElem,false);}}.bind(this));}else{fb.set(xc,"You must be online to make a call.");this._hideVideoCallouts();this._updateCallBackLinks(document.body,false);}},_updateCallBackLinks:function(wc,xc){var yc=da.scry(wc,'a.callBackLink');if(xc){yc.forEach(z.show);}else yc.forEach(z.hide);},_hideVideoCallouts:function(){this._contextualDialogController.hideVideoCallouts();},_updatePrivacyLink:function(wc){if(wc==r.OFFLINE){da.setContent(this._privacyLink,"Go online");}else{var xc=this._getCanonicalUserID(),yc='fbid:'+xc;ma.get(yc,function(zc){var ad=null;if(wc==r.BLOCKED){ad=qb._("Turn On Chat for {name}",{name:zc.short_name});}else ad=qb._("Turn Off Chat for {name}",{name:zc.short_name});da.setContent(this._privacyLink,ad);}.bind(this));}},_unsubscribeToThread:function(){if(vb.isEmptyLocalThread(this._threadID)){tc.inform('unsubscribed',this._threadID);}else{var wc=rb.constructLogMessageObject(na.CHAT_WEB,this._threadID,la.UNSUBSCRIBE,{});rb.sendMessage(wc);}return true;},_initializeUploader:function(wc){this._subscriptionsHandler.addSubscriptions(wc.subscribe(['all-uploads-completed','upload-canceled'],function(){pc(this);}.bind(this)),wc.subscribe('dom-updated',function(){qc(this);}.bind(this)),wc.subscribe('submit',function(){this._getNode('input').focus();}.bind(this)));},_initializeAutoSendPhotoUploader:function(){this._photoUploader=new m(this._tabTemplate.getNode('photoAttachButtonForm'),this._tabTemplate.getNode('photoFileInput'),this._tabTemplate.getNode('photoAttachID'));var wc=function(xc){var yc=rb.updateMessageAfterUpload(xc.upload_id,xc);rb.clearUploadedMessage(xc.upload_id);rb.deleteMessages(yc.thread_id,[yc.message_id]);rb.deleteLocalMessage(yc.thread_id);};rc(this,'submit',ua.UPLOAD_START);rc(this,'all-uploads-completed',ua.ALL_UPLOADS_DONE);rc(this,'last-upload-failed',ua.CLIENT_ERROR);rc(this,'last-upload-canceled',ua.CANCEL_DURING_UPLOAD);this._subscriptionsHandler.addSubscriptions(this._photoUploader.subscribe('submit',function(xc,yc){kc(this,'',[],function(zc){if(this._threadID!==zc.thread_id){this._newThreadIDFromPhotoUpload=zc.thread_id;if(this._messagesView)this._messagesView.setNewThreadID(zc.thread_id);}rb.updateNewMessage(zc,yc.upload_id,yc);rb.sendMessage(zc);}.bind(this));this._getNode('input').focus();}.bind(this)),this._photoUploader.subscribe('last-upload-failed',function(xc,yc){wc(yc);this._handlePhotoUploadFailed();}.bind(this)),this._photoUploader.subscribe('last-upload-canceled',function(xc,yc){wc(yc);}),this._photoUploader.subscribe('all-uploads-completed',function(xc,yc){var zc=rb.updateMessageAfterUpload(yc.upload_id,yc);rb.clearUploadedMessage(yc.upload_id);rb.sendMessage(zc);var ad=yc.image_ids.length||yc.attachments.length;jc(this,ad);}.bind(this)),g.subscribe('ChatPhotoEditor/save'+this._threadID,function(xc,yc){this._photoUploader.uploadFile(yc);}.bind(this)));},_stickerSelected:function(wc){kc(this,'',[],function(xc){xc.has_attachment=true;xc.sticker_id=wc;rb.sendMessage(xc);this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emoticonView:null});e.exports=tc;});
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryMessages","MercuryParticipants","MercuryThreads","tx"],function(a,b,c,d,e,f){var g=b('MercuryAssert'),h=b('MercuryMessages').get(),i=b('MercuryParticipants'),j=b('MercuryThreads').get(),k=b('tx');function l(m,n){g.isThreadID(m);j.getThreadMeta(m,function(o){h.getThreadMessagesRange(m,0,1,function(p){var q=p.length&&p[p.length-1];if(q&&q.author!=i.user){i.get(q.author,function(r){if(o.name){n(k._("{senderName} messaged {groupName}",{senderName:r.short_name,groupName:o.name}));}else n(k._("{name} messaged you",{name:r.short_name}));});}else n("New message!");});});}e.exports={renderDocumentTitle:l};});
__d("ChatTitleBarBlinker",["ChatActivity","DocumentTitle","JSLogger","MercuryThreadInformer","MercuryNotificationRenderer","PresenceState","MercuryTimestampTracker"],function(a,b,c,d,e,f){var g=b('ChatActivity'),h=b('DocumentTitle'),i=b('JSLogger'),j=b('MercuryThreadInformer').get(),k=b('MercuryNotificationRenderer'),l=b('PresenceState'),m=b('MercuryTimestampTracker').get(),n=i.create('chat_title'),o=null,p=0,q=false;function r(){if(o){o.stop();o=null;return true;}return false;}function s(x){var y=x||m.getLastUserMessageTimestamp();if(p<=y){p=y;if(r()||q)l.doSync();}}var t={blink:function(x,y){if(!o&&p<y)k.renderDocumentTitle(x,function(z){if(!o)o=h.blink(z);});},stopBlinking:function(){s();},blinkingElsewhere:function(){q=true;}};function u(x){var y=l.verifyNumber(x.sb2);if(!y||y<=p)return null;return y;}function v(x){var y=x&&u(x);if(y){p=y;n.debug('load',p);r();q=false;}}function w(x){var y=u(x);if(!y){n.debug('store',p);x.sb2=p;q=false;}return x;}l.registerStateStorer(w);l.registerStateLoader(v);j.subscribe('thread-read-changed',function(x,y){var z=m.getLastUserMessageTimestamp(),aa=0;for(var ba in y)if(y[ba].mark_as_read&&y[ba].timestamp>=z&&y[ba].timestamp>aa)aa=y[ba].timestamp;aa&&s(aa);});g.subscribe('activity',function(){s();});(function(){var x=l.getInitial();if(x)p=u(x)||0;})();e.exports=t;});
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","MercuryParticipants","MercuryThreadMuter","MercuryThreads","MessagingTag","Sound","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ChatActivity'),i=b('ChatConfig'),j=b('ChatOptions'),k=b('ChatTitleBarBlinker'),l=b('MercuryParticipants'),m=b('MercuryThreadMuter'),n=b('MercuryThreads').get(),o=b('MessagingTag'),p=b('Sound'),q=b('copyProperties');p.init(['audio/ogg','audio/mpeg']);function r(t){if(j.getSetting('sound'))p.play([i.get('sound.notif_ogg_url'),i.get('sound.notif_mp3_url')],t,false);}var s={messageReceived:function(t){if(t.author==l.user||!t.is_unread||(t.folder!=o.INBOX&&t.folder!=o.ARCHIVED))return;var u=t.thread_id,v=h.isActive();if(v){var w=false;s.inform('before-alert',{threadID:u,cancelAlert:function(){w=true;}});}n.getThreadMeta(u,function(x){var y=m.isThreadMuted(x);if(y)return;var z=t.timestamp;if(v){!w&&r(z);}else{k.blink(u,z);r(z);}k.blinkingElsewhere();}.bind(this));}};e.exports=q(s,g);});
__d("ChatNewMessageHandler",["ArbiterMixin","ChatActivity","ChatTabModel","ChatTabView","JSLogger","MercuryAssert","MercuryBrowserAlerts","UserActivity","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ChatActivity'),i=b('ChatTabModel'),j=b('ChatTabView'),k=b('JSLogger'),l=b('MercuryAssert'),m=b('MercuryBrowserAlerts'),n=b('UserActivity'),o=b('copyProperties'),p=k.create('chat_new_message'),q={_raiseNewMessageTab:function(r,s){var t=i.getTab(r),u=false;if(t){u=t.raised;}else u=true;q.inform('chat/new-message-from-server',{thread_id:r});s.to_new_tab=!t;s.to_raised_tab=!!u;},_notify:function(r,s,t){var u=j.get(r);t.view_is_visible=u&&u.isVisible();t.view_is_focused=u&&u.isFocused();if(!t.view_is_visible)p.log('message_to_hidden');t.is_active=h.isActive();m.messageReceived(s);},newMessage:function(r,s,t){l.isThreadID(r);var u={thread_id:r,message_id:s.message_id};this._raiseNewMessageTab(r,u);this._notify(r,s,u);p.log('message',u);}};o(q,g);m.subscribe('before-alert',function(r,event){var s=event.threadID,t=j.get(s),u=i.getTab(s);if(u&&u.raised&&t&&t.isVisible()&&t.isFocused()&&n.isActive()){t.tryMarkAsRead();event.cancelAlert();}});e.exports=q;});
__d("ChatTabLRUManager",["ChatTabView","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f){var g=b('ChatTabView'),h=b('ChatTabModel'),i=b('MercuryThreads').get(),j={getLRUVisibleTab:function(k){if(k.hasRoomForRaisedTab())return undefined;var l=Object.keys(k.getTabsToShow()||{}),m=1*60,n=null,o=Infinity;for(var p=0;p<l.length;p++){var q=l[p],r=i.getThreadMetaNow(q);if(h.isTabPromoted(q))continue;if(!g.get(q).hasEmptyInput()||!r)continue;var s=(h.getServerTime()-r.timestamp)/1000;if(!r.timestamp||(r.timestamp&&r.timestamp<o&&s>m)){n=r.thread_id;o=r.timestamp;}}return n;}};e.exports=j;});
__d("MercuryUnseenState",["TimestampConverter","KeyedCallbackManager","LogHistory","MercuryActionTypeConstants","MercurySingletonMixin","MercuryThreadlistConstants","MessagingTag","MercuryServerRequests","ReportState","MercuryThreadInformer","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('TimestampConverter'),h=b('KeyedCallbackManager'),i=b('LogHistory'),j=b('MercuryActionTypeConstants'),k=b('MercurySingletonMixin'),l=b('MercuryThreadlistConstants'),m=b('MessagingTag'),n=b('MercuryServerRequests'),o=b('ReportState'),p=b('MercuryThreadInformer'),q=b('copyProperties'),r=b('createObjectFrom'),s=l.MAX_UNSEEN_COUNT,t='unseen_thread_hash',u='unseen_thread_list',v=i.getInstance('mercury_unseen_state');function w(ja){this._fbid=ja;this._serverRequests=n.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._initialUnseenCount=0;this._lastSeenTimestamp=0;this._maxCount=false;this._unseenResources=new h();this._serverRequests.subscribe('update-unseen',function(ka,la){ba(this,la);}.bind(this));this._serverRequests.subscribe('update-thread-ids',function(ka,la){ha(this,la);}.bind(this));}q(w.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){v.error('unguarded_unseen_count_fetch',{});return 0;}return aa(this);},exceedsMaxCount:function(){return this._maxCount||(aa(this)>s);},markAsSeen:function(){if(aa(this)>0||this._maxCount){this._serverRequests.markSeen();ca(this,g.convertActionIDToTimestamp(this._serverRequests.getLastActionID()),[]);}},markThreadSeen:function(ja,ka){var la={};la[ja]=null;ea(this,la,ka);}});q(w,k);function x(ja,ka){ja._unseenResources.setResource(t,ka);ja._unseenResources.setResource(u,Object.keys(ka));}function y(ja,ka){var la=ja._unseenResources.executeOrEnqueue(t,ka),ma=ja._unseenResources.getUnavailableResources(la);if(ma.length)ja._serverRequests.fetchUnseenThreadIDs();}function z(ja){return ja._unseenResources.getResource(t);}function aa(ja){var ka=ja._unseenResources.getResource(u);if(ka){return ka.length;}else return ja._initialUnseenCount;}function ba(ja,ka){var la=ia(ka);if(ka.unseen_thread_ids){ka.unseen_thread_ids.forEach(function(wa){if(wa.folder!=m.INBOX)return;var xa=ga(ja,wa.thread_ids),ya=ja._lastSeenTimestamp;if(la&&la.seen_timestamp)ya=la.seen_timestamp;ca(ja,ya,xa);if(la&&la.unseen_count>s)ja._maxCount=true;});}else if(la&&la.seen_timestamp){ja._lastSeenTimestamp=la.seen_timestamp;if(la.unseen_count>s){ja._maxCount=true;x(ja,{});}else{ja._initialUnseenCount=la.unseen_count;if(ja._initialUnseenCount===0)x(ja,{});}}else{if(ja._maxCount)return;var ma=ka.actions;if(!ma||!(ma.length))return;var na={},oa={};for(var pa=0;pa<ma.length;pa++){var qa=ma[pa];if(qa.is_forward)continue;var ra=qa.action_type,sa=qa.action_id,ta=qa.thread_id?qa.thread_id:qa.server_thread_id,ua=qa.folder===undefined||qa.folder==m.INBOX;if(!ua)continue;if(ra==j.USER_GENERATED_MESSAGE||ra==j.LOG_MESSAGE){var va=g.isGreaterThan(sa,na[ta]);if(qa.is_unread&&(!na[ta]||va))na[ta]=sa;}else if(ra==j.CHANGE_READ_STATUS&&qa.mark_as_read)oa[ta]=sa;}da(ja,na);ea(ja,oa);}}function ca(ja,ka,la){var ma=z(ja);if(ma===undefined||ka>ja._lastSeenTimestamp||ja._maxCount){ja._lastSeenTimestamp=ka;la=la||[];if(la.length<=s)ja._maxCount=false;var na={},oa=z(ja)||{};for(var pa in oa)if(oa[pa]!==true){var qa=oa[pa];if(fa(ja,qa))na[pa]=qa;}var ra=q(r(la,true),na);x(ja,ra);ja._threadInformer.updatedUnseenState();}}function da(ja,ka){if(ja._maxCount)return;var la={},ma=false;for(var na in ka){var oa=ka[na];if(fa(ja,oa)){la[na]=oa;ma=true;}}if(!ma)return;y(ja,function(pa){for(var qa in la){var ra=la[qa];if(!pa[qa]&&fa(ja,ra))pa[qa]=la[qa];}x(ja,pa);ja._threadInformer.updatedUnseenState();});}function ea(ja,ka,la){var ma=false;for(var na in ka){ma=true;break;}if(ma)y(ja,function(oa){var pa=false;for(var qa in ka){var ra=ka[qa],sa=g.isGreaterThan(ra,oa[qa]);if(oa[qa]&&(!ra||sa)){delete oa[qa];pa=true;}}if(pa){x(ja,oa);ja._threadInformer.updatedUnseenState();if(la&&aa(ja)===0)ja._serverRequests.markSeen();}});}function fa(ja,ka){var la=g.convertActionIDToTimestamp(ka);return la>ja._lastSeenTimestamp;}function ga(ja,ka){return ka.map(ja._serverRequests.convertThreadIDIfAvailable.bind(ja._serverRequests));}function ha(ja,ka){var la=z(ja);if(!la)return;for(var ma in ka){var na=ka[ma];if(la[ma]){la[na]=la[ma];delete la[ma];}}x(ja,la);}function ia(ja){var ka=(ja.message_counts||[]);for(var la=0;la<ka.length;la++)if(ka[la].folder==m.INBOX)return ka[la];return null;}o.registerCallback('mercury-unseen-state',function(){var ja={};ja.unseen={};ja.unseen_max_count={};ja.unseen_time={};var ka=w._getInstances();for(var la in ka){ja.unseen[la]=q({},z(ka[la]));ja.unseen_max_count[la]=ka[la]._maxCount;ja.unseen_time[la]=ka[la]._lastSeenTimestamp;}return ja;});e.exports=w;});
__d("ChatTabPolicy",["ChatBehavior","FBDesktopPlugin","JSLogger","MercuryActionTypeConstants","MercuryAssert","MercuryParticipants","MercuryParticipantTypes","MercurySourceType","MercuryThreadMode","MercuryThreadMuter","MercuryUnseenState","MessagingTag","PresencePrivacy","ShortProfiles"],function(a,b,c,d,e,f){var g=b('ChatBehavior'),h=b('FBDesktopPlugin'),i=b('JSLogger'),j=b('MercuryActionTypeConstants'),k=b('MercuryAssert'),l=b('MercuryParticipants'),m=b('MercuryParticipantTypes'),n=b('MercurySourceType'),o=b('MercuryThreadMode'),p=b('MercuryThreadMuter'),q=b('MercuryUnseenState').get(),r=b('MessagingTag'),s=b('PresencePrivacy'),t=b('ShortProfiles'),u=i.create('tab_policy');function v(w,x){q.markThreadSeen(w,x);}e.exports={messageIsAllowed:function(w,x,y){var z=w.thread_id,aa=x.message_id;k.isThreadID(z);k.isParticipantID(x.author);var ba;if(p.isThreadMuted(w)){ba={thread_id:z,message_id:aa,mute_settings:w.mute_settings};u.log('message_thread_muted',ba);return;}if(w.mode==o.OBJECT_ORIGINATED){ba={thread_id:z,message_id:aa,mode:w.mode};u.log('message_object_originated',ba);return;}if(x.source==n.EMAIL||x.source==n.TITAN_EMAIL_REPLY){ba={thread_id:z,message_id:aa,source:x.source};u.log('message_source_not_allowed',ba);return;}var ca=l.getUserID(x.author);if(!ca){u.log('message_bad_author',{thread_id:z,message_id:aa,user:ca});return;}if(x.action_type!=j.USER_GENERATED_MESSAGE){ba={thread_id:z,message_id:aa,type:x.action_type};u.log('message_non_user_generated',ba);return;}if(w.is_canonical_user&&!g.notifiesUserMessages()){u.log('message_jabber',{thread_id:z,message_id:aa});v(z,true);return;}if(w.is_canonical&&!w.canonical_fbid){u.log('message_canonical_contact',{thread_id:z,message_id:aa});return;}if(h.shouldSuppressMessages()){u.log('message_desktop',{thread_id:z,message_id:aa});return;}if(w.folder!=r.INBOX){u.log('message_folder',{thread_id:z,message_id:aa,folder:w.folder});return;}var da=l.getUserID(l.user);t.getMulti([ca,da],function(ea){if(!s.allows(ca)){u.log('message_privacy',{thread_id:z,message_id:aa,user:ca});return;}var fa=ea[ca].employee&&ea[da].employee;if(!fa&&ea[ca].type!==m.FRIEND){u.log('message_non_friend',{thread_id:z,message_id:aa,user:ca});return;}y();});}};});
__d("ChatTabViewSelector",["Event","Arbiter","CSS","DataStore","DOM","MenuDeprecated","MercuryThreadInformer","MercuryThreads","NubController","ChatTabTemplates","MercuryThreadMetadataRenderer","Toggler","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('MenuDeprecated'),m=b('MercuryThreadInformer').get(),n=b('MercuryThreads').get(),o=b('NubController'),p=b('ChatTabTemplates'),q=b('MercuryThreadMetadataRenderer').get(),r=b('Toggler'),s=b('copyProperties');function t(u){var v=p[':fb:chat:tab:selector'].build(),w=v.getRoot(),x=v.getNode('menu'),y=k.find(x,'.uiMenuInner'),z={},aa=new o().init(w);i.hide(w);k.insertBefore(u,w);function ba(ea){var fa=0;for(var ga in z){var ha=z[ga],ia=n.getThreadMetaNow(ga),ja=ha.getNode('unreadCount'),ka=(ia&&ia.unread_count)||0;fa+=ka;if(ka>9)ka='+';i.conditionClass(ja,'invisible_elem',!ka);k.setContent(ja,ka);}var la=v.getNode('numMessages');i.conditionShow(la,fa);k.setContent(la,fa);}this.setTabData=function(ea){z={};if(ea.length<1){i.hide(w);return;}i.show(w);k.empty(y);ea.forEach(function(fa){var ga=p[':fb:chat:tab:selector:item'].build();z[fa.id]=ga;var ha=ga.getNode('content');q.renderAndSeparatedParticipantList(fa.id,ha);k.prependContent(y,ga.getRoot());j.set(ga.getRoot(),'threadID',fa.id);var ia=ga.getNode('closeButton');g.listen(ia,'click',function(event){t.inform('selector/close-tab',fa.id);event.kill();});});aa.flyoutContentChanged();k.setContent(v.getNode('numTabs'),ea.length);ba();};function ca(event,ea){if(ea.menu!=x)return;var fa=j.get(ea.item,'threadID');t.inform('selected',fa);r.hide(w);}function da(event,ea){l.register(x);}l.subscribe('select',ca.bind(this));r.listen('show',w,function(){h.inform('layer_shown',{type:'ChatTabSelector'});da();});r.listen('hide',w,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});m.subscribe('threads-updated',ba);}s(t,new h());e.exports=t;});
__d("ChatTabViewCoordinator",["Arbiter","BanzaiODS","Bootloader","ChatConfig","ChatTabModel","ChatTabView","ChatTabViewSelector","CSS","JSLogger","Style","Rect","VideoCallCore","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('BanzaiODS'),i=b('Bootloader'),j=b('ChatConfig'),k=b('ChatTabModel'),l=b('ChatTabView'),m=b('ChatTabViewSelector'),n=b('CSS'),o=b('JSLogger'),p=b('Style'),q=b('Rect'),r=b('VideoCallCore'),s=b('copyProperties'),t=o.create('chat_tab_coordinator'),u,v;function w(x,y){var z=new m(x),aa={},ba={},ca=false;function da(){var pa=k.get(),qa={};pa.tabs.forEach(function(sa){qa[sa.id]=1;});t.log('process_tab_changed',{model_tabs:Object.keys(qa),view_tabs:Object.keys(aa)});for(var ra in aa)if(!qa[ra]){t.log('remove_tab',{tab_id:ra});aa[ra].destroy();delete(aa[ra]);}ea(pa);na(pa);if(pa.tabNeedsFocus&&!pa.tabNeedsFocus.isFocused())pa.tabNeedsFocus.focus();}function ea(pa){var qa=null;pa.tabs.forEach(function(ra){var sa=ra.id,ta=false;if(!aa[sa]){t.log('add_tab',{tab_id:sa});aa[sa]=new l(sa,ra.server_id,ra.signatureID);ta=true;}else aa[sa].updateSignatureID(ra.signatureID);if(aa[sa].isFocused())pa.tabNeedsFocus=aa[sa];if(ta||!aa[sa].nextTabIs(qa)){var ua=aa[sa].getScrollTop();if(qa){aa[sa].insertBefore(qa);}else aa[sa].appendTo(x);if(ua)aa[sa].setScrollTop(ua);}qa=aa[sa];});}function fa(){var pa=y.getShowingTabsOrder();if(!pa||!pa.length)return;var qa=aa[pa[0].id]._tabElem,ra=aa[pa[pa.length-1].id]._tabElem,sa=parseInt(p.get(ra,'margin-left'),10)||0,ta=q.getElementBounds(ra).l-2*sa;ta=ta>0?ta:0;u&&u.setBoundingBox(new q(0,q.getElementBounds(qa).r,0,ta));}function ga(pa,qa){var ra=false;qa.forEach(function(ua){if(ua.raised){if(ba[ua.id]){ra=true;delete ba[ua.id];}}else if(!ba[ua.id]){ra=true;ba[ua.id]=true;}});if(ra)return true;if(!u)return true;var sa=ha()||[];if(sa.length!==pa.length)return true;for(var ta=0;ta<pa.length;ta++)if(sa[ta]!==pa[ta].id)return true;return false;}function ha(){var pa=u&&u.getOrder();pa&&pa.reverse();return pa;}function ia(){var pa=ha();if(pa){h.bumpEntityKey('chat.web','tab.drag_order_changed');g.inform('chat/tabs-order-changed',pa);}}function ja(pa,qa,ra){if(aa[ra]._scrollTop!=null)aa[ra].setScrollTop(aa[ra]._scrollTop);}function ka(pa,qa){v=qa;aa[qa]._isDragDropActive=true;aa[qa]._scrollTop=aa[qa].getScrollTop();p.set(aa[qa]._tabElem,'z-index',1);fa();h.bumpEntityKey('chat.web','tab.drag_started');}function la(pa){p.set(aa[pa]._tabElem,'z-index','');if(aa[pa]._scrollTop!=null)aa[pa].setScrollTop(aa[pa]._scrollTop);aa[pa]._scrollTop=null;v=null;setTimeout(function(){aa[pa]._isDragDropActive=false;},0);}function ma(pa){if(!j.get('chat_tabs_management'))return;i.loadModules(['SortableGroup'],function(qa){var ra=y.getShowingTabsOrder(),sa=ga(ra,pa);if(ra.length<=1){u&&u.removeAllSortables();return;}if(sa){if(u){u.removeAllSortables();}else u=new qa().setBeforeGrabCallback(ka).setDragOverCallback(ja).setDropCallback(la).setOrderChangeHandler(ia).setUseScroller(false).setDragOverHorizontally();for(var ta=0;ta<ra.length;ta++){var ua=ra[ta];u.addSortable(ua.id,aa[ua.id]._tabElem,ba[ua.id]?null:aa[ua.id]._titlebar);}}});}function na(pa){var qa=y.getTabsToShow(pa),ra=[],sa=false;pa.tabs.forEach(function(ta){if(!qa[ta.id]){aa[ta.id].setVisibleState(false,ta.raised);ra.push(ta);}});pa.tabs.forEach(function(ta){if(qa[ta.id]){aa[ta.id].setVisibleState(true,ta.raised);sa|=ta.raised;}});z.setTabData(ra);oa(sa);ma(pa.tabs);}function oa(pa){if(!pa&&ca){g.inform('layer_hidden',{type:'ChatTab'});ca=false;}else if(pa&&!ca){g.inform('layer_shown',{type:'ChatTab'});ca=true;}}if(r.isSupported())n.addClass(x,'videoCallEnabled');y.subscribe('tabs-changed',da);da();}s(w.prototype,{forceDrop:function(){if(u&&v){u.forceDrop(v);v=null;return true;}return false;}});e.exports=w;});
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionTypeConstants","MercuryGlobalActionType","MercuryMessages","MercuryPayloadSource","MercurySendLogger","MessagingReliabilityLogger","MessagingEvent","MessagingTag","MercuryParticipants","PresenceUtil","MercuryServerRequests","MercuryThreadInformer","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('MercuryActionTypeConstants'),j=b('MercuryGlobalActionType'),k=b('MercuryMessages').get(),l=b('MercuryPayloadSource'),m=b('MercurySendLogger'),n=b('MessagingReliabilityLogger'),o=b('MessagingEvent'),p=b('MessagingTag'),q=b('MercuryParticipants'),r=b('PresenceUtil'),s=b('MercuryServerRequests').get(),t=b('MercuryThreadInformer').get(),u=b('copyProperties');function v(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj||!la.obj.message){n.addEntry('channel_receive','invalid_data');return;}var ma=la.obj.message,na={author:ma.mercury_author_id,author_email:ma.mercury_author_email,body:ma.body,subject:ma.subject,has_attachment:ma.has_attachment,attachments:ma.attachments,html_body:ma.html_body,thread_id:ma.tid,message_id:ma.mid,coordinates:ma.mercury_coordinates,is_spoof_warning:ma.is_spoof_warning,source:ma.mercury_source,source_tags:ma.mercury_source_tags,threading_id:ma.threading_id,timestamp:ma.timestamp,timestamp_absolute:ma.timestamp_absolute,timestamp_relative:ma.timestamp_relative,timestamp_time_passed:ma.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:ma.is_unread,action_id:ma.action_id,is_forward:false,forward_count:ma.forward_count||ma.forward,forward_message_ids:ma.forward_msg_ids,location_text:ma.location_text,folder:la.obj.folder},oa=[u({},na)];oa=oa.concat(ma.forward_actions||[]);var pa=l.CLIENT_CHANNEL_MESSAGE;s.handleUpdateWaitForThread({actions:oa,payload_source:pa},ma.tid);if(!ma.is_unread&&ma.mercury_author_id===q.user){var qa={};qa[ma.tid]=la.obj.folder;w(h.getArbiterType('messaging'),{obj:{event:o.READ,tids:[ma.tid],folder_info:qa,timestamp:ma.timestamp}});}if(ma.mercury_author_id===q.user)if(k.getMessagesFromIDs([ma.threading_id]).length)m.log(m.CLIENT_CHANNEL_ECHO,ma.threading_id,{canonical:!ma.group_thread_info});n.addEntry('channel_receive','success',[na.thread_id,na.message_id,r.getSessionID()]);}function w(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj||!la.obj.tids)return;var ma=[],na=la.obj.event==o.READ;la.obj.tids.forEach(function(oa){ma.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_id:oa,mark_as_read:na,timestamp:la.obj.timestamp||0,folder:la.obj.folder_info[oa]});});s.handleUpdate({actions:ma,payload_source:l.CLIENT_CHANNEL_MESSAGE});}function x(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj||!la.obj.tids)return;var ma=[];la.obj.tids.forEach(function(na){ma.push({action_type:i.DELETE_THREAD,action_id:null,thread_id:na});});s.handleUpdate({actions:ma,payload_source:l.CLIENT_CHANNEL_MESSAGE});}function y(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj||!la.obj.tids||!la.obj.mids)return;var ma=la.obj.tids[0],na={action_type:i.DELETE_MESSAGES,action_id:null,thread_id:ma,message_ids:la.obj.mids};s.handleUpdate({actions:[na],threads:[la.obj.updated_thread],payload_source:l.CLIENT_CHANNEL_MESSAGE});}function z(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj||!la.obj.folder)return;var ma={action_type:j.MARK_ALL_READ,action_id:la.obj.action_id,folder:la.obj.folder};s.handleUpdate({global_actions:[ma]});}function aa(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj.tids)return;var ma=l.CLIENT_CHANNEL_MESSAGE;la.obj.tids.forEach(function(na){var oa={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:na,archived:la.obj.state};s.handleUpdateWaitForThread({actions:[u({},oa)],payload_source:ma},na);});}function ba(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj.tids)return;var ma=l.CLIENT_CHANNEL_MESSAGE,na;la.obj.tids.forEach(function(oa){if(la.obj.event==o.TAG){na=la.obj.tag;}else na=la.obj.marked_as_spam?p.SPAM:p.INBOX;var pa={action_type:i.CHANGE_FOLDER,action_id:null,thread_id:oa,new_folder:na};s.handleUpdateWaitForThread({actions:[u({},pa)],payload_source:ma},oa);});}function ca(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj.tag)return;switch(la.obj.tag){case p.ACTION_ARCHIVED:aa(ka,la);break;case p.INBOX:case p.OTHER:ba(ka,la);break;}}function da(ka,la){if(ka!=h.getArbiterType('inbox')||!la.obj||!la.obj.seen_timestamp)return;s.handleUpdate({message_counts:[{seen_timestamp:la.obj.seen_timestamp,folder:p.INBOX}],unseen_thread_ids:[{thread_ids:[],folder:p.INBOX}],payload_source:l.CLIENT_CHANNEL_MESSAGE});}function ea(ka,la){if(ka!=h.getArbiterType('mercury')||!la.obj)return;t.synchronizeInforms(function(){var ma=la.obj,na=[];(ma.actions||[]).forEach(function(oa){var pa=i.USER_GENERATED_MESSAGE;if(oa.action_type==i.LOG_MESSAGE){var qa=l.CLIENT_CHANNEL_MESSAGE;s.handleUpdateWaitForThread({actions:[u({},oa)],payload_source:qa},oa.thread_id);}else if(oa.action_type!=pa)na.push(oa);});ma.actions=na;ma.payload_source=l.CLIENT_CHANNEL_MESSAGE;s.handleUpdate(ma);});}function fa(ka,la){s.handleRoger(la.obj);}function ga(ka,la){if(ka!=h.getArbiterType('messaging')||!la.obj||la.obj.mute_settings===undefined||!la.obj.thread_id)return;var ma=i.CHANGE_MUTE_SETTINGS,na=[{action_type:ma,action_id:null,thread_id:la.obj.thread_id,mute_settings:la.obj.mute_settings}];s.handleUpdate({actions:na,payload_source:l.CLIENT_CHANNEL_MESSAGE});}function ha(ka,la){switch(la.obj.event){case o.DELIVER:v(ka,la);break;case o.READ:case o.UNREAD:w(ka,la);break;case o.READ_ALL:z(ka,la);break;case o.DELETE:x(ka,la);break;case o.DELETE_MESSAGES:y(ka,la);break;case o.TAG:ca(ka,la);break;case o.REPORT_SPAM:ba(ka,la);break;case o.READ_RECEIPT:fa(ka,la);break;case o.CHANGE_MUTE_SETTINGS:ga(ka,la);break;}}var ia=[],ja={turnOn:function(){if(!ia.length){var ka={mercury:ea,messaging:ha,inbox:da};for(var la in ka)ia.push(g.subscribe(h.getArbiterType(la),ka[la]));}},turnOff:function(){if(ia.length){ia.forEach(g.unsubscribe);ia=[];}}};ja.turnOn();e.exports=ja;});
__d("MercuryStateCheck",["Arbiter","ChannelConstants","MercuryFolders","MessagingTag","MercuryServerRequests","URI","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('MercuryFolders'),j=b('MessagingTag'),k=b('MercuryServerRequests').get(),l=b('URI'),m=b('copyProperties'),n=m(new g(),{initialize:function(){g.subscribe(h.ON_INVALID_HISTORY,o);d(['ChannelConnection'],function(p){p.subscribe(p.CONNECTED,function(q,r){if(!r.init)o();});});}});function o(){var p;if(l.getRequestURI().getPath().search(/messages/)!==-1){p=i.getSupportedFolders();}else p=[j.INBOX];k.fetchMissedMessages(p);}n.initialize();e.exports=n;});
__d("ChatApp",["CSS","JSLogger"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('JSLogger'),i=null;function j(k,l,m){"use strict";if(i){h.create('chat_app').error('repeated_init');return;}i=this;this.$ChatApp0=k;d(['TabsViewport','ChatTabController','ChatTabViewCoordinator','MercuryServerRequests','MercuryChannelHandler','MercuryStateCheck'],function(n,o,p,q,r,s){q.get().handleUpdate(m);this.tabsViewport=new n(l);this.tabViewCoordinator=new p(l,this.tabsViewport);this.tabController=new o(this.tabsViewport,this.tabViewCoordinator);this.$ChatApp1=this.$ChatApp2=true;}.bind(this));}j.getInstance=function(){"use strict";return i;};j.hide=function(){"use strict";if(j.getInstance())j.getInstance().hide();};j.unhide=function(){"use strict";if(j.getInstance())j.getInstance().unhide();};j.prototype.isHidden=function(){"use strict";return this.$ChatApp3;};j.prototype.hide=function(){"use strict";if(!this.$ChatApp1||this.$ChatApp3)return;g.hide(this.$ChatApp0);this.$ChatApp3=true;};j.prototype.unhide=function(){"use strict";if(this.$ChatApp1){if(this.$ChatApp3){g.show(this.$ChatApp0);this.tabsViewport.checkWidth();d(['Dock'],function(k){k.resizeAllFlyouts();});this.$ChatApp3=false;}}else if(!this.$ChatApp2){d(['UIPagelet'],function(k){k.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');k.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});this.$ChatApp2=true;}};e.exports=j;});
__d("ChatOpenTab",["Arbiter","Banzai","Bootloader","ChatApp","ChatVisibility","ContextualThing","cx","Event","MercuryIDs","MercuryMessages","MercuryServerRequests","MercuryThreads","Parent"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Banzai'),i=b('Bootloader'),j=b('ChatApp'),k=b('ChatVisibility'),l=b('ContextualThing'),m=b('cx'),n=b('Event'),o=b('MercuryIDs'),p=b('MercuryMessages').get(),q=b('MercuryServerRequests').get(),r=b('MercuryThreads').get(),s=b('Parent'),t='messaging_tracking';function u(z){r.getThreadMeta(z,function(){g.inform('chat/open-tab',{thread_id:z});});}function v(z,aa,ba,ca){n.listen(z,'click',function(da){if(ca(aa,ba))return;return da.kill();});}function w(z,aa,ba){var ca={referrer:z||'',message_thread_id:aa,message_view:'chat',timestamp_send:Date.now()};if(ba!==undefined)ca.message_target_ids=[ba];h.post(t,ca,{delay:0,retry:true});}function x(z){var aa=l.getContext(z);return (aa&&s.byClass(aa,"_3qw")!==null);}var y={openEmptyTab:function(z,aa){if(!window.Chat||!k.isOnline()||!j.getInstance()||j.getInstance().isHidden())return true;i.loadModules(['ChatTabModel'],function(ba){var ca=ba.getEmptyTab();if(!ca){ca='root:'+p.generateNewClientMessageID(Date.now());r.createNewLocalThread(ca,[]);}u(ca);w(aa,ca);});},listenOpenEmptyTab:function(z,aa){v(z,null,aa,y.openEmptyTab);},openThread:function(z,aa){if(o.isValid(z)){u(z);}else q.getClientThreadID(z,u);w(aa,z);},listenOpenThread:function(z,aa,ba){v(z,aa,ba,y.openThread);},openUserTab:function(z,aa){var ba=r.getCanonicalThreadToUser(z);u(ba.thread_id);w(aa,ba.thread_id,z);},listenOpenUserTab:function(z,aa,ba){if(!x(z))v(z,aa,ba,y.openUserTab);}};e.exports=y;});
__d("Chat",["Arbiter","ChatTypeaheadConstants","MercuryParticipantTypes"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatTypeaheadConstants'),i=b('MercuryParticipantTypes');function j(o,p){d(['ChatImpressionLogger','PresenceStatus'],function(q,r){var s=p&&p.source;if(s&&s==='ordered_list'||s==='more_online_friends'||s==='online_friends'||s==='recent_threads_in_divebar_new'||s==='recent_threads_in_divebar'||s==='presence'||s==='typeahead'){p.viewport_width=document.body.clientWidth;p.target=o;p.target_presence=r.get(o);q.logImpressions(p);}});}var k={buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'};function l(o,p){g.subscribe(k[o],function(event,q){p(q);});}function m(){return (Math.random()*2147483648|0).toString(16);}var n={openTab:function(o,p,q){if(window.External&&window.External.Chat&&window.External.Chat.openWindow)window.External.Chat.openWindow(o);setTimeout(j.bind(null,o,q),0);d(['MercuryThreads'],function(r){if(!p||p===i.FRIEND||p===h.FRIEND_TYPE||p===h.USER_TYPE){var s=r.get().getCanonicalThreadToUser(o),t=m();g.inform('chat/open-tab',{thread_id:s.thread_id,signature_id:t});return;}if(p===h.THREAD_TYPE)d(['ChatOpenTab'],function(u){if(o){u.openThread(o);}else u.openEmptyTab();});});},openBuddyList:function(){l('buddyListNub',function(o){o.show();l('sidebar',function(p){p.enable();});});},closeBuddyList:function(){l('buddyListNub',function(o){o.hide();});},toggleSidebar:function(){l('sidebar',function(o){o.toggle();});},goOnline:function(o){d(['ChatVisibility'],function(p){p.goOnline(o);});},isOnline:function(){var o=null;d(['ChatVisibility'],function(p){o=p;});return o&&o.isOnline();}};a.Chat=e.exports=n;},3);
__d("DropdownContextualHelpLink",["DOM","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ge'),i={set:function(j){var k=h('navHelpCenter');if(k!==null)g.replace(k,j);}};e.exports=i;});
__d("Waiter",[],function(a,b,c,d,e,f){function g(h){"use strict";this.$Waiter0=h;this.$Waiter1=0;this.$Waiter2=false;}g.prototype.wait=function(h){"use strict";var i=this,j=false;this.$Waiter3();return function(){var k=Array.prototype.slice.call(arguments,0);if(j)return;h&&h.apply(this,k);i.$Waiter4();j=true;};};g.prototype.go=function(){"use strict";this.$Waiter2=true;this.$Waiter5();return this;};g.prototype.$Waiter3=function(){"use strict";this.$Waiter1++;};g.prototype.$Waiter5=function(){"use strict";if(!this.$Waiter1&&this.$Waiter2)this.$Waiter0();};g.prototype.$Waiter4=function(){"use strict";this.$Waiter1--;this.$Waiter5();};e.exports=g;});